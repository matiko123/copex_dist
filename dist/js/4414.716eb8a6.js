"use strict";(self["webpackChunkcork_vue3"]=self["webpackChunkcork_vue3"]||[]).push([[4414],{44414:function(a,e,l){l.r(e),l.d(e,{default:function(){return O}});var t=l(66252),o=l(3577),s=l(2262),i=l(49963),n=l(87066),d=l(56296),r=l(26212),c=l.n(r),u=l(42119);const m={class:"layout-px-spacing"},b=(0,t.uE)('<ul class="navbar-nav flex-row mt-2"><li><div class="page-header"><nav class="breadcrumb-one" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="javascript:;">Masters</a></li><li class="breadcrumb-item active" aria-current="page"><span> Budget Allocations </span></li></ol></nav></div></li></ul>',1),p={class:"text-center"},v={class:"mb-3"},g=(0,t._)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-arrow-left",viewBox:"0 0 16 16"},[(0,t._)("path",{"fill-rule":"evenodd",d:"M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"})],-1),_=(0,t.Uk)(" Back "),f=[g,_],h=["innerHTML"],w={key:1,class:"row layout-top-spacing"},y={class:"col-xl-12 col-lg-12 col-sm-12 layout-spacing"},k={class:"panel p-0"},x={class:"custom-table table3"},H={class:"d-flex justify-content-center align-items-center gap-2"},C=["onClick"],S=(0,t._)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"text-primary"},[(0,t._)("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),(0,t._)("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1),j=[S],M={class:"modal fade mymodal",id:"edit-allocation-modal","data-bs-backdrop":"false","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"editallocationModalLabel","aria-hidden":"true"},B={class:"modal-dialog modal-xl"},A={class:"modal-content"},U={class:"modal-header"},L=(0,t._)("h1",{class:"modal-title fs-5",id:"editallocationModalLabel"},"Edit Allocation",-1),N={class:"modal-body"},V={class:"row mb-3"},D={class:"col-md-6"},P=(0,t._)("label",{for:"budget"},"Budget",-1),q={class:"col-md-6"},z=(0,t._)("label",{for:"amount"},"Amount",-1),E={class:"col-md-12"},$=(0,t._)("label",{for:"project"},"Purpose",-1),T={class:"modal-footer"},I={type:"submit",class:"btn btn-primary"},R={key:0,class:"spinner-border spinner-border-sm text-white me-2",role:"status"},W=(0,t.Uk)(" Edit ");var F={setup(a){const e=(0,u.yj)();(0,d.j)({title:"Budget Allocations"});const l=(0,t.f3)("showMessage"),r=(0,t.f3)("showError"),g=(JSON.parse(localStorage.getItem("user")).permissions,(0,t.f3)("formatDate")),_=(0,t.f3)("tableShimmer"),S=((0,t.f3)("loadingSpinner"),(0,t.f3)("formatNumber")),F=(0,s.iH)(""),J=(0,s.iH)(""),O=(0,s.iH)(""),Y=(0,s.iH)(null),Z=(0,s.iH)(!1),G=(0,s.iH)(["SNo","budget","project","purpose","funded_amount","allocated_date","allocated_by","actions"]),K=(0,s.iH)({perPage:20,perPageValues:[20,50,100],skin:"table table-hover table-striped",columnsClasses:{actions:"actions text-center"},sortable:["SNo","name","short_name","status"],sortIcon:{base:"sort-icon-none",up:"sort-icon-asc",down:"sort-icon-desc"},pagination:{nav:"scroll",chunk:5},texts:{count:"Showing {from} to {to} of {count}",filter:"",filterPlaceholder:"Search...",limit:"Results:"},resizableColumns:!1}),Q=n.Z.create({baseURL:"https://bushman.ink/api/v1/"}),X=(0,s.iH)([]),aa=async()=>{Z.value=!0;try{const a=await Q.get(`budget-allocations?budget_id=${e.params.budget_id}`);X.value=a.data.map(((a,e)=>({SNo:e+1,id:a.id,budget_id:a.budget.id,budget:a.budget.name,purpose:a.description,project:a.budget.project.short_name,amount:a.amount,funded_amount:S(a.amount),allocated_date:g(a.date),allocated_by:a.issuer.name}))),a.data.length>0&&(Y.value=a.data[0].budget)}catch(a){r(a.message)}finally{Z.value=!1}},ea=(0,s.iH)([]),la=async()=>{try{const a=await Q.get("budgets");ea.value=a.data.map((a=>({id:a.id,name:a.name})))}catch(a){r(a.message)}},ta=a=>{O.value=ea.value.find((e=>e.id===a.budget_id))||"",F.value=a.purpose,J.value=a.amount},oa=async a=>{Z.value=!0;try{const e={budget_id:O.value.id,description:F.value,amount:J.value};await Q.put(`/budget-allocations/${a}`,e),l("Allocation updated successfully"),aa(),sa()}catch(e){r(e.message)}finally{Z.value=!1}},sa=()=>{O.value="",F.value="",J.value=""};return(0,t.YP)((()=>e.params.budget_id),(a=>{a&&aa()}),{immediate:!0}),(0,t.bv)((()=>{la()})),(a,e)=>{const l=(0,t.up)("v-client-table");return(0,t.wg)(),(0,t.iD)("div",m,[b,(0,t._)("h4",p,(0,o.zw)(Y.value?.name?`Budget Allocations for ${Y.value.name}`:"No Allocations Found for This Budget"),1),(0,t._)("div",v,[(0,t._)("button",{onClick:e[0]||(e[0]=e=>a.$router.back()),class:"btn btn-dark"},f)]),Z.value?((0,t.wg)(),(0,t.iD)("div",{key:0,innerHTML:(0,s.SU)(_)()},null,8,h)):((0,t.wg)(),(0,t.iD)("div",w,[(0,t._)("div",y,[(0,t._)("div",k,[(0,t._)("div",x,[(0,t.Wm)(l,{data:X.value,columns:G.value,options:K.value},{actions:(0,t.w5)((a=>[(0,t._)("div",H,[(0,t._)("a",{href:"javascript:;",class:"edit me-3",onClick:e=>ta(a.row),"data-bs-toggle":"modal","data-bs-target":"#edit-allocation-modal"},j,8,C)])])),_:1},8,["data","columns","options"])])])])])),(0,t._)("div",M,[(0,t._)("div",B,[(0,t._)("div",A,[(0,t._)("div",U,[L,(0,t._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:e[1]||(e[1]=a=>sa())})]),(0,t._)("form",{onSubmit:e[6]||(e[6]=(0,i.iM)((e=>oa(a.props.row.id)),["prevent"]))},[(0,t._)("div",N,[(0,t._)("div",V,[(0,t._)("div",D,[P,(0,t.Wm)((0,s.SU)(c()),{modelValue:O.value,"onUpdate:modelValue":e[2]||(e[2]=a=>O.value=a),options:ea.value,label:"name",placeholder:"Select Budget",searchable:!0,required:!0,"allow-empty":!1},null,8,["modelValue","options"])]),(0,t._)("div",q,[z,(0,t.wy)((0,t._)("input",{type:"number","onUpdate:modelValue":e[3]||(e[3]=a=>J.value=a),class:"form-control",placeholder:"name",required:""},null,512),[[i.nr,J.value]])]),(0,t._)("div",E,[$,(0,t.wy)((0,t._)("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=a=>F.value=a),class:"form-control",placeholder:"name",required:""},null,512),[[i.nr,F.value]])])])]),(0,t._)("div",T,[(0,t._)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal",onClick:e[5]||(e[5]=a=>sa()),id:"close_editing"},"Close"),(0,t._)("button",I,[Z.value?((0,t.wg)(),(0,t.iD)("span",R)):(0,t.kq)("",!0),W])])],32)])])])])}}};const J=F;var O=J}}]);
//# sourceMappingURL=4414.716eb8a6.js.map