"use strict";(self["webpackChunkcork_vue3"]=self["webpackChunkcork_vue3"]||[]).push([[24],{10024:function(a,e,t){t.r(e),t.d(e,{default:function(){return Ua}});t(26699);var s=t(66252),l=t(3577),n=t(2262),o=t(49963),i=t(87066),r=t(56296),c=t(26212),d=t.n(c),u=t(42119);const m={class:"layout-px-spacing"},v=(0,s.uE)('<ul class="navbar-nav flex-row mt-2"><li><div class="page-header"><nav class="breadcrumb-one" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item active" aria-current="page"><span>Jobcards</span></li></ol></nav></div></li></ul>',1),p={class:"offcanvas offcanvas-end","data-bs-scroll":"true",tabindex:"-1",id:"offcanvasWithBothOptions","aria-labelledby":"offcanvasWithBothOptionsLabel"},b=(0,s._)("div",{class:"offcanvas-header"},[(0,s._)("h5",{class:"offcanvas-title",id:"offcanvasWithBothOptionsLabel"},"COMPANIES LIST"),(0,s._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"offcanvas","aria-label":"Close"})],-1),_={class:"offcanvas-body"},h={class:"row"},g={class:"col-12"},y={class:"list-group",id:"list-tab",role:"tablist"},w=["id","href","aria-controls","onClick"],f={class:"offcanvas offcanvas-end","data-bs-scroll":"true",tabindex:"-1",id:"jobcardServices","aria-labelledby":"jobcardServicesLabel"},S=(0,s._)("div",{class:"offcanvas-header"},[(0,s._)("h5",{class:"offcanvas-title",id:"jobcardServicesLabel"},"SELECT A SERVICE"),(0,s._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"offcanvas","aria-label":"Close"})],-1),k={class:"offcanvas-body"},x={class:"row"},C={class:"col-12"},H={class:"list-group",id:"list-tab",role:"tablist"},U={class:"d-flex me-4 mt-2"},T={class:"ms-auto"},z=(0,s._)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"currentColor",class:"bi bi-plus-square",viewBox:"0 0 16 16"},[(0,s._)("path",{d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"}),(0,s._)("path",{d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"})],-1),E=[z],j={key:0,class:"spinner-border text-white mt-1",role:"status",style:{width:"1.5rem",height:"1.5rem"}},L=(0,s._)("span",{class:"sr-only"},"Loading...",-1),M=[L],D={key:1,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-printer me-1"},O=(0,s._)("polyline",{points:"6 9 6 2 18 2 18 9"},null,-1),A=(0,s._)("path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"},null,-1),R=(0,s._)("rect",{x:"6",y:"14",width:"12",height:"8"},null,-1),$=[O,A,R],N=(0,s._)("div",{class:"btn-group ms-2 me-4",role:"group","aria-label":"Filter Job Cards"},[(0,s._)("div",{class:"btn-group",role:"group","aria-label":"Filter Job Cards"})],-1),V=["onSubmit"],I=(0,s._)("h4",{class:"text-center"}," JOBCARD REGISTRATION",-1),J={class:"row mb-2"},P={class:"col-md-4"},q=(0,s._)("label",{class:"form-label"},"Company ",-1),B={class:"col-md-4"},K=(0,s._)("label",{class:"form-label"},"Service Type",-1),W=(0,s._)("option",{value:""},"Select a Service Type",-1),Y=["value"],F={class:"col-md-4"},G=(0,s._)("label",{class:"form-label"},"Current Km of Service",-1),X={class:"col-md-4"},Z=(0,s._)("label",{class:"form-label"},"Next Km of Service",-1),Q={class:"col-md-4"},aa=(0,s._)("label",{class:"form-label"},"Enter Date Created",-1),ea={class:"text-center gap-2 justify-content-end"},ta=(0,s._)("button",{type:"submit",class:"btn btn-primary"},"Register",-1),sa={class:"text-center mb-2"},la={key:0},na={class:"row layout-top-spacing"},oa={class:"layout-spacing col-xl-6 col-lg-6 col-sm-12"},ia={class:"text-center"},ra={class:"panel p-0"},ca={class:"custom-table table3"},da=["innerHTML"],ua=(0,s._)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"currentColor",class:"bi bi-eye",viewBox:"0 0 16 16"},[(0,s._)("path",{d:"M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8M1.173 8a13 13 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5s3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5s-3.879-1.168-5.168-2.457A13 13 0 0 1 1.172 8z"}),(0,s._)("path",{d:"M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5M4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0"})],-1),ma={class:"col-xl-6 col-lg-6 col-sm-12 layout-spacing overflow-auto",style:{height:"900px"}},va={class:"text-center"},pa={class:"panel p-0"},ba={class:"custom-table table3"},_a=["innerHTML"],ha={class:"text-center"},ga={class:"panel p-0"},ya={class:"custom-table table3"},wa=["innerHTML"],fa={class:"text-center"},Sa={class:"panel p-0"},ka={class:"custom-table table3"},xa=["innerHTML"];var Ca={setup(a){const e=JSON.parse(localStorage.getItem("user")).permissions,t=(0,u.yj)(),c=(0,n.iH)(""),z=(0,n.iH)(""),L=(0,n.iH)(""),O=(0,n.iH)(!0),A=(0,n.iH)(!1),R=(0,n.iH)(!1),Ca=(0,n.iH)([]),Ha=(0,s.f3)("showMessage"),Ua=(0,s.f3)("showError"),Ta=(0,s.f3)("formatNumber"),za=(0,s.f3)("tableShimmer");(0,r.j)({title:"Jobcard Lists"});const Ea=(0,n.iH)([]),ja=async a=>{R.value=!0;try{const e=await Ia.get(`/jobcard-summary?asset_id=${a}`);Ea.value=e.data,await(0,s.Y3)(),La()}catch(e){Ua(e.message),console.error("Error fetching jobcard summary:",e)}},La=()=>{const a=Ea.value||[];R.value=!1;const e=document.createElement("iframe");e.style.display="none",document.body.appendChild(e);const t=`\n<!DOCTYPE html>\n<html>\n<head>\n<title>Jobcard Summary</title>\n<style>\n  body { font-family: Arial, sans-serif; margin: 40px; font-size: 13px; }\n  .header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }\n  .logo { width: 150px; height: auto; }\n  .company-title { text-align: center; margin-top: 5px; }\n  .company-title h2 { margin: 5px 0; }\n  .reg-info { position: absolute; top: 40px; right: 40px; text-align: right; font-size: 10px; line-height: 1.4; font-weight: normal; }\n  table { width: 100%; border-collapse: collapse; margin-top: 20px; }\n  th, td { border: 1px solid #000; padding: 6px; text-align: center; }\n  th { background-color: #f8f8f8; }\n</style>\n</head>\n<body>\n\n<div class="header">\n  <img src="https://bushman.ink/copex.jpg" class="logo" />\n  <div class="reg-info">\n    TIN: 135-489-247<br>\n    VRN: 40-032826C\n  </div>\n</div>\n\n<div class="company-title">\n  <h2>COPEX CONTRACTORS CO.LTD</h2>\n  <div>Msamvu, P.O.BOX 678, Morogoro</div>\n  <div>Mobile: 0713 000 777, 0657 111 555</div>\n</div>\n\n\n<table>\n  <thead>\n    <tr>\n      <th>${Ga.value.category.name}</th>\n      <th>TYPE</th>\n    </tr>\n  </thead>\n  <tbody>\n      <tr>\n        <td>${Ga.value.name}</td>\n        <td>${Ga.value.type_name}</td>\n      </tr>\n  </tbody>\n</table>\n\n<h2 style="text-align:center; margin-top: 20px;">Jobcard Summary</h2>\n\n<table>\n  <thead>\n    <tr>\n      <th>SN</th>\n      <th>Jobcard NO</th>\n      <th>Date Created</th>\n      <th>Service Type</th>\n      <th>Current Km Service</th>\n      <th>Next Km Service</th>\n      <th>Status</th>\n      <th>Total Sum</th>\n    </tr>\n  </thead>\n  <tbody>\n    ${a.map(((a,e)=>`\n      <tr>\n        <td>${e+1}</td>\n        <td>${a.id}</td>\n        <td>${a.date_created}</td>\n        <td>${a.service_type}</td>\n        <td>${a.current_km_service}</td>\n        <td>${a.next_km_service}</td>\n        <td>${a.status_name}</td>\n        <td style="text-align:right">${parseFloat(a.total_sum).toLocaleString()}/=</td>\n      </tr>\n    `)).join("")}\n    <tr>\n      <td colspan="7" style="text-align:right"><strong>Grand Total</strong></td>\n      <td style="text-align:right"><strong>${a.reduce(((a,e)=>a+parseFloat(e.total_sum||0)),0).toLocaleString()}/=</strong></td>\n    </tr>\n  </tbody>\n</table>\n\n\n\n\n</body>\n</html>\n`,s=e.contentWindow.document;s.open(),s.write(t),s.close(),e.onload=()=>{e.contentWindow.focus(),e.contentWindow.print(),setTimeout((()=>{document.body.removeChild(e)}),1e3)}},Ma=(0,n.iH)(""),Da=a=>{Ma.value=a.toUpperCase()},Oa=(0,n.iH)(["Sno","card","name","date_created","service_type","current_km_of_service","next_km_of_service","status","actions"]),Aa=(0,n.iH)(["Sno","jobcard_id","service_type","spare","description","quantity","rate","amount"]),Ra=(0,n.iH)(["Sno","jobcard_id","service_type","tyre_no","quantity","rate","amount"]),$a=(0,n.iH)(["Sno","jobcard_id","service_type","description","quantity","rate","amount"]),Na=(0,n.iH)([]),Va=(0,n.iH)({perPage:50,perPageValues:[50,100,200,500,1e3],skin:"table table-hover table-striped",columnsClasses:{actions:"actions text-center"},sortable:["id","vehicle_no","date","service_type","current_service_kms","next_service_kms","status"],sortIcon:{base:"sort-icon-none",up:"sort-icon-asc",down:"sort-icon-desc"},pagination:{nav:"scroll",chunk:5},texts:{count:"Showing {from} to {to} of {count}",filter:"",filterPlaceholder:"Search...",limit:"Results:"},resizableColumns:!1}),Ia=i.Z.create({baseURL:"https://bushman.ink/api/v1/"}),Ja=(0,n.iH)("JOBCARDS"),Pa=async()=>{try{const a=await Ia.get(`job-card?asset_id=${t.params.asset_id}`);Na.value=a.data.map(((a,e)=>({...a,Sno:e+1,card:a.id,name:a.machine.name+" - "+a.machine.type_name,status:{key:a.status.name,class:a.status.color}}))),Za.value=Na.value}catch(a){}},qa=(0,n.iH)(""),Ba=()=>{A.value=!1,O.value=!0;const a={machine_id:t.params.asset_id,machine_name:"none",status_name:"Active",status_color:"primary",status_id:6,service_type:Ca.value.find((a=>a.id===c.value)).name,current_km_of_service:z.value,next_km_of_service:L.value,date_created:qa.value,company_id:Ya.value.id,issuer_id:JSON.parse(localStorage.getItem("user")).id};Ia.post("/job-card",a).then((a=>{Pa(),Ha("Jobcard registered successfully!"),O.value=!1})).catch((a=>{Ua(a.message),console.log(a),O.value=!1}))},Ka=()=>{O.value=!0,Ia.get("/service-type").then((a=>{Array.isArray(a.data)?Ca.value=a.data:console.error("Invalid response format")})).catch((a=>{console.error("Error fetching user data:",a.message)})).finally((()=>{O.value=!1}))},Wa=(0,n.iH)([]),Ya=(0,n.iH)(""),Fa=async()=>{const a=await Ia.get("companies");Wa.value=a.data},Ga=(0,n.iH)(""),Xa=async()=>{const a=await Ia.get(`machines/${t.params.asset_id}`);Ga.value=a.data},Za=(0,n.iH)([]);(0,s.YP)(Ya,(a=>{Za.value=a?Na.value.filter((e=>e.company_id===a.id)):Na.value}));const Qa=(0,n.iH)(""),ae=async()=>{const a=await Ia.get(`asset-expenses?asset_id=${t.params.asset_id}`);Qa.value=a.data};return(0,s.bv)((()=>{Fa(),Pa(),Xa(),Ka(),ae()})),(a,i)=>{const r=(0,s.up)("router-link"),u=(0,s.up)("v-client-table");return(0,s.wg)(),(0,s.iD)("div",m,[v,(0,s._)("div",p,[b,(0,s._)("div",_,[(0,s._)("div",h,[(0,s._)("div",g,[(0,s._)("div",y,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(Wa.value,(a=>((0,s.wg)(),(0,s.iD)("a",{key:a.id,class:"list-group-item list-group-item-action",id:"company-link-"+a.id,"data-bs-toggle":"list",href:"#company-"+a.id,role:"tab","aria-controls":"company-"+a.id,"data-bs-dismiss":"offcanvas",onClick:e=>Ya.value=a},(0,l.zw)(a.short_name),9,w)))),128)),(0,s._)("a",{class:"list-group-item list-group-item-action",id:"company-link-all","data-bs-toggle":"list",href:"#company-all",role:"tab","aria-controls":"company-all","data-bs-dismiss":"offcanvas",onClick:i[0]||(i[0]=a=>Ya.value="")},"ALL COMPANIES")])])])])]),(0,s._)("div",f,[S,(0,s._)("div",k,[(0,s._)("div",x,[(0,s._)("div",C,[(0,s._)("div",H,[(0,s._)("a",{class:"list-group-item list-group-item-action",id:"company-link-all","data-bs-toggle":"list",href:"#company-all",role:"tab","aria-controls":"company-all","data-bs-dismiss":"offcanvas",onClick:i[1]||(i[1]=a=>Da("tyres"))},"TYRES"),(0,s._)("a",{class:"list-group-item list-group-item-action",id:"company-link-all","data-bs-toggle":"list",href:"#company-all",role:"tab","aria-controls":"company-all","data-bs-dismiss":"offcanvas",onClick:i[2]||(i[2]=a=>Da("spares"))},"SPARES"),(0,s._)("a",{class:"list-group-item list-group-item-action",id:"company-link-all","data-bs-toggle":"list",href:"#company-all",role:"tab","aria-controls":"company-all","data-bs-dismiss":"offcanvas",onClick:i[3]||(i[3]=a=>Da("all"))},"ALL COSTS AND SERVICES")])])])])]),(0,s._)("div",U,[(0,s._)("div",T,[(0,n.SU)(e).includes("can_register_jobcard")?((0,s.wg)(),(0,s.iD)("button",{key:0,class:"me-2 btn btn-primary me-2",onClick:i[4]||(i[4]=a=>A.value=!A.value)},E)):(0,s.kq)("",!0),(0,n.SU)(e).includes("can_print_asset_jobcards")?((0,s.wg)(),(0,s.iD)("button",{key:1,class:"btn btn-success",onClick:i[5]||(i[5]=a=>ja((0,n.SU)(t).params.asset_id))},[R.value?((0,s.wg)(),(0,s.iD)("div",j,M)):((0,s.wg)(),(0,s.iD)("svg",D,$))])):(0,s.kq)("",!0),N])]),A.value?((0,s.wg)(),(0,s.iD)("form",{key:0,class:"mt-3 p-3 border rounded bg-white shadow",onSubmit:(0,o.iM)(Ba,["prevent"])},[I,(0,s._)("div",J,[(0,s._)("div",P,[q,(0,s.Wm)((0,n.SU)(d()),{modelValue:Ya.value,"onUpdate:modelValue":i[6]||(i[6]=a=>Ya.value=a),options:Wa.value,"close-on-select":!0,label:"name","value-prop":"id",placeholder:"Select Company",searchable:!0},null,8,["modelValue","options"])]),(0,s._)("div",B,[K,(0,s.wy)((0,s._)("select",{class:"form-select","onUpdate:modelValue":i[7]||(i[7]=a=>c.value=a),required:""},[W,((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(Ca.value,(a=>((0,s.wg)(),(0,s.iD)("option",{key:a.id,value:a.id},(0,l.zw)(a.name),9,Y)))),128))],512),[[o.bM,c.value]])]),(0,s._)("div",F,[G,(0,s.wy)((0,s._)("input",{type:"number",class:"form-control",placeholder:"Enter Current Km","onUpdate:modelValue":i[8]||(i[8]=a=>z.value=a)},null,512),[[o.nr,z.value]])]),(0,s._)("div",X,[Z,(0,s.wy)((0,s._)("input",{type:"number",class:"form-control",placeholder:"Enter Next Km","onUpdate:modelValue":i[9]||(i[9]=a=>L.value=a)},null,512),[[o.nr,L.value]])]),(0,s._)("div",Q,[aa,(0,s.wy)((0,s._)("input",{type:"date",class:"form-control",placeholder:"Enter Next Km","onUpdate:modelValue":i[10]||(i[10]=a=>qa.value=a)},null,512),[[o.nr,qa.value]])])]),(0,s._)("div",ea,[(0,s._)("button",{type:"button",class:"btn btn-danger me-3",onClick:i[11]||(i[11]=a=>A.value=!1)},"Cancel"),ta])],40,V)):(0,s.kq)("",!0),(0,s._)("div",sa,[(0,s._)("h4",null,[Ga.value?((0,s.wg)(),(0,s.iD)("span",la,(0,l.zw)(Ga.value.category.name)+" "+(0,l.zw)(Ga.value.name)+" - "+(0,l.zw)(Ga.value.type_name),1)):(0,s.kq)("",!0)])]),(0,s._)("div",na,[(0,s._)("div",oa,[(0,s._)("h3",ia,(0,l.zw)(Ja.value)+" "+(0,l.zw)((0,n.SU)(Ta)(Qa.value?.grand_total||0)),1),(0,s._)("div",ra,[(0,s._)("div",ca,[O.value?((0,s.wg)(),(0,s.iD)("div",{key:0,innerHTML:(0,n.SU)(za)()},null,8,da)):((0,s.wg)(),(0,s.j4)(u,{key:1,data:Za.value,columns:Oa.value,options:Va.value},{status:(0,s.w5)((a=>[(0,s._)("span",{class:(0,l.C_)(["badge inv-status","badge-"+a.row.status.class])},(0,l.zw)(a.row.status.key),3)])),actions:(0,s.w5)((a=>[(0,s.Wm)(r,{to:"/jobcard/"+a.row.id+"/"+a.row.machine_id,class:"text-primary"},{default:(0,s.w5)((()=>[ua])),_:2},1032,["to"])])),_:1},8,["data","columns","options"]))])])]),(0,s._)("div",ma,[(0,s._)("div",null,[(0,s._)("h3",va," TYRES "+(0,l.zw)((0,n.SU)(Ta)(Qa.value?.tyres?.total_amount||0)),1),(0,s._)("div",pa,[(0,s._)("div",ba,[O.value?((0,s.wg)(),(0,s.iD)("div",{key:0,innerHTML:(0,n.SU)(za)()},null,8,_a)):((0,s.wg)(),(0,s.j4)(u,{key:1,data:Qa.value.tyres.data,columns:Ra.value,options:Va.value},{Sno:(0,s.w5)((a=>[(0,s.Uk)((0,l.zw)(a.index++),1)])),rate:(0,s.w5)((a=>[(0,s.Uk)((0,l.zw)((0,n.SU)(Ta)(a.row.rate)),1)])),amount:(0,s.w5)((a=>[(0,s.Uk)((0,l.zw)((0,n.SU)(Ta)(a.row.amount)),1)])),_:1},8,["data","columns","options"]))])])]),(0,s._)("div",null,[(0,s._)("h3",ha," SPARES "+(0,l.zw)((0,n.SU)(Ta)(Qa.value?.item_usages?.total_amount||0)),1),(0,s._)("div",ga,[(0,s._)("div",ya,[O.value?((0,s.wg)(),(0,s.iD)("div",{key:0,innerHTML:(0,n.SU)(za)()},null,8,wa)):((0,s.wg)(),(0,s.j4)(u,{key:1,data:Qa.value.item_usages.data,columns:Aa.value,options:Va.value},{Sno:(0,s.w5)((a=>[(0,s.Uk)((0,l.zw)(a.index++),1)])),rate:(0,s.w5)((a=>[(0,s.Uk)((0,l.zw)((0,n.SU)(Ta)(a.row.rate)),1)])),amount:(0,s.w5)((a=>[(0,s.Uk)((0,l.zw)((0,n.SU)(Ta)(a.row.amount)),1)])),_:1},8,["data","columns","options"]))])])]),(0,s._)("div",null,[(0,s._)("h3",fa," OTHER COSTS "+(0,l.zw)((0,n.SU)(Ta)(Qa.value?.cost_notes?.total_amount||0)),1),(0,s._)("div",Sa,[(0,s._)("div",ka,[O.value?((0,s.wg)(),(0,s.iD)("div",{key:0,innerHTML:(0,n.SU)(za)()},null,8,xa)):((0,s.wg)(),(0,s.j4)(u,{key:1,data:Qa.value.cost_notes.data,columns:$a.value,options:Va.value},{Sno:(0,s.w5)((a=>[(0,s.Uk)((0,l.zw)(a.index++),1)])),rate:(0,s.w5)((a=>[(0,s.Uk)((0,l.zw)((0,n.SU)(Ta)(a.row.rate)),1)])),amount:(0,s.w5)((a=>[(0,s.Uk)((0,l.zw)((0,n.SU)(Ta)(a.row.amount)),1)])),_:1},8,["data","columns","options"]))])])])])])])}}};const Ha=Ca;var Ua=Ha}}]);
//# sourceMappingURL=24.cd240f46.js.map