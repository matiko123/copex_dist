"use strict";(self["webpackChunkcork_vue3"]=self["webpackChunkcork_vue3"]||[]).push([[4141],{84141:function(a,e,t){t.r(e),t.d(e,{default:function(){return Z}});var l=t(66252),s=t(3577),o=t(49963),n=t(2262),r=t(87066),i=t(56296),u=t(26212),c=t.n(u);const d={class:"layout-px-spacing"},m=(0,l.uE)('<ul class="navbar-nav flex-row mt-2"><li><div class="page-header"><nav class="breadcrumb-one" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="javascript:;">Masters</a></li><li class="breadcrumb-item active" aria-current="page"><span>Services</span></li></ol></nav></div></li></ul>',1),v={class:"text-center"},p={class:"d-flex me-4 mt-2 align-items-center flex-wrap"},b=(0,l._)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"26",height:"26",fill:"currentColor",class:"bi bi-printer",viewBox:"0 0 16 16"},[(0,l._)("path",{d:"M2.5 8a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1"}),(0,l._)("path",{d:"M5 1a2 2 0 0 0-2 2v2H2a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h1v1a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-1h1a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-1V3a2 2 0 0 0-2-2zM4 3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v2H4zm1 5a2 2 0 0 0-2 2v1H2a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v-1a2 2 0 0 0-2-2zm7 2v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1"})],-1),_=[b],y=["disabled"],h={class:"row layout-top-spacing"},g={class:"col-xl-12 col-lg-12 col-sm-12 layout-spacing"},w={class:"panel p-0"},f={class:"custom-table table3"},k=["innerHTML"],S=["value"],x={class:"modal fade mymodal",id:"payment-request-modal","data-bs-backdrop":"false","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"paymentRequestModalLabel","aria-hidden":"true"},H={class:"modal-dialog modal-xl"},q={class:"modal-content"},C={class:"modal-header"},j=(0,l._)("h1",{class:"modal-title fs-5",id:"paymentRequestModalLabel"},"Create Payment Request",-1),U={class:"modal-body"},D={class:"row mb-3"},M={class:"col-md-6 my-2"},V=(0,l._)("b",null,"Selected labours:",-1),z={class:"col-md-6 my-2"},P=(0,l._)("b",null,"Total Amount:",-1),R={class:"col-md-12"},E=(0,l._)("label",{class:"form-label"},"Summary Description",-1),I=(0,l._)("div",{class:"col-md-12"},[(0,l._)("hr")],-1),L={class:"col-md-12"},A={class:"panel p-0"},O={class:"custom-table"},T={class:"modal-footer"},N=["disabled"],B={key:0,class:"spinner-border spinner-border-sm text-white me-2",role:"status"},F=(0,l.Uk)(" submit ");var J={setup(a){(0,i.j)({title:"Labour Attendance"});const e=r.Z.create({baseURL:"https://bushman.ink/api/v1/"}),t=(0,n.iH)(!1),u=(0,l.Fl)((()=>({count:$.value.length,total:$.value.reduce(((a,e)=>a+Number(e.rate_original)),0)}))),b=()=>{$.value.length===la.value.length?$.value=[]:$.value=[...la.value]},J=(0,n.iH)(""),W=()=>{console.log($.value)},Z=(0,l.f3)("showMessage"),G=(0,l.f3)("showError"),K=((0,l.f3)("waitIndicator"),(0,l.f3)("printEmployees"),(0,l.f3)("showConfirmation"),(0,l.f3)("formatNumber")),Q=(0,l.f3)("formatDate"),X=(0,l.f3)("tableShimmer"),Y=((0,n.iH)(""),(0,n.iH)(!1)),$=(0,n.iH)([]),aa=(0,n.iH)(["Sno","full_name","type","rate","project","supervisor","task","status","date","actions"]),ea=(0,n.iH)(["Sno","full_name","type","rate","project","task","date"]),ta=(0,n.iH)({perPage:20,perPageValues:[20,50,100],skin:"table table-hover table-striped",columnsClasses:{actions:"actions text-center"},sortable:["id","service_name"],sortIcon:{base:"sort-icon-none",up:"sort-icon-asc",down:"sort-icon-desc"},pagination:{nav:"scroll",chunk:5},texts:{count:"Showing {from} to {to} of {count}",filter:"",filterPlaceholder:"Search...",limit:"Results:"},resizableColumns:!1}),la=(0,n.iH)([]),sa=((0,n.iH)((new Date).toISOString().slice(0,10)),(0,n.iH)((new Date).toISOString().slice(0,10))),oa=(0,n.iH)((new Date).toISOString().slice(0,10)),na=async()=>{Y.value=!0;try{const a={start_date:sa.value,end_date:oa.value};ia.value?.short_name&&(a.project_id=ia.value.id);const t=await e.get("labour-attendants",{params:a});la.value=t.data.map(((a,e)=>({...a,Sno:e+1,full_name:a.labour_name,type:a.labour_type?.name,rate:K(a.labour_type?.rate),rate_original:a.labour_type?.rate,project:a.project?.short_name,supervisor:a.registrar?.name,date:Q(a.created_at)})))}catch(a){G(a.message)}finally{Y.value=!1}},ra=(0,n.iH)([""]),ia=(0,n.iH)(),ua=async()=>{try{const a=await e.get("projects");ra.value=a.data}catch(a){G(a.message),console.log(a)}},ca=(0,n.iH)(!1),da=async()=>{if(ia.value){ca.value=!0;try{const a=await e.get("labour-payment-requests",{params:{project_id:ia.value.id}}),t=a.data,l=t.some((a=>a.start_date===sa.value&&a.end_date===oa.value));if(l)return void G("A payment request already exists for this project and date range.");const s={project_id:ia.value.id,start_date:sa.value,end_date:oa.value,issuer_id:JSON.parse(localStorage.getItem("user")).id,description:J.value,labours:$.value.map((a=>({attendance_id:a.id,labour_id:a.labour_id,quantity:a.rate_original})))};await e.post("labour-payment-requests",s),Z("Payment request created successfully"),document.getElementById("close_payment_request").click()}catch(a){console.log(a),G(a.message)}finally{ca.value=!1}}else G("Please select a project")},ma=()=>{$.value=[],J.value="",t.value=!1};return(0,l.bv)((()=>{na(),ua()})),(a,e)=>{const r=(0,l.up)("v-client-table");return(0,l.wg)(),(0,l.iD)("div",d,[m,(0,l._)("h3",v,"SITE LABOUR ATTENDANCE FROM "+(0,s.zw)(sa.value)+" TO "+(0,s.zw)(oa.value),1),(0,l._)("div",p,[(0,l._)("button",{class:"btn btn-success me-2",onClick:e[0]||(e[0]=e=>a.printLabourAttendance(la.value))},_),(0,l.wy)((0,l._)("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=a=>sa.value=a),class:"form-control me-2",style:{"max-width":"180px"}},null,512),[[o.nr,sa.value]]),(0,l.wy)((0,l._)("input",{type:"date","onUpdate:modelValue":e[2]||(e[2]=a=>oa.value=a),class:"form-control me-2",style:{"max-width":"180px"}},null,512),[[o.nr,oa.value]]),(0,l.Wm)((0,n.SU)(c()),{modelValue:ia.value,"onUpdate:modelValue":e[3]||(e[3]=a=>ia.value=a),options:ra.value,label:"short_name",placeholder:"Select Project",searchable:!0,"allow-empty":!1,class:"me-2",style:{"min-width":"200px","max-width":"300px"}},null,8,["modelValue","options"]),(0,l._)("button",{class:"btn btn-primary me-2",onClick:e[4]||(e[4]=a=>na())},"Search"),t.value?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("button",{key:0,class:"btn btn-primary me-2",onClick:e[5]||(e[5]=a=>t.value=!t.value)}," Create Payment Request ")),t.value?((0,l.wg)(),(0,l.iD)("button",{key:1,class:"btn btn-success flex-shrink-0",onClick:W,disabled:0===$.value.length,"data-bs-toggle":"modal","data-bs-target":"#payment-request-modal"}," Request Payment ",8,y)):(0,l.kq)("",!0),t.value?((0,l.wg)(),(0,l.iD)("button",{key:2,class:"btn btn-secondary ms-2",onClick:b},(0,s.zw)($.value.length===la.value.length?"❌":"✔"),1)):(0,l.kq)("",!0)]),(0,l._)("div",h,[(0,l._)("div",g,[(0,l._)("div",w,[(0,l._)("div",f,[Y.value?((0,l.wg)(),(0,l.iD)("div",{key:0,innerHTML:(0,n.SU)(X)()},null,8,k)):((0,l.wg)(),(0,l.j4)(r,{key:1,data:la.value,columns:aa.value,options:ta.value},{status:(0,l.w5)((a=>[(0,l._)("span",{class:(0,s.C_)(["badge inv-status","badge-"+a.row.status.color])},(0,s.zw)(a.row.status.name),3)])),actions:(0,l.w5)((a=>[t.value?(0,l.wy)(((0,l.wg)(),(0,l.iD)("input",{key:0,type:"checkbox",value:a.row,"onUpdate:modelValue":e[6]||(e[6]=a=>$.value=a)},null,8,S)),[[o.e8,$.value]]):(0,l.kq)("",!0)])),_:1},8,["data","columns","options"]))])])])]),(0,l._)("div",x,[(0,l._)("div",H,[(0,l._)("div",q,[(0,l._)("div",C,[j,(0,l._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:e[7]||(e[7]=a=>ma())})]),(0,l._)("form",{onSubmit:e[10]||(e[10]=(0,o.iM)((a=>da()),["prevent"]))},[(0,l._)("div",U,[(0,l._)("div",D,[(0,l._)("div",M,[(0,l._)("p",null,[V,(0,l.Uk)(" "+(0,s.zw)((0,n.SU)(u)?.count),1)])]),(0,l._)("div",z,[(0,l._)("p",null,[P,(0,l.Uk)(" "+(0,s.zw)((0,n.SU)(K)((0,n.SU)(u)?.total)),1)])]),(0,l._)("div",R,[E,(0,l.wy)((0,l._)("input",{type:"text","onUpdate:modelValue":e[8]||(e[8]=a=>J.value=a),class:"form-control",placeholder:"Enter summary description"},null,512),[[o.nr,J.value]])]),I,(0,l._)("div",L,[(0,l._)("div",A,[(0,l._)("div",O,[$.value.length>0?((0,l.wg)(),(0,l.j4)(r,{key:0,data:$.value,columns:ea.value,options:ta.value},null,8,["data","columns","options"])):(0,l.kq)("",!0)])])])])]),(0,l._)("div",T,[(0,l._)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal",onClick:e[9]||(e[9]=a=>ma()),id:"close_payment_request"},"Close"),(0,l._)("button",{type:"submit",class:"btn btn-primary",disabled:ca.value},[ca.value?((0,l.wg)(),(0,l.iD)("span",B)):(0,l.kq)("",!0),F],8,N)])],32)])])])])}}};const W=J;var Z=W}}]);
//# sourceMappingURL=4141.1bc89d7e.js.map