"use strict";(self["webpackChunkcork_vue3"]=self["webpackChunkcork_vue3"]||[]).push([[1764],{11764:function(e,t,a){a.r(t),a.d(t,{default:function(){return Qt}});a(26699);var l=a(66252),n=a(2262),o=a(3577),s=a(49963),r=a(87066),i=a(56296),d=a(26212),c=a.n(d);const u={class:"layout-px-spacing"},p=(0,l.uE)('<ul class="navbar-nav flex-row mt-2"><li><div class="page-header"><nav class="breadcrumb-one" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="javascript:;">Labours</a></li><li class="breadcrumb-item active" aria-current="page"><span> Labour Payment Requests </span></li></ol></nav></div></li></ul><h3 class="text-center">LABOUR PAYMENT REQUESTS</h3>',2),m={key:0,class:"d-flex justify-content-end mb-3"},b=(0,l._)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-plus-square",viewBox:"0 0 16 16"},[(0,l._)("path",{d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"}),(0,l._)("path",{d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"})],-1),v=["innerHTML"],_={key:2,class:"row layout-top-spacing"},h={class:"col-xl-12 col-lg-12 col-sm-12 layout-spacing"},g={class:"panel p-0"},y={class:"custom-table table3"},w=["onClick"],f=(0,l._)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-eye"},[(0,l._)("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),(0,l._)("circle",{cx:"12",cy:"12",r:"3"})],-1),k=[f],x=["onClick"],D=(0,l._)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-printer text-success"},[(0,l._)("polyline",{points:"6 9 6 2 18 2 18 9"}),(0,l._)("path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"}),(0,l._)("rect",{x:"6",y:"14",width:"12",height:"8"})],-1),S=[D],C={class:"modal fade mymodal",id:"payment-request-modal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true","data-bs-backdrop":"false",ref:"approvalModal"},N={class:"modal-dialog modal-fullscreen",role:"document"},T={class:"modal-content"},A={class:"modal-header"},H=(0,l._)("h5",{class:"modal-title",id:"exampleModalLabel"},"Labour Payment Request ",-1),R={class:"col-xl-12 col-lg-12 col-sm-12 layout-spacing"},O={class:"panel p-0"},U={class:"custom-table table3 table-responsive"},$={class:"table table-bordered table-striped"},E=(0,l._)("thead",null,[(0,l._)("tr",null,[(0,l._)("th",null,"Ref No."),(0,l._)("th",null,"Requester"),(0,l._)("th",null,"Requested"),(0,l._)("th",null,"Approval Group"),(0,l._)("th",null,"Start Date"),(0,l._)("th",null,"End Date"),(0,l._)("th",null,"project"),(0,l._)("th",null,"Print")])],-1),L=(0,l._)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-printer text-success"},[(0,l._)("polyline",{points:"6 9 6 2 18 2 18 9"}),(0,l._)("path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"}),(0,l._)("rect",{x:"6",y:"14",width:"12",height:"8"})],-1),j=[L],z={key:0},q={colspan:"8"},M=(0,l._)("b",null," Brief Description : ",-1),P={key:0},F={colspan:"8"},B=(0,l._)("b",null," Remark : ",-1),I={class:"modal-body"},Y={key:0,class:"d-flex justify-content-center mt-2 mb-2"},W=["disabled"],V=["innerHTML"],K={key:1},X={class:"input-group container"},J=["disabled"],Q=["innerHTML"],G={key:1},Z={key:2,class:"d-flex justify-content-center mb-2"},ee={class:"btn-group"},te=["disabled"],ae=["disabled"],le=["disabled"],ne=["disabled"],oe={key:3,class:"mb-2 text-center"},se={key:4,class:"input-group"},re=["placeholder"],ie=["disabled"],de=["innerHTML"],ce={key:1},ue={class:"custom-table table3 table-responsive"},pe={class:"table"},me=(0,l._)("br",null,null,-1),be=(0,l._)("br",null,null,-1),ve={key:0,class:"text-dark"},_e=(0,l._)("br",null,null,-1),he={key:1,class:"text-dark"},ge={class:"panel p-0 mt-3"},ye=(0,l._)("h5",{class:"text-center mt-3"},"LABOUR PAYMENTS",-1),we={class:"custom-table table3 table-responsive"},fe={class:"table table-bordered table-striped"},ke=(0,l._)("th",null,"No.",-1),xe=(0,l._)("th",null,"Labour Name",-1),De=(0,l._)("th",null,"Labour Type",-1),Se=(0,l._)("th",null,"phone number",-1),Ce=(0,l._)("th",{class:"text-right"},"No. Days Rate",-1),Ne=(0,l._)("th",{class:"text-right"},"Rate",-1),Te=(0,l._)("th",{class:"text-right"},"Total",-1),Ae=(0,l._)("th",{class:"text-right"},"action",-1),He={class:"text-right"},Re={class:"text-right"},Oe={class:"text-right"},Ue=["onClick"],$e={style:{"background-color":"#f0f0f0"}},Ee=(0,l._)("td",{colspan:"4",class:"text-right"},[(0,l._)("strong",null,"TOTAL:")],-1),Le=(0,l._)("td",null,null,-1),je=(0,l._)("td",null,null,-1),ze={class:"text-right"},qe=(0,l._)("td",null,null,-1),Me={class:"panel p-0 mt-3"},Pe={class:"d-flex justify-content-center align-items-center mt-3 mb-2 px-3 position-relative"},Fe=(0,l._)("h5",{class:"mb-0"},"LABOUR ATTENDANCE AND SITE WORKS",-1),Be=(0,l._)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-printer text-success"},[(0,l._)("polyline",{points:"6 9 6 2 18 2 18 9"}),(0,l._)("path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"}),(0,l._)("rect",{x:"6",y:"14",width:"12",height:"8"})],-1),Ie=[Be],Ye={class:"custom-table table3"},We={key:5,class:"row layout-top-spacing"},Ve=(0,l._)("h4",{class:"text-center"},"PROOF OF PAYMENT",-1),Ke={class:"col-xl-12 col-lg-12 col-sm-12 layout-spacing"},Xe={class:"panel p-0"},Je={class:"custom-table table3"},Qe=["href","onClick"],Ge={key:6,class:"row layout-top-spacing"},Ze=(0,l._)("h4",{class:"text-center"},"LABOUR DEBTS",-1),et={class:"col-xl-12 col-lg-12 col-sm-12 layout-spacing"},tt={class:"panel p-0"},at={class:"custom-table table3"},lt={class:"modal-footer"},nt={class:"modal fade mymodal",id:"payment-proof","data-bs-backdrop":"false","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true"},ot={class:"modal-dialog modal-fullscreen"},st={class:"modal-content"},rt={class:"modal-header"},it={class:"modal-title fs-5",id:"staticBackdropLabel"},dt={class:"modal-body"},ct={class:"panel p-0 mt-3"},ut=(0,l._)("h5",{class:"text-center mt-3"},"LABOUR PAYMENT DETAILS",-1),pt={class:"custom-table table3"},mt={class:"table table-bordered table-striped"},bt=(0,l._)("th",null,"No.",-1),vt=(0,l._)("th",null,"Labour Name",-1),_t=(0,l._)("th",null,"Labour Type",-1),ht=(0,l._)("th",{class:"text-right"},"No. Days Rate",-1),gt=(0,l._)("th",{class:"text-right"},"Rate",-1),yt=(0,l._)("th",{class:"text-right"},"Total",-1),wt=["innerHTML"],ft={style:{"background-color":"#f0f0f0"}},kt=(0,l._)("td",{colspan:"3",class:"text-right"},[(0,l._)("strong",null,"TOTAL:")],-1),xt={class:"text-right"},Dt=(0,l._)("td",null,null,-1),St={class:"text-right"},Ct={class:"row layout-top-spacing"},Nt={class:"col-xl-12 col-lg-12 col-sm-12 layout-spacing"},Tt={class:"panel p-0"},At={class:"custom-table table3"},Ht={class:"row"},Rt={class:"col-md-6"},Ot=(0,l._)("label",{class:"form-label"},"Reference Number ",-1),Ut={class:"col-md-6"},$t=(0,l._)("label",{class:"form-label"},"Paid From ",-1),Et={class:"col-md-3"},Lt=(0,l._)("label",{class:"form-label"},"Amount",-1),jt={class:"col-md-4"},zt=(0,l._)("label",{class:"form-label"},"Receiver",-1),qt={class:"col-md-2"},Mt=(0,l._)("label",{class:"form-label"},"Date ",-1),Pt={class:"col-md-3"},Ft=(0,l._)("label",{class:"form-label"},"Attachment ",-1),Bt={class:"col-md-12"},It=(0,l._)("label",{class:"form-label"},"Remark",-1),Yt={class:"modal-footer"},Wt=["disabled"],Vt=["innerHTML"],Kt={key:1};var Xt={setup(e){(0,i.j)({title:"Labour Payment Requests"});const t=(0,l.f3)("showMessage"),a=(0,l.f3)("showError"),d=JSON.parse(localStorage.getItem("user")).permissions,f=(0,n.iH)(JSON.parse(localStorage.getItem("user")).role),D=(0,n.iH)(JSON.parse(localStorage.getItem("user")).id),L=(0,l.f3)("formatDate"),Be=(0,l.f3)("formatNumber"),Xt=(0,l.f3)("tableShimmer"),Jt=(0,l.f3)("loadingSpinner"),Qt=(0,n.iH)(!1),Gt=(0,n.iH)(!1),Zt=(0,n.iH)(["Sno","ref_no","issuer","host","amount","direction","target_account","attachment","date"]),ea=(0,n.iH)(["SNo","project","start_date","end_date","approval_group","issuer","description","awaits","status","actions"]),ta=((0,n.iH)(""),(0,n.iH)(""),(0,n.iH)([]),(0,n.iH)([])),aa=(0,n.iH)(""),la=(0,n.iH)({perPage:20,perPageValues:[20,50,100],skin:"table table-hover table-striped",columnsClasses:{actions:"actions text-center"},sortable:["SNo","name","short_name","status"],sortIcon:{base:"sort-icon-none",up:"sort-icon-asc",down:"sort-icon-desc"},pagination:{nav:"scroll",chunk:5},texts:{count:"Showing {from} to {to} of {count}",filter:"",filterPlaceholder:"Search...",limit:"Results:"},resizableColumns:!1}),na=r.Z.create({baseURL:"https://bushman.ink/api/v1/"}),oa=(0,l.Fl)((()=>ia.value?.roles_sequence??[])),sa=e=>{if(!e)return"";const t=new Date(e);if(isNaN(t.getTime()))return e;const a=String(t.getDate()).padStart(2,"0"),l=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getFullYear()).slice(-2);return`${a}.${l}.${n}`},ra=async()=>{Gt.value=!0;try{const e=await na.get("labour-payment-requests");ta.value=e.data.map(((e,t)=>({...e,SNo:t+1,id:e.id,date:L(e.created_at),awaits:e.awaiting_approval?.name||"no one",project:e.project.short_name,issuer:e.issuer.name,approval_group:e.approval_group.name,start_date:e.start_date,end_date:e.end_date,status:{key:e.status.name,class:e.status.color}})))}catch(e){console.log(e),a(e.message)}finally{Gt.value=!1}},ia=(0,n.iH)(null),da=(0,n.iH)([]),ca=(0,n.iH)(null),ua=(0,n.iH)(""),pa=e=>{console.log(e),ia.value=e,aa.value=e.awaitingApproval,da.value=e.items.map(((e,t)=>({SNo:t+1,labour:e.attendance.labour,labour_name:e.attendance.labour_name,labour_type:e.attendance.labour_type.name,phone_number:e.attendance.labour?.phone_no,task:e.attendance.task,rate:Be(e.attendance.labour_type.rate),date:e.attendance.created_at,attendance_date:L(e.attendance.created_at),labour_debt:e.attendance.labour?.labour_debt||[]}))),Pa()},ma=()=>{ia.value=null,da.value=[],ca.value=null,ua.value=""},ba=(0,n.iH)(["SNo","labour_name","labour_type","task","rate","attendance_date"]),va=(0,n.iH)(!1),_a=async()=>{try{va.value=!0;const e={labour_payment_request_id:ia.value.id,approval_role_id:f.value,status_id:ca.value,remark:ua.value};await na.post("labour-payment-approval-chains",e),t(3===ca.value?"Request Approved":4===ca.value?"Request Rejected":14===ca.value?"Request Remarked":17===ca.value?"Request On Hold":"Action Recorded"),ra(),ca.value=null,ua.value="",document.getElementById("close-approval-modal").click()}catch(e){console.log(e),a(e.message)}finally{va.value=!1}},ha=async()=>{try{const e=document.createElement("iframe");e.style.display="none",document.body.appendChild(e);const t=new Date(ia.value?.start_date),a=new Date(ia.value?.end_date),l=[],n=[];let o=new Date(t);while(o<=a){const e=sa(o),t=o.toISOString().split("T")[0];l.push(e),n.push(t),o.setDate(o.getDate()+1)}const s={};da.value.forEach((e=>{s[e.labour_name]||(s[e.labour_name]={labour_name:e.labour_name,labour_type:e.labour_type,phone_number:e.phone_number,rate:e.rate,attendance:{}});const t=new Date(e.date),a=t.toISOString().split("T")[0],o=sa(t),r=n.findIndex((e=>e===a||sa(new Date(e))===o));if(-1!==r){const t=l[r];s[e.labour_name].attendance[t]=1}}));const r={};l.forEach((e=>{r[e]=Object.values(s).reduce(((t,a)=>t+(a.attendance[e]||0)),0)}));const i=Object.values(s).map(((e,t)=>{const a=l.map((t=>{const a=e.attendance[t]||0;return`<td class="text-center">${a}</td>`})).join(""),n=Object.values(e.attendance).reduce(((e,t)=>e+t),0),o="string"===typeof e.rate?parseFloat(e.rate.replace(/,/g,"")):e.rate,s=n*(isNaN(o)?0:o);return`\n  <tr>\n    <td>${t+1}</td>\n    <td>${e.labour_name||"N/A"}</td>\n    <td>${e.labour_type||"N/A"}</td>\n    <td>${e.phone_number||"--"}</td>\n    ${a}\n    <td class="text-right">${n}</td> \n    <td class="text-right">${e.rate||"0"}</td>\n    <td class="text-right">${Be(s)}</td>\n  </tr>\n  `})),d=l.map((e=>`<td class="text-center"><strong>${r[e]}</strong></td>`)).join(""),c=Object.values(s).reduce(((e,t)=>{const a=Object.values(t.attendance).reduce(((e,t)=>e+t),0),l="string"===typeof t.rate?parseFloat(t.rate.replace(/,/g,"")):t.rate;return e+a*(isNaN(l)?0:l)}),0),u=`\n<!DOCTYPE html>\n<html>\n<head>\n<title>Labour Payment Request Report</title>\n<style>\n  body { font-family: 'Courier New', monospace; margin: 40px; font-size: 13px; }\n  .text-style { font-family: 'Courier New', monospace; }\n  .company-title { text-align: center; }\n  .title { text-align: center; font-size: 16px; margin: 10px 0; white-space: nowrap; }\n  .info-section { margin: 20px 0; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }\n  .info-row { margin: 5px 0; }\n  .description { margin: 20px 0; padding: 10px; text-align: justify; }\n  table { width: 100%; border-collapse: collapse; margin-top: 10px; }\n  th, td { border: 0.5px solid #000; padding: 6px; }\n  th { background-color: #f8f8f8; font-weight: bold; }\n  .text-right { text-align: right; }\n  .text-center { text-align: center; }\n  .text-success { color: green; }\n  .text-danger { color: red; }\n  hr { border: 0; border-top: 0.5px solid #000; margin: 0px 0; }\n  @media print { body { margin: 10mm; } }\n</style>\n</head>\n<body>\n\n<div class="company-title text-style">\n  <i>\n  <h1>COPEX CONTRACTORS CO.LTD</h1>\n  <div><b>Address:</b> Msamvu, P.O.BOX 678, Morogoro</div>\n  <div><b>Tel:</b> 0713 000 777, 0657 111 555</div>\n  <div><b>Email:</b> info@copexcontractors.co.tz</div>\n  <div><b>TIN:</b> 135-489-247 &nbsp;&nbsp; <b>VRN:</b> 40-032826C</div>\n  </i>\n</div>\n\n<hr style="margin-top:20px">\n\n<div class="title text-style">\n  LABOUR PAYMENT REQUEST (${ia.value?.start_date||"--"} to ${ia.value?.end_date||"--"}) - ${ia.value?.project||"N/A"}\n</div>\n\n<hr>\n\n<table>\n  <thead>\n    <tr>\n      <th>No.</th>\n      <th>Labour Name</th>\n      <th>Labour Type</th>\n      <th>Phone Number</th>\n      ${l.map((e=>`<th>${e}</th>`)).join("")}\n      <th class="text-right">Days Rate</th>\n      <th class="text-right">Rate</th>\n      <th class="text-right">Total</th>\n    </tr>\n  </thead>\n  <tbody>\n    ${i.join("")}\n    <tr style="background-color: #f0f0f0;">\n      <td colspan="4" class="text-right"><strong>TOTAL:</strong></td>\n      ${d}\n      <td colspan="2"></td>\n      <td class="text-right"><strong>${Be(c)}</strong></td>\n    </tr>\n  </tbody>\n</table>\n\n${ia.value?.description?`\n<div class="description">\n  <p><strong>Note:</strong> ${ia.value.description}</p>\n</div>\n`:""}\n\n<h3 class="text-center">APPROVAL CHAIN</h3>\n<table class="signatures" style="margin-top: 10px;">\n  <tbody>\n    <tr>\n      ${ia.value?.roles_sequence?.map((e=>`\n      <td style="border-bottom:1px solid #000;border-top:1px solid #fff;border-right:1px solid #fff;border-left:1px solid #fff;" class="text-center ${3==e?.status?.id?"text-success":"text-danger"}">${e?.status?.name??"Pending"}</td>\n      `)).join("")}\n    </tr>\n  </tbody>\n  <tfoot>\n    <tr>\n      ${ia.value?.roles_sequence?.map((e=>`\n      <th style="border-bottom:1px solid #fff;border-top:1px solid #fff;border-right:55px solid #fff;border-left:1px solid #fff;">${e.name||"N/A"}</th>\n      `)).join("")}\n    </tr>\n  </tfoot>\n</table>\n\n</body>\n</html>\n`,p=e.contentWindow.document;p.open(),p.write(u),p.close(),e.onload=()=>{e.contentWindow.focus(),e.contentWindow.print(),setTimeout((()=>{document.body.removeChild(e)}),1e3)}}catch(e){a(`Failed to print report: ${e.message}`)}},ga=(0,n.iH)([]),ya=(0,n.iH)([]),wa=(0,n.iH)({}),fa=(0,n.iH)(0);(0,l.YP)([da,ia],(()=>{da.value.length&&ia.value&&ka()}),{immediate:!0});const ka=()=>{if(!da.value.length||!ia.value)return ga.value=[],ya.value=[],wa.value={},void(fa.value=0);const e=new Date(ia.value.start_date),t=new Date(ia.value.end_date),a=[],l=[];let n=new Date(e);while(n<=t){const e=sa(n);a.push(e),l.push(n.toISOString().split("T")[0]),n.setDate(n.getDate()+1)}ya.value=a;const o={};da.value.forEach((e=>{o[e.labour_name]||(o[e.labour_name]={labour_name:e.labour_name,labour_type:e.labour_type,phone_number:e.phone_number,rate:e.rate,attendance:{},daysWorked:0,totalAmount:0});const t=new Date(e.date),n=t.toISOString().split("T")[0],s=l.findIndex((e=>e===n));-1!==s&&(o[e.labour_name].attendance[a[s]]=1)}));const s={};a.forEach((e=>{s[e]=0}));const r=Object.values(o).map((e=>{e.daysWorked=Object.values(e.attendance).reduce(((e,t)=>e+t),0);const t="string"===typeof e.rate?parseFloat(e.rate.replace(/,/g,"")):parseFloat(e.rate)||0;return e.totalAmount=e.daysWorked*t,e.rate=t,a.forEach((t=>{s[t]+=e.attendance[t]||0})),e}));wa.value=s,ga.value=r,fa.value=r.reduce(((e,t)=>e+t.totalAmount),0)},xa=async()=>{try{const e=document.createElement("iframe");e.style.display="none",document.body.appendChild(e);const t=da.value.length,a=`\n<!DOCTYPE html>\n<html>\n<head>\n<title>Labour Attendance Report</title>\n<style>\n  body { font-family: 'Courier New', monospace; margin: 40px; font-size: 13px; }\n  .text-style { font-family: 'Courier New', monospace; }\n  .company-title { text-align: center; }\n  .title { text-align: center; font-size: 16px; margin: 10px 0; white-space: nowrap; }\n  table { width: 100%; border-collapse: collapse; margin-top: 10px; }\n  th, td { border: 0.5px solid #000; padding: 6px; }\n  th { background-color: #f8f8f8; font-weight: bold; }\n  .text-right { text-align: right; }\n  .text-center { text-align: center; }\n  hr { border: 0; border-top: 0.5px solid #000; margin: 0px 0; }\n  @media print { body { margin: 10mm; } }\n</style>\n</head>\n<body>\n\n<div class="company-title text-style">\n  <i>\n  <h1>COPEX CONTRACTORS CO.LTD</h1>\n  <div><b>Address:</b> Msamvu, P.O.BOX 678, Morogoro</div>\n  <div><b>Tel:</b> 0713 000 777, 0657 111 555</div>\n  <div><b>Email:</b> info@copexcontractors.co.tz</div>\n  <div><b>TIN:</b> 135-489-247 &nbsp;&nbsp; <b>VRN:</b> 40-032826C</div>\n  </i>\n</div>\n\n<hr style="margin-top:20px">\n\n<div class="title text-style">\n  LABOUR ATTENDANCE (${ia.value?.start_date||"--"} to ${ia.value?.end_date||"--"}) - ${ia.value?.project||"N/A"}\n</div>\n\n<hr>\n\n<table>\n  <thead>\n    <tr>\n      <th>No.</th>\n      <th>Labour Name</th>\n      <th>Labour Type</th>\n      <th>Task</th>\n      <th>Attendance Date</th>\n    </tr>\n  </thead>\n  <tbody>\n    ${da.value.map(((e,t)=>`\n    <tr>\n      <td>${t+1}</td>\n      <td>${e.labour_name||"N/A"}</td>\n      <td>${e.labour_type||"N/A"}</td>\n      <td>${e.task||"N/A"}</td>\n      <td>${e.attendance_date||"N/A"}</td>\n    </tr>\n    `)).join("")}\n  </tbody>\n  <tfoot>\n    <tr style="background-color: #f0f0f0;">\n      <td colspan="5" class="text-right"><strong>Total Number of Labours: ${t}</strong></td>\n    </tr>\n  </tfoot>\n</table>\n\n</body>\n</html>\n`,l=e.contentWindow.document;l.open(),l.write(a),l.close(),e.onload=()=>{e.contentWindow.focus(),e.contentWindow.print(),setTimeout((()=>{document.body.removeChild(e)}),1e3)}}catch(e){a(`Failed to print attendance report: ${e.message}`)}},Da=((0,n.iH)(""),(0,n.iH)([])),Sa=(0,n.iH)(""),Ca=async()=>{try{const e=await na.get("account-transaction-points");Da.value=e.data.map(((e,t)=>({...e,name:(e?.name??"")+" "+(e?.mobile_money?.name??"")+" "+(e?.mobile_money?.category??"CASH")})))}catch(e){a(e.message)}},Na=(0,n.iH)((new Date).toISOString().slice(0,10)),Ta=(0,n.iH)(""),Aa=(0,n.iH)(""),Ha=(0,n.iH)(""),Ra=(0,n.iH)(""),Oa=(0,n.iH)(""),Ua=(0,n.iH)(!1),$a=async()=>{Ua.value=!0;const e=new FormData;e.append("reference_number",Ha.value),e.append("account_transaction_point_id",Sa.value.id),e.append("host",Ta.value),e.append("amount",Aa.value),e.append("description",Oa.value),e.append("issuer_id",D.value),e.append("approval_item_id",ia.value.id),e.append("direction","DECREMENT"),e.append("opening_balance",Sa.value.transactions_sum),e.append("date",Na.value),Ra.value instanceof File&&e.append("attachment",Ra.value);try{const a=await na.post("account-transactions",e);t(a.data.message),document.getElementById("close-proof-modal").click()}catch(l){a(l.message),console.log(l)}finally{Ua.value=!1}},Ea=e=>{Ra.value=e.target.files[0]},La=(0,n.iH)(null),ja=e=>{La.value=e,Ca(),za()},za=()=>{Sa.value="",Ta.value="",Aa.value="",Ha.value="",Oa.value="",Ra.value=null,Na.value=(new Date).toISOString().slice(0,10)},qa=(0,l.Fl)((()=>{if(!La.value||!da.value.length||!ia.value)return{dateColumns:[],rows:"",dateTotals:{},totalAmount:0};const e=new Date(ia.value.start_date),t=new Date(ia.value.end_date),a=[],l=[];let n=new Date(e);while(n<=t){const e=sa(n);a.push(e),l.push(n.toISOString().split("T")[0]),n.setDate(n.getDate()+1)}const o=[La.value],s={};a.forEach((e=>{s[e]=o.reduce(((t,a)=>t+(a.attendance[e]||0)),0)}));const r=o.map(((e,t)=>{const l=a.map((t=>`<td class="text-center">${e.attendance[t]||0}</td>`)).join(""),n=Object.values(e.attendance).reduce(((e,t)=>e+t),0),o="string"===typeof e.rate?parseFloat(e.rate.replace(/,/g,"")):parseFloat(e.rate)||0,s=n*o;return`\n      <tr>\n          <td>${t+1}</td>\n          <td>${e.labour_name||"N/A"}</td>\n          <td>${e.labour_type||"N/A"}</td>\n          ${l}\n          <td class="text-right">${n}</td> \n          <td class="text-right">${Be(o)}</td>\n          <td class="text-right">${Be(s)}</td>\n      </tr>`})).join(""),i=o.reduce(((e,t)=>{const a=Object.values(t.attendance).reduce(((e,t)=>e+t),0),l="string"===typeof t.rate?parseFloat(t.rate.replace(/,/g,"")):parseFloat(t.rate)||0;return e+a*l}),0);return{dateColumns:a,rows:r,dateTotals:s,totalAmount:i}})),Ma=(0,n.iH)([]),Pa=async()=>{Ma.value=[];try{const e=await na.get(`account-transactions?approval_item_id=${ia.value.id}`);Ma.value=e.data.map(((e,t)=>({...e,Sno:t+1,attachment:"https://bushman.ink/api/v1/../../"+e.attachment,amount:Be(e.amount),date:L(e.date),ref_no:e.reference_number,issuer:e?.issuer?.name,target_account:(e?.transaction_point?.name??"")+" "+(e?.transaction_point?.mobile_money?.name??"")+" "+(e?.transaction_point?.mobile_money?.category??"CASH")})))}catch(e){a(e.message),console.log(e)}},Fa=(0,n.iH)(!1),Ba=async()=>{const e={status_id:16,remark:ua.value};try{Fa.value=!0;await na.put(`labour-payment-requests/${ia.value.id}`,e);t("Transaction Completed"),ra(),Qt.value=!1}catch(l){a(l.message),console.log(l)}finally{Fa.value=!1}},Ia=(0,n.iH)(["SNo","labour_name","labour_type","description","amount","date","status"]),Ya=(0,l.Fl)((()=>{if(!da.value.length)return[];const e=[];return da.value.forEach((t=>{const a=t.labour;a?.labour_debt?.length&&a.labour_debt.forEach((l=>{e.push({SNo:e.length+1,labour_id:a.id,labour_name:t.labour_name,labour_type:t.labour_type,date:L(l.date),description:l.description||"--",amount:Be(l.amount),status:l.status?.name||"Unknown",status_color:l.status?.color||"secondary",created_at:l.created_at})}))})),e}));return(0,l.bv)((()=>{ra()})),(e,t)=>{const a=(0,l.up)("router-link"),r=(0,l.up)("v-client-table");return(0,l.wg)(),(0,l.iD)("div",u,[p,(0,n.SU)(d).includes("can_issue_labour_payments")?((0,l.wg)(),(0,l.iD)("div",m,[(0,l.Wm)(a,{to:"/hr/labour/requests",class:"btn btn-primary"},{default:(0,l.w5)((()=>[b])),_:1})])):(0,l.kq)("",!0),Gt.value?((0,l.wg)(),(0,l.iD)("div",{key:1,innerHTML:(0,n.SU)(Xt)()},null,8,v)):((0,l.wg)(),(0,l.iD)("div",_,[(0,l._)("div",h,[(0,l._)("div",g,[(0,l._)("div",y,[(0,l.Wm)(r,{data:ta.value,columns:ea.value,options:la.value},{status:(0,l.w5)((e=>[(0,l._)("span",{class:(0,o.C_)(["badge inv-status","badge-"+e.row.status.class])},(0,o.zw)(e.row.status.key),3)])),actions:(0,l.w5)((t=>[(0,l._)("a",{href:"javascript:;",class:"view me-3",onClick:e=>pa(t.row),"data-bs-toggle":"modal","data-bs-target":"#payment-request-modal"},k,8,w),!(0,n.SU)(d).includes("can_print_labour_payment_request")||"approved"!==t.row.status.key&&"paid"!==t.row.status.key?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("a",{key:0,href:"javascript:;",class:"print",onClick:a=>{pa(t.row),e.$nextTick((()=>ha()))}},S,8,x))])),_:1},8,["data","columns","options"])])])])])),(0,l._)("div",C,[(0,l._)("div",N,[(0,l._)("div",T,[(0,l._)("div",A,[H,(0,l._)("button",{type:"button","data-dismiss":"modal","data-bs-dismiss":"modal","aria-label":"Close",class:"btn-close",onClick:t[0]||(t[0]=e=>ma()),id:"close-approval-modal"})]),(0,l._)("div",R,[(0,l._)("div",O,[(0,l._)("div",U,[(0,l._)("table",$,[E,(0,l._)("tbody",null,[(0,l._)("tr",null,[(0,l._)("td",null,"00"+(0,o.zw)(ia.value?.id),1),(0,l._)("td",null,(0,o.zw)(ia.value?.issuer),1),(0,l._)("td",null,(0,o.zw)((0,n.SU)(L)(ia.value?.date)),1),(0,l._)("td",null,(0,o.zw)(ia.value?.approval_group),1),(0,l._)("td",null,(0,o.zw)(ia.value?.start_date),1),(0,l._)("td",null,(0,o.zw)(ia.value?.end_date),1),(0,l._)("td",null,(0,o.zw)(ia.value?.project),1),(0,l._)("td",null,[!(0,n.SU)(d).includes("can_print_labour_payment_request")||"approved"!==ia.value?.status?.key&&"paid"!==ia.value?.status?.key?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("a",{key:0,href:"javascript:;",class:"print",onClick:ha},j))])]),ia.value?.description?((0,l.wg)(),(0,l.iD)("tr",z,[(0,l._)("td",q,[M,(0,l.Uk)(" "+(0,o.zw)(ia.value?.description),1)]),ia.value?.remark?((0,l.wg)(),(0,l.iD)("tr",P,[(0,l._)("td",F,[B,(0,l.Uk)(" "+(0,o.zw)(ia.value?.remark),1)])])):(0,l.kq)("",!0)])):(0,l.kq)("",!0)])])])])]),(0,l._)("div",I,[(0,n.SU)(d).includes("can_complete_transaction")&&"approved"===ia.value?.status?.key?((0,l.wg)(),(0,l.iD)("div",Y,[(0,l._)("button",{class:"btn btn-primary",type:"button",disabled:Fa.value,onClick:t[1]||(t[1]=e=>Qt.value=!Qt.value)},[Fa.value?((0,l.wg)(),(0,l.iD)("span",{key:0,innerHTML:(0,n.SU)(Jt)()},null,8,V)):((0,l.wg)(),(0,l.iD)("span",K,"Paid"))],8,W)])):(0,l.kq)("",!0),Qt.value?((0,l.wg)(),(0,l.iD)("form",{key:1,onSubmit:t[3]||(t[3]=(0,s.iM)((e=>Ba()),["prevent"]))},[(0,l._)("div",X,[(0,l.wy)((0,l._)("input",{type:"text",class:"form-control",placeholder:"Enter Any remark ","onUpdate:modelValue":t[2]||(t[2]=e=>ua.value=e)},null,512),[[s.nr,ua.value]]),(0,l._)("button",{class:"btn btn-primary me-2",type:"submit",disabled:Fa.value},[Fa.value?((0,l.wg)(),(0,l.iD)("span",{key:0,innerHTML:(0,n.SU)(Jt)()},null,8,Q)):((0,l.wg)(),(0,l.iD)("span",G,"Save"))],8,J)])],32)):(0,l.kq)("",!0),f.value!=ia.value?.await&&!(0,n.SU)(d).includes("is_md")||"paid"===ia.value?.status?.key?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("div",Z,[(0,l._)("div",ee,[(0,l._)("button",{class:"btn btn-primary me-2",onClick:t[4]||(t[4]=e=>ca.value=3),disabled:va.value}," Check ",8,te),(0,l._)("button",{class:"btn btn-danger me-2",onClick:t[5]||(t[5]=e=>ca.value=4),disabled:va.value}," Reject ",8,ae),(0,l._)("button",{class:"btn btn-info me-2",onClick:t[6]||(t[6]=e=>ca.value=14),disabled:va.value}," Remark ",8,le),(0,l._)("button",{class:"btn btn-warning",onClick:t[7]||(t[7]=e=>ca.value=17),disabled:va.value}," On Hold ",8,ne)])])),ca.value?((0,l.wg)(),(0,l.iD)("div",oe,[(0,l._)("span",{class:(0,o.C_)(["badge rounded-pill",{"bg-danger":4==ca.value,"bg-success":3==ca.value,"bg-info":14==ca.value,"bg-warning":17==ca.value}]),style:{"font-size":"1rem"}},(0,o.zw)(3==ca.value?"Check / Approve Request":4==ca.value?"Reject Request":14==ca.value?"Fill Remark":"On Hold"),3)])):(0,l.kq)("",!0),ca.value?((0,l.wg)(),(0,l.iD)("div",se,[(0,l.wy)((0,l._)("input",{type:"text",class:"form-control",placeholder:3==ca.value?"Enter Approval Remark":4==ca.value?"Enter Rejection Remark":"Enter Remark","onUpdate:modelValue":t[8]||(t[8]=e=>ua.value=e)},null,8,re),[[s.nr,ua.value]]),(0,l._)("button",{onClick:t[9]||(t[9]=e=>_a()),class:"btn btn-primary me-2",type:"button",disabled:va.value},[va.value?((0,l.wg)(),(0,l.iD)("span",{key:0,innerHTML:(0,n.SU)(Jt)()},null,8,de)):((0,l.wg)(),(0,l.iD)("span",ce,"Save"))],8,ie)])):(0,l.kq)("",!0),(0,l._)("div",ue,[(0,l._)("table",pe,[(0,l._)("thead",null,[(0,l._)("tr",null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)((0,n.SU)(oa),(e=>((0,l.wg)(),(0,l.iD)("th",{key:e.role_id||e.position||e.name},[(0,l.Uk)((0,o.zw)(e.name)+" ",1),me])))),128))])]),(0,l._)("tbody",null,[(0,l._)("tr",null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)((0,n.SU)(oa),((e,t)=>((0,l.wg)(),(0,l.iD)("td",{key:e.role_id||e.position||t,class:(0,o.C_)(e?.status?.color?"text-"+e.status.color:"text-danger")},[(0,l._)("span",null,(0,o.zw)(e?.status?.name??"Unchecked"),1),be,e.approved_at?((0,l.wg)(),(0,l.iD)("span",ve," Checked At: "+(0,o.zw)((0,n.SU)(L)(e.approved_at)),1)):(0,l.kq)("",!0),_e,e.remark?((0,l.wg)(),(0,l.iD)("span",he," Remark: "+(0,o.zw)(e.remark),1)):(0,l.kq)("",!0)],2)))),128))])])])]),(0,l._)("div",ge,[ye,(0,l._)("div",we,[(0,l._)("table",fe,[(0,l._)("thead",null,[(0,l._)("tr",null,[ke,xe,De,Se,((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(ya.value,(e=>((0,l.wg)(),(0,l.iD)("th",{key:e},(0,o.zw)(e),1)))),128)),Ce,Ne,Te,Ae])]),(0,l._)("tbody",null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(ga.value,((e,t)=>((0,l.wg)(),(0,l.iD)("tr",{key:e.labour_name},[(0,l._)("td",null,(0,o.zw)(t+1),1),(0,l._)("td",null,(0,o.zw)(e.labour_name||"N/A"),1),(0,l._)("td",null,(0,o.zw)(e.labour_type||"N/A"),1),(0,l._)("td",null,(0,o.zw)(e.phone_number||"--"),1),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(ya.value,(t=>((0,l.wg)(),(0,l.iD)("td",{key:t,class:"text-center"},(0,o.zw)(e.attendance[t]||0),1)))),128)),(0,l._)("td",He,(0,o.zw)(e.daysWorked),1),(0,l._)("td",Re,(0,o.zw)((0,n.SU)(Be)(e.rate)),1),(0,l._)("td",Oe,(0,o.zw)((0,n.SU)(Be)(e.totalAmount)),1),(0,l._)("td",null,[(0,n.SU)(d).includes("can_complete_transaction")&&"approved"===ia.value?.status?.key?((0,l.wg)(),(0,l.iD)("button",{key:0,class:"btn btn-primary","data-bs-toggle":"modal","data-bs-target":"#payment-proof",onClick:t=>ja(e)}," Paid ",8,Ue)):(0,l.kq)("",!0)])])))),128))]),(0,l._)("tfoot",null,[(0,l._)("tr",$e,[Ee,((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(ya.value,(e=>((0,l.wg)(),(0,l.iD)("td",{key:e,class:"text-center"},[(0,l._)("strong",null,(0,o.zw)(wa.value[e]||0),1)])))),128)),Le,je,(0,l._)("td",ze,[(0,l._)("strong",null,(0,o.zw)((0,n.SU)(Be)(fa.value)),1)]),qe])])])])]),(0,l._)("div",Me,[(0,l._)("div",Pe,[Fe,(0,n.SU)(d).includes("can_print_labour_attendance")&&"approved"===ia.value?.status?.key?((0,l.wg)(),(0,l.iD)("a",{key:0,href:"javascript:;",class:"print position-absolute end-0 me-3 ms-5",onClick:t[10]||(t[10]=e=>xa())},Ie)):(0,l.kq)("",!0)]),(0,l._)("div",Ye,[(0,l.Wm)(r,{data:da.value,columns:ba.value,options:la.value},null,8,["data","columns","options"])])]),Ma.value.length>0?((0,l.wg)(),(0,l.iD)("div",We,[Ve,(0,l._)("div",Ke,[(0,l._)("div",Xe,[(0,l._)("div",Je,[(0,l.Wm)(r,{data:Ma.value,columns:Zt.value,options:la.value},{attachment:(0,l.w5)((t=>[(0,l._)("a",{href:t.row.attachment,target:"_blank",class:"badge badge-primary text-white",style:{cursor:"pointer"},onClick:a=>e.fillTransaction(t.row)}," Open Attachment ",8,Qe)])),_:1},8,["data","columns","options"])])])])])):(0,l.kq)("",!0),(0,n.SU)(Ya).length>0?((0,l.wg)(),(0,l.iD)("div",Ge,[Ze,(0,l._)("div",et,[(0,l._)("div",tt,[(0,l._)("div",at,[(0,l.Wm)(r,{data:(0,n.SU)(Ya),columns:Ia.value,options:la.value},{status:(0,l.w5)((e=>[(0,l._)("span",{class:(0,o.C_)(["badge inv-status","badge-"+e.row.status_color])},(0,o.zw)(e.row.status),3)])),_:1},8,["data","columns","options"])])])])])):(0,l.kq)("",!0)]),(0,l._)("div",lt,[(0,l._)("button",{type:"button",class:"btn btn-primary","data-dismiss":"modal","data-bs-dismiss":"modal",onClick:t[11]||(t[11]=e=>ma())},"close")])])])],512),(0,l._)("div",nt,[(0,l._)("div",ot,[(0,l._)("div",st,[(0,l._)("div",rt,[(0,l._)("h1",it," PROOF OF PAYMENT - "+(0,o.zw)(La.value?.labour_name||"Labour"),1),(0,l._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",id:"close-proof-modal",onClick:t[12]||(t[12]=e=>La.value=null)})]),(0,l._)("div",dt,[(0,l._)("div",ct,[ut,(0,l._)("div",pt,[(0,l._)("table",mt,[(0,l._)("thead",null,[(0,l._)("tr",null,[bt,vt,_t,((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)((0,n.SU)(qa).dateColumns,(e=>((0,l.wg)(),(0,l.iD)("th",{key:e},(0,o.zw)(e),1)))),128)),ht,gt,yt])]),(0,l._)("tbody",{innerHTML:(0,n.SU)(qa).rows},null,8,wt),(0,l._)("tfoot",null,[(0,l._)("tr",ft,[kt,((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)((0,n.SU)(qa).dateColumns,(e=>((0,l.wg)(),(0,l.iD)("td",{key:e,class:"text-center"},[(0,l._)("strong",null,(0,o.zw)((0,n.SU)(qa).dateTotals[e]||0),1)])))),128)),(0,l._)("td",xt,[(0,l._)("strong",null,(0,o.zw)((0,n.SU)(qa).dateColumns.length>0?Object.values(La.value?.attendance||{}).reduce(((e,t)=>e+t),0):0),1)]),Dt,(0,l._)("td",St,[(0,l._)("strong",null,(0,o.zw)((0,n.SU)(Be)((0,n.SU)(qa).totalAmount)),1)])])])])])]),(0,l._)("div",Ct,[(0,l._)("div",Nt,[(0,l._)("div",Tt,[(0,l._)("div",At,[(0,l._)("div",Ht,[(0,l._)("div",Rt,[Ot,(0,l.wy)((0,l._)("input",{class:"form-control",type:"text",placeholder:"Enter Reference Number","onUpdate:modelValue":t[13]||(t[13]=e=>Ha.value=e)},null,512),[[s.nr,Ha.value]])]),(0,l._)("div",Ut,[$t,(0,l.Wm)((0,n.SU)(c()),{modelValue:Sa.value,"onUpdate:modelValue":t[14]||(t[14]=e=>Sa.value=e),options:Da.value,placeholder:"Select Account",label:"name",searchable:!0,multple:"false",required:!0,"allow-empty":!1},null,8,["modelValue","options"])]),(0,l._)("div",Et,[Lt,(0,l.wy)((0,l._)("input",{class:"form-control",type:"number",step:"any",placeholder:"Enter Amount","onUpdate:modelValue":t[15]||(t[15]=e=>Aa.value=e)},null,512),[[s.nr,Aa.value]])]),(0,l._)("div",jt,[zt,(0,l.wy)((0,l._)("input",{class:"form-control",type:"text",placeholder:"Enter Receiver","onUpdate:modelValue":t[16]||(t[16]=e=>Ta.value=e)},null,512),[[s.nr,Ta.value]])]),(0,l._)("div",qt,[Mt,(0,l.wy)((0,l._)("input",{class:"form-control",type:"date","onUpdate:modelValue":t[17]||(t[17]=e=>Na.value=e)},null,512),[[s.nr,Na.value]])]),(0,l._)("div",Pt,[Ft,(0,l._)("input",{class:"form-control",type:"file",onChange:Ea,accept:"application/pdf"},null,32)]),(0,l._)("div",Bt,[It,(0,l.wy)((0,l._)("input",{class:"form-control",type:"text",placeholder:"Enter Remark","onUpdate:modelValue":t[18]||(t[18]=e=>Oa.value=e)},null,512),[[s.nr,Oa.value]])])])])])])])]),(0,l._)("div",Yt,[(0,l._)("button",{type:"button",class:"btn btn-danger me-2","data-bs-dismiss":"modal",onClick:t[19]||(t[19]=e=>La.value=null)},"Close"),(0,l._)("button",{type:"button",class:"btn btn-success",onClick:t[20]||(t[20]=e=>$a()),disabled:Ua.value},[Ua.value?((0,l.wg)(),(0,l.iD)("span",{key:0,innerHTML:(0,n.SU)(Jt)()},null,8,Vt)):((0,l.wg)(),(0,l.iD)("span",Kt,"Save"))],8,Wt)])])])])])}}};const Jt=Xt;var Qt=Jt}}]);
//# sourceMappingURL=1764.60a1307a.js.map