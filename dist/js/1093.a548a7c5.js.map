{"version":3,"file":"js/1093.a548a7c5.js","mappings":"0pCA+EAA,EAAAA,EAAAA,GAAQ,CAAEC,MAAO,gBACOC,EAAAA,EAAAA,IAAO,eAA3B,MACMC,GAAYD,EAAAA,EAAAA,IAAO,aACvBE,GAAQC,EAAAA,EAAAA,MACRC,GAASC,EAAAA,EAAAA,IAAI,CAAC,CAAEC,KAAM,MACtBC,GAAaF,EAAAA,EAAAA,IAAI,IACjBG,GAAkBH,EAAAA,EAAAA,KAAI,GACtBI,EAAkBC,MAAAA,IACpB,GAAKC,EAAQC,OAAUD,EAAQC,MAAMC,GAKrC,IACI,MAAMC,QAAYC,EAAAA,EAAAA,IAAW,kEAAiEC,KACxFC,EAAQH,EAAIR,KAElB,IAAKW,EAAMC,OAKP,OAJAjB,EAAU,mCACVM,EAAWK,MAAQ,GACnBR,EAAOQ,MAAQ,CAAC,CAAEN,KAAM,UACxBE,EAAgBI,OAAQ,GAG5BJ,EAAgBI,OAAQ,EACxBL,EAAWK,MAAQK,EAAME,KAAIC,GAAQA,EAAKC,cAC1CjB,EAAOQ,MAAQ,CAAC,CACZN,KAAMW,EAAME,KAAIC,GAAQA,EAAKE,gBAEnC,MAAOC,GACLC,QAAQD,MAAM,+BAAgCA,QArB9CE,KA4BFC,GAAYC,EAAAA,EAAAA,KAAS,KACvB,MAAMC,EAAU1B,EAAM2B,MAAMC,aACtBC,EAAWC,KAAKC,OAAO7B,EAAOQ,MAAM,GAAGN,MAE7C,MAAO,CACH4B,MAAO,CAAEC,QAAS,CAAEC,MAAM,IAC1BC,WAAY,CACRC,SAAS,EACTC,UAAYC,GAAQA,EAAIC,eAAe,QAAS,CAAEC,sBAAuB,IACzEC,MAAO,CAAEC,OAAQ,CAAChB,EAAU,OAAS,UAEzCiB,YAAa,CACTC,IAAK,CAAEC,YAAY,IAEvBC,MAAO,CACHzC,WAAYA,EAAWK,MACvBqC,IAAK,EACLhB,IAAKF,EACLmB,WAAY,EACZC,OAAQ,CACJZ,UAAYC,GAAQA,EAAIC,eAAe,QAAS,CAAEC,sBAAuB,IACzEC,MAAO,CAAEC,OAAQhB,EAAU,OAAS,SAExCwB,gBAAgB,GAEpBC,MAAO,CACHF,OAAQ,CAAER,MAAO,CAAEC,OAAQhB,EAAU,OAAS,UAElD0B,QAAS,CACLC,EAAG,CACChB,UAAYC,GAAQA,EAAIC,eAAe,QAAS,CAAEC,sBAAuB,MAGjFc,KAAM,CACFC,YAAa7B,EAAU,UAAY,eAKzC8B,GAAWrD,EAAAA,EAAAA,IAAI,IACfM,GAAUN,EAAAA,EAAAA,IAAI,MAEdsD,EAAcjD,UAChB,IACI,MAAMkD,QAAiB7C,EAAAA,EAAAA,IAAW,uDAClC2C,EAAS9C,MAAQgD,EAAStD,KAAKuD,QAAOlD,GAA8B,WAAnBA,EAAQmD,QAA6C,GAAtBnD,EAAQoD,aAC1F,MAAOxC,GACLtB,EAAUsB,EAAMyC,WAKlBvC,EAAsBf,UACvB,IACG,MAAMI,QAAYC,EAAAA,EAAAA,IAAW,kEACvBE,EAAQH,EAAIR,KAElB,IAAKW,EAAMC,OAIP,OAHAjB,EAAU,mCACVM,EAAWK,MAAQ,QACnBR,EAAOQ,MAAQ,CAAC,CAAEN,KAAM,MAI5BC,EAAWK,MAAQK,EAAME,KAAIC,GAAQA,EAAKC,cAC1CjB,EAAOQ,MAAQ,CAAC,CACZN,KAAMW,EAAME,KAAIC,GAAQA,EAAKE,gBAEnC,MAAOC,GACLC,QAAQD,MAAM,+BAAgCA,K,OAItD0C,EAAAA,EAAAA,KAAU,KACNN,IACIhD,EAAQC,OAAOC,GACfJ,EAAiB,cAAaE,EAAQC,MAAMC,MAE5CY,O,4nCC/LR,MAAMyC,EAAc,EAEpB","sources":["webpack://cork-vue3/./src/views/budgets/analysis.vue","webpack://cork-vue3/./src/views/budgets/analysis.vue?9405"],"sourcesContent":["<template>\r\n  <div class=\"w-100 px-0\">\r\n    <teleport to=\"#breadcrumb\">\r\n      <ul class=\"navbar-nav flex-row\">\r\n        <li>\r\n          <div class=\"page-header\">\r\n            <nav class=\"breadcrumb-one\" aria-label=\"breadcrumb\">\r\n              <ol class=\"breadcrumb\">\r\n                <li class=\"breadcrumb-item\"><a href=\"javascript:;\">Charts</a></li>\r\n                <li class=\"breadcrumb-item active\" aria-current=\"page\"><span>Apex</span></li>\r\n              </ol>\r\n            </nav>\r\n          </div>\r\n        </li>\r\n      </ul>\r\n    </teleport>\r\n\r\n  <div v-scroll-spy class=\"row g-0\">\r\n    <div id=\"chartBar\" class=\"col-12 px-0\">\r\n      <div class=\"statbox panel box box-shadow w-100\">\r\n        <div class=\"panel-heading\">\r\n          <div class=\"row justify-content-center text-center \">\r\n            <div class=\"col-12\">\r\n              <div v-if=\"project\" class=\"d-flex flex-column flex-md-row align-items-center justify-content-md-between gap-2\">\r\n                <h4 class=\"mb-0\">BUDGET ANALYSIS FOR {{ project?.short_name }} PROJECT</h4>\r\n                <router-link :to=\"`/report/project-budgets/${project.id}`\"\r\n                  v-if=\"budgetAvailable\"\r\n                  class=\"btn btn-primary p-1\"\r\n                >\r\n                  Open Budget\r\n                </router-link>\r\n              </div>\r\n              <h4 v-else class=\"text-center\">HIGHEST COST BUDGETS</h4>\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Improved Multiselect section alignment -->\r\n          <div class=\"row justify-content-center mb-4\"> <!-- Increased mb-3 to mb-4 -->\r\n            <div class=\"col-12 col-md-6\">\r\n              <Multiselect\r\n                v-model=\"project\"\r\n                :options=\"projects\"\r\n                label=\"short_name\"\r\n                track-by=\"id\"\r\n                placeholder=\"Select A project\"\r\n                :searchable=\"true\"\r\n                :append-to-body=\"true\"\r\n                @update:modelValue=\"(val) => fetchBudgetData(`project_id=${val?.id}`)\"\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"panel-body\">\r\n          <apexchart\r\n            v-if=\"options_5\"\r\n            height=\"350\"\r\n            type=\"bar\"\r\n            :options=\"options_5\"\r\n            :series=\"budget\"\r\n          />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  </div>\r\n</template>\r\n\r\n\r\n\r\n<script setup>\r\nimport { ref, computed, onMounted,inject } from 'vue';\r\nimport '@/assets/sass/scrollspyNav.scss';\r\nimport apexchart from 'vue3-apexcharts';\r\nimport { useStore } from 'vuex';\r\nimport { useMeta } from '@/composables/use-meta';\r\nimport axios from 'axios';\r\nimport Multiselect from '@suadelabs/vue3-multiselect';\r\nimport '@suadelabs/vue3-multiselect/dist/vue3-multiselect.css';\r\nuseMeta({ title: 'Apex Chart' });\r\n    const showMessage = inject('showMessage');\r\n    const showError = inject('showError');\r\nconst store = useStore();\r\nconst budget = ref([{ data: [] }]);\r\nconst categories = ref([]);\r\nconst budgetAvailable = ref(false)\r\nconst fetchBudgetData = async (query) => {\r\n    if (!project.value || !project.value.id) {\r\n        fetchGeneralBudgets()\r\n        return;\r\n    }\r\n\r\n    try {\r\n        const res = await axios.get(`https://construction.trustdigital.space/api/v1/budget-analysis?${query}`);\r\n        const items = res.data;\r\n         \r\n        if (!items.length) {\r\n            showError('This project has no budget data');\r\n            categories.value = [];\r\n            budget.value = [{ data: [] }];\r\n            budgetAvailable.value = false;\r\n            return;\r\n        }\r\n        budgetAvailable.value = true;\r\n        categories.value = items.map(item => item.budget_name);\r\n        budget.value = [{\r\n            data: items.map(item => item.budget_cost),\r\n        }];\r\n    } catch (error) {\r\n        console.error('Failed to fetch budget data:', error);\r\n    }\r\n};\r\n\r\n\r\n\r\n\r\nconst options_5 = computed(() => {\r\n    const is_dark = store.state.is_dark_mode;\r\n    const maxValue = Math.max(...budget.value[0].data); // Get raw max (e.g., 121212)\r\n    \r\n    return {\r\n        chart: { toolbar: { show: false } },\r\n        dataLabels: {\r\n            enabled: true,\r\n            formatter: (val) => val.toLocaleString('en-US', { maximumFractionDigits: 0 }),\r\n            style: { colors: [is_dark ? '#fff' : '#000'] }\r\n        },\r\n        plotOptions: {\r\n            bar: { horizontal: true }\r\n        },\r\n        xaxis: {\r\n            categories: categories.value,\r\n            min: 0,\r\n            max: maxValue, // Exact max value (e.g., 121212)\r\n            tickAmount: 6, // Force 6 sections\r\n            labels: {\r\n                formatter: (val) => val.toLocaleString('en-US', { maximumFractionDigits: 0 }),\r\n                style: { colors: is_dark ? '#fff' : '#000' }\r\n            },\r\n            forceNiceScale: false // Disable auto-scaling\r\n        },\r\n        yaxis: {\r\n            labels: { style: { colors: is_dark ? '#fff' : '#000' } }\r\n        },\r\n        tooltip: {\r\n            y: {\r\n                formatter: (val) => val.toLocaleString('en-US', { maximumFractionDigits: 0 })\r\n            }\r\n        },\r\n        grid: {\r\n            borderColor: is_dark ? '#191e3a' : '#e0e6ed'\r\n        }\r\n    };\r\n});\r\n\r\nconst projects = ref([])\r\nconst project = ref(null);\r\n\r\nconst getProjects = async () => {\r\n    try {\r\n        const response = await axios.get(`https://bcftrack.trustdigital.space/api/v1/projects`);\r\n        projects.value = response.data.filter(project => project.status === 'active' && project.company_id == 6)\r\n    } catch (error) {\r\n        showError(error.message);\r\n      \r\n    }\r\n};\r\n\r\nconst fetchGeneralBudgets = async () =>{\r\n     try {\r\n        const res = await axios.get(`https://construction.trustdigital.space/api/v1/budget-analysis`);\r\n        const items = res.data;\r\n\r\n        if (!items.length) {\r\n            showError('This project has no budget data');\r\n            categories.value = [];\r\n            budget.value = [{ data: [] }];\r\n            return;\r\n        }\r\n\r\n        categories.value = items.map(item => item.budget_name);\r\n        budget.value = [{\r\n            data: items.map(item => item.budget_cost),\r\n        }];\r\n    } catch (error) {\r\n        console.error('Failed to fetch budget data:', error);\r\n    }\r\n}\r\n\r\nonMounted(() => {\r\n    getProjects();\r\n    if (project.value?.id) {\r\n        fetchBudgetData(`project_id=${project.value.id}`);\r\n    }else{\r\n        fetchGeneralBudgets()\r\n    }\r\n});\r\n\r\n</script>\r\n\r\n","import script from \"./analysis.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./analysis.vue?vue&type=script&setup=true&lang=js\"\n\nconst __exports__ = script;\n\nexport default __exports__"],"names":["useMeta","title","inject","showError","store","useStore","budget","ref","data","categories","budgetAvailable","fetchBudgetData","async","project","value","id","res","axios","query","items","length","map","item","budget_name","budget_cost","error","console","fetchGeneralBudgets","options_5","computed","is_dark","state","is_dark_mode","maxValue","Math","max","chart","toolbar","show","dataLabels","enabled","formatter","val","toLocaleString","maximumFractionDigits","style","colors","plotOptions","bar","horizontal","xaxis","min","tickAmount","labels","forceNiceScale","yaxis","tooltip","y","grid","borderColor","projects","getProjects","response","filter","status","company_id","message","onMounted","__exports__"],"sourceRoot":""}