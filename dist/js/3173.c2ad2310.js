"use strict";(self["webpackChunkcork_vue3"]=self["webpackChunkcork_vue3"]||[]).push([[3173],{53173:function(t,e,a){a.r(e),a.d(e,{default:function(){return et}});var n=a(66252),s=a(2262),o=a(3577),r=a(49963),l=a(87066),i=a(56296);const d={class:"layout-px-spacing"},c=(0,n.uE)('<ul class="navbar-nav flex-row mt-2"><li><div class="page-header"><nav class="breadcrumb-one" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="javascript:;">Masters</a></li><li class="breadcrumb-item active" aria-current="page"><span>Account Budgets</span></li></ol></nav></div></li></ul><h3 class="text-center">Account Budgets</h3>',2),u=["innerHTML"],p={key:1,class:"row layout-top-spacing"},m={class:"col-xl-12 col-lg-12 col-sm-12 layout-spacing"},g={class:"panel p-0"},b={class:"custom-table table3"},h=["onClick"],v=(0,n._)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-eye text-primary"},[(0,n._)("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),(0,n._)("circle",{cx:"12",cy:"12",r:"3"})],-1),_=[v],f=["onClick"],x=(0,n._)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"currentColor",class:"bi bi-credit-card-2-front text-secondary",viewBox:"0 0 16 16"},[(0,n._)("path",{d:"M14 3a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1zM2 2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2z"}),(0,n._)("path",{d:"M2 5.5a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5m0 2a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5m3 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5m3 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5m3 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5"})],-1),y=[x],w={class:"modal fade mymodal",id:"view-budget-modal","data-bs-backdrop":"false","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"editAccountBudgetModalLabel","aria-hidden":"true"},k={class:"modal-dialog modal-fullscreen"},q={class:"modal-content"},C={class:"modal-body"},$={class:"my-4"},S=(0,n._)("h3",{class:"text-center"}," COPEX CONTRACTORS COMPANY LIMITED",-1),A={class:"text-center"},j=(0,n._)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-printer"},[(0,n._)("polyline",{points:"6 9 6 2 18 2 18 9"}),(0,n._)("path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"}),(0,n._)("rect",{x:"6",y:"14",width:"12",height:"8"})],-1),N=[j],O={class:"row"},E={class:"col-12"},M={class:"col-xl-12 col-lg-12 col-sm-12 layout-spacing"},z={class:"panel p-0"},D={class:"custom-table table3"},R=(0,n._)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-eye text-primary"},[(0,n._)("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),(0,n._)("circle",{cx:"12",cy:"12",r:"3"})],-1),T={class:"modal fade mymodal",id:"edit-budget-modal","data-bs-backdrop":"false","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"","aria-hidden":"true"},B={class:"modal-dialog modal-xl"},P={class:"modal-content"},H={class:"modal-header"},F={class:"modal-title fs-5",id:"edit-budget-modal"},L={class:"modal-body"},V={class:"row mb-3"},I={class:"col-md-6"},U=(0,n._)("label",{for:"cheque_no"},"Cheque NO.",-1),W={class:"col-md-6"},X=(0,n._)("label",{for:"remark"},"Remark",-1),Y={class:"modal-footer"},G=["disabled"],Q={key:0,class:"spinner-border spinner-border-sm text-white me-2",role:"status"},Z={key:1},J={key:2};var K={setup(t){(0,i.j)({title:"Account Budgets"});const e=(0,s.iH)(!1),a=(0,n.f3)("showMessage"),v=(0,n.f3)("showError"),x=(0,n.f3)("formatDate"),j=(0,n.f3)("tableShimmer"),K=(0,s.iH)(!1),tt=(0,s.iH)(["SNo","account_budget","type","date","amount","cheque_no","remark","actions"]),et=(0,s.iH)(["sno","ref_no","project","type","description","quantity","rate","amount","balance","requester","actions"]),at=(0,s.iH)([]),nt=(0,s.iH)({}),st=(0,s.iH)(""),ot=(0,n.f3)("formatNumber"),rt=(0,s.iH)({perPage:20,perPageValues:[20,50,100],skin:"table table-hover table-striped",columnsClasses:{actions:"actions text-center"},sortable:["SNo","account_budget","status"],sortIcon:{base:"sort-icon-none",up:"sort-icon-asc",down:"sort-icon-desc"},pagination:{nav:"scroll",chunk:5},texts:{count:"Showing {from} to {to} of {count}",filter:"",filterPlaceholder:"Search...",limit:"Results:"},resizableColumns:!1}),lt=(0,s.iH)({perPage:10,perPageValues:[10,20,50],skin:"table table-hover table-striped",sortable:["SNo","description","quantity"],sortIcon:{base:"sort-icon-none",up:"sort-icon-asc",down:"sort-icon-desc"},pagination:{nav:"scroll",chunk:5},texts:{count:"Showing {from} to {to} of {count}",filter:"",filterPlaceholder:"Search items...",limit:"Results:"},resizableColumns:!1}),it=(0,n.Fl)((()=>{if(!nt.value.items||!Array.isArray(nt.value.items))return[];const t=[];let e=0;return nt.value.items.forEach((a=>{a.approval_list&&a.approval_list.items&&a.approval_list.items.forEach((n=>{if(n.requisition_items){const s=n.requisition_items,o=s.requisition_type,r=o?.requisition,l=r?.project,i=n.quantity,d=parseFloat(i)*parseFloat(s.rate);e+=d,t.push({sno:t.length+1,ref_no:a.approval_list.id,type:a.approval_list?.approval_group?.name||"-",description:s.description||"-",quantity:i||"0",rate:ot(s.rate||0),amount:ot(d),balance:ot(e),units:s.units||"",project:l?.short_name||l?.project_name||"-",requester:a.approval_list.requester?.name||"-",status:a.approval_list.status?.name||"-",status_color:a.approval_list.status?.color||"secondary"})}}))})),t})),dt=l.Z.create({baseURL:"https://bushman.ink/api/v1/"}),ct=async()=>{K.value=!0;try{const t=await dt.get("account-budgets");at.value=t.data.map(((t,e)=>{let a=0;return t.items&&Array.isArray(t.items)&&t.items.forEach((t=>{t.approval_list&&t.approval_list.items&&t.approval_list.items.forEach((t=>{if(t.requisition_items){const e=t.requisition_items,n=parseFloat(t.quantity||0)*parseFloat(e.rate||0);a+=n}}))})),{SNo:e+1,id:t.id,account_budget:t.name,type:t.type,cheque_no:t.cheque_no,remark:t.remark,date:x(t.created_at),amount:ot(a),items:t.items}}))}catch(t){console.error(t),v(t.message)}finally{K.value=!1}},ut=t=>{nt.value=t},pt=()=>{nt.value={}},mt=async()=>{try{const t=document.createElement("iframe");t.style.display="none",document.body.appendChild(t);const e=`${nt.value.id}`,a=new Date,n=String(a.getDate()).padStart(2,"0"),s=String(a.getMonth()+1).padStart(2,"0"),o=a.getFullYear(),r=`${n}/${s}/${o}`,l=`${n}.${s}.${o}`,i=`${r}, ${a.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`,d={};it.value&&it.value.length>0&&it.value.forEach((t=>{d[t.project]||(d[t.project]=[]),d[t.project].push(t)}));const c={};let u=0;Object.keys(d).forEach((t=>{const e=d[t].reduce(((t,e)=>{const a=parseFloat(e.quantity||0)*parseFloat(e.rate?.replace(/,/g,"")||0);return t+a}),0);c[t]=e,u+=e}));const p=()=>{if(!nt.value.items||0===nt.value.items.length)return{approval_roles:[],approval_steps:[],roles_sequence:[]};const t=nt.value.items[0]?.approval_list;if(!t)return{approval_roles:[],approval_steps:[],roles_sequence:[]};const e=t.approval_group?.approval_roles||[],a=t.approval_chain||[],n=e.map((t=>{const e=a.find((e=>e.role_id===t.role_id));return{name:t.role?.name||"N/A",position:t.position,status:e?.status||{name:"pending",id:2},status_id:e?.status_id||2,remark:e?.remark||null,approval_date:e?.created_at?m(e.created_at):null}})).sort(((t,e)=>t.position-e.position));return{approval_roles:e,approval_steps:a,roles_sequence:n}},m=t=>{if(!t)return"N/A";const e=new Date(t);return`${e.getDate().toString().padStart(2,"0")}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getFullYear()}`},g=p(),b=(t,e)=>{let a=`\n<div class="section-title">${t}</div>\n<table class="items" style="margin-top: 10px;">\n  <thead>\n    <tr>\n      <th style="width: 30px;"><strong>Sno.</strong></th>\n      <th><strong>Ref</strong></th>\n      <th><strong>Description</strong></th>\n      <th><strong>Requester</strong></th>\n      <th><strong>Quantity</strong></th>\n      <th><strong>Rate</strong></th>\n      <th><strong>Amount</strong></th>\n    </tr>\n  </thead>\n  <tbody>\n  `;return e.forEach(((t,e)=>{a+=`\n    <tr>\n      <td class="text-center">${e+1}</td>\n      <td class="text-center">${t.ref_no}</td>\n      <td class="text-start">${t.description}</td>\n      <td class="text-start">${t.requester}</td>      \n      <td class="text-end">${t.quantity}</td>\n      <td class="text-end">${t.rate}</td>\n      <td class="text-end">${t.amount}</td>\n    </tr>\n    `})),a+=`\n    <tr style="font-weight: bold; background-color: #f8f8f8;">\n      <td colspan="6" class="text-end"><strong>Subtotal for ${t}:</strong></td>\n      <td class="text-end"><strong>${ot(c[t])}</strong></td>\n    </tr>\n  </tbody>\n</table>\n<div style="margin-bottom: 30px;"></div>\n`,a},h=`\n<!DOCTYPE html>\n<html>\n<head>\n<title>Account Budget</title>\n<style>\n  body { font-family: Arial, sans-serif; margin: 40px; font-size: 13px; }\n  .header { display: flex; justify-content: space-between; align-items: flex-start; }\n  .logo { width: 160px; height: auto; }\n  .budget-box { border: 1px solid #000; padding: 4px 8px; font-size: 11px; text-align: center; margin-left: auto; border-radius: 5px; }\n  .company-title { text-align: center; margin-top: 10px; }\n  .reg-info { position: absolute; top: 120px; right: 40px; text-align: right; font-size: 10px; line-height: 1.4; }\n  .title { text-align: center; font-weight: bold; margin: 20px 0 10px 0; }\n  .section-title { text-align: left; font-weight: bold; margin: 30px 0 15px 0; font-size: 14px; text-decoration: underline; color: #333; }\n  table { width: 100%; border-collapse: collapse; margin-top: 10px; }\n  table.items th, table.items td { border: 1px solid #000; padding: 6px; font-weight: normal; }\n  table.items thead tr th { background-color: #f8f8f8; border: 1px solid #000; font-weight: bold; }\n  table.info-table { border: none; margin-top: 15px; }\n  table.info-table td { border: none; padding: 5px; }\n  table.signatures th, table.signatures td { border: 1px solid #000; padding: 10px; text-align: center; }\n  table.signatures th { background-color: #f5f5f5; font-weight: bold; }\n  .text-right { text-align: right; }\n  .text-end { text-align: end; }\n  .text-center { text-align: center; }\n  .text-start { text-align: start; }\n  .approval-status { font-size: 11px; padding: 2px 6px; border-radius: 3px; }\n  .status-approved { background-color: #d4edda; color: #155724; }\n  .status-pending { background-color: #fff3cd; color: #856404; }\n  .status-rejected { background-color: #f8d7da; color: #721c24; }\n  .project-summary { margin-top: 40px; padding: 15px; border: 1px solid #ccc; background-color: #f9f9f9; }\n  .overall-total { margin-top: 20px; padding: 10px; background-color: #e8f4fd; border: 2px solid #000; font-size: 14px; }\n  @media print { \n    body { margin: 10mm; } \n    .no-print { display: none; } \n    table { page-break-inside: avoid; }\n    .signatures-table { page-break-before: always; }\n  }\n</style>\n</head>\n<body>\n<div class="header">\n  <img src="https://bushman.ink/copex.jpg" class="logo" />\n  <div class="budget-box">\n    BUDGET NO. <br>\n    <span style="color:red;">00${e}</span>\n  </div>\n</div>\n\n<div class="reg-info">\n  TIN: 103-826-519<br>\n  VRN: 20-01-017530R\n</div>\n\n<div class="company-title">\n  <h2>COPEX CONTRACTORS CO.LTD</h2>\n  <div>Msamvu, P.O.BOX 678, Morogoro</div>\n  <div>Mobile, 0713 000 777, 0657 111 555</div>\n</div>\n\n<div class="title">${nt.value.account_budget||"Account Budget"}</div>\n\n<table class="info-table">\n  <tr>\n    <td style="width: 33%;"><strong>Budget Type:</strong> ${nt.value.type||"-"}</td>\n    <td style="width: 33%; text-align: center;"><strong>Date:</strong> ${l}</td>\n    <td style="width: 33%; text-align: right;">${nt.value.cheque_no?`<strong>Cheque No:</strong> ${nt.value.cheque_no}`:""}</td>\n  </tr>\n</table>\n\n\n${Object.keys(d).length>0?Object.keys(d).map((t=>b(t,d[t]))).join(""):'<p style="text-align: center; margin-top: 20px;">No items found for this budget.</p>'}\n\n<div class="text-end">\n  <strong style = "text-start">GRAND TOTAL:</strong> <span style="font-size: 16px; color: #d9534f;">${ot(u)}</span>\n</div>\n\n<div class="section-title" style="margin-top: 40px; text-align: center; text-decoration: none;">\n  APPROVAL CHAIN\n</div>\n\n${g.roles_sequence&&g.roles_sequence.length>0?`\n<table class="signatures" style="margin-top: 15px;">\n  <thead>\n    <tr>\n    ${g.roles_sequence.map((t=>`\n      <th class="text-center">${t.name}</th>\n    `)).join("")}    \n    </tr>    \n  </thead>\n  <tbody>\n    <tr>\n    ${g.roles_sequence.map((t=>`\n      <td class="text-center">\n        <span class="approval-status ${3===t.status_id?"status-approved":4===t.status_id?"status-rejected":"status-pending"}">\n          ${t.status.name?t.status.name.toUpperCase():"PENDING"}\n        </span>\n      </td>\n      `)).join("")}\n    </tr>\n  </tbody>\n</table>\n`:'<p style="text-align: center; color: #666;">No approval chain information available.</p>'}\n\n<div style="margin-top: 40px; text-align: center; font-size: 12px; border-top: 1px solid #666; padding-top: 8px;">\n  <p>Â© ${(new Date).getFullYear()} COPEX CONTRACTORS CO.LTD | TIN: 103-826-519 | VRN: 20-01-017530R</p>\n  <p>Msamvu, P.O.BOX 678, Morogoro | Mobile: 0713 000 777, 0657 111 555</p>\n</div>\n\n<div style="margin-top: 10px; font-size: 11px; text-align: left;">\n  ${i}\n</div>\n\n</body>\n</html>\n`,v=t.contentWindow.document;v.open(),v.write(h),v.close(),t.onload=()=>{t.contentWindow.focus(),t.contentWindow.print(),setTimeout((()=>{document.body.removeChild(t)}),1e3)}}catch(t){v(`Failed to print budget: ${t.message}`)}},gt=t=>{nt.value=t,st.value=t.cheque_no,bt.value=t.remark},bt=(0,s.iH)(""),ht=async()=>{e.value=!0;const t={cheque_no:st.value,remark:bt.value};try{const n=await dt.put(`account-budgets/${nt.value.id}`,t);200===n.status&&(document.getElementById("close_cheque").click(),vt(),a("Account Budget updated successfully!"),pt())}catch(n){v(n.response?.data?.message||n.message||"Failed to update account budget")}finally{e.value=!1}},vt=async()=>{const t=await dt.get("account-budgets");at.value=t.data.map(((t,e)=>{let a=0;return t.items&&Array.isArray(t.items)&&t.items.forEach((t=>{t.approval_list&&t.approval_list.items&&t.approval_list.items.forEach((t=>{if(t.requisition_items){const e=t.requisition_items,n=parseFloat(t.quantity||0)*parseFloat(e.rate||0);a+=n}}))})),{SNo:e+1,id:t.id,account_budget:t.name,type:t.type,cheque_no:t.cheque_no,remark:t.remark,date:x(t.created_at),amount:ot(a),items:t.items}}))};return(0,n.bv)((()=>{ct()})),(t,a)=>{const l=(0,n.up)("v-client-table"),i=(0,n.up)("router-link");return(0,n.wg)(),(0,n.iD)("div",d,[c,K.value?((0,n.wg)(),(0,n.iD)("div",{key:0,innerHTML:(0,s.SU)(j)()},null,8,u)):((0,n.wg)(),(0,n.iD)("div",p,[(0,n._)("div",m,[(0,n._)("div",g,[(0,n._)("div",b,[(0,n.Wm)(l,{data:at.value,columns:tt.value,options:rt.value},{status:(0,n.w5)((t=>[(0,n._)("span",{class:(0,o.C_)(["badge inv-status","badge-"+t.row.status.class])},(0,o.zw)(t.row.status.key),3)])),actions:(0,n.w5)((t=>[(0,n._)("a",{href:"javascript:;",class:"edit me-3",onClick:e=>ut(t.row),"data-bs-toggle":"modal","data-bs-target":"#view-budget-modal",title:"View","data-bs-placement":"top"},_,8,h),(0,n._)("a",{href:"javascript:;",class:"edit me-3",onClick:e=>gt(t.row),"data-bs-toggle":"modal","data-bs-target":"#edit-budget-modal",title:"cheque","data-bs-placement":"top"},y,8,f)])),_:1},8,["data","columns","options"])])])])])),(0,n._)("div",w,[(0,n._)("div",k,[(0,n._)("div",q,[(0,n._)("div",{class:"modal-header"},[(0,n._)("div",{class:"ms-auto"},[(0,n._)("button",{type:"button",class:"btn btn-light","data-bs-dismiss":"modal",onClick:pt},"X")])]),(0,n._)("div",C,[(0,n._)("div",$,[S,(0,n._)("h4",A,(0,o.zw)(nt.value.account_budget),1),(0,n._)("div",{class:"d-flex justify-content-end"},[(0,n._)("button",{type:"button",class:"btn btn-success",onClick:mt},N)])]),(0,n._)("div",O,[(0,n._)("div",E,[(0,n._)("div",M,[(0,n._)("div",z,[(0,n._)("div",D,[(0,n.Wm)(l,{data:(0,s.SU)(it),columns:et.value,options:lt.value},{ref_no:(0,n.w5)((t=>[(0,n.Wm)(i,{class:"text-primary",to:`/approvalChain/individual/${t.row.ref_no}`,title:""},{default:(0,n.w5)((()=>[(0,n.Uk)((0,o.zw)(t.row.ref_no),1)])),_:2},1032,["to"])])),status:(0,n.w5)((t=>[(0,n._)("span",{class:(0,o.C_)(["badge","badge-"+t.row.status_color])},(0,o.zw)(t.row.status),3)])),actions:(0,n.w5)((t=>[(0,n.Wm)(i,{class:"text-primary",to:`/approvalChain/individual/${t.row.ref_no}`,title:"view"},{default:(0,n.w5)((()=>[R])),_:2},1032,["to"])])),_:1},8,["data","columns","options"])])])])])])]),(0,n._)("div",{class:"modal-footer"},[(0,n._)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal",onClick:pt},"Close")])])])]),(0,n._)("div",T,[(0,n._)("div",B,[(0,n._)("div",P,[(0,n._)("div",H,[(0,n._)("h1",F,"Account Budget "+(0,o.zw)(nt.value.account_budget),1),(0,n._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:a[0]||(a[0]=t=>pt())})]),(0,n._)("form",{onSubmit:a[4]||(a[4]=(0,r.iM)((t=>ht()),["prevent"]))},[(0,n._)("div",L,[(0,n._)("div",V,[(0,n._)("div",I,[U,(0,n.wy)((0,n._)("input",{type:"text","onUpdate:modelValue":a[1]||(a[1]=t=>st.value=t),class:"form-control",placeholder:"Enter Cheque NO.",min:"1",required:""},null,512),[[r.nr,st.value]])]),(0,n._)("div",W,[X,(0,n.wy)((0,n._)("input",{type:"text","onUpdate:modelValue":a[2]||(a[2]=t=>bt.value=t),class:"form-control",placeholder:"Enter Remark"},null,512),[[r.nr,bt.value]])])])]),(0,n._)("div",Y,[(0,n._)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal",onClick:a[3]||(a[3]=t=>pt()),id:"close_cheque"},"Close"),(0,n._)("button",{type:"submit",class:"btn btn-primary",disabled:e.value},[e.value?((0,n.wg)(),(0,n.iD)("span",Q)):(0,n.kq)("",!0),e.value?((0,n.wg)(),(0,n.iD)("span",Z)):((0,n.wg)(),(0,n.iD)("span",J,"Save"))],8,G)])],32)])])])])}}};const tt=K;var et=tt}}]);
//# sourceMappingURL=3173.c2ad2310.js.map