{"version":3,"file":"js/730.6197284c.js","mappings":"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","sources":["webpack://cork-vue3/./src/views/jobcards/assetConsumption.vue","webpack://cork-vue3/./src/views/jobcards/assetConsumption.vue?f93a"],"sourcesContent":["<template>\r\n  <div class=\"layout-px-spacing\">  \r\n    <!-- Breadcrumb -->\r\n    <ul class=\"navbar-nav flex-row mt-2\">\r\n      <li>\r\n        <div class=\"page-header\">\r\n          <nav class=\"breadcrumb-one\" aria-label=\"breadcrumb\">\r\n            <ol class=\"breadcrumb\">\r\n              <li class=\"breadcrumb-item\"><a href=\"javascript:;\">Masters</a></li>\r\n              <li class=\"breadcrumb-item active\" aria-current=\"page\"><span>Assets Consumption Details</span></li>\r\n            </ol>\r\n          </nav>\r\n        </div>\r\n      </li>\r\n    </ul>\r\n\r\n    <!-- Loading Spinner -->\r\n    <div v-if=\"loading_spinner\" v-html=\"tableShimmer()\"></div>\r\n\r\n    <!-- Machines Table -->\r\n    <div v-else class=\"custom-table table3\">\r\n      <v-client-table :data=\"items\" :columns=\"Columns\" :options=\"table_option\">\r\n        <template #actions=\"props\">\r\n          <svg xmlns=\"http://www.w3.org/2000/svg\" \r\n               width=\"24\" height=\"24\" \r\n               viewBox=\"0 0 24 24\" \r\n               fill=\"none\" stroke=\"currentColor\" \r\n               stroke-width=\"1.5\" \r\n               stroke-linecap=\"round\" \r\n               stroke-linejoin=\"round\" \r\n               class=\"text-primary\"\r\n               @click=\"viewJobcards(props.row.id)\" \r\n               data-bs-toggle=\"modal\" \r\n               data-bs-target=\"#ItemConsumption\">\r\n            <path d=\"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z\"></path>\r\n            <circle cx=\"12\" cy=\"12\" r=\"3\"></circle>\r\n          </svg>\r\n        </template>\r\n      </v-client-table>\r\n    </div>\r\n  \r\n    <!-- Modal -->\r\n    <div class=\"modal fade mymodal\" id=\"ItemConsumption\" data-bs-backdrop=\"false\" data-bs-keyboard=\"false\" tabindex=\"-1\">\r\n      <div class=\"modal-dialog modal-fullscreen modal-dialog-scrollable\">\r\n        <div class=\"modal-content\">\r\n          \r\n          <!-- Header -->\r\n          <div class=\"modal-header\">\r\n            <h1 class=\"modal-title fs-5\">Items Consumption Details</h1>\r\n            <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"\r\n              @click=\"resetModalData()\"></button>\r\n          </div>\r\n\r\n          <!-- Body -->\r\n          <div class=\"modal-body flex-grow-1 overflow-auto\">\r\n            <div class=\"row layout-top-spacing\">\r\n              \r\n              <!-- Jobcards (Left) -->\r\n              <div class=\"col-xl-6 col-lg-12 col-sm-12 layout-spacing\">\r\n                <div class=\"statbox  box-shadow  shadow card\">\r\n                      <div class=\"card-header text-center\">\r\n                        <h4 class=\"mb-0\">JOBCARDS</h4>\r\n                      </div>\r\n                  <div class=\"custom-table table3\">   \r\n                    <v-client-table :data=\"jobcards\" :columns=\"jobcardColumns\">\r\n                      <template #status=\"props\">\r\n                                <span class=\"badge inv-status\" :class=\"'badge-' + props.row.status.class\">{{ props.row.status.key }}</span>\r\n                            </template>\r\n                      <template #actions=\"props\">\r\n                    <span\r\n                    class=\"text-success\"\r\n                     @click=\"viewItems(props.row)\"\r\n                    >\r\n\r\n\r\n<svg\r\n v-if=\"props.row.jobcard_id === selectedjobcard?.jobcard_id\"\r\nxmlns=\"http://www.w3.org/2000/svg\" width=\"26\" height=\"26\" fill=\"currentColor\" class=\"bi bi-check2-circle\" viewBox=\"0 0 16 16\">\r\n  <path d=\"M2.5 8a5.5 5.5 0 0 1 8.25-4.764.5.5 0 0 0 .5-.866A6.5 6.5 0 1 0 14.5 8a.5.5 0 0 0-1 0 5.5 5.5 0 1 1-11 0\"/>\r\n  <path d=\"M15.354 3.354a.5.5 0 0 0-.708-.708L8 9.293 5.354 6.646a.5.5 0 1 0-.708.708l3 3a.5.5 0 0 0 .708 0z\"/>\r\n</svg>\r\n                      <svg\r\n                     v-else\r\n                       xmlns=\"http://www.w3.org/2000/svg\" width=\"26\" height=\"26\" fill=\"currentColor\" class=\"bi bi-circle\" viewBox=\"0 0 16 16\">\r\n  <path d=\"M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16\"/>\r\n</svg>\r\n\r\n                    </span>\r\n\r\n                  </template>\r\n                    </v-client-table>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              \r\n\r\n              <!-- Items (Right) -->\r\n              <div class=\"col-xl-6 col-lg-12 col-sm-12 layout-spacing\" style=\"max-height: 95vh; overflow-y: auto;\">\r\n                <div class=\"row\">\r\n                  <div class=\"col-12 mb-4\" v-if=\"spares.length > 0\">\r\n                    <div class=\"statbox widget box box-shadow widget-statistics h-100 shadow card\">\r\n                      <div class=\"card-header text-center\">\r\n                        <h4 class=\"mb-0\">SPARES USED</h4>\r\n                      </div>\r\n                      <div class=\"card-body\">\r\n                        <div class=\"custom-table table3\">\r\n                          <v-client-table :data=\"spares\" :columns=\"columns\"></v-client-table>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div class=\"col-12 mb-4\" v-if=\"bodyWorks.length > 0\">\r\n                    <div class=\"statbox widget box box-shadow widget-statistics h-100 shadow card\">\r\n                      <div class=\"card-header text-center\">\r\n                        <h4 class=\"mb-0\">BODY WORKS</h4>\r\n                      </div>\r\n                      <div class=\"card-body\">\r\n                        <div class=\"custom-table table3\">\r\n                          <v-client-table :data=\"bodyWorks\" :columns=\"columns\"></v-client-table>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div class=\"col-12 mb-4\" v-if=\"Tyres.length > 0\">\r\n                    <div class=\"statbox widget box box-shadow widget-statistics h-100 shadow card\">\r\n                      <div class=\"card-header text-center\">\r\n                        <h4 class=\"mb-0\">TYRES USED</h4>\r\n                      </div>\r\n                      <div class=\"card-body\">\r\n                        <div class=\"custom-table table3\">\r\n                          <v-client-table :data=\"Tyres\" :columns=\"TyresColumns\"></v-client-table>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div class=\"col-12 mb-4\" v-if=\"additionalWorks.length > 0\">\r\n                    <div class=\"statbox widget box box-shadow widget-statistics h-100 shadow card\">\r\n                      <div class=\"card-header text-center\">\r\n                        <h4 class=\"mb-0\">ADDITIONAL WORKS</h4>\r\n                      </div>\r\n                      <div class=\"card-body\">\r\n                        <div class=\"custom-table table3\">\r\n                          <v-client-table :data=\"additionalWorks\" :columns=\"costNoteColumns\"></v-client-table>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div class=\"col-12 mb-4\" v-if=\"engineeringWorks.length > 0\">\r\n                    <div class=\"statbox widget box box-shadow widget-statistics h-100 shadow card\">\r\n                      <div class=\"card-header text-center\">\r\n                        <h4 class=\"mb-0\">ENGINEERING WORKS</h4>\r\n                      </div>\r\n                      <div class=\"card-body\">\r\n                        <div class=\"custom-table table3\">\r\n                          <v-client-table :data=\"engineeringWorks\" :columns=\"costNoteColumns\"></v-client-table>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div class=\"col-12 mb-4\" v-if=\"labour.length > 0\">\r\n                    <div class=\"statbox widget box box-shadow widget-statistics h-100 shadow card\">\r\n                      <div class=\"card-header text-center\">\r\n                        <h4 class=\"mb-0\">LABOUR COST</h4>\r\n                      </div>\r\n                      <div class=\"card-body\">\r\n                        <div class=\"custom-table table3\">\r\n                          <v-client-table :data=\"labour\" :columns=\"costNoteColumns\"></v-client-table>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div class=\"col-12 mb-4\" v-if=\"electric.length > 0\">\r\n                    <div class=\"statbox widget box box-shadow widget-statistics h-100 shadow card\">\r\n                      <div class=\"card-header text-center\">\r\n                        <h4 class=\"mb-0\">ELECTRICAL WORKS</h4>\r\n                      </div>\r\n                      <div class=\"card-body\">\r\n                        <div class=\"custom-table table3\">\r\n                          <v-client-table :data=\"electric\" :columns=\"costNoteColumns\"></v-client-table>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n            </div>\r\n          </div>\r\n\r\n          <!-- Footer -->\r\n          <div class=\"modal-footer\">\r\n            <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\"\r\n              @click=\"resetModalData()\">Close</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { onMounted, ref, inject, computed } from 'vue';\r\nimport axios from 'axios';\r\nimport { useMeta } from '@/composables/use-meta';\r\nuseMeta({ title: 'Custom Table' });\r\n\r\nconst axiosInstance = axios.create({\r\n  baseURL: process.env.VUE_APP_API_BASE_URL\r\n});\r\n\r\nconst loadingIndicator = inject('loadingIndicator');\r\nconst tableShimmer = inject('tableShimmer');\r\nconst showError = inject('showError');\r\nconst loading_spinner = ref(false);\r\nconst items = ref([]);\r\nconst jobcards = ref([]);\r\nconst spares = ref([]);\r\nconst bodyWorks = ref([]);\r\nconst additionalWorks = ref([]);\r\nconst engineeringWorks = ref([]);\r\nconst labour = ref([]);\r\nconst electric = ref([]);\r\nconst Tyres = ref([]);\r\nconst Columns = ref(['SNo', 'name', 'type', 'fuel_type','complete_jobcards','active_jobcards','total_jobcards','total_cost', 'actions']);\r\nconst TyresColumns = ref(['SNo', 'tyre_no','rate','date_changed']); \r\nconst jobcardColumns = ref([ 'jobcard_id', 'service_type','status', 'date_created','cost', 'actions']);\r\nconst columns = computed(() => ['SNo','spare','quantity', 'rate','cost',  ]);\r\nconst costNoteColumns = computed(() => ['SNo','description','quantity','rate','cost',]);\r\nconst selectedjobcard = ref(null);\r\n\r\nconst table_option = ref({\r\n  perPage: 10,\r\n  perPageValues: [10, 20, 50],\r\n  skin: 'table table-hover table-striped',\r\n  columnsClasses: { actions: 'actions text-center' },\r\n  sortable: ['SNo', 'name','type','fuel_type'],\r\n  sortIcon: { base: 'sort-icon-none', up: 'sort-icon-asc', down: 'sort-icon-desc' },\r\n  pagination: { nav: 'scroll', chunk: 5 },\r\n  texts: {\r\n    count: 'Showing {from} to {to} of {count}',\r\n    filter: '',\r\n    filterPlaceholder: 'Search...',\r\n    limit: 'Results:',\r\n  },\r\n  resizableColumns: false,\r\n  // Add SNo computation\r\n  responseAdapter(data) {\r\n    return data.map((item, index) => ({\r\n      ...item,\r\n      SNo: index + 1\r\n    }));\r\n  }\r\n});\r\n\r\nconst getItems = () => {\r\n  loading_spinner.value = true;\r\n  axiosInstance.get('machine-consumptions')\r\n    .then((response) => {\r\n      items.value = response.data.map((machine, index) => {\r\n        const jobcards = (machine.jobcards || []).map((job, jIndex) => {\r\n          // compute cost for each jobcard once\r\n          const itemCost = (job.item_usages || []).reduce((s, item) => s + (Number(item.quantity) * Number(item.rate)), 0);\r\n          const tyreCost = (job.tyres || []).reduce((s, tyre) => s + Number(tyre.rate), 0);\r\n          const notesCost = (job.cost_notes || []).reduce((s, note) => s + (Number(note.quantity) * Number(note.rate)), 0);\r\n\r\n          return {\r\n            ...job,\r\n            SNo: jIndex + 1,\r\n            cost: itemCost + tyreCost + notesCost, // store raw number\r\n          };\r\n        });\r\n\r\n        // total jobcards & total cost\r\n        const totalJobcards = jobcards.length;\r\n        const totalCost = jobcards.reduce((sum, jc) => sum + jc.cost, 0);\r\n            const completeJobcards = jobcards.filter(jc => jc.status?.toLowerCase() === 'completed').length;\r\n            const activeJobcards   = jobcards.filter(jc => jc.status?.toLowerCase() === 'active').length;\r\n\r\n        return {\r\n          SNo: index + 1,\r\n          id: machine.machine_id,\r\n          name: machine.machine_name,\r\n          type: machine.machine_type,\r\n          fuel_type: machine.fuel_type ?? '-',\r\n          jobcards: jobcards,\r\n          complete_jobcards: completeJobcards,\r\n    active_jobcards: activeJobcards,\r\n          total_jobcards: totalJobcards,\r\n          total_cost: totalCost.toLocaleString() + '/=',\r\n        };\r\n      });\r\n      loading_spinner.value = false;\r\n    })\r\n    .catch(error => {\r\n      showError(error.message || \"Failed to fetch items\");\r\n      loading_spinner.value = false;\r\n    });\r\n};\r\n\r\nconst viewJobcards = (id) => {\r\n  const machine = items.value.find(item => item.id === id);\r\n  jobcards.value = (machine.jobcards || []).map((job, index) => {\r\n    // sum item usages\r\n    const itemCost = (job.item_usages || []).reduce((sum, item) => {\r\n      return sum + (Number(item.quantity) * Number(item.rate));\r\n    }, 0);\r\n    // sum tyres usages\r\n    const tyreCost = (job.tyres || []).reduce((sum, tyre) => {\r\n      return sum + Number(tyre.rate);\r\n    }, 0);\r\n    // sum cost notes usages\r\n    const notesCost = (job.cost_notes || []).reduce((sum, note) => {\r\n      return sum + (Number(note.quantity) * Number(note.rate));\r\n    }, 0);\r\n    // total cost\r\n    const totalCost = itemCost + tyreCost + notesCost;\r\n    return {\r\n      ...job,\r\n      SNo: index + 1,\r\n      cost: totalCost.toLocaleString() + '/=',\r\n      status: {\r\n        key: job.status,\r\n        class: job.status_color\r\n       },\r\n    };\r\n  });\r\n};\r\n\r\nconst viewItems = (jobcard) => {\r\n  selectedjobcard.value = jobcard; // Set the selected jobcard\r\n   spares.value = (jobcard.item_usages.filter(item => item.usage_type === 'spares') || [])\r\n    .map((item, index) => ({ ...item, SNo: index + 1,\r\n      cost : (item.quantity * item.rate).toLocaleString() + '/=',\r\n      rate: Number(item.rate).toLocaleString() +'/=',\r\n     }));\r\n\r\n  bodyWorks.value = (jobcard.item_usages.filter(item => item.usage_type === 'body_works') || [])\r\n    .map((item, index) => ({ ...item, SNo: index + 1,\r\n      cost : (item.quantity * item.rate).toLocaleString() + '/=',\r\n      rate: Number(item.rate).toLocaleString() +'/=',\r\n     }));\r\n\r\n  Tyres.value = (jobcard.tyres || []).map((tyre, index) => ({\r\n    ...tyre,\r\n    SNo: index + 1,\r\n    rate: Number(tyre.rate).toLocaleString() +'/=',\r\n  }));\r\n\r\n    additionalWorks.value = (jobcard.cost_notes.filter(note => note.type === 'additional') || [])\r\n    .map((note, index) => ({ ...note, SNo: index + 1,\r\n      cost : (note.quantity * note.rate).toLocaleString() + '/=',\r\n      rate: Number(note.rate).toLocaleString() +'/=',\r\n     }));\r\n\r\n    engineeringWorks.value = (jobcard.cost_notes.filter(note => note.type === 'engineering') || [])\r\n    .map((note, index) => ({ ...note, SNo: index + 1,\r\n      cost : (note.quantity * note.rate).toLocaleString() + '/=',\r\n      rate: Number(note.rate).toLocaleString() +'/=',\r\n     }));\r\n\r\n    labour.value = (jobcard.cost_notes.filter(note => note.type === 'labour') || [])\r\n    .map((note, index) => ({ ...note, SNo: index + 1,\r\n      cost : (note.quantity * note.rate).toLocaleString() + '/=',\r\n      rate: Number(note.rate).toLocaleString() +'/=',\r\n     }));\r\n    \r\n    electric.value = (jobcard.cost_notes.filter(note => note.type === 'electric') || [])\r\n    .map((note, index) => ({ ...note, SNo: index + 1,\r\n      cost : (note.quantity * note.rate).toLocaleString() + '/=',\r\n      rate: Number(note.rate).toLocaleString() +'/',\r\n     }));\r\n\r\n};\r\n\r\nconst resetModalData = () => {\r\n  jobcards.value = [];\r\n  spares.value = [];\r\n  bodyWorks.value = [];\r\n  Tyres.value = [];\r\n  additionalWorks.value = [];\r\n  engineeringWorks.value = [];\r\n  labour.value = [];\r\n  electric.value = [];\r\n  selectedjobcard.value = null; \r\n};\r\n\r\n\r\nonMounted(() => {\r\n  getItems();\r\n});\r\n</script>\r\n\r\n<style>\r\n.table3 .actions svg {\r\n  padding: 2px;\r\n}\r\n</style>\r\n","import script from \"./assetConsumption.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./assetConsumption.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./assetConsumption.vue?vue&type=style&index=0&id=5950bebb&lang=css\"\n\nconst __exports__ = script;\n\nexport default __exports__"],"names":["useMeta","title","axiosInstance","axios","baseURL","process","tableShimmer","inject","showError","loading_spinner","ref","items","jobcards","spares","bodyWorks","additionalWorks","engineeringWorks","labour","electric","Tyres","Columns","TyresColumns","jobcardColumns","columns","computed","costNoteColumns","selectedjobcard","table_option","perPage","perPageValues","skin","columnsClasses","actions","sortable","sortIcon","base","up","down","pagination","nav","chunk","texts","count","filter","filterPlaceholder","limit","resizableColumns","responseAdapter","data","map","item","index","SNo","getItems","value","get","then","response","machine","job","jIndex","itemCost","item_usages","reduce","s","Number","quantity","rate","tyreCost","tyres","tyre","notesCost","cost_notes","note","cost","totalJobcards","length","totalCost","sum","jc","completeJobcards","status","toLowerCase","activeJobcards","id","machine_id","name","machine_name","type","machine_type","fuel_type","complete_jobcards","active_jobcards","total_jobcards","total_cost","toLocaleString","catch","error","message","viewJobcards","find","key","class","status_color","viewItems","jobcard","usage_type","resetModalData","onMounted","__exports__"],"sourceRoot":""}