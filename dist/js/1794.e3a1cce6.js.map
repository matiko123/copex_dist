{"version":3,"file":"js/1794.e3a1cce6.js","mappings":"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","sources":["webpack://cork-vue3/./src/views/approvalChain/approval.vue","webpack://cork-vue3/./src/views/approvalChain/approval.vue?bf84"],"sourcesContent":["<template>\r\n  <div class=\"row layout-top-spacing\">\r\n    <!-- Main LPO Info Table -->\r\n    <div class=\"col-xl-12 col-lg-12 col-sm-12 layout-spacing my-4\">\r\n      <div class=\"panel p-0\">\r\n        <div class=\"custom-table table3\">\r\n          <table class=\"table table-bordered table-striped\">\r\n            <thead>\r\n              <tr>\r\n                <th>Requester</th>\r\n                <th>Date Requested</th>\r\n                <th>Purpose</th>\r\n                <th>Project</th>\r\n                <th>Vendor</th>\r\n                <th>Awaits</th>\r\n                <th>Cost</th>\r\n                <th>Action</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody v-if=\"lpoDetails\">\r\n              <tr>\r\n                <td>{{ lpoDetails.requester?.name }}</td>\r\n                <td>{{ formatDate(lpoDetails.date) }}</td>\r\n                <td>{{ lpoDetails.description }}</td>\r\n                <td>{{ lpoDetails.project }}</td>\r\n                <td>{{ lpoDetails.vendor?.name }}</td>\r\n                <td>{{ lpoDetails.awaiting_approval?.name }}</td>\r\n                <td>{{ formatNumber(totalCost) }}</td>\r\n                <td>\r\n  <a href=\"javascript:void(0);\" class=\"text-success\" @click=\"printLPO(lpoDetails, lpoDetails.vendor)\">\r\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\"\r\n                      fill=\"currentColor\" class=\"bi bi-printer\" viewBox=\"0 0 16 16\">\r\n                      <path d=\"M2.5 8a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1z\"/>\r\n                      <path d=\"M5 1a2 2 0 0 0-2 2v2H2a2 2 \r\n                        0 0 0-2 2v3a2 2 0 0 0 2 2h1v1a2 2 \r\n                        0 0 0 2 2h6a2 2 0 0 0 2-2v-1h1a2 \r\n                        2 0 0 0 2-2V7a2 2 0 0 0-2-2h-1V3a2 \r\n                        2 0 0 0-2-2H5zM4 3a1 1 0 0 1 1-1h6a1 \r\n                        1 0 0 1 1 1v2H4V3zm1 5a2 2 0 0 0-2 \r\n                        2v1H2a1 1 0 0 1-1-1V7a1 1 0 0 \r\n                        1 1-1h12a1 1 0 0 1 1 1v3a1 1 \r\n                        0 0 1-1 1h-1v-1a2 2 0 0 \r\n                        0-2-2H5zm7 2v3a1 1 0 0 \r\n                        1-1 1H5a1 1 0 0 1-1-1v-3a1 \r\n                        1 0 0 1 1-1h6a1 1 0 0 \r\n                        1 1 1z\"/>\r\n                    </svg>\r\n                  </a>\r\n                </td>\r\n              </tr>\r\n              <tr>\r\n                <td colspan=\"5\"><b>Brief Description:</b> {{ lpoDetails.description }}</td>\r\n              </tr>\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Approval Chain -->\r\n    <div v-if=\"lpoDetails?.roles_sequence\" class=\"custom-table table3 table-responsive\">\r\n      <table class=\"table\">\r\n        <thead>\r\n          <tr>\r\n            <th v-for=\"role in lpoDetails.roles_sequence\" :key=\"role.position\">\r\n              {{ role.name }}\r\n            </th>\r\n          </tr>\r\n        </thead>\r\n        <tbody v-if=\"lpoDetails?.roles_sequence\">\r\n  <tr>\r\n    <td\r\n      v-for=\"(role, idx) in lpoDetails.roles_sequence\"\r\n      :key=\"role.role_id || role.position || idx\"\r\n      :class=\"role?.status?.color ? 'text-' + role.status.color : 'text-danger'\"\r\n    >\r\n      <span>{{ role?.status?.name ?? 'Unchecked' }}</span><br/>\r\n      <span class=\"text-dark\" v-if=\"role.approved_at\">\r\n        Checked At: {{ formatDate(role.approved_at) }}\r\n      </span><br>\r\n      <span class=\"text-dark\" v-if=\"role.remark\">\r\n        Remark: {{ role.remark }}\r\n      </span>\r\n    </td>\r\n  </tr>\r\n</tbody>\r\n\r\n      </table>\r\n    </div>\r\n\r\n    <!-- Approval Items -->\r\n    <div class=\"col-xl-12 col-lg-12 col-sm-12 layout-spacing\">\r\n      <div class=\"panel p-0\">\r\n        <div class=\"custom-table table3\">\r\n          <v-client-table :data=\"requisitionItems\" :columns=\"itemColumns\" :options=\"table_option\" />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { onMounted, ref, inject, computed, watch } from 'vue';\r\nimport axios from 'axios';\r\nconst formatDate = inject('formatDate');\r\nconst formatNumber = inject('formatNumber'); \r\nconst showError = inject('showError');\r\nimport { useRoute } from 'vue-router'\r\n\r\nconst route = useRoute()\r\n const axiosInstance = axios.create({\r\n        baseURL: process.env.VUE_APP_API_BASE_URL\r\n    });\r\n// v-client-table options\r\nconst table_option = ref({\r\n  perPage: 10,\r\n  perPageValues: [10],\r\n  skin: 'table table-hover table-striped',\r\n  columnsClasses: { actions: 'actions text-center' },\r\n  sortable: ['Sno', 'Item'],\r\n  sortIcon: {\r\n    base: 'sort-icon-none',\r\n    up: 'sort-icon-asc',\r\n    down: 'sort-icon-desc',\r\n  },\r\n  pagination: { nav: 'scroll', chunk: 5 },\r\n  texts: {\r\n    count: 'Showing {from} to {to} of {count}',\r\n    filter: '',\r\n    filterPlaceholder: 'Search...',\r\n    limit: 'Results:',\r\n  },\r\n  resizableColumns: false,\r\n})\r\n\r\nconst requisitionItems = ref([])\r\nconst itemColumns = ref(['Sno', 'Item', 'Description', 'Quantity', 'Rate', 'Total'])\r\nconst lpoDetails = ref(null)\r\n\r\n// total cost computed\r\nconst totalCost = computed(() => {\r\n  if (!lpoDetails.value?.items) return 0\r\n  return lpoDetails.value.items.reduce((sum, item) => {\r\n    const qty = parseFloat(item.quantity) || 0\r\n    const rate = parseFloat(item.requisition_items?.rate) || 0\r\n    return sum + qty * rate\r\n  }, 0)\r\n})\r\n\r\n// fetch data from API\r\nconst getlpoDetails = async () => {\r\n  try {\r\n    const response = await axiosInstance.get(`/approval-lists/${route.params.approval_id}`)\r\n    lpoDetails.value = response.data\r\n\r\n    // map requisition items\r\n    const mapItems = (items) => {\r\n      return items.map((item, index) => ({\r\n        Sno: index + 1,\r\n        Item: item.requisition_items?.description,\r\n        Description: item.requisition_items?.remark,\r\n        Quantity: item.quantity,\r\n        Rate: formatNumber(item.requisition_items?.rate),\r\n        Total: formatNumber(item.quantity * item.requisition_items?.rate),\r\n      }))\r\n    }\r\n\r\n    requisitionItems.value = mapItems(response.data.items || [])\r\n  } catch (error) {\r\n    showError(error.message)\r\n    console.error(error)\r\n  }\r\n\r\n}\r\n\r\nconst total_amount = ref(0)\r\n\r\nconst printLPO = async (voucher, vendor) => {\r\n  total_amount.value = voucher.items.reduce(\r\n    (acc, item) => acc + (item.quantity * item.requisition_items?.rate),\r\n    0\r\n  );\r\n\r\n  try {\r\n    const iframe = document.createElement(\"iframe\");\r\n    iframe.style.display = \"none\";\r\n    document.body.appendChild(iframe);\r\n\r\n    const date = new Date(voucher.date);\r\n    const dateString = `${date.getDate().toString().padStart(2, '0')}/${(date.getMonth() + 1).toString().padStart(2, '0')}`;\r\n\r\n    const printContent = `\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n<title>Print LPO</title>\r\n<style>\r\n  body { font-family: Arial, sans-serif; margin: 40px; font-size: 13px; }\r\n  .header { display: flex; justify-content: space-between; align-items: flex-start; }\r\n  .logo { width: 160px; height: auto; }\r\n  .voucher-box { border: 1px solid #000; padding: 5px 10px; font-size: 13px; text-align: center; margin-left: auto; border-radius: 5px; }\r\n  .company-title { text-align: center; margin-top: 10px; }\r\n  .company-title h2 { margin: 5px 0; }\r\n  .reg-info { position: absolute; top: 120px; right: 40px; text-align: right; font-size: 10px; line-height: 1.4; }\r\n  .section-title { text-align: center; font-weight: bold; text-decoration: underline; margin: 20px 0 10px 0; }\r\n  table { width: 100%; border-collapse: collapse; margin-top: 10px; }\r\n  table.items th, table.items td { border: 0.5px solid #000; padding: 6px; }\r\n  table.items thead tr th { background-color: #f8f8f8; }\r\n  .text-right { text-align: right; }\r\n  .text-center { text-align: center; }\r\n  .text-success { color: green; }\r\n  .text-danger { color: red; }\r\n</style>\r\n</head>\r\n<body>\r\n<div class=\"header\">\r\n  <img src=\"https://bushman.ink/copex.jpg\" class=\"logo\" />\r\n  <div class=\"voucher-box\">\r\n    LPO NO:<br>\r\n    <span style=\"color:red;\">${(\"0000\" + route.params.Lpo_id ).slice(-4)}/${dateString}</span>\r\n  </div>\r\n</div>\r\n<div class=\"reg-info\">\r\n  TIN: 135-489-247<br>\r\n  VRN: 40-032826C\r\n</div>\r\n<div class=\"company-title\">\r\n  <h2>COPEX CONTRACTORS CO.LTD</h2>\r\n  <div>Msamvu, P.O.BOX 678, Morogoro</div>\r\n  <div>Mobile, 0713 000 777, 0657 111 555</div>\r\n</div>\r\n\r\n<div class=\"section-title\">LOCAL PURCHASE ORDER</div><br>\r\n<div class=\"title text-center\"><strong>PROJECT : ${voucher?.project?.toUpperCase() ?? \"NO PROJECT\"} </strong></div>\r\n\r\n<p><strong>Vendor Details </strong></p>\r\n<table class=\"items\">\r\n  <thead>\r\n    <tr>\r\n      <th>Vendor Name</th>\r\n      <th>Location</th>\r\n      <th>Email</th>\r\n      <th>Phone</th>\r\n      <th>Address</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    <tr>\r\n      <td>${vendor?.name || ''}</td>\r\n      <td>${vendor?.location || ''}</td>\r\n      <td>${vendor?.email || ''}</td>\r\n      <td>${vendor?.phone || ''}</td>\r\n      <td>${vendor?.address || ''}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<p><strong>Please provide the following as per requisition details below</strong></p>\r\n<table class=\"items\">\r\n  <thead>\r\n    <tr>\r\n      <th>SN</th>\r\n      <th>Item</th>\r\n      <th>Description</th>\r\n      <th>Quantity</th>\r\n      <th>Rate</th>\r\n      <th>Total</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    ${voucher.items.map((item, index) => `\r\n      <tr>\r\n        <td>${index + 1}</td>\r\n        <td>${item.requisition_items?.remark || ''}</td>\r\n        <td>${item.requisition_items?.description || ''}</td>\r\n        <td class=\"text-right\">${item.quantity}</td>\r\n        <td class=\"text-right\">${Number(item.requisition_items?.rate || 0).toLocaleString()}/=</td>\r\n        <td class=\"text-right\">${(item.quantity * item.requisition_items?.rate || 0).toLocaleString()}/=</td>\r\n      </tr>\r\n    `).join(\"\")}\r\n    <tr>\r\n      <td colspan=\"6\" style=\"text-align:right;\">\r\n        <strong>TOTAL</strong> ${total_amount.value.toLocaleString()}/=\r\n      </td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<div class=\"section-title\">APPROVAL CHAIN</div>\r\n<table class=\"items\">\r\n  <thead>\r\n    <tr>\r\n      ${voucher.roles_sequence.map(role => `<th>${role.name}</th>`).join(\"\")}\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    <tr>\r\n      ${voucher.roles_sequence.map(role => `\r\n        <td class=\"text-center ${role?.status?.id == 3 ? 'text-success' : 'text-danger'}\">\r\n          ${role?.status?.name ?? 'Pending'}<br/>\r\n        </td>\r\n      `).join(\"\")}\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n</body>\r\n</html>\r\n`;\r\n\r\n    const iframeDoc = iframe.contentWindow.document;\r\n    iframeDoc.open();\r\n    iframeDoc.write(printContent);\r\n    iframeDoc.close();\r\n\r\n    iframe.onload = () => {\r\n      iframe.contentWindow.focus();\r\n      iframe.contentWindow.print();\r\n      setTimeout(() => document.body.removeChild(iframe), 1000);\r\n    };\r\n  } catch (error) {\r\n    showError(`Failed to print LPO: ${error.message}`);\r\n  }\r\n};\r\n\r\n\r\nconst whatsappAlert = inject('whatsappAlert');\r\nonMounted(() => getlpoDetails());\r\n\r\nwatch(\r\n  () => route.params.Lpo_id,\r\n  (newId, oldId) => {\r\n    if (newId !== oldId) {\r\n      getlpoDetails();\r\n    }\r\n  }\r\n);\r\n\r\n\r\n</script>\r\n","import script from \"./approval.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./approval.vue?vue&type=script&setup=true&lang=js\"\n\nconst __exports__ = script;\n\nexport default __exports__"],"names":["formatDate","inject","formatNumber","showError","route","useRoute","axiosInstance","axios","baseURL","process","table_option","ref","perPage","perPageValues","skin","columnsClasses","actions","sortable","sortIcon","base","up","down","pagination","nav","chunk","texts","count","filter","filterPlaceholder","limit","resizableColumns","requisitionItems","itemColumns","lpoDetails","totalCost","computed","value","items","reduce","sum","item","qty","parseFloat","quantity","rate","requisition_items","getlpoDetails","async","response","get","params","approval_id","data","mapItems","map","index","Sno","Item","description","Description","remark","Quantity","Rate","Total","error","message","console","total_amount","printLPO","voucher","vendor","acc","iframe","document","createElement","style","display","body","appendChild","date","Date","dateString","getDate","toString","padStart","getMonth","printContent","Lpo_id","slice","project","toUpperCase","name","location","email","phone","address","Number","toLocaleString","join","roles_sequence","role","status","id","iframeDoc","contentWindow","open","write","close","onload","focus","print","setTimeout","removeChild","onMounted","watch","newId","oldId","__exports__"],"sourceRoot":""}