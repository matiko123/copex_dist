"use strict";(self["webpackChunkcork_vue3"]=self["webpackChunkcork_vue3"]||[]).push([[2076],{92076:function(e,a,t){t.r(a),t.d(a,{default:function(){return je}});t(26699);var s=t(66252),l=t(2262),n=t(3577),i=t(49963),r=t(87066),o=t(56296);const u=e=>((0,s.dD)("data-v-5158279c"),e=e(),(0,s.Cn)(),e),d={class:"layout-px-spacing"},c=(0,s.uE)('<ul class="navbar-nav flex-row mt-2" data-v-5158279c><li data-v-5158279c><div class="page-header" data-v-5158279c><nav class="breadcrumb-one" aria-label="breadcrumb" data-v-5158279c><ol class="breadcrumb" data-v-5158279c><li class="breadcrumb-item" data-v-5158279c><a href="javascript:;" data-v-5158279c>Masters</a></li><li class="breadcrumb-item active" aria-current="page" data-v-5158279c><span data-v-5158279c>Support Request</span></li></ol></nav></div></li></ul>',1),v={class:"d-flex me-4 mt-2"},m={class:"ms-auto"},p={class:"row layout-top-spacing"},b={class:"col-xl-12 col-lg-12 col-sm-12 layout-spacing"},g={class:"panel p-0"},_={class:"custom-table table3"},y=["innerHTML"],k=["onClick"],w={key:0,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"text-info","data-bs-toggle":"modal","data-bs-target":"#request_support"},f=u((()=>(0,s._)("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"},null,-1))),h=u((()=>(0,s._)("circle",{cx:"12",cy:"12",r:"3"},null,-1))),x=[f,h],C={key:0,xmlns:"http://www.w3.org/2000/svg",width:"26",height:"26",fill:"currentColor",class:"bi bi-check2-all",viewBox:"0 0 16 16"},S=u((()=>(0,s._)("path",{d:"M12.354 4.354a.5.5 0 0 0-.708-.708L5 10.293 1.854 7.146a.5.5 0 1 0-.708.708l3.5 3.5a.5.5 0 0 0 .708 0zm-4.208 7-.896-.897.707-.707.543.543 6.646-6.647a.5.5 0 0 1 .708.708l-7 7a.5.5 0 0 1-.708 0"},null,-1))),D=u((()=>(0,s._)("path",{d:"m5.354 7.146.896.897-.707.707-.897-.896a.5.5 0 1 1 .708-.708"},null,-1))),H=[S,D],q={key:0},R={key:1,class:"text-muted"},U={class:"modal fade mymodal",id:"inquary","data-bs-backdrop":"false","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true"},I={class:"modal-dialog modal-xl"},z={class:"modal-content"},E={class:"modal-header"},M=u((()=>(0,s._)("h5",{class:"modal-title"},"System Inquiry Form",-1))),j={class:"modal-body flex-grow-1 p-3 p-md-4 bg-light",style:{"overflow-y":"auto"}},L=["onSubmit"],N={class:"row"},B={class:"col-12 mb-3"},F=u((()=>(0,s._)("label",{class:"form-label fw-semibold mb-2"}," ðŸ’¬ Type your inquiry and mention users with @ ",-1))),T={class:"mention-container position-relative"},O={class:"popup-content"},V=u((()=>(0,s._)("h6",{class:"mb-0"},"Select User to Mention",-1))),Y={class:"popup-body"},A={class:"search-container mb-2"},K={class:"users-list"},P=["onClick"],J={class:"user-avatar me-2"},$={class:"user-info flex-grow-1"},Z={class:"user-name fw-medium"},G={class:"user-email text-muted small"},Q={key:0,class:"selected-indicator text-success"},W={key:0,class:"no-users text-center text-muted py-3"},X=u((()=>(0,s._)("div",{class:"popup-footer"},[(0,s._)("small",{class:"text-muted"}," Use â†‘â†“ to navigate, Enter to select, Esc to close ")],-1))),ee={class:"form-text"},ae=(0,s.Uk)(" Type @ followed by username to mention users. They will be notified. "),te={key:0,class:"text-info ms-2"},se={class:"d-flex justify-content-end gap-2"},le=["disabled"],ne={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},ie={key:1},re={class:"modal fade mymodal",id:"request_support","data-bs-backdrop":"false","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true"},oe={class:"modal-dialog modal-xl"},ue={class:"modal-content"},de={class:"modal-header"},ce=u((()=>(0,s._)("h1",{class:"modal-title fs-5",id:"staticBackdropLabel"}," Inquiry Details",-1))),ve={class:"modal-body"},me={class:"card shadow mb-4"},pe={class:"card-body"},be={class:"row"},ge={class:"col-md-12 mb-2 text-start"},_e=u((()=>(0,s._)("strong",null,"Sender:",-1))),ye={class:"ms-2"},ke={class:"col-md-12 mb-2 text-start"},we=u((()=>(0,s._)("strong",null,"Request Date:",-1))),fe={class:"ms-2"},he={class:"col-md-12 mb-2 text-start"},xe=u((()=>(0,s._)("strong",null,"Description:",-1))),Ce={class:"mt-2 p-3 bg-light rounded text-start"},Se={class:"d-flex justify-content-center"},De={class:"mb-2 my-4 d-flex justify-content-center"},He={key:0,class:"input-group"},qe=["placeholder"],Re=["disabled"],Ue={key:0,class:"spinner-border spinner-border-sm me-1"},Ie=(0,s.Uk)(" Save ");var ze={setup(e){(0,o.j)({title:"Custom Table"});const a=r.Z.create({baseURL:"https://bushman.ink/api/v1/"}),t=(0,l.iH)(null),u=(0,s.f3)("tableShimmer"),f=JSON.parse(localStorage.getItem("user")).id,h=(0,s.f3)("showMessage"),S=(0,s.f3)("showError"),D=(0,s.f3)("formatDate"),ze=(0,l.iH)([]),Ee=(0,l.iH)(!1),Me=(0,l.iH)(!1),je=(0,l.iH)(!1),Le=((0,l.iH)(!1),(0,l.iH)(["SNo","sender","attendant","description","tagged_users","remark","date","status","actions"])),Ne=(0,l.iH)({perPage:10,perPageValues:[10,20,50],skin:"table table-hover table-striped",columnsClasses:{actions:"actions text-center"},sortable:["SNo","sender_name","description","status"],sortIcon:{base:"sort-icon-none",up:"sort-icon-asc",down:"sort-icon-desc"},pagination:{nav:"scroll",chunk:5},texts:{count:"Showing {from} to {to} of {count}",filter:"",filterPlaceholder:"Search...",limit:"Results:"},resizableColumns:!1}),Be=(0,l.iH)(null),Fe=(0,l.iH)(null),Te=(0,l.iH)(!1),Oe=(0,l.iH)([]),Ve=(0,l.iH)(0),Ye=(0,l.iH)(-1),Ae=(0,l.iH)(""),Ke=(0,l.iH)(0),Pe=(0,s.Fl)((()=>{const e=aa.value,a=[],t=/@([^\s@]+)/g;let s;while(null!==(s=t.exec(e))){const e=s[1],t=Xe.value.find((a=>a.name.toLowerCase()===e.toLowerCase()));t&&!a.find((e=>e.id===t.id))&&a.push(t)}return a})),Je=(0,s.Fl)((()=>{if(!Be.value)return{};const e=Be.value,a=e.getBoundingClientRect(),t=e.closest(".modal-content").getBoundingClientRect(),s=a.left+a.width/2,l=a.top+a.height/2,n=s-t.left-200,i=l-t.top-150;return{left:`${Math.max(10,Math.min(n,t.width-410))}px`,top:`${Math.max(10,Math.min(i,t.height-310))}px`}})),$e=e=>e.split(" ").map((e=>e[0])).join("").toUpperCase().substring(0,2),Ze=()=>{Me.value=!0,(0,s.Y3)((()=>{Be.value&&Be.value.focus()}))},Ge=()=>{Me.value=!1,aa.value="",Te.value=!1,Oe.value=[],Ye.value=-1,Ae.value=""},Qe=()=>{Te.value=!1,Ye.value=-1,Ae.value="",(0,s.Y3)((()=>{Be.value&&Be.value.focus()}))},We=async()=>{je.value=!0,ta.value=!0;try{const e=await a.get("inquiry-remarks?remark_type=inquiry");let t=e.data.data.map((e=>({...e,sender:e.sender_name,attendant:e.attendant_name,date:D(e.created_at),remark:e.remark,status_name:e.status?.name,status_color:e.status?.color,status_id:e.status?.id,tagged_user_ids:e.tagged_users?.map((e=>e.user_id))||[]})));t.sort(((e,a)=>{const t=e.tagged_user_ids.includes(f),s=a.tagged_user_ids.includes(f),l=!e.tagged_user_ids.length&&[8,39].includes(e.remarker_id),n=!a.tagged_user_ids.length&&[8,39].includes(a.remarker_id);return t&&!s?-1:!t&&s?1:l&&!n?-1:!l&&n?1:a.id-e.id})),t=t.map(((e,a)=>({...e,SNo:a+1}))),ze.value=t}catch(e){console.error("Error fetching remarks:",e),S("Failed to load remarks")}finally{je.value=!1,ta.value=!1}},Xe=(0,l.iH)([]),ea=async()=>{try{const e=await a.get("users");Xe.value=e.data.map((e=>({...e,isSelected:!1})))}catch(e){S(e.message)}},aa=(0,l.iH)(""),ta=(0,l.iH)(!1),sa=e=>{const a=aa.value;Ke.value=Be.value.selectionStart;const t=a.substring(0,Ke.value),l=t.lastIndexOf("@");if(-1!==l){const e=t.substring(l+1),a=e.indexOf(" ");if(-1===a||a>e.length)return Ye.value=l,Ae.value=e.toLowerCase(),la(),Te.value=!0,Ve.value=0,void(0,s.Y3)((()=>{Fe.value&&(Fe.value.focus(),Fe.value.select())}))}Te.value=!1,Oe.value=[],Ye.value=-1,Ae.value=""},la=()=>{Oe.value=Xe.value.filter((e=>e.name.toLowerCase().includes(Ae.value)||e.email.toLowerCase().includes(Ae.value))).map((e=>({...e,isSelected:Pe.value.some((a=>a.id===e.id))})))},na=()=>{sa()},ia=e=>{if(Te.value)switch(e.key){case"Escape":Qe();break}},ra=e=>{switch(e.key){case"ArrowDown":e.preventDefault(),Ve.value=(Ve.value+1)%Oe.value.length;break;case"ArrowUp":e.preventDefault(),Ve.value=Ve.value>0?Ve.value-1:Oe.value.length-1;break;case"Enter":e.preventDefault(),Oe.value.length>0&&oa(Oe.value[Ve.value]);break;case"Escape":e.preventDefault(),Qe();break;case"Tab":e.preventDefault(),Oe.value.length>0&&oa(Oe.value[Ve.value]);break}},oa=e=>{if(-1===Ye.value)return;const a=aa.value,t=a.substring(0,Ye.value),l=a.substring(Ke.value);aa.value=t+"@"+e.name+" "+l,Qe(),(0,s.Y3)((()=>{const a=t.length+e.name.length+2;Be.value.focus(),Be.value.setSelectionRange(a,a)}))},ua=()=>Pe.value.map((e=>e.id)),da=async()=>{if(!aa.value.trim())return void S("Remark cannot be empty!");const e=ua();Ee.value=!0;try{const t={remarker_id:f,description:aa.value,type_id:f,remark:null,status_id:18,remark_type:"inquiry",remarker:JSON.parse(localStorage.getItem("user")).name,users:e},s=await a.post("remark",t);201!==s.status&&200!==s.status||(await ca(s),h("Inquary submitted successfully"),document.getElementById("close").click(),We())}catch(t){console.log(t),S(t.message)}finally{Ee.value=!1}},ca=async e=>{const t=ua(),s={remark_id:e.data.id,users:t};try{await a.post("tagged-users",s)}catch(l){S(l.message),console.log(l)}},va=(0,l.iH)(null),ma=(0,l.iH)(!1),pa=(0,l.iH)(""),ba=async e=>{if(va.value){ma.value=!0;try{let t=pa.value?.trim();t||(12==va.value?t="Fixed":17==va.value?t="On Hold":14==va.value&&(t="Remarked"));const s={status_id:va.value,remark:t,attendant_id:JSON.parse(localStorage.getItem("user")).id},l=await a.put(`remark/${e}`,s);200===l.status&&(h("Status updated successfully"),document.getElementById("close_modal").click(),We())}catch(t){console.error(t),S("Failed to update status")}finally{ma.value=!1}}else S("Please select a status first")},ga=(0,l.iH)(null),_a=e=>{ga.value=e.id,t.value=e.status_id},ya=()=>{pa.value="",va.value=null};return(0,s.bv)((()=>{We(),ea()})),(e,a)=>{const r=(0,s.up)("v-client-table");return(0,s.wg)(),(0,s.iD)("div",d,[c,(0,s._)("div",v,[(0,s._)("div",m,[(0,s._)("button",{class:"btn btn-info mx-2",onClick:a[0]||(a[0]=e=>Ze()),title:"Inquary","data-bs-toggle":"modal","data-bs-target":"#inquary"}," Â Create Inquiry ")])]),(0,s._)("div",p,[(0,s._)("div",b,[(0,s._)("div",g,[(0,s._)("div",_,[je.value?((0,s.wg)(),(0,s.iD)("div",{key:0,innerHTML:(0,l.SU)(u)()},null,8,y)):((0,s.wg)(),(0,s.j4)(r,{key:1,data:ze.value,columns:Le.value,options:Ne.value},{status:(0,s.w5)((e=>[(0,s._)("span",{class:(0,n.C_)(["badge inv-status","badge-"+e.row.status_color])},(0,n.zw)(e.row.status_name),3)])),actions:(0,s.w5)((e=>[(0,s._)("a",{href:"javascript:void(0);",title:"View",onClick:a=>_a(e.row)},[12!=e.row.status_id&&e.row.tagged_user_ids.includes((0,l.SU)(f))?((0,s.wg)(),(0,s.iD)("svg",w,x)):(0,s.kq)("",!0)],8,k),12==e.row.status_id?((0,s.wg)(),(0,s.iD)("svg",C,H)):(0,s.kq)("",!0)])),tagged_users:(0,s.w5)((e=>[e.row.tagged_users&&e.row.tagged_users.length?((0,s.wg)(),(0,s.iD)("span",q,(0,n.zw)(e.row.tagged_users.map((e=>e.user_name)).join(", ")),1)):((0,s.wg)(),(0,s.iD)("span",R,"-"))])),_:1},8,["data","columns","options"]))])])])]),(0,s._)("div",U,[(0,s._)("div",I,[(0,s._)("div",z,[(0,s._)("div",E,[M,(0,s._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:a[1]||(a[1]=e=>Ge()),id:"close"})]),(0,s._)("div",j,[(0,s._)("form",{onSubmit:(0,i.iM)(da,["prevent"])},[(0,s._)("div",N,[(0,s._)("div",B,[F,(0,s._)("div",T,[(0,s.wy)((0,s._)("textarea",{ref_key:"remarkTextarea",ref:Be,"onUpdate:modelValue":a[2]||(a[2]=e=>aa.value=e),class:"form-control mention-textarea",rows:"6",placeholder:"Type your inquiry here... Use @ to mention users (type @ followed by username)",onInput:sa,onKeydown:ia,onClick:na},null,544),[[i.nr,aa.value]]),Te.value?((0,s.wg)(),(0,s.iD)("div",{key:0,class:"user-suggestions-popup",style:(0,n.j5)((0,l.SU)(Je))},[(0,s._)("div",O,[(0,s._)("div",{class:"popup-header"},[V,(0,s._)("button",{type:"button",class:"btn-close btn-close-sm",onClick:Qe})]),(0,s._)("div",Y,[(0,s._)("div",A,[(0,s.wy)((0,s._)("input",{ref_key:"userSearchInput",ref:Fe,type:"text",class:"form-control form-control-sm",placeholder:"Search users...","onUpdate:modelValue":a[3]||(a[3]=e=>Ae.value=e),onInput:la,onKeydown:ra},null,544),[[i.nr,Ae.value]])]),(0,s._)("div",K,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(Oe.value,((e,a)=>((0,s.wg)(),(0,s.iD)("div",{key:e.id,class:(0,n.C_)(["user-item cursor-pointer",{active:Ve.value===a}]),onClick:a=>oa(e)},[(0,s._)("div",J,(0,n.zw)($e(e.name)),1),(0,s._)("div",$,[(0,s._)("div",Z,(0,n.zw)(e.name),1),(0,s._)("div",G,(0,n.zw)(e.email),1)]),e.isSelected?((0,s.wg)(),(0,s.iD)("div",Q," âœ“ ")):(0,s.kq)("",!0)],10,P)))),128)),0===Oe.value.length?((0,s.wg)(),(0,s.iD)("div",W," No users found ")):(0,s.kq)("",!0)])]),X])],4)):(0,s.kq)("",!0)]),(0,s._)("div",ee,[ae,(0,l.SU)(Pe).length>0?((0,s.wg)(),(0,s.iD)("span",te," Mentioned: "+(0,n.zw)((0,l.SU)(Pe).map((e=>e.name)).join(", ")),1)):(0,s.kq)("",!0)])])]),(0,s._)("div",se,[(0,s._)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal",onClick:a[4]||(a[4]=e=>Ge()),id:"close"}," Close "),(0,s._)("button",{type:"submit",class:"btn btn-primary",disabled:Ee.value||!aa.value.trim()},[Ee.value?((0,s.wg)(),(0,s.iD)("span",ne)):((0,s.wg)(),(0,s.iD)("span",ie,"Save"))],8,le)])],40,L)])])])]),(0,s._)("div",re,[(0,s._)("div",oe,[(0,s._)("div",ue,[(0,s._)("div",de,[ce,(0,s._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:a[5]||(a[5]=e=>ya()),id:"close"})]),(0,s._)("div",ve,[(0,s._)("div",me,[(0,s._)("div",pe,[(0,s._)("div",be,[(0,s._)("div",ge,[_e,(0,s._)("span",ye,(0,n.zw)(ze.value.find((e=>e.id===ga.value))?.sender_name||"N/A"),1)]),(0,s._)("div",ke,[we,(0,s._)("span",fe,(0,n.zw)(ze.value.find((e=>e.id===ga.value))?.date||"N/A"),1)]),(0,s._)("div",he,[xe,(0,s._)("p",Ce,(0,n.zw)(ze.value.find((e=>e.id===ga.value))?.description||"No description available"),1)])])])]),(0,s._)("div",Se,[(0,s._)("button",{class:"btn btn-success me-2",onClick:a[6]||(a[6]=e=>va.value=12)},"Fix"),17!=t.value?((0,s.wg)(),(0,s.iD)("button",{key:0,class:"btn btn-warning me-2",onClick:a[7]||(a[7]=e=>va.value=17)},"On Hold")):(0,s.kq)("",!0),14!=t.value?((0,s.wg)(),(0,s.iD)("button",{key:1,class:"btn btn-primary me-2",onClick:a[8]||(a[8]=e=>va.value=14)},"Remark")):(0,s.kq)("",!0)]),(0,s._)("div",De,[(0,s._)("span",{class:(0,n.C_)(["badge rounded-pill",{"bg-success":12==va.value,"bg-warning":17==va.value,"bg-primary":14==va.value}]),style:{"font-size":"1rem"}},(0,n.zw)(12==va.value?"Fix Request":17==va.value?"Hold Request":14==va.value?"Remark Request":"Unknown"),3)]),12==va.value||17==va.value||14==va.value?((0,s.wg)(),(0,s.iD)("div",He,[(0,s.wy)((0,s._)("input",{type:"text",class:"form-control",placeholder:12==va.value?"Enter Fix Remark":17==va.value?"Enter Hold Remark":"Enter Remark","onUpdate:modelValue":a[9]||(a[9]=e=>pa.value=e),onKeyup:a[10]||(a[10]=(0,i.D2)((e=>ba(ga.value)),["enter"]))},null,40,qe),[[i.nr,pa.value]]),(0,s._)("button",{class:"btn btn-primary",onClick:a[11]||(a[11]=e=>ba(ga.value)),disabled:ma.value},[ma.value?((0,s.wg)(),(0,s.iD)("span",Ue)):(0,s.kq)("",!0),Ie],8,Re)])):(0,s.kq)("",!0)]),(0,s._)("div",{class:"modal-footer"},[(0,s._)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal",onClick:ya,id:"close_modal"},"Close")])])])])])}}},Ee=t(83744);const Me=(0,Ee.Z)(ze,[["__scopeId","data-v-5158279c"]]);var je=Me}}]);
//# sourceMappingURL=2076.5a95d623.js.map