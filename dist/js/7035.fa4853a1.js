"use strict";(self["webpackChunkcork_vue3"]=self["webpackChunkcork_vue3"]||[]).push([[7035],{47035:function(e,a,t){t.r(a),t.d(a,{default:function(){return Ae}});t(26699);var l=t(66252),s=t(3577),i=t(2262),u=t(49963),n=(t(26212),t(87066)),r=t(56296),o=t(42119);const c={class:"layout-px-spacing"},d=(0,l.uE)('<ul class="navbar-nav flex-row mt-2"><li><div class="page-header"><nav class="breadcrumb-one" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="javascript:;">Masters</a></li><li class="breadcrumb-item active" aria-current="page"><span>Requisitions</span></li></ol></nav></div></li></ul><h3 class="text-center">REQUISITIONS</h3>',2),v={class:"row"},b={class:"card shadow mb-4 col-xl-12 col-lg-12 col-sm-12 layout-spacing"},p={class:"panel p-0"},m={class:"custom-table table3"},_={class:"table table-bordered table-striped"},k=(0,l._)("th",null,"Req No",-1),g=(0,l._)("th",null,"Requester",-1),y=(0,l._)("th",null,"Date Requested",-1),w=(0,l._)("th",null,"Source",-1),h=(0,l._)("th",null,"Purpose",-1),H=(0,l._)("th",null,"Project",-1),q=(0,l._)("th",null,"Cost",-1),f=(0,l._)("th",null,"Status",-1),R={key:0},D={key:0},S=(0,l.Uk)("Subcontractor"),C=["href"],z={key:0},x={colspan:"9",class:"text-start"},j=(0,l._)("b",null," Brief Description : ",-1),P={key:1},U={colspan:"9",class:"text-start"},L=(0,l._)("b",null," Remark : ",-1),Y={key:0,class:"mb-2 text-center"},E={class:"btn-group mb-3"},I=["onClick","disabled"],T=["onClick","disabled"],M=["onClick","disabled"],N=["onClick","disabled"],A={key:0,class:"mb-2"},O={key:1,class:"input-group"},B=["placeholder"],$=["disabled","onClick"],V=["innerHTML"],F={key:1},G={class:(0,s.C_)(["col-lg-12","col-sm-12"])},K={class:"panel p-0"},W={class:"custom-table table3"},J=(0,l._)("button",{class:"btn btn-primary"},"Diesel",-1),Q={key:0,class:"mt-3"},Z=(0,l._)("h4",{class:"text-center text-danger"},"Rejection Details",-1),X={class:"table table-bordered table-striped align-middle"},ee=(0,l._)("thead",null,[(0,l._)("tr",null,[(0,l._)("th",null,"Sno"),(0,l._)("th",null,"Rejected By"),(0,l._)("th",null,"Date"),(0,l._)("th",null,"Reason")])],-1),ae=(0,l._)("td",null,"Director",-1),te={key:1,class:"col-xl-6 col-lg-12 col-sm-12 layout-spacing"},le={class:"panel p-3 position-relative"},se=["href"],ie=(0,l._)("h4",{class:"text-center"},"Proforma Invoice",-1),ue=["src"],ne=["innerHTML"],re={class:"modal fade mymodal",id:"requisitionItems","data-bs-backdrop":"false","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true"},oe={class:"modal-dialog modal-fullscreen"},ce={class:"modal-content"},de={class:"modal-header"},ve=(0,l._)("h1",{class:"modal-title fs-5",id:"staticBackdropLabel"},"Requisition Items",-1),be={class:"modal-body"},pe={class:"col-xl-12 col-lg-12 col-sm-12 layout-spacing"},me={class:"panel p-0"},_e={class:"custom-table table3"},ke={class:"table table-bordered table-striped"},ge=(0,l._)("thead",null,[(0,l._)("tr",null,[(0,l._)("th",null,"Requester"),(0,l._)("th",null,"Date Requested"),(0,l._)("th",null,"Source"),(0,l._)("th",null,"Purpose"),(0,l._)("th",null,"Project"),(0,l._)("th",null,"Status")])],-1),ye={key:0},we={colspan:"5"},he=(0,l._)("b",null," Brief Description : ",-1),He={key:1},qe={colspan:"5"},fe=(0,l._)("b",null," Remark : ",-1),Re={class:"mb-2 text-center fw-bold",style:{"font-size":"x-large"}},De=(0,l._)("strong",null,"Total Cost: ",-1),Se={key:0,class:"mb-2 text-center"},Ce={class:"btn-group mb-3"},ze=["disabled"],xe=["disabled"],je=["disabled"],Pe=["disabled"],Ue={key:0,class:"mb-2"},Le={key:1,class:"input-group"},Ye=["placeholder"],Ee=["disabled"],Ie=["innerHTML"],Te={key:1};var Me={setup(e){(0,r.j)({title:"Custom Table"});const a=n.Z.create({baseURL:"https://bushman.ink/api/v1/"}),t=((0,o.tv)(),(0,o.yj)()),Me=(0,i.iH)(""),Ne=((0,i.iH)(["General","budget","labour","construction materials","spares"]),(0,i.iH)([]),JSON.parse(localStorage.getItem("user")).permissions),Ae=(0,i.iH)([]),Oe=(0,i.iH)(""),Be=(0,i.iH)(!1),$e=(0,i.iH)(""),Ve=(0,l.f3)("tableShimmer"),Fe=(0,l.f3)("formatNumber"),Ge=(0,l.f3)("formatDate"),Ke=(0,l.f3)("loadingSpinner"),We=((0,i.iH)((new Date).toISOString().split("T")[0]),(0,i.iH)("")),Je=(0,i.iH)(""),Qe=(0,i.iH)(""),Ze=(0,i.iH)(""),Xe=(0,i.iH)(),ea=(0,i.iH)(""),aa=(0,i.iH)([]),ta=(0,i.iH)(0),la=((0,i.iH)(""),(0,i.iH)([])),sa=(0,i.iH)(!1),ia=((0,i.iH)(["Sno","ref_no","requester","purpose","type","project","date","cost","status","remark","actions"]),(0,i.iH)(!1),(0,l.f3)("showMessage")),ua=(0,l.f3)("showError"),na=(0,i.iH)([]),ra=(0,i.iH)([]),oa=((0,i.iH)(""),(0,i.iH)([""]),(0,i.iH)([]),(0,i.iH)(""),(0,i.iH)(""),(0,i.iH)([]),(0,i.iH)([]),(0,i.iH)([])),ca=(0,i.iH)(""),da=async()=>{const e=await a.get("projects");oa.value=e.data},va=(0,i.iH)([]),ba=(0,i.iH)(""),pa=async e=>{const t=await a.get(`budgets?project_id=${e}`);va.value=t.data.filter((e=>"closed"===e.status))};(0,l.YP)(ca,(e=>{e&&pa(e.id)})),(0,l.YP)(Oe,(e=>{e&&(na.value=[],ra.value=[],va.value=[],ba.value="",ca.value="",Sa())})),(0,l.YP)($e,(e=>{e&&(Pa(),$e.value=e,na.value=[],ra.value=[],Sa())}));const ma=(0,i.iH)([]),_a=(0,i.iH)("");(0,l.YP)(ba,(e=>{e&&(ma.value=e.items)}));const ka=(0,i.iH)([]),ga=(0,i.iH)(""),ya=(0,i.iH)(""),wa=(0,i.iH)("");(0,l.YP)(_a,(e=>{e&&(ka.value=e.descriptions,Je.value=e.name)})),(0,l.YP)(ga,(e=>{e&&(wa.value=e.quantity*e.quantity_2,ya.value=e.quantity*e.quantity_2*e.cost-e.used_cost,ta.value=e.id,za.value=e.name,ea.value=e.units)}));(0,i.iH)([]),(0,i.iH)("");(0,l.YP)((()=>t.params.status_id),(e=>{sa.value=!0,Ea()}));const ha=async e=>{Be.value=!0;const t={status_id:We.value,remark:Xe.value,...3==We.value&&{approval:{approval_group_id:e.approval_group_id,source:"requisition",source_id:e.id,requester_id:e.requester_id,items:e.items}}};try{await a.put(`requisitions/${e.id}`,t);Ea(),ia("Saved Successfully"),document.getElementById("close").click()}catch(l){console.log(l),ua(l.message)}finally{Be.value=!1}},Ha=(0,i.iH)({perPage:50,perPageValues:[50,100,200,500],skin:"table table-hover table-striped",columnsClasses:{actions:"actions text-center"},sortable:["id","role_name"],sortIcon:{base:"sort-icon-none",up:"sort-icon-asc",down:"sort-icon-desc"},pagination:{nav:"scroll",chunk:5},texts:{count:"Showing {from} to {to} of {count}",filter:"",filterPlaceholder:"Search...",limit:"Results:"},resizableColumns:!1}),qa=(0,i.iH)([]),fa=async e=>{const t=await a.get(e);qa.value=t.data.map(((e,a)=>({...e,SNo:a+1,name:e.name+(e.description?" - "+e.description:""),unit:e.unit??"---"})))},Ra=(0,i.iH)([]),Da=async()=>{const e=await a.get("/labour-types");Ra.value=e.data};(0,l.YP)(Oe,(e=>{"spares"===e&&fa("get-spares"),"labour"===e&&Da(),"construction materials"===e&&fa("get-materials")})),(0,l.YP)(Je,(e=>{"labour"===Oe.value&&e&&(Ze.value=e.rate)}));const Sa=()=>{Qe.value="",Ze.value="",Xe.value="",Je.value="",za.value="",ea.value="",Ca.value="",ga.value="",_a.value=""},Ca=(0,i.iH)(""),za=(0,i.iH)(""),xa=(0,i.iH)([]),ja=(0,i.iH)(["Sno","item","description","units","quantity","rate","total","action"]),Pa=()=>{xa.value=[],$e.value="",Xe.value="",We.value="",ba.value="",_a.value="",ca.value="",ea.value="",Je.value="",Qe.value="",Ze.value="",za.value="",Oe.value="",ga.value="",va.value=[],ma.value=[],ka.value=[],Ya.value=""},Ua=(0,i.iH)(""),La=(0,i.iH)(""),Ya=(0,i.iH)(""),Ea=()=>{const e=t.params.status_id;let l="requisitions";e&&"all"!==e&&(l+=`?status_id=${e}`),a.get(l).then((e=>{let a=e.data.map(((e,a)=>{Ae.value.find((a=>a.id===e.requisition_type_id));return{...e,items:e.items.map(((e,a)=>({...e,Sno:a+1,item:e.remark,rate:Fe(e.rate),total:Fe(e.quantity*e.rate),rate_original:e.rate,quantity_original:e.quantity}))),ref_no:e.id,date:Ge(e.created_at),Sno:a+1,requester_id:e.requester_id,requester_email:e.requester_email,type:e.type,purpose:e.approval_group,attachment:e.attachment?"https://copex.trustdigital.space/"+e.attachment:null,status_id:e.status.id,cost:Fe(e.items.reduce(((e,a)=>e+a.quantity*a.rate),0)),status:{key:e.status,class:e.status_color}}}));a.sort(((e,a)=>{const t=["Unapproved","On Hold","Remarked"],l=t.indexOf(e.status.key),s=t.indexOf(a.status.key);return-1===l&&-1===s?0:-1===l?1:-1===s?-1:l-s})),la.value=a,sa.value=!1})).catch((e=>{ua(e.message),sa.value=!1}))};return(0,l.bv)((async()=>{sa.value=!0,Ea(),da()})),(e,a)=>{const t=(0,l.up)("router-link"),n=(0,l.up)("v-client-table");return(0,l.wg)(),(0,l.iD)("div",c,[d,(0,l._)("div",v,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(la.value,(r=>((0,l.wg)(),(0,l.iD)("div",b,[(0,l._)("div",p,[(0,l._)("div",m,[(0,l._)("table",_,[(0,l._)("thead",null,[(0,l._)("tr",null,[k,g,y,w,h,H,q,f,r.attachment||r.subcontractor?((0,l.wg)(),(0,l.iD)("th",R,"Action")):(0,l.kq)("",!0)])]),(0,l._)("tbody",null,[(0,l._)("tr",null,[(0,l._)("td",null,(0,s.zw)(r.id),1),(0,l._)("td",null,(0,s.zw)(r.requester),1),(0,l._)("td",null,(0,s.zw)(r.date),1),(0,l._)("td",null,(0,s.zw)(r.type),1),(0,l._)("td",null,(0,s.zw)(r.purpose),1),(0,l._)("td",null,(0,s.zw)(r.project),1),(0,l._)("td",null,(0,s.zw)(r?.items?.reduce(((e,a)=>{const t=Number(a.quantity_original)||0,l=Number(a.rate_original)||0;return e+t*l}),0).toLocaleString()+"/="),1),(0,l._)("td",null,[(0,l._)("span",{class:(0,s.C_)(["mb-0 badge",`badge-${r.status?.class}`])},(0,s.zw)(r.status?.key),3)]),r.subcontractor||r.attachment?((0,l.wg)(),(0,l.iD)("td",D,[(0,l.Wm)(t,{class:"btn btn-primary",to:`/subcontractor/${r.subcontractor.id}`},{default:(0,l.w5)((()=>[S])),_:2},1032,["to"]),r.attachment?((0,l.wg)(),(0,l.iD)("a",{key:0,href:r.attachment,target:"_blank",class:"btn btn-sm btn-primary"},"View Attachment",8,C)):(0,l.kq)("",!0)])):(0,l.kq)("",!0)]),r.description?((0,l.wg)(),(0,l.iD)("tr",z,[(0,l._)("td",x,[j,(0,l.Uk)(" "+(0,s.zw)(r.description),1)])])):(0,l.kq)("",!0),r.remark?((0,l.wg)(),(0,l.iD)("tr",P,[(0,l._)("td",U,[L,(0,l.Uk)(" "+(0,s.zw)(r.remark),1)])])):(0,l.kq)("",!0)])]),"Unapproved"!==r.status?.key&&"Remarked"!==r.status?.key&&"On Hold"!==r.status?.key||!(0,i.SU)(Ne).includes("is_md")?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("div",Y,[(0,l._)("div",E,[(0,l._)("button",{class:"btn btn-primary me-2",onClick:e=>(We.value=3,Me.value=r.id,Xe.value=r.remark),disabled:Be.value},"Approve",8,I),(0,l._)("button",{class:"btn btn-danger me-2",onClick:e=>(We.value=4,Me.value=r.id,Xe.value=r.remark),disabled:Be.value},"Reject",8,T),(0,l._)("button",{class:"btn btn-warning me-2",onClick:e=>(We.value=17,Me.value=r.id,Xe.value=r.remark),disabled:Be.value},"Hold Request",8,M),(0,l._)("button",{class:"btn btn-info",onClick:e=>(We.value=14,Xe.value=r.remark,Me.value=r.id),disabled:Be.value},"Remark",8,N)]),Me.value==r.id?((0,l.wg)(),(0,l.iD)("div",A,[(0,l._)("span",{class:(0,s.C_)(["badge rounded-pill",{"bg-danger":4==We.value,"bg-success":3==We.value,"bg-warning":17==We.value,"bg-info":3!=We.value&&4!=We.value}]),style:{"font-size":"1rem"}},(0,s.zw)(3==We.value?"Approve Request":17==We.value?"Hold Request":4==We.value?"Reject Request":"Fill Remark"),3)])):(0,l.kq)("",!0),Me.value==r.id?((0,l.wg)(),(0,l.iD)("div",O,[(0,l.wy)((0,l._)("input",{type:"text",class:"form-control",placeholder:3==We.value?"Enter Approval Remark":4==We.value?"Enter Rejection Remark":"Enter Remark","onUpdate:modelValue":a[0]||(a[0]=e=>Xe.value=e)},null,8,B),[[u.nr,Xe.value]]),(0,l._)("button",{class:"btn btn-primary",type:"button",disabled:Be.value,onClick:e=>ha(r)},[Be.value?((0,l.wg)(),(0,l.iD)("span",{key:0,innerHTML:(0,i.SU)(Ke)()},null,8,V)):((0,l.wg)(),(0,l.iD)("span",F,"Save "))],8,$)])):(0,l.kq)("",!0)])),(0,l._)("div",G,[(0,l._)("div",K,[(0,l._)("div",W,[(0,l.Wm)(n,{data:r.items,columns:ja.value,options:Ha.value},{action:(0,l.w5)((a=>[a.row.asset_id?((0,l.wg)(),(0,l.j4)(t,{key:0,to:`/assets/fuel-statement/${a.row.asset_id}`,onClick:e.closeModal},{default:(0,l.w5)((()=>[J])),_:2},1032,["to","onClick"])):(0,l.kq)("",!0)])),_:2},1032,["data","columns","options"])])]),aa.value.length>0?((0,l.wg)(),(0,l.iD)("div",Q,[Z,(0,l._)("table",X,[ee,(0,l._)("tbody",null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(aa.value,((e,a)=>((0,l.wg)(),(0,l.iD)("tr",{key:e.id},[(0,l._)("td",null,(0,s.zw)(a+1),1),ae,(0,l._)("td",null,(0,s.zw)(new Date(e.created_at).toLocaleDateString("en-GB")),1),(0,l._)("td",null,(0,s.zw)(e.remark),1)])))),128))])])])):(0,l.kq)("",!0)]),Ua.value?((0,l.wg)(),(0,l.iD)("div",te,[(0,l._)("div",le,[(0,l._)("a",{href:Ua.value,target:"_blank",class:"stretched-link"},null,8,se),ie,(0,l._)("embed",{src:Ua.value,type:"application/pdf",width:"100%",height:"600px"},null,8,ue)])])):(0,l.kq)("",!0)])])])))),256))]),sa.value?((0,l.wg)(),(0,l.iD)("div",{key:0,innerHTML:(0,i.SU)(Ve)()},null,8,ne)):(0,l.kq)("",!0),(0,l._)("div",re,[(0,l._)("div",oe,[(0,l._)("div",ce,[(0,l._)("div",de,[ve,(0,l._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:a[1]||(a[1]=e=>Pa()),id:"close"})]),(0,l._)("div",be,[(0,l._)("div",pe,[(0,l._)("div",me,[(0,l._)("div",_e,[(0,l._)("table",ke,[ge,(0,l._)("tbody",null,[(0,l._)("tr",null,[(0,l._)("td",null,(0,s.zw)(La.value.requester),1),(0,l._)("td",null,(0,s.zw)(La.value.date),1),(0,l._)("td",null,(0,s.zw)(La.value.type),1),(0,l._)("td",null,(0,s.zw)(La.value.purpose),1),(0,l._)("td",null,(0,s.zw)(La.value.project),1),(0,l._)("td",null,[(0,l._)("span",{class:(0,s.C_)(["mb-0 badge",`badge-${La.value.status?.class}`])},(0,s.zw)(La.value.status?.key),3)])]),La.value.description?((0,l.wg)(),(0,l.iD)("tr",ye,[(0,l._)("td",we,[he,(0,l.Uk)(" "+(0,s.zw)(La.value.description),1)])])):(0,l.kq)("",!0),La.value.remark?((0,l.wg)(),(0,l.iD)("tr",He,[(0,l._)("td",qe,[fe,(0,l.Uk)(" "+(0,s.zw)(La.value.remark),1)])])):(0,l.kq)("",!0)])])])])]),(0,l._)("div",Re,[De,(0,l._)("span",null,(0,s.zw)(La.value?.items?.reduce(((e,a)=>{const t=Number(a.quantity)||0,l=Number(a.rate)||0;return e+t*l}),0).toLocaleString()+"/="),1)]),"Unapproved"!==La.value.status?.key&&"Remarked"!==La.value.status?.key&&"On Hold"!==La.value.status?.key||!(0,i.SU)(Ne).includes("is_md")?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("div",Se,[(0,l._)("div",Ce,[(0,l._)("button",{class:"btn btn-primary me-2",onClick:a[2]||(a[2]=e=>We.value=3),disabled:Be.value},"Approve",8,ze),(0,l._)("button",{class:"btn btn-danger me-2",onClick:a[3]||(a[3]=e=>We.value=4),disabled:Be.value},"Reject",8,xe),(0,l._)("button",{class:"btn btn-warning me-2",onClick:a[4]||(a[4]=e=>(We.value=17,Xe.value=La.value.remark)),disabled:Be.value},"Hold Request",8,je),(0,l._)("button",{class:"btn btn-info",onClick:a[5]||(a[5]=e=>(We.value=14,Xe.value=La.value.remark)),disabled:Be.value},"Remark",8,Pe)]),We.value?((0,l.wg)(),(0,l.iD)("div",Ue,[(0,l._)("span",{class:(0,s.C_)(["badge rounded-pill",{"bg-danger":4==We.value,"bg-success":3==We.value,"bg-warning":17==We.value,"bg-info":3!=We.value&&4!=We.value}]),style:{"font-size":"1rem"}},(0,s.zw)(3==We.value?"Approve Request":17==We.value?"Hold Request":4==We.value?"Reject Request":"Fill Remark"),3)])):(0,l.kq)("",!0),We.value?((0,l.wg)(),(0,l.iD)("div",Le,[(0,l.wy)((0,l._)("input",{type:"text",class:"form-control",placeholder:3==We.value?"Enter Approval Remark":4==We.value?"Enter Rejection Remark":"Enter Remark","onUpdate:modelValue":a[6]||(a[6]=e=>Xe.value=e)},null,8,Ye),[[u.nr,Xe.value]]),(0,l._)("button",{class:"btn btn-primary",type:"button",disabled:Be.value,onClick:a[7]||(a[7]=e=>ha(La.value))},[Be.value?((0,l.wg)(),(0,l.iD)("span",{key:0,innerHTML:(0,i.SU)(Ke)()},null,8,Ie)):((0,l.wg)(),(0,l.iD)("span",Te,"Save"))],8,Ee)])):(0,l.kq)("",!0)]))])])])])])}}};const Ne=Me;var Ae=Ne}}]);
//# sourceMappingURL=7035.fa4853a1.js.map