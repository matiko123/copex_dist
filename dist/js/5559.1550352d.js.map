{"version":3,"file":"js/5559.1550352d.js","mappings":"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","sources":["webpack://cork-vue3/./src/views/subcontractors/list.vue","webpack://cork-vue3/./src/views/subcontractors/list.vue?3e50"],"sourcesContent":["<template>\r\n  <div class=\"layout-px-spacing\">\r\n    <ul class=\"navbar-nav flex-row mt-2\">\r\n      <li>\r\n        <div class=\"page-header\">\r\n          <nav class=\"breadcrumb-one\" aria-label=\"breadcrumb\">\r\n            <ol class=\"breadcrumb\">\r\n              <li class=\"breadcrumb-item\"><a href=\"javascript:;\">Masters</a></li>\r\n              <li class=\"breadcrumb-item active\" aria-current=\"page\">\r\n                <span>Subcontractors</span>\r\n              </li>\r\n            </ol>\r\n          </nav>\r\n        </div>\r\n      </li>\r\n    </ul>\r\n\r\n    <!-- Loading spinner -->\r\n    <div v-if=\"loading_spinner\" v-html=\"loadingIndicator()\"></div>\r\n\r\n    <!-- Agreements list -->\r\n   <div v-else class=\"row\">\r\n    <div class=\"col-md-6 p-1 \"\r\n      v-for=\"agreement in agreements\" \r\n    :key=\"agreement.id\"\r\n    >\r\n  <div \r\n    class=\"card shadow \"\r\n  >\r\n    <div class=\"card-body d-flex\">\r\n      <div class=\"flex-grow-1\">\r\n        <h5 class=\"card-title text-primary\">\r\n          {{ agreement.project }} - {{ agreement.item }} ({{ agreement.subcontracted_to }})\r\n        </h5>\r\n        <p class=\"card-text mb-1 text-start\"><strong>Subcontracted To:</strong> {{ agreement.subcontracted_to }}</p><br>\r\n        <p class=\"card-text mb-1 text-start\"><strong>Item Description:</strong> {{ agreement.item}}</p><br>\r\n        <p class=\"card-text mb-1 text-start\"><strong>Payment Term:</strong> {{ agreement.payment_term }}</p><br>\r\n        <p class=\"card-text mb-1 text-start\"><strong>Payment Details:</strong> {{ agreement.payment_number }}</p><br>\r\n        <p class=\"card-text mb-1 text-start\"><strong>Agreement Unit:</strong> {{ agreement.unit }}</p><br>\r\n        <!-- <p class=\"card-text mb-1 text-start\"><strong>Budget Quantity:</strong> {{ budget_item_description.value.quantity }} {{ agreement.unit }}</p><br> -->\r\n        <p class=\"card-text mb-1 text-start\"><strong>Agreement Quantity:</strong> {{ agreement.quantity }} {{ agreement.unit }}</p><br>\r\n        <p class=\"card-text mb-1 text-start\" v-if=\"agreement.revised_quantity != 0\"><strong>Revised Quantity:</strong> {{ agreement.revised_quantity }} </p><br v-if=\"agreement.revised_quantity != 0\">\r\n\r\n        <!-- <p class=\"card-text mb-1 text-start\"><strong>Budget Rate:</strong> {{budget_item_description.value.rate }}</p><br>  -->\r\n        <p class=\"card-text mb-1 text-start\"><strong>Agreement Rate:</strong> {{ formatNumber(agreement.rate) }}</p><br>  \r\n        <p class=\"card-text mb-1 text-start\"><strong>Total Cost:</strong> {{ agreement.cost }}</p><br>\r\n        <p class=\"card-text mb-1 text-start\" v-if=\"agreement.revised_quantity != 0\"><strong>Revised Cost:</strong> {{ formatNumber((Number(agreement.revised_quantity) + Number(agreement.quantity))* agreement.rate) }}</p><br  v-if=\"agreement.revised_quantity != 0\">\r\n        <p class=\"card-text mb-1 text-start\"><strong>Payable Amount:</strong> {{ agreement.payable }}</p><br>\r\n        <p class=\"card-text mb-1 text-start\"><strong>Balance Amount:</strong> {{ agreement.balance }}</p><br>\r\n                <p class=\"card-text mb-1 text-start\"><strong>Balance Amount:</strong> {{ agreement.balance }}</p><br>\r\n        <p class=\"card-text mb-1 text-start\"><strong>Archived Quantity To Date:</strong> {{ agreement.archived_quantity }} {{ agreement.unit }}</p><br>\r\n      </div>\r\n      <div class=\"ms-3 d-flex align-items-start\">\r\n        <div class=\"btn-group custom-dropdown mb-4 me-2\" role=\"group\">\r\n    <button id=\"btndefault\" type=\"button\" class=\"btn btn-primary dropdown-toggle\" data-bs-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\">\r\n        Action\r\n        <svg> ... </svg>\r\n    </button>\r\n    <ul class=\"dropdown-menu\" aria-labelledby=\"btndefault\">\r\n        <li>\r\n              <a class=\"dropdown-item\" :href=\"agreement.attachment\" target=\"_blank\">\r\n                Attachment\r\n              </a>\r\n            </li>\r\n        <li>\r\n              <router-link class=\"dropdown-item\" :to=\"`/subcontractor/${agreement.id}`\">\r\n                Details\r\n              </router-link>\r\n            </li>\r\n    </ul>\r\n</div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"card-footer bg-transparent border-0 d-flex justify-content-between\">\r\n<div class=\"btn group d-inline-flex align-items-center mx-auto\">\r\n<button class=\"btn btn-secondary me-2\"\r\n  data-bs-toggle=\"modal\" \r\n  data-bs-target=\"#revised-modal\" \r\n   @click=\"viewDetails(agreement)\"\r\n>\r\n    Revise\r\n</button>      \r\n<button \r\n  type=\"button\"\r\n  class=\" btn btn-primary me-2\"\r\n  data-bs-toggle=\"modal\" \r\n  data-bs-target=\"#quantity-modal\" \r\n  @click=\"viewDetails(agreement)\"\r\n>\r\n  Request\r\n</button>\r\n\r\n  <router-link class=\"btn btn-success\" :to=\"`/subcontractor/${agreement.id}`\">\r\n    History\r\n  </router-link>\r\n</div>      \r\n\r\n\r\n      \r\n    </div>\r\n  </div>\r\n</div>\r\n</div>\r\n\r\n    <!-- Archived quantity modal -->\r\n    <div\r\n      class=\"modal fade mymodal\"\r\n      id=\"quantity-modal\"\r\n      data-bs-backdrop=\"false\"\r\n      data-bs-keyboard=\"false\"\r\n      tabindex=\"-1\"\r\n      aria-labelledby=\"editEngineeringModalLabel\"\r\n      aria-hidden=\"true\"\r\n    >\r\n      <div class=\"modal-dialog modal-xl\">\r\n        <div class=\"modal-content\">\r\n          <div class=\"modal-header\">\r\n            <h1 class=\"modal-title fs-5\" id=\"editEngineeringModalLabel\">\r\n              Subcontract Archived Quantity : {{ selectedAgreement?.subcontracted_to }}\r\n              <span v-if=\"budget_item_description\">\r\n                 (Budget rate {{ formatNumber(budget_item_description.cost) }} and Budget quantity {{ budget_item_description.quantity }} {{  selectedAgreement?.unit }})\r\n              </span>\r\n            </h1>\r\n            <button\r\n              type=\"button\"\r\n              class=\"btn-close\"\r\n              data-bs-dismiss=\"modal\"\r\n              aria-label=\"Close\"\r\n              @click=\"closeEditModal()\"\r\n              id=\"close_modal\"\r\n            ></button>\r\n          </div>\r\n\r\n          <form @submit.prevent=\"updateArchivedQuantity\">\r\n            <div class=\"modal-body\">\r\n              <div class=\"row\">\r\n                <div class=\"col-md-6\">\r\n                  <label for=\"quantity\">\r\n                    Archived Quantity (Remaining:\r\n                    {{\r\n                      Math.max(\r\n                        0,\r\n                        selectedAgreement?.quantity -\r\n                          selectedAgreement?.archived_quantity\r\n                      ).toFixed(2)\r\n                    }})\r\n                  </label>\r\n                  <input\r\n                    type=\"number\"\r\n                    v-model=\"archived_quantity\"\r\n                    class=\"form-control\"\r\n                    placeholder=\"Enter Archived Quantity\"\r\n                    min=\"0\"\r\n                    :max=\"\r\n                      selectedAgreement\r\n                        ? Math.max(\r\n                            0,\r\n                            selectedAgreement.quantity -\r\n                              selectedAgreement.archived_quantity\r\n                          )\r\n                        : undefined\r\n                    \"\r\n                    step=\"any\"\r\n                    required\r\n                  />\r\n                </div>\r\n\r\n                <div class=\"col-md-6\">\r\n                  <label for=\"total\" class=\"form-label\"\r\n                    >Total Expected Archived Quantity</label\r\n                  >\r\n                  <span class=\"form-control\">{{\r\n                    totalArchivedQuantity.toLocaleString()\r\n                  }}</span>\r\n                </div>\r\n        <div class=\"col-md-12 mt-2\" >\r\n          <textarea class=\"form-control\" placeholder=\"Enter Brief Description of the requisition\" v-model=\"briefing\"></textarea>\r\n        </div>\r\n                <div \r\n        class=\"col-md-4 mb-3 \">\r\n            <label class=\"form-label small\">Select Requisition Type</label>\r\n            <multiselect \r\n                v-model=\"requisition_type\"\r\n                :options=\"['budget','general']\"\r\n                placeholder=\"Select Requisition Type\"\r\n                :searchable=\"true\"        \r\n                :multiple=\"false\"\r\n                :required=\"true\"\r\n                :allow-empty=\"false\"\r\n            ></multiselect>\r\n        </div>\r\n        \r\n\r\n                <div class=\"col-md-4\" v-if=\"requisition_type === 'budget'\">\r\n                  <label class=\"form-label small\">Select A Budget</label>\r\n                  <multiselect\r\n                    v-model=\"budget\"\r\n                    :options=\"budgets\"\r\n                    placeholder=\"Select A Budget\"\r\n                    :searchable=\"true\"\r\n                    label=\"name\"\r\n                    :allow-empty=\"false\"\r\n                  />\r\n                </div>\r\n\r\n                <div class=\"col-md-4\" v-if=\"budget\">\r\n                  <label class=\"form-label small\">Select An Item</label>\r\n                  <multiselect\r\n                    v-model=\"budget_item\"\r\n                    :options=\"budgetItems\"\r\n                    placeholder=\"Select An Item\"\r\n                    :searchable=\"true\"\r\n                    label=\"name\"\r\n                    :allow-empty=\"false\"\r\n                  />\r\n                </div>\r\n\r\n                <div class=\"col-md-12\" v-if=\"budget_item\">\r\n                  <label class=\"form-label small\">Select Description</label>\r\n                  <multiselect\r\n                    v-model=\"budget_item_description\"\r\n                    :options=\"budgetItemDescriptions\"\r\n                    placeholder=\"Select An Option\"\r\n                    :searchable=\"true\"\r\n                    label=\"name\"\r\n                    :allow-empty=\"false\"\r\n                  />\r\n                </div>\r\n                 <div class=\"col-md-4\" v-if=\"budget_item_description\">\r\n                  <label class=\"form-label small\">Enter Quantity</label>\r\n                  <input type=\"number\" class=\"form-control\" placeholder=\"Enter Quantity\" v-model=\"quantity\" required>\r\n                </div>\r\n                   <div class=\"col-md-4\" v-if=\"budget_item_description\">\r\n                  <label class=\"form-label small\">Enter Rate</label>\r\n                  <input type=\"number\" class=\"form-control\" placeholder=\"Enter Rate\" v-model=\"rate\" required>\r\n                </div>\r\n               <div class=\"col-md-12\" v-if=\"budget_item_description\">\r\n                  <label class=\"form-label small\">Enter Description</label>\r\n                  <input type=\"text\" class=\"form-control\" placeholder=\"Enter item Description\" v-model=\"description\" required>\r\n                </div>\r\n\r\n                <div class=\"col-md-12 col-lg-12 mb-2 text-end\">\r\n            <button \r\n                type=\"button\" \r\n                class=\"btn btn-outline-success btn-sm mt-4\"\r\n                @click=\"pushItem()\"\r\n                v-if=\"requisition_type === 'budget'\"\r\n            >\r\n                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"feather feather-plus-square\">\r\n                    <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"></rect>\r\n                    <line x1=\"12\" y1=\"8\" x2=\"12\" y2=\"16\"></line>\r\n                    <line x1=\"8\" y1=\"12\" x2=\"16\" y2=\"12\"></line>\r\n                </svg>\r\n                Add Item\r\n            </button>\r\n        </div>\r\n              </div>\r\n            </div>\r\n<!-- item table starts -->\r\n   <div \r\n     v-if=\"requisition_type === 'budget'\"\r\n   class=\"row layout-top-spacing\" style=\"max-height: 67vh; overflow-y: auto;\">\r\n            <div class=\"col-xl-12 col-lg-12 col-sm-12 layout-spacing\">\r\n                <div class=\"panel p-0\">\r\n                    <div class=\"custom-table table3\">\r\n                        <v-client-table :data=\"formRequisitionItems\" :columns=\"itemsColumns\"  >\r\n                          <template #actions=\"props\">\r\n  <a href=\"javascript:void(0);\" title=\"Delete\" @click=\"pullItem(props.row.Sno)\">\r\n                            <svg\r\n                                xmlns=\"http://www.w3.org/2000/svg\"\r\n                                width=\"20\"\r\n                                height=\"20\"\r\n                                viewBox=\"0 0 24 24\"\r\n                                fill=\"none\"\r\n                                stroke=\"currentColor\"\r\n                                stroke-width=\"1.5\"\r\n                                stroke-linecap=\"round\"\r\n                                stroke-linejoin=\"round\"\r\n                                class=\"text-danger\"\r\n                            >\r\n                                <polyline points=\"3 6 5 6 21 6\"></polyline>\r\n                                <path d=\"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\"></path>\r\n                            </svg>\r\n                        </a>\r\n                          </template> \r\n                        \r\n                        </v-client-table>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n<!-- item table ends -->\r\n            <div class=\"modal-footer\">\r\n              <button\r\n                type=\"button\"\r\n                class=\"btn btn-secondary\"\r\n                data-bs-dismiss=\"modal\"\r\n                @click=\"closeEditModal\"\r\n              >\r\n                Close\r\n              </button>\r\n             <button \r\n  type=\"submit\" \r\n  class=\"btn btn-primary\"\r\n  :disabled=\"(formRequisitionItems2.length == 0 && requisition_type ==='budget') || loading_spinner || !requisition_type\"\r\n>\r\n  <span\r\n    v-if=\"loading_spinner\"\r\n    class=\"spinner-border spinner-border-sm text-white me-2\"\r\n    role=\"status\"\r\n  ></span>\r\n  Save\r\n</button>\r\n\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- revised quantity starts -->\r\n      <div\r\n      class=\"modal fade mymodal\"\r\n      id=\"revised-modal\"\r\n      data-bs-backdrop=\"false\"\r\n      data-bs-keyboard=\"false\"\r\n      tabindex=\"-1\"\r\n      aria-labelledby=\"editEngineeringModalLabel\"\r\n      aria-hidden=\"true\"\r\n    >\r\n      <div class=\"modal-dialog modal-xl\">\r\n        <div class=\"modal-content\">\r\n          <div class=\"modal-header\">\r\n            <h1 class=\"modal-title fs-5\" id=\"editEngineeringModalLabel\">\r\n              Subcontractor Revised Quantity {{ selectedAgreement?.item }} ( {{ selectedAgreement?.subcontracted_to }} )\r\n             \r\n            </h1>\r\n            <button\r\n              type=\"button\"\r\n              class=\"btn-close\"\r\n              data-bs-dismiss=\"modal\"\r\n              aria-label=\"Close\"\r\n              @click=\"closeEditModal()\"\r\n              id=\"close-revised\"\r\n            ></button>\r\n          </div>\r\n\r\n          <form @submit.prevent=\"updateRevisedQuantity()\">\r\n            <div class=\"modal-body\">\r\n              <div class=\"row\">\r\n                <div class=\"col-md-6\">\r\n                   <label class=\"form-label\">Enter Revised Quantity</label>\r\n                  <input\r\n                    type=\"number\"\r\n                    v-model=\"revised_quantity\"\r\n                    class=\"form-control\"\r\n                    placeholder=\"Enter Revised Quantity\"\r\n                    step=\"any\"\r\n                    required\r\n                    \r\n                  />\r\n                </div>\r\n\r\n                 <div class=\"col-md-6\">\r\n                   <label class=\"form-label\">Total New Quantity</label>\r\n                  <label class=\"form-control\">{{  (Number(selectedAgreement?.quantity)  + Number(selectedAgreement?.revised_quantity) + Number(revised_quantity)).toFixed(2)}}</label>\r\n                </div>\r\n\r\n                 <div class=\"col-md-12\">\r\n                   <label class=\"form-label\">Enter Brief Description</label>\r\n                   <input\r\n                    type=\"text\"\r\n                    v-model=\"description\"\r\n                    class=\"form-control\"\r\n                    placeholder=\"Enter Brief description\"\r\n                    \r\n                  />                \r\n                </div>\r\n\r\n              </div>\r\n              \r\n            </div>\r\n\r\n            <div class=\"modal-footer\">\r\n              <button\r\n                type=\"button\"\r\n                class=\"btn btn-secondary\"\r\n                data-bs-dismiss=\"modal\"\r\n                @click=\"closeEditModal\"\r\n              >\r\n                Close\r\n              </button>\r\n             <button \r\n  type=\"submit\" \r\n  class=\"btn btn-primary\"\r\n  :disabled=\"loading_spinner\"\r\n>\r\n  <span\r\n    v-if=\"loading_spinner\"\r\n    class=\"spinner-border spinner-border-sm text-white me-2\"\r\n    role=\"status\"\r\n  ></span>\r\n  Save\r\n</button>\r\n\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n     <!-- revised quantity ends -->\r\n  </div>\r\n</template>\r\n\r\n<style>\r\n.table3 .actions svg {\r\n  padding: 2px;\r\n}\r\n</style>\r\n\r\n<script setup>\r\nimport { ref, onMounted, inject, watch, computed } from \"vue\";\r\nimport axios from \"axios\";\r\nimport { useMeta } from \"@/composables/use-meta\";\r\nimport Multiselect from \"@suadelabs/vue3-multiselect\";\r\nimport \"@suadelabs/vue3-multiselect/dist/vue3-multiselect.css\";\r\n\r\nuseMeta({ title: \"Subcontractors Agreements\" });\r\n\r\nconst axiosInstance = axios.create({\r\n  baseURL: process.env.VUE_APP_API_BASE_URL,\r\n});\r\n\r\nconst loadingIndicator = inject(\"loadingIndicator\");\r\nconst formatNumber = inject(\"formatNumber\");\r\nconst showMessage = inject(\"showMessage\");\r\nconst showError = inject(\"showError\");\r\nconst itemsColumns = ref(['Sno', 'item','description','quantity','units','rate','cost','actions']);\r\nconst loading_spinner = ref(false);\r\nconst agreements = ref([]);\r\nconst selectedAgreement = ref(null);\r\nconst archived_quantity = ref(0);\r\nconst totalArchivedQuantity = ref(0);\r\nconst description = ref('');\r\nconst requisition_type = ref('');\r\nconst briefing = ref('');\r\nconst revised_quantity = ref('')\r\nconst quantity = ref('')\r\nconst i = ref(1)  \r\nconst formRequisitionItems = ref([])\r\nconst formRequisitionItems2 = ref([])\r\nconst rate = ref(4000)\r\nconst clearItemForm = ()=>{\r\n    quantity.value = '',\r\n    description.value = ''\r\n    budget_item_description.value = ''\r\n    budget_item.value = '',\r\n    rate.value = ''\r\n}\r\n    const pushItem = () => {\r\n        if(!quantity.value ){\r\n            showError(\"Fill in all fields\");\r\n            return ;\r\n        }\r\n\r\n        if( (quantity.value * rate.value) > (( budget_item_description.value.quantity *  budget_item_description.value.cost ) - budget_item_description.value.used_cost )  ){\r\n            showError(\"Exceeds available budget cost : \"+formatNumber(( budget_item_description.value.quantity *  budget_item_description.value.cost ) - budget_item_description.value.used_cost ) );\r\n            return ;\r\n        }\r\n    const agreement = selectedAgreement.value\r\n    const payload = {\r\n      Sno: i.value,\r\n      item: requisition_type.value === 'budget' ? budget_item.value.name : 'Subcontractor for ' + agreement.item ,\r\n      item_id: requisition_type.value === 'budget' ? budget_item_description.value.id : 0,\r\n      quantity: quantity.value,\r\n      beneficiary: agreement.subcontracted_to + '( '+ agreement.payment_number+' )',\r\n      rate: formatNumber(rate.value),\r\n      // remark: agreement.item + (description.value ? ' ('+ description.value + ')' : ''),\r\n      remark: agreement.item + '( '+ description.value + ' )',\r\n      description: requisition_type.value === 'budget' ? budget_item_description.value.name + (description.value ? ' ('+ description.value + ')' : '') : 'Subcontractor for ' + agreement.item ,\r\n      units: requisition_type.value === 'budget' ?  budget_item_description.value.units : agreement.unit,\r\n      cost : formatNumber(quantity.value *rate.value)\r\n    };\r\n\r\n    const payload2 = {\r\n      Sno: i.value,\r\n      item_id: requisition_type.value === 'budget' ? budget_item_description.value.id : 0,\r\n      quantity: quantity.value,\r\n      beneficiary: agreement.subcontracted_to + '( '+ agreement.payment_number+' )',\r\n      rate: rate.value,\r\n      remark: agreement.item ,\r\n      description: requisition_type.value === 'budget' ? budget_item_description.value.name + (description.value ? ' ('+ description.value + ')' : '') : 'Subcontractor for ' + agreement.item ,\r\n      units: requisition_type.value === 'budget' ?  budget_item_description.value.units : agreement.unit,\r\n    };\r\n\r\n\r\n    // Add Sno as index (1-based)\r\n    i.value = i.value + 1;\r\n    formRequisitionItems.value.push(payload);\r\n    formRequisitionItems2.value.push(payload2);\r\n    clearItemForm()\r\n    }\r\n\r\n\r\n    const pullItem = (sno) => {\r\n    formRequisitionItems.value = formRequisitionItems.value.filter(item => item.Sno !== sno);\r\n    formRequisitionItems2.value = formRequisitionItems2.value.filter(item => item.Sno !== sno);\r\n    formRequisitionItems.value.forEach((item, idx) => {\r\n        item.Sno = idx + 1;\r\n    });\r\n    formRequisitionItems2.value.forEach((item, idx) => {\r\n        item.Sno = idx + 1;\r\n    });\r\n    i.value = formRequisitionItems.value.length + 1;\r\n}\r\n\r\nconst updateRevisedQuantity = async ()=>{\r\n   const payload = {\r\n    revised_quantity: Number(\r\n      Number(selectedAgreement.value?.revised_quantity || 0) +\r\n      Number(revised_quantity.value || 0)\r\n    ),\r\n    description: `Revising agreement work from ${Number(selectedAgreement.value?.quantity || 0) + Number(selectedAgreement.value?.revised_quantity || 0)} to ${Number(selectedAgreement.value?.quantity || 0) + Number(selectedAgreement.value?.revised_quantity || 0) + Number(revised_quantity.value || 0)}${description.value ? ' - ' + description.value : ''}`,\r\n    subcontractor_id : selectedAgreement.value.id,\r\n    remarker_id : JSON.parse(localStorage.getItem(\"user\")).id,\r\n   }\r\n   loading_spinner.value = true\r\n   try{\r\n    const response = await axiosInstance.put(`subcontractor-agreements/${selectedAgreement.value.id}`,payload)\r\n    showMessage('Agreement Revised')\r\n    closeEditModal()\r\n    getAgreements()\r\n   }catch(error){\r\n    showError(error.message)\r\n    console.log(error)\r\n   }finally{\r\n    loading_spinner.value = false\r\n   }\r\n}\r\n\r\nconst budgets = ref([]);\r\nconst budget = ref(\"\");\r\nconst budgetItems = ref([]);\r\nconst budget_item = ref(\"\");\r\nconst budgetItemDescriptions = ref([]);\r\nconst budget_item_description = ref(\"\");\r\n\r\nconst viewDetails = (row) => {\r\n  selectedAgreement.value = row;\r\n  archived_quantity.value = null;\r\n  totalArchivedQuantity.value = Number(row.archived_quantity || 0);\r\n  getBudgets(row.project_id);\r\n};\r\n\r\nwatch(archived_quantity, (newVal) => {\r\n  if (selectedAgreement.value) {\r\n    totalArchivedQuantity.value =\r\n      Number(selectedAgreement.value.archived_quantity || 0) +\r\n      Number(newVal || 0);\r\n  }\r\n});\r\n\r\nconst getAgreements = async () => {\r\n  loading_spinner.value = true;\r\n  try {\r\n    const response = await axiosInstance.get(\"/subcontractor-agreements\");\r\n    agreements.value = response.data.map((item, index) => ({\r\n      ...item,\r\n      SNo: index + 1,\r\n      subcontractor_agreement_id: item.id,\r\n      project_id: item.project.id,\r\n      project: item.project.short_name,\r\n      attachment: \"https://copex.trustdigital.space/\" + item.attachment,\r\n      payment_term: item.payment_term.name,\r\n      rate: item.rate,\r\n      cost: formatNumber(item.quantity * item.rate),\r\n      archived_quantity: item.payments.reduce((sum, p) => sum + (p.quantity/item.rate || 0), 0).toFixed(2),\r\n      payable: formatNumber(item.payments.reduce((sum, p) => sum + (p.quantity || 0), 0)),\r\n      balance: formatNumber(item.quantity * item.rate - item.archived_quantity  * item.rate),\r\n    }));\r\n  } catch (error) {\r\n    showError(error.message);\r\n  } finally {\r\n    loading_spinner.value = false;\r\n  }\r\n};\r\n\r\nconst getBudgets = async (id) => {\r\n  const response = await axiosInstance.get(`budgets?project_id=${id}`);\r\n  budgets.value = response.data.filter((b) => b.status === \"closed\");\r\n};\r\n\r\nwatch(budget, (newVal) => {\r\n  if (newVal) budgetItems.value = newVal.items;\r\n});\r\nwatch(budget_item, (newVal) => {\r\n  if (newVal) budgetItemDescriptions.value = newVal.descriptions;\r\n});\r\n\r\nconst updateArchivedQuantity = async () => {\r\n    if(!archived_quantity.value){\r\n    showError('Enter Archived Quantity !')\r\n    return ;\r\n  }\r\n  loading_spinner.value = true;\r\n      const payload = {\r\n        archived_quantity: totalArchivedQuantity.value,\r\n      }\r\n     try {\r\n    const response = await axiosInstance.put(`/subcontractor-agreements/${selectedAgreement.value.id}`,payload);\r\n    if (response.status === 200) {\r\n      await registerRequisition(selectedAgreement.value);\r\n      document.getElementById(\"close_modal\").click();\r\n      await getAgreements();\r\n      closeEditModal();\r\n    } else {\r\n      showError(error.message);\r\n    }\r\n  } catch (error) {\r\n    showError(error.message);\r\n  } finally {\r\n    loading_spinner.value = false;\r\n  }\r\n};\r\n\r\nconst registerRequisition = async () => {\r\n  if(requisition_type.value === 'general'){\r\n      formRequisitionItems2.value =  [{\r\n      item_id: requisition_type.value === 'budget' ? budget_item_description.value.id : 0,\r\n      quantity: archived_quantity.value,\r\n      beneficiary:selectedAgreement.value.subcontracted_to + '( '+ selectedAgreement.value.payment_number+' )',\r\n      rate: selectedAgreement.value.rate,\r\n      remark: selectedAgreement.value.item,\r\n      description: requisition_type.value === 'budget' ? budget_item_description.value.name : 'Subcontractor for ' + selectedAgreement.value.item ,\r\n      units: selectedAgreement.value.unit,\r\n    }]\r\n  }\r\n  const formData = new FormData();\r\n\r\n  formData.append(\r\n    \"requisition\",\r\n    JSON.stringify({\r\n      date: new Date().toISOString().split(\"T\")[0],\r\n      description: briefing.value,\r\n      project_id: selectedAgreement.value.project_id,\r\n      required_date: new Date().toISOString().split(\"T\")[0],\r\n      requester_id: JSON.parse(localStorage.getItem(\"user\")).id,\r\n      beneficiary: selectedAgreement.value.subcontracted_to,\r\n      subcontractor_agreement_id: selectedAgreement.value.id,\r\n      approval_group_id: 8,\r\n    })\r\n  );\r\n\r\n  formData.append(\r\n    \"type\",\r\n    JSON.stringify({\r\n      name: requisition_type.value,\r\n      item_id: requisition_type.value === 'budget' ? budget.value.id : 0,\r\n    })\r\n  );\r\n\r\n    formData.append(\"items\", JSON.stringify(formRequisitionItems2.value));\r\n \r\n  try {\r\n    await axiosInstance.post(\"create-requisition\", formData, {\r\n      headers: { \"Content-Type\": \"multipart/form-data\" },\r\n    });\r\n    showMessage(\"Requisition created successfully\");\r\n  } catch (error) {\r\n    showError(error.message);\r\n    console.log(error)\r\n  }\r\n};\r\n\r\nconst closeEditModal = () => {\r\n  requisition_type.value = '';\r\n  briefing.value = '';\r\n  archived_quantity.value = 0;\r\n  totalArchivedQuantity.value = 0;\r\n  selectedAgreement.value = null;\r\n  budget.value = \"\";\r\n  budget_item.value = \"\";\r\n  budget_item_description.value = \"\";\r\n  budgetItems.value = [];\r\n  budgetItemDescriptions.value = [];\r\n  revised_quantity.value = ''\r\n  formRequisitionItems.value = []\r\n  formRequisitionItems2.value = []\r\n  document.getElementById('close-revised').click()\r\n  clearItemForm()\r\n};\r\n\r\nonMounted(() => {\r\n  getAgreements();\r\n});\r\n</script>\r\n","import script from \"./list.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./list.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./list.vue?vue&type=style&index=0&id=25cb6fb2&lang=css\"\n\nconst __exports__ = script;\n\nexport default __exports__"],"names":["useMeta","title","axiosInstance","axios","baseURL","process","loadingIndicator","inject","formatNumber","showMessage","showError","itemsColumns","ref","loading_spinner","agreements","selectedAgreement","archived_quantity","totalArchivedQuantity","description","requisition_type","briefing","revised_quantity","quantity","i","formRequisitionItems","formRequisitionItems2","rate","clearItemForm","value","budget_item_description","budget_item","pushItem","cost","used_cost","agreement","payload","Sno","item","name","item_id","id","beneficiary","subcontracted_to","payment_number","remark","units","unit","payload2","push","pullItem","sno","filter","forEach","idx","length","updateRevisedQuantity","async","Number","subcontractor_id","remarker_id","JSON","parse","localStorage","getItem","put","closeEditModal","getAgreements","error","message","console","log","budgets","budget","budgetItems","budgetItemDescriptions","viewDetails","row","getBudgets","project_id","watch","newVal","response","get","data","map","index","SNo","subcontractor_agreement_id","project","short_name","attachment","payment_term","payments","reduce","sum","p","toFixed","payable","balance","b","status","items","descriptions","updateArchivedQuantity","registerRequisition","document","getElementById","click","formData","FormData","append","stringify","date","Date","toISOString","split","required_date","requester_id","approval_group_id","post","headers","onMounted","__exports__"],"sourceRoot":""}