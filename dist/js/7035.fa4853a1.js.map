{"version":3,"file":"js/7035.fa4853a1.js","mappings":"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","sources":["webpack://cork-vue3/./src/views/requisitions/sheet.vue","webpack://cork-vue3/./src/views/requisitions/sheet.vue?4f7b"],"sourcesContent":["<template>\r\n    <div class=\"layout-px-spacing\">  \r\n            <ul class=\"navbar-nav flex-row mt-2\">\r\n                <li>\r\n                    <div class=\"page-header\">\r\n                        <nav class=\"breadcrumb-one\" aria-label=\"breadcrumb\">\r\n                            <ol class=\"breadcrumb\">\r\n                                <li class=\"breadcrumb-item\"><a href=\"javascript:;\">Masters</a></li>\r\n                                <li class=\"breadcrumb-item active\" aria-current=\"page\"><span>Requisitions</span></li>\r\n                            </ol>\r\n                        </nav>\r\n                    </div>\r\n                </li>\r\n            </ul>\r\n            <h3 class=\"text-center\">REQUISITIONS</h3>\r\n   \r\n            <!-- requisition details starts -->\r\n             <div class=\"row\">\r\n                    <div \r\n                    v-for=\"requisition in requisitions\"\r\n                    class=\"card shadow mb-4 col-xl-12 col-lg-12 col-sm-12 layout-spacing\">\r\n                <div class=\"panel p-0\">\r\n                    <div class=\"custom-table table3 \">\r\n<table class=\"table table-bordered table-striped\">\r\n      <thead >\r\n        <tr>\r\n          <th>Req No</th>\r\n          <th>Requester</th>\r\n          <th>Date Requested</th>\r\n          <th>Source</th>\r\n          <th>Purpose</th>\r\n          <th>Project</th>\r\n          <th>Cost</th>\r\n          <th>Status</th>\r\n          <th v-if=\"requisition.attachment || requisition.subcontractor \">Action</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        <tr >\r\n          <td>{{ requisition.id }}</td>\r\n          <td>{{ requisition.requester }}</td>\r\n          <td>{{ requisition.date }}</td>\r\n          <td>{{ requisition.type }}</td>\r\n          <td>{{ requisition.purpose }}</td>\r\n          <td>{{ requisition.project }}</td>\r\n          <td>\r\n             {{\r\n          requisition?.items?.reduce((sum, item) => {\r\n            const qty = Number(item.quantity_original) || 0;\r\n            const rate = Number(item.rate_original) || 0;\r\n            return sum + qty * rate;\r\n          }, 0).toLocaleString() + '/='\r\n        }}\r\n          </td>\r\n          <td> <span class=\"mb-0 badge\" :class=\"`badge-${requisition.status?.class}`\">\r\n                  {{ requisition.status?.key }}\r\n                </span>\r\n          </td>\r\n          <td v-if=\"requisition.subcontractor || requisition.attachment\">\r\n            <router-link class=\"btn btn-primary \" :to=\"`/subcontractor/${requisition.subcontractor.id}`\">Subcontractor</router-link>\r\n          \r\n            <a \r\n            v-if=\"requisition.attachment\"\r\n            :href=\"requisition.attachment\" target=\"_blank\" class=\"btn btn-sm btn-primary\" >View Attachment</a>\r\n\r\n          </td>\r\n            \r\n        </tr>\r\n        \r\n     <tr v-if=\"requisition.description\">\r\n      <td colspan=\"9\" class=\"text-start\"><b> Brief Description : </b> {{ requisition.description }}</td>\r\n    </tr>\r\n      <tr v-if=\"requisition.remark\">\r\n      <td colspan=\"9\" class=\"text-start\"> <b> Remark :  </b> {{ requisition.remark }}</td>\r\n    </tr>\r\n      </tbody>\r\n    </table>\r\n<!-- approval buttons starts -->\r\n   <div v-if=\"(requisition.status?.key === 'Unapproved' || requisition.status?.key === 'Remarked' || requisition.status?.key === 'On Hold' ) && user_permissions.includes('is_md')\" class=\"mb-2 text-center\">\r\n  <div class=\"btn-group mb-3\">\r\n    <button class=\"btn btn-primary me-2\" @click=\"status = 3,approval= requisition.id ,remark = requisition.remark\" :disabled=\"spinner\">Approve</button>\r\n    <button class=\"btn btn-danger me-2\" @click=\"status = 4,approval= requisition.id,remark = requisition.remark \" :disabled=\"spinner\">Reject</button>\r\n    <button class=\"btn btn-warning me-2\" @click=\"status = 17,approval= requisition.id ,remark = requisition.remark\" :disabled=\"spinner\">Hold Request</button>\r\n    <button class=\"btn btn-info\" @click=\"status = 14,remark = requisition.remark,approval= requisition.id\" :disabled=\"spinner\">Remark</button>\r\n  </div>\r\n\r\n  <div v-if=\"approval == requisition.id\" class=\"mb-2\">\r\n    <span\r\n      class=\"badge rounded-pill\"\r\n      :class=\"{\r\n        'bg-danger': status == 4,\r\n        'bg-success': status == 3,\r\n        'bg-warning': status == 17,\r\n        'bg-info': status != 3 && status != 4\r\n      }\"\r\n      style=\"font-size: 1rem;\"\r\n    >\r\n      {{\r\n        status == 3\r\n          ? 'Approve Request'\r\n          : status == 17\r\n           ? 'Hold Request'\r\n          : status == 4\r\n          ? 'Reject Request'\r\n          : 'Fill Remark'\r\n      }}\r\n    </span>\r\n  </div>\r\n\r\n  <div class=\"input-group\" v-if=\"approval == requisition.id\">\r\n    <input\r\n      type=\"text\"\r\n      class=\"form-control\"\r\n      :placeholder=\"status == 3 ? 'Enter Approval Remark' : status == 4 ? 'Enter Rejection Remark' : 'Enter Remark'\"\r\n      v-model=\"remark\"\r\n    >\r\n    <button class=\"btn btn-primary\" type=\"button\" :disabled=\"spinner\" @click=\"fillRequisitionRemark(requisition)\">\r\n      <span v-if=\"spinner\" v-html=\"loadingSpinner()\"></span>\r\n      <span v-else>Save </span>\r\n    </button>\r\n  </div>\r\n\r\n</div>\r\n <!-- approval buttons ends -->\r\n              <!-- Requisition Items -->\r\n            <div :class=\"['col-lg-12', 'col-sm-12']\">\r\n              <div class=\"panel p-0\">\r\n                <div class=\"custom-table table3\">\r\n                  <v-client-table :data=\"requisition.items\" :columns=\"itemColumns\" :options=\"table_option\">\r\n                    <template #action=\"props\">\r\n                        <router-link  :to=\"`/assets/fuel-statement/${props.row.asset_id}`\" @click=\"closeModal\" v-if =\"props.row.asset_id\">     \r\n                <button class=\"btn btn-primary\">Diesel</button>\r\n            </router-link>  \r\n                    </template>\r\n                  </v-client-table>\r\n               \r\n                </div>\r\n              </div>\r\n\r\n              <!-- Rejection Details -->\r\n              <div v-if=\"remarks.length > 0\" class=\"mt-3\">\r\n                <h4 class=\"text-center text-danger\">Rejection Details</h4>\r\n                <table class=\"table table-bordered table-striped align-middle\">\r\n                  <thead>\r\n                    <tr>\r\n                      <th>Sno</th>\r\n                      <th>Rejected By</th>\r\n                      <th>Date</th>\r\n                      <th>Reason</th>\r\n                    </tr>\r\n                  </thead>\r\n                  <tbody>\r\n                    <tr v-for=\"remark, i in remarks\" :key=\"remark.id\">\r\n                      <td>{{ i + 1 }}</td>\r\n                      <td>Director</td>\r\n                      <td>{{ new Date(remark.created_at).toLocaleDateString('en-GB') }}</td>\r\n                      <td>{{ remark.remark }}</td>\r\n                    </tr>\r\n                  </tbody>\r\n                </table>\r\n              </div>\r\n            </div>\r\n            <!-- Proforma starts-->\r\n       <div class=\"col-xl-6 col-lg-12 col-sm-12 layout-spacing\" v-if=\"proforma\">\r\n  <div class=\"panel p-3 position-relative\">\r\n    <a :href=\"proforma\" target=\"_blank\" class=\"stretched-link\"></a>\r\n    <h4 class=\"text-center\">Proforma Invoice</h4>\r\n    <embed :src=\"proforma\" type=\"application/pdf\" width=\"100%\" height=\"600px\" />\r\n  </div>\r\n</div>\r\n<!-- proforma ends -->\r\n    </div>\r\n    </div>\r\n    </div>\r\n             </div>\r\n\r\n\r\n             <!-- requisition details ends -->\r\n                           <!-- loading spinner starts -->\r\n                 <div v-if=\"loading_spinner \" v-html=\"tableShimmer()\"></div>\r\n        <!-- Loading spinner ends -->\r\n\r\n\r\n\r\n            <!-- requisition items sterts -->\r\n<div class=\"modal fade mymodal\" id=\"requisitionItems\" data-bs-backdrop=\"false\" data-bs-keyboard=\"false\" tabindex=\"-1\" aria-labelledby=\"staticBackdropLabel\" aria-hidden=\"true\">\r\n  <div class=\"modal-dialog modal-fullscreen\">\r\n    <div class=\"modal-content\">\r\n      <!-- Header -->\r\n      <div class=\"modal-header\">\r\n        <h1 class=\"modal-title fs-5\" id=\"staticBackdropLabel\">Requisition Items</h1>\r\n        <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\" @click=\"clearForm()\" id=\"close\"></button>\r\n      </div>\r\n\r\n      <!-- Body -->\r\n      <div class=\"modal-body\">\r\n\r\n\r\n         <div class=\"col-xl-12 col-lg-12 col-sm-12 layout-spacing\">\r\n                <div class=\"panel p-0\">\r\n                    <div class=\"custom-table table3 \">\r\n<table class=\"table table-bordered table-striped\">\r\n      <thead >\r\n        <tr>\r\n          <th>Requester</th>\r\n          <th>Date Requested</th>\r\n          <th>Source</th>\r\n          <th>Purpose</th>\r\n          <th>Project</th>\r\n          <th>Status</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        <tr >\r\n          <td>{{ requisition.requester }}</td>\r\n          <td>{{ requisition.date }}</td>\r\n          <td>{{ requisition.type }}</td>\r\n          <td>{{ requisition.purpose }}</td>\r\n          <td>{{ requisition.project }}</td>\r\n          <td> <span class=\"mb-0 badge\" :class=\"`badge-${requisition.status?.class}`\">\r\n                  {{ requisition.status?.key }}\r\n                </span></td>\r\n        </tr>\r\n     <tr v-if=\"requisition.description\">\r\n      <td colspan=\"5\"><b> Brief Description : </b> {{ requisition.description }}</td>\r\n    </tr>\r\n      <tr v-if=\"requisition.remark\">\r\n      <td colspan=\"5\"> <b> Remark :  </b> {{ requisition.remark }}</td>\r\n    </tr>\r\n      </tbody>\r\n    </table>\r\n\r\n    </div>\r\n    </div>\r\n    </div>\r\n\r\n                <!-- approval button starts -->\r\n                     <div class=\"mb-2 text-center fw-bold\" style=\"font-size: x-large;\">\r\n      <strong>Total Cost: </strong>\r\n      <span>\r\n        {{\r\n          requisition?.items?.reduce((sum, item) => {\r\n            const qty = Number(item.quantity) || 0;\r\n            const rate = Number(item.rate) || 0;\r\n            return sum + qty * rate;\r\n          }, 0).toLocaleString() + '/='\r\n        }}\r\n      </span>\r\n    </div>\r\n  <div v-if=\"(requisition.status?.key === 'Unapproved' || requisition.status?.key === 'Remarked' || requisition.status?.key === 'On Hold' ) && user_permissions.includes('is_md')\" class=\"mb-2 text-center\">\r\n  <div class=\"btn-group mb-3\">\r\n    <button class=\"btn btn-primary me-2\" @click=\"status = 3\" :disabled=\"spinner\">Approve</button>\r\n    <button class=\"btn btn-danger me-2\" @click=\"status = 4 \" :disabled=\"spinner\">Reject</button>\r\n        <button class=\"btn btn-warning me-2\" @click=\"status = 17 ,remark = requisition.remark\" :disabled=\"spinner\">Hold Request</button>\r\n    <button class=\"btn btn-info\" @click=\"status = 14,remark = requisition.remark\" :disabled=\"spinner\">Remark</button>\r\n  </div>\r\n\r\n  <div v-if=\"status\" class=\"mb-2\">\r\n    <span\r\n      class=\"badge rounded-pill\"\r\n      :class=\"{\r\n        'bg-danger': status == 4,\r\n        'bg-success': status == 3,\r\n        'bg-warning': status == 17,\r\n        'bg-info': status != 3 && status != 4\r\n      }\"\r\n      style=\"font-size: 1rem;\"\r\n    >\r\n      {{\r\n        status == 3\r\n          ? 'Approve Request'\r\n          : status == 17\r\n           ? 'Hold Request'\r\n          : status == 4\r\n          ? 'Reject Request'\r\n          : 'Fill Remark'\r\n      }}\r\n    </span>\r\n  </div>\r\n\r\n  <div class=\"input-group\" v-if=\"status\">\r\n    <input\r\n      type=\"text\"\r\n      class=\"form-control\"\r\n      :placeholder=\"status == 3 ? 'Enter Approval Remark' : status == 4 ? 'Enter Rejection Remark' : 'Enter Remark'\"\r\n      v-model=\"remark\"\r\n    >\r\n    <button class=\"btn btn-primary\" type=\"button\" :disabled=\"spinner\" @click=\"fillRequisitionRemark(requisition)\">\r\n      <span v-if=\"spinner\" v-html=\"loadingSpinner()\"></span>\r\n      <span v-else>Save</span>\r\n    </button>\r\n  </div>\r\n\r\n</div>\r\n\r\n\r\n      </div>\r\n\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n\r\n<!-- requisition items ends -->\r\n\r\n\r\n\r\n   \r\n\r\n\r\n    </div>\r\n</template>\r\n\r\n<script setup>\r\n    import Multiselect from '@suadelabs/vue3-multiselect';\r\n    import '@suadelabs/vue3-multiselect/dist/vue3-multiselect.css';\r\n    import { onMounted, ref,inject,computed,watch } from 'vue';\r\n    import axios from 'axios';\r\n    import { useMeta } from '@/composables/use-meta';\r\n    import '@/assets/sass/scrollspyNav.scss';\r\n\r\n    useMeta({ title: 'Custom Table' });\r\n\r\n    const axiosInstance = axios.create({\r\n        baseURL: process.env.VUE_APP_API_BASE_URL\r\n    });\r\n\r\n    import { useRouter, useRoute } from 'vue-router';\r\n    const router = useRouter();\r\n    const route = useRoute(); \r\n    const approval = ref('')\r\n    const allTypes = ref(['General','budget','labour','construction materials','spares'])\r\n    const  types = ref([])\r\n    const user_permissions = JSON.parse(localStorage.getItem(\"user\")).permissions;\r\n    const requisitionTypes = ref([]);\r\n    const requisition_type = ref('');\r\n    const spinner = ref(false)\r\n    const incidence = ref('')\r\n    const tableShimmer = inject('tableShimmer');\r\n    const formatNumber = inject('formatNumber');\r\n    const formatDate = inject('formatDate');\r\n    const loadingSpinner = inject('loadingSpinner');\r\n    const date = ref(new Date().toISOString().split('T')[0])\r\n    const status = ref('')\r\n    const item = ref('')\r\n    const quantity = ref('')\r\n    const rate = ref('')\r\n    const remark = ref()\r\n    const units = ref('')\r\n    const remarks = ref([])\r\n    const item_id = ref(0)\r\n    const required_date = ref('');\r\n    const requisitions = ref([]);\r\n    const loading_spinner = ref(false);\r\n    const columns = ref(['Sno','ref_no', 'requester','purpose','type','project','date','cost','status','remark',  'actions']);\r\n    const role_registration = ref(false);\r\n    const showMessage = inject('showMessage');\r\n    const showError = inject('showError');\r\n    const formRequisitionItems = ref([])\r\n    const formRequisitionItems2 = ref([])\r\n    const upload = ref('')\r\n    const issueItems = ref([''])\r\n    const unitList = ref([])\r\n    const vendor = ref('')\r\n    const beneficiary = ref('')\r\nconst vendors = ref([])\r\nconst getVendors = async ()=>{\r\n  const response = await axiosInstance.get('vendors')\r\n  vendors.value = response.data\r\n}\r\n\r\nconst assets= ref([])\r\nconst getAssets = async ()=>{\r\n  const response = await axiosInstance.get('machines')\r\n  assets.value = response.data.map((item)=>({\r\n  ...item,\r\n  name : item.name + ' - ' + item.type_name\r\n  }))\r\n}\r\n\r\nconst projects = ref([])\r\nconst project = ref('')\r\n\r\nconst getProjects = async ()=>{\r\n  const response = await axiosInstance.get('projects')\r\n  projects.value = response.data\r\n}\r\n\r\nconst budgets = ref([])\r\nconst budget = ref('')\r\nconst getBudgets = async (id) => {\r\n  const response = await axiosInstance.get(`budgets?project_id=${id}`)\r\n  budgets.value = response.data.filter(b => b.status === 'closed')\r\n}\r\n\r\n\r\nwatch(project, (newVal) => {\r\n    if (newVal) {\r\n        getBudgets(newVal.id)\r\n    }\r\n});\r\n\r\nwatch(requisition_type, (newVal) => {\r\n    if (newVal) {\r\n      formRequisitionItems.value = []\r\n      formRequisitionItems2.value = []\r\n      budgets.value = []\r\n      budget.value = ''\r\n      project.value = ''\r\n      clearItemForm()\r\n    }\r\n});\r\n\r\nwatch(incidence, (newVal) => {\r\n    if (newVal) {\r\n      clearForm()\r\n      incidence.value = newVal\r\n      formRequisitionItems.value = []\r\n      formRequisitionItems2.value = []\r\n      clearItemForm()\r\n    }\r\n});\r\n\r\n\r\n\r\nconst budgetItems = ref([])\r\nconst budget_item = ref('')\r\nwatch(budget, (newVal) => {\r\n    if (newVal) {\r\n         budgetItems.value = newVal.items\r\n    }\r\n});\r\n\r\nconst budgetItemDescriptions = ref([])\r\nconst budget_item_description = ref('')\r\nconst max_cost = ref('')\r\nconst max_quantity = ref('')\r\nwatch(budget_item, (newVal) => {\r\n    if (newVal) {\r\n         budgetItemDescriptions.value = newVal.descriptions\r\n         item.value = newVal.name\r\n    }\r\n});\r\n\r\nwatch(budget_item_description, (newVal) => {\r\n    if (newVal) {\r\n         max_quantity.value = newVal.quantity * newVal.quantity_2,\r\n         max_cost.value = (newVal.quantity * newVal.quantity_2 * newVal.cost) - newVal.used_cost\r\n         item_id.value = newVal.id\r\n         description.value = newVal.name\r\n         units.value = newVal.units\r\n    }\r\n});\r\n\r\nconst subcontractors = ref([])\r\nconst selected_subcontractor = ref('')\r\nconst getSubcontractors = async ()=>{\r\n  const response = await axiosInstance.get('subcontractor-agreements')\r\n  subcontractors.value = response.data.map((item)=>({\r\n    ...item,\r\n    name : item.project.short_name + ' - ' +item.item\r\n  }))\r\n}\r\n\r\n\r\nwatch(() => route.params.status_id, (newStatusId) => {\r\n  loading_spinner.value = true;\r\n  getRequisitions();\r\n});\r\n\r\n\r\nconst getUnits = async ()=>{\r\n  const response = await axiosInstance.get('units')\r\n  unitList.value = response.data\r\n}\r\n\r\n\r\nconst fillRequisitionRemark = async (requisition) => {\r\n  spinner.value = true\r\n  const payload = {\r\n    status_id: status.value,\r\n    remark: remark.value,\r\n    ...(status.value == 3 && {\r\n      approval: {\r\n        approval_group_id: requisition.approval_group_id,\r\n        source: 'requisition',\r\n        source_id: requisition.id,\r\n        requester_id: requisition.requester_id,\r\n        items: requisition.items\r\n      }\r\n    })\r\n  }\r\n\r\n\r\n  try{\r\n    const response = await axiosInstance.put(`requisitions/${requisition.id}`,payload)\r\n     getRequisitions();\r\n    showMessage(\"Saved Successfully\")\r\n    document.getElementById('close').click()\r\n  }catch(error){\r\n    console.log(error)\r\n    showError(error.message)\r\n  }finally{\r\n    spinner.value = false\r\n  }\r\n}\r\n\r\n \r\n    const table_option = ref({\r\n        perPage: 50,\r\n        perPageValues: [  50 ,100 ,200 ,500 ],\r\n        skin: 'table table-hover table-striped',\r\n        columnsClasses: { actions: 'actions text-center' },\r\n        sortable: ['id', 'role_name'],\r\n        sortIcon: {\r\n            base: 'sort-icon-none',\r\n            up: 'sort-icon-asc',\r\n            down: 'sort-icon-desc',\r\n        },\r\n        pagination: { nav: 'scroll', chunk: 5 },\r\n        texts: {\r\n            count: 'Showing {from} to {to} of {count}',\r\n            filter: '',\r\n            filterPlaceholder: 'Search...',\r\n            limit: 'Results:',\r\n        },\r\n        resizableColumns: false,\r\n    });\r\n\r\n\r\nconst items_list = ref([])\r\n    const getItems = async (source) => {\r\n        const response = await  axiosInstance.get(source)\r\n        items_list.value = response.data.map((item, index) => ({\r\n            ...item,\r\n            SNo: index + 1,\r\n            name : item.name + (item.description ? ' - ' + item.description : ''),\r\n            unit:item.unit ?? '---'\r\n        }));\r\n    };\r\n\r\n    const labours = ref([])\r\n    const getLabours = async () => {\r\n        const response = await axiosInstance.get('/labour-types')\r\n        labours.value = response.data\r\n    };\r\n\r\n\r\nwatch(requisition_type, (newVal) => {\r\n    if (newVal === 'spares') getItems('get-spares');\r\n    if (newVal === 'labour') getLabours();\r\n    if (newVal === 'construction materials') getItems('get-materials');\r\n});\r\n\r\nwatch(item, (newVal) => {\r\n    if (requisition_type.value === 'labour' && newVal) {\r\n        rate.value = newVal.rate\r\n    }\r\n});\r\n\r\n\r\n\r\n\r\n\r\nconst clearItemForm = ()=>{\r\n    quantity.value = '',\r\n    rate.value = '',\r\n    remark.value = '',\r\n    item.value = '',\r\n    description.value = ''\r\n    units.value = ''\r\n    asset.value = ''\r\n    budget_item_description.value = ''\r\n    budget_item.value = ''\r\n}\r\n\r\nconst asset = ref('')\r\nconst description = ref('')\r\n\r\n\r\n    const requisitionItems = ref([])\r\n const itemColumns = ref(['Sno','item','description','units', 'quantity','rate','total','action']);\r\n\r\n\r\n    const clearForm = () =>{\r\n      requisitionItems.value= ([])\r\n      incidence.value = '',\r\n      remark.value = '',\r\n      status.value = ''\r\n      budget.value = ''\r\n      budget_item.value = ''\r\n      project.value = ''\r\n      units.value = ''\r\n      item.value = ''\r\n      quantity.value = ''\r\n      rate.value = ''\r\n      description.value = ''\r\n      requisition_type.value = ''\r\n      budget_item_description.value = ''\r\n      budgets.value = []\r\n      budgetItems.value = []\r\n      budgetItemDescriptions.value = []\r\n      briefing.value = ''\r\n    }\r\n\r\n    const proforma = ref('')\r\n    const requisition = ref('')\r\n\r\nconst briefing = ref('')\r\n\r\n\r\nconst getRequisitions = () => {\r\n  const status_id = route.params.status_id; \r\n  \r\n  let url = \"requisitions\";\r\n  if (status_id && status_id !== \"all\") {\r\n    url += `?status_id=${status_id}`;\r\n  }\r\n  \r\n  axiosInstance.get(url)\r\n    .then((response) => {\r\n      let data = response.data.map((item, index) => {\r\n        const type = requisitionTypes.value.find(t => t.id === item.requisition_type_id);\r\n        return {\r\n          ...item,\r\n          items : item.items.map((row,r)=>({\r\n            ...row,\r\n            Sno : r+1,\r\n            item : row.remark,\r\n            rate : formatNumber(row.rate),\r\n            total : formatNumber(row.quantity * row.rate),\r\n            rate_original : row.rate,\r\n            quantity_original : row.quantity\r\n          })),\r\n          ref_no: item.id,\r\n          date: formatDate(item.created_at),\r\n          Sno: index + 1,\r\n          requester_id: item.requester_id,\r\n          requester_email: item.requester_email,\r\n          type: item.type,\r\n          purpose: item.approval_group,\r\n          attachment: item.attachment ? 'https://copex.trustdigital.space/' + item.attachment : null,\r\n          status_id: item.status.id,\r\n          cost: formatNumber(item.items.reduce((total, it) => total + it.quantity * it.rate, 0)),\r\n          status: {\r\n            key: item.status,\r\n            class: item.status_color\r\n          },\r\n        };\r\n      });\r\n\r\n      data.sort((a, b) => {\r\n        const order = ['Unapproved', 'On Hold', 'Remarked'];\r\n        const aIndex = order.indexOf(a.status.key);\r\n        const bIndex = order.indexOf(b.status.key);\r\n        if (aIndex === -1 && bIndex === -1) return 0;\r\n        if (aIndex === -1) return 1;\r\n        if (bIndex === -1) return -1;\r\n        return aIndex - bIndex;\r\n      });\r\n\r\n      requisitions.value = data;\r\n      loading_spinner.value = false;\r\n    })\r\n    .catch((error) => {\r\n      showError(error.message);\r\n      loading_spinner.value = false;\r\n    });\r\n};\r\n\r\n\r\n\r\n\r\n    onMounted(async () => {\r\n        loading_spinner.value = true;\r\n        getRequisitions();\r\n        getProjects()\r\n    });\r\n</script>\r\n","import script from \"./sheet.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./sheet.vue?vue&type=script&setup=true&lang=js\"\n\nconst __exports__ = script;\n\nexport default __exports__"],"names":["useMeta","title","axiosInstance","axios","baseURL","process","route","useRouter","useRoute","approval","ref","user_permissions","JSON","parse","localStorage","getItem","permissions","requisitionTypes","requisition_type","spinner","incidence","tableShimmer","inject","formatNumber","formatDate","loadingSpinner","status","Date","toISOString","split","item","quantity","rate","remark","units","remarks","item_id","requisitions","loading_spinner","showMessage","showError","formRequisitionItems","formRequisitionItems2","projects","project","getProjects","async","response","get","value","data","budgets","budget","getBudgets","id","filter","b","watch","newVal","clearItemForm","clearForm","budgetItems","budget_item","items","budgetItemDescriptions","budget_item_description","max_cost","max_quantity","descriptions","name","quantity_2","cost","used_cost","description","params","status_id","newStatusId","getRequisitions","fillRequisitionRemark","payload","approval_group_id","requisition","source","source_id","requester_id","put","document","getElementById","click","error","console","log","message","table_option","perPage","perPageValues","skin","columnsClasses","actions","sortable","sortIcon","base","up","down","pagination","nav","chunk","texts","count","filterPlaceholder","limit","resizableColumns","items_list","getItems","map","index","SNo","unit","labours","getLabours","asset","requisitionItems","itemColumns","briefing","proforma","url","then","find","t","requisition_type_id","row","r","Sno","total","rate_original","quantity_original","ref_no","date","created_at","requester_email","type","purpose","approval_group","attachment","reduce","it","key","class","status_color","sort","a","order","aIndex","indexOf","bIndex","catch","onMounted","__exports__"],"sourceRoot":""}