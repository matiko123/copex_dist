{"version":3,"file":"js/4183.058559d5.js","mappings":"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","sources":["webpack://cork-vue3/./src/views/attendances/individual.vue","webpack://cork-vue3/./src/views/attendances/individual.vue?67a9"],"sourcesContent":["<template>\r\n  <div class=\"layout-px-spacing\">\r\n    <ul class=\"navbar-nav flex-row mt-2\">\r\n      <li>\r\n        <div class=\"page-header\">\r\n          <nav class=\"breadcrumb-one\" aria-label=\"breadcrumb\">\r\n            <ol class=\"breadcrumb\">\r\n              <li class=\"breadcrumb-item\"><a href=\"javascript:;\">Reports</a></li>\r\n              <li class=\"breadcrumb-item active\" aria-current=\"page\"><span>Geo Location Attendance</span></li>\r\n            </ol>\r\n          </nav>\r\n        </div>\r\n      </li>\r\n    </ul>\r\n\r\n    <div class=\"row\">\r\n      <div class=\"col-md-12\">\r\n        <h4 class=\"text-center\">Geo Location Attendance Report </h4>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"row mb-3\">\r\n      <div class=\"col-md-12 text-end d-flex justify-content-end align-items-center gap-2\">\r\n\r\n        <button \r\n          class=\"btn btn-secondary btn-lg d-flex align-items-center\"\r\n          @click=\"getCurrentLocation\"\r\n          :disabled=\"refreshingLocation\"\r\n          title=\"Refresh Location\"\r\n        >\r\n          <svg v-if=\"refreshingLocation\" class=\"spinner-border spinner-border-sm me-2\" width=\"20\" height=\"20\" role=\"status\"></svg>\r\n          <svg v-else xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" fill=\"currentColor\" class=\"bi bi-arrow-clockwise\" viewBox=\"0 0 16 16\">\r\n            <path fill-rule=\"evenodd\" d=\"M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z\"/>\r\n            <path d=\"M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z\"/>\r\n          </svg>\r\n          <span v-if=\"refreshingLocation\" class=\"ms-2\">Getting Location...</span>\r\n          <span v-else class=\"ms-2\">Refresh Location</span>\r\n        </button>\r\n\r\n        <button   \r\n          class=\"btn btn-primary btn-lg d-flex align-items-center\"\r\n          :disabled=\"userStatus.report || isSupervisorLoading\"\r\n          @click=\"initiateReport\"\r\n          v-if=\"!userStatus.report\"\r\n        >\r\n          <svg v-if=\"isSupervisorLoading\" class=\"spinner-border spinner-border-sm me-2\" width=\"20\" height=\"20\" role=\"status\"></svg>\r\n          <svg v-else xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" fill=\"currentColor\" class=\"bi bi-check-circle me-2\" viewBox=\"0 0 16 16\">\r\n            <path d=\"M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16\"/>\r\n            <path d=\"m10.97 4.97-.02.022-3.473 4.425-2.093-2.094a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05\"/>\r\n          </svg>\r\n          <span v-if=\"isSupervisorLoading\">Submitting...</span>\r\n          <span v-else>Report</span>\r\n        </button>\r\n\r\n\r\n        <input \r\n          type=\"date\" \r\n          v-model=\"selectedDate\" \r\n          class=\"form-control form-control-sm\" \r\n          style=\"width: 150px;\"\r\n        >\r\n        <button @click=\"printReport\" class=\"btn btn-success\">\r\n          <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"currentColor\" class=\"bi bi-printer me-2\" viewBox=\"0 0 16 16\">\r\n            <path d=\"M2.5 8a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1z\"/>\r\n            <path d=\"M5 1a2 2 0 0 0-2 2v2H2a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h1v1a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-1h1a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-1V3a2 2 0 0 0-2-2H5zM4 3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v2H4V3zm1 5a2 2 0 0 0-2 2v1H2a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v-1a2 2 0 0 0-2-2H5zm7 2v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1z\"/>\r\n          </svg>\r\n        </button>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- loading spinner starts -->\r\n    <div v-if=\"loading_spinner\" v-html=\"tableShimmer()\"></div>\r\n    <!-- Loading spinner ends -->\r\n\r\n    <div v-else class=\"row layout-top-spacing\">\r\n      <div class=\"col-xl-12 col-lg-12 col-sm-12 layout-spacing\">\r\n        <div class=\"panel p-0\">\r\n          <div class=\"custom-table table3\">\r\n            <v-client-table :data=\"filteredAttendance\" :columns=\"columns\" :options=\"table_option\">\r\n              <template #actions=\"props\">\r\n                <a\r\n                  href=\"javascript:;\"\r\n                  class=\"edit me-3\"\r\n                  @click.prevent=\"openViewModal(props.row)\"\r\n                  data-bs-toggle=\"modal\"\r\n                  data-bs-target=\"#view-attendance-modal\"\r\n                >\r\n                  <!-- eye icon -->\r\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"text-primary\">\r\n                    <path d=\"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z\"></path>\r\n                    <circle cx=\"12\" cy=\"12\" r=\"3\"></circle>\r\n                  </svg>\r\n                </a>\r\n              </template>\r\n            </v-client-table>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- view attendance modal starts -->\r\n      <div class=\"modal fade mymodal\" id=\"view-attendance-modal\" data-bs-backdrop=\"false\" data-bs-keyboard=\"false\" tabindex=\"-1\" aria-labelledby=\"viewAttendanceModalLabel\" aria-hidden=\"true\">\r\n      <div class=\"modal-dialog modal-fullscreen modal-dialog-centered\">\r\n        <div class=\"modal-content\">\r\n          <div class=\"modal-header\">\r\n            <h5 class=\"modal-title\" id=\"viewAttendanceModalLabel\">Geo Location Attendance View For {{ selectedAttendance.name }}</h5>\r\n            <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\" @click=\"closeModal\"></button>\r\n          </div>\r\n\r\n          <div class=\"modal-body\">\r\n            <div class=\"p-3 my-4\">\r\n            <div class=\"row\">\r\n              <div class=\"col-md-6 text-start\">\r\n                 <p class=\"mb-3 text-dark\"><strong>Supervisor:</strong> {{ selectedAttendance.name || '--' }}</p> \r\n                  <p class=\"mb-3 text-dark\"><strong>Location:</strong> {{ selectedAttendance.location || '--' }}</p> \r\n\r\n              </div>\r\n\r\n              <div class=\"col-md-6 text-start\">\r\n                <p class=\"mb-3 text-dark\"><strong>phone no:</strong> {{ selectedAttendance.phone }}</p>\r\n                <p class=\"mb-3 text-dark\"><strong>Date:</strong> {{ selectedAttendance.date || '--' }}</p>\r\n              </div>\r\n           </div>\r\n           </div>\r\n\r\n            <div class=\"row\">\r\n              <!-- Report Location Map -->\r\n              <div class=\"col-md-12 mb-3\">\r\n                <h6>Report Location</h6>\r\n                <div id=\"reportMap\" class=\"map-container\"></div>\r\n                <div class=\"small mt-1 text-muted\">{{ selectedAttendance.report_location || '' }}</div>\r\n              </div>\r\n            </div>\r\n\r\n          </div>\r\n\r\n          <div class=\"modal-footer\">\r\n            <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\" @click=\"closeModal\">Close</button>\r\n          </div>\r\n\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <!-- view attendance modal ends -->\r\n\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted, inject, computed } from 'vue';\r\nimport { useRoute } from 'vue-router';\r\nimport axios from 'axios';\r\nimport L from 'leaflet';\r\nimport 'leaflet/dist/leaflet.css';\r\nimport Swal from 'sweetalert2';\r\n\r\nconst route = useRoute();\r\nconst showMessage = inject('showMessage');\r\nconst showError = inject('showError');\r\nconst formatDate = inject('formatDate');\r\nconst tableShimmer = inject('tableShimmer');\r\nconst loadingSpinner = inject('loadingSpinner');\r\n\r\nconst loading_spinner = ref(false);\r\nconst columns = ref(['SNo','name','phone','date','location','actions']);\r\nconst items = ref([]);\r\nconst attendance = ref([]);\r\nconst attendance_factor_id = ref('');\r\n\r\nconst table_option = ref({\r\n  perPage: 20,\r\n  perPageValues: [20, 50 ,100],\r\n  skin: 'table table-hover table-striped',\r\n  columnsClasses: { actions: 'actions text-center' },\r\n  sortable: ['SNo', 'name','short_name','status'],\r\n  sortIcon: {\r\n    base: 'sort-icon-none',\r\n    up: 'sort-icon-asc',\r\n    down: 'sort-icon-desc',\r\n  },\r\n  pagination: { nav: 'scroll', chunk: 5 },\r\n  texts: {\r\n    count: 'Showing {from} to {to} of {count}',\r\n    filter: '',\r\n    filterPlaceholder: 'Search...',\r\n    limit: 'Results:',\r\n  },\r\n  resizableColumns: false,\r\n});\r\n\r\nconst axiosInstance = axios.create({\r\n  baseURL: process.env.VUE_APP_API_BASE_URL || ''\r\n});\r\n\r\nconst selectedDate = ref(\"\")\r\n\r\nconst filteredAttendance = computed(() => {\r\n  if (!selectedDate.value) return attendance.value\r\n\r\n  return attendance.value.filter(u =>\r\n    new Date(u.created_at).toISOString().split(\"T\")[0] === selectedDate.value\r\n  )\r\n})\r\n\r\n// selected attendance for modal\r\nconst selectedAttendance = ref({});\r\nlet reportMap = null;\r\nlet leaveMap = null;\r\n\r\n// helper to safely parse lat/lon\r\nconst toFloat = (v) => {\r\n  if (v === null || v === undefined) return null;\r\n  const n = parseFloat(String(v).replace(/[, ]+/g, ''));\r\n  return Number.isFinite(n) ? n : null;\r\n};\r\n\r\nconst formatTime = (datetime) => {\r\n  if (!datetime) return '--';\r\n  // if already time-only string, return as-is\r\n  try {\r\n    const date = new Date(datetime);\r\n    if (isNaN(date.getTime())) return datetime;\r\n    return date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });\r\n  } catch (e) {\r\n    return datetime;\r\n  }\r\n};\r\n\r\nconst getAttendance = async () => {\r\n  loading_spinner.value = true;\r\n  try {\r\n    const response = await axiosInstance.get(`geo-location-attendances?user_id=${JSON.parse(localStorage.getItem(\"user\")).id}`);\r\n    attendance.value = response.data.map((item, index) => ({\r\n      SNo: index + 1,\r\n      ...item,\r\n      id: item.id,\r\n      name: item.user?.name,\r\n      phone: item.user?.phone_no,\r\n      store_name: item.store?.name,\r\n      date: formatDate(item.created_at),\r\n      site: `${item.store?.project?.short_name || 'No Project'}`,\r\n      location: item.location,\r\n      report_latitude: item.latitude,\r\n      report_longitude: item.longitude,\r\n    }));\r\n  } catch (error) {\r\n    console.error(error);\r\n    showError?.(error.message);\r\n  } finally {\r\n    loading_spinner.value = false;\r\n  }\r\n};\r\n\r\nconst getUserStatus = async () => {\r\n    try {\r\n        const response = await axiosInstance.get(`user-status/${JSON.parse(localStorage.getItem(\"user\")).id}`);\r\n        userStatus.value = response.data;\r\n    } catch (error) {\r\n        console.error(error);\r\n    }\r\n};\r\n\r\n\r\nconst openViewModal = (row) => {\r\n  selectedAttendance.value = { ...row };\r\n  setTimeout(() => {\r\n    loadReportMap();\r\n    if (selectedAttendance.value.leave_latitude) {\r\n      loadLeaveMap();\r\n    } else {\r\n      if (leaveMap) {\r\n        leaveMap.remove();\r\n        leaveMap = null;\r\n      }\r\n    }\r\n  }, 300);\r\n\r\n};\r\n\r\nfunction loadReportMap() {\r\n  const lat = toFloat(selectedAttendance.value.report_latitude);\r\n  const lon = toFloat(selectedAttendance.value.report_longitude);\r\n  if (lat === null || lon === null) return;\r\n\r\n  // remove old map instance to avoid errors\r\n  if (reportMap) {\r\n    try { reportMap.remove(); } catch (e) { /* ignore */ }\r\n    reportMap = null;\r\n  }\r\n\r\n  // initialize map\r\n  reportMap = L.map('reportMap', { center: [lat, lon], zoom: 16, scrollWheelZoom: true });\r\n  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\r\n    attribution: '&copy; OpenStreetMap contributors'\r\n  }).addTo(reportMap);\r\n\r\n  const marker = L.marker([lat, lon]).addTo(reportMap);\r\n  marker.bindPopup('<b>Report Location</b>').openPopup();\r\n\r\n  // ensure map renders correctly inside modal\r\n  setTimeout(() => { reportMap.invalidateSize(); }, 200);\r\n}\r\n\r\nfunction loadLeaveMap() {\r\n  const lat = toFloat(selectedAttendance.value.leave_latitude);\r\n  const lon = toFloat(selectedAttendance.value.leave_longitude);\r\n  if (lat === null || lon === null) return;\r\n\r\n  if (leaveMap) {\r\n    try { leaveMap.remove(); } catch (e) { /* ignore */ }\r\n    leaveMap = null;\r\n  }\r\n\r\n  leaveMap = L.map('leaveMap', { center: [lat, lon], zoom: 16, scrollWheelZoom: true });\r\n  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\r\n    attribution: '&copy; OpenStreetMap contributors'\r\n  }).addTo(leaveMap);\r\n\r\n  const marker = L.marker([lat, lon]).addTo(leaveMap);\r\n  marker.bindPopup('<b>Leave Location</b>').openPopup();\r\n\r\n  setTimeout(() => { leaveMap.invalidateSize(); }, 200);\r\n}\r\n\r\nconst printReport = async () => {\r\n  try {\r\n    const iframe = document.createElement(\"iframe\");\r\n    iframe.style.display = \"none\";\r\n    document.body.appendChild(iframe);\r\n\r\n    // Date formatting\r\n    const now = new Date();\r\n    const day = String(now.getDate()).padStart(2, '0');\r\n    const month = String(now.getMonth() + 1).padStart(2, '0');\r\n    const year = now.getFullYear();\r\n    const formattedDate = `${day}.${month}.${year}`;\r\n    const formatDate = `${day}.${month}.${year}`;\r\n    const formattedDateTime = `${formattedDate}, ${now.toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'})}`;\r\n\r\n    const printContent = `\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n<title>Supervisor Attendance Report</title>\r\n<style>\r\n  body { font-family: Arial, sans-serif; margin: 40px; font-size: 13px; }\r\n  .header { display: flex; justify-content: space-between; align-items: flex-start; position: relative; }\r\n  .logo { width: 160px; height: auto; }\r\n  .report-box { border: 1px solid #000; padding: 4px 8px; font-size: 11px; text-align: center; margin-left: auto; border-radius: 5px; }\r\n  .company-title { text-align: center; margin-top: 10px; }\r\n  .reg-info { position: absolute; top: 60px; right: 0; text-align: right; font-size: 10px; line-height: 1.4; }\r\n  .title { text-align: center; font-weight: bold; margin: 20px 0 10px 0; }\r\n  table { width: 100%; border-collapse: collapse; margin-top: 20px; }\r\n  table.items th, table.items td { border: 1px solid #000; padding: 6px; font-weight: normal; }\r\n  table.items thead tr th { background-color: #f8f8f8; border: 1px solid #000; font-weight: bold; }\r\n  .text-right { text-align: right; }\r\n  .text-end { text-align: end; }\r\n  .text-center { text-align: center; }\r\n  .text-start { text-align: start; }\r\n  @media print { body { margin: 10mm; } .no-print { display: none; } }\r\n</style>\r\n</head>\r\n<body>\r\n<div class=\"header\">\r\n  <img src=\"https://bushman.ink/copex.jpg\" class=\"logo\" />\r\n  <div class=\"report-box\">\r\n    REPORT ON.<br>\r\n    <span style=\"color:red;\">${formattedDate}</span>\r\n  </div>\r\n  <div class=\"reg-info\">\r\n    TIN: 103-826-519<br>\r\n    VRN: 20-01-017530R\r\n  </div>\r\n</div>\r\n\r\n<div class=\"company-title\">\r\n  <h2>COPEX CONTRACTORS CO.LTD</h2>\r\n  <div>Msamvu, P.O.BOX 678, Morogoro</div>\r\n  <div>Mobile, 0713 000 777, 0657 111 555</div>\r\n</div>\r\n\r\n<div class=\"title\">SUPERVISOR ATTENDANCE REPORT</div>\r\n\r\n<div style=\"text-align: right; margin-top: 10px;\">\r\n  <strong>Date: ${formatDate}</strong>\r\n</div>\r\n\r\n<table class=\"items\">\r\n  <thead>\r\n    <tr>\r\n      <th style=\"width: 40px;\">S/No</th>\r\n      <th>Name</th>\r\n      <th>Number</th>\r\n      <th>Date</th>\r\n      <th>Location</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    ${filteredAttendance.value.map((item, index) => `\r\n    <tr>\r\n      <td class=\"text-center\">${index + 1}</td>\r\n      <td class=\"text-start\">${item.name || '--'}</td>\r\n      <td class=\"text-center\">${item.phone || '--'}</td>\r\n      <td class=\"text-center\">${item.date || '--'}</td>\r\n      <td class=\"text-start\">${item.location || '--'}</td>\r\n    </tr>\r\n    `).join('')}\r\n  </tbody>\r\n</table>\r\n\r\n<div style=\"margin-top: 40px; text-align: center; font-size: 12px; border-top: 1px solid #666; padding-top: 8px;\">\r\n  <p>Â© ${new Date().getFullYear()} COPEX CONTRACTORS CO.LTD | TIN: 103-826-519 | VRN: 20-01-017530R</p>\r\n  <p>Msamvu, P.O.BOX 678, Morogoro | Mobile: 0713 000 777, 0657 111 555</p>\r\n</div>\r\n\r\n<div style=\"margin-top: 10px; font-size: 11px; text-align: left;\">\r\n  ${formattedDateTime}\r\n</div>\r\n\r\n</body>\r\n</html>\r\n`;\r\n\r\n    const iframeDoc = iframe.contentWindow.document;\r\n    iframeDoc.open();\r\n    iframeDoc.write(printContent);\r\n    iframeDoc.close();\r\n\r\n    iframe.onload = () => {\r\n      iframe.contentWindow.focus();\r\n      iframe.contentWindow.print();\r\n      setTimeout(() => {\r\n        document.body.removeChild(iframe);\r\n      }, 1000);\r\n    };\r\n  } catch (error) {\r\n    showError(`Failed to print report: ${error.message}`);\r\n  }\r\n};\r\n\r\n\r\nconst userStatus = ref(false);\r\n\r\nconst currentLocation = ref({\r\n    address: '',\r\n    latitude: null,\r\n    longitude: null,\r\n    timestamp: null\r\n});\r\n\r\nconst refreshingLocation = ref(false);\r\nconst isSupervisorLoading = ref(false);\r\n\r\n\r\nconst initiateReport = () => {\r\n    // Check if location is already available\r\n    if (!currentLocation.value.latitude ||\r\n            !currentLocation.value.longitude) {\r\n        // Open Google Chrome Location Settings page in a new tab.\r\n        window.open(\r\n            \"https://support.google.com/chrome/answer/142065?hl=en\", \r\n            \"_blank\"\r\n        );\r\n        return;\r\n    }\r\n\r\n    Swal.fire({\r\n        title: 'Report',\r\n        html: `\r\n            <div class=\"text-center\">\r\n                <p>This will record your current location and time.</p>\r\n            </div>\r\n        `,\r\n        icon: 'question',\r\n        showCancelButton: true,\r\n        confirmButtonColor: '#3085d6',\r\n        cancelButtonColor: '#d33',\r\n        confirmButtonText: 'Yes, Report Now',\r\n        cancelButtonText: 'Cancel'\r\n    }).then((result) => {\r\n        if (result.isConfirmed) {\r\n            submitReport();\r\n        }\r\n    });\r\n};\r\n\r\nconst now = new Date();\r\nconst eatNow = new Date(now.getTime() + (3 * 60 * 60 * 1000));\r\nconst mysqlDatetime = eatNow.toISOString().slice(0, 19).replace('T', ' ');\r\n\r\n\r\nconst submitReport = async () => {\r\n    isSupervisorLoading.value = true;\r\n\r\n    try {\r\n        // Always ensure location is fetched\r\n        if (\r\n            !currentLocation.value.latitude ||\r\n            !currentLocation.value.longitude\r\n        ) {\r\n            await getCurrentLocation();\r\n        }\r\n        const payload = {\r\n            user_id: JSON.parse(localStorage.getItem(\"user\")).id,\r\n            location: currentLocation.value.address,\r\n            latitude: currentLocation.value.latitude,\r\n            longitude: currentLocation.value.longitude\r\n        };\r\n\r\n        await axiosInstance.post('geo-location-attendances', payload);\r\n        await getAttendance();\r\n        showMessage('Successfully Reported!');\r\n        await getUserStatus();\r\n\r\n    } catch (error) {\r\n        console.error(error);\r\n        showError(error.message);\r\n    } finally {\r\n        isSupervisorLoading.value = false;\r\n    }\r\n};\r\n\r\nconst submitLeave = async () => {\r\n    isSupervisorLoading.value = true;\r\n\r\n    try {\r\n        // Always ensure location is fetched\r\n        if (\r\n            !currentLocation.value.latitude ||\r\n            !currentLocation.value.longitude\r\n        ) {\r\n            await getCurrentLocation();\r\n        }\r\n        const payload = {\r\n            user_id: JSON.parse(localStorage.getItem(\"user\")).id,\r\n            location: currentLocation.value.address,\r\n            latitude: currentLocation.value.latitude,\r\n            longitude: currentLocation.value.longitude,\r\n            direction:'leave'\r\n        };\r\n\r\n        await axiosInstance.post('geo-location-attendances', payload);\r\n        await getAttendance();\r\n        showMessage('Successfully Left!');\r\n        await getUserStatus();\r\n\r\n    } catch (error) {\r\n        console.error(error);\r\n        showError(error.message);\r\n    } finally {\r\n        isSupervisorLoading.value = false;\r\n    }\r\n};\r\n\r\n\r\nconst getCurrentLocation = () => {\r\n    refreshingLocation.value = true;\r\n    \r\n    if (!navigator.geolocation) {\r\n        showError(\"Geolocation is not supported by your browser\");\r\n        return;\r\n    }\r\n    \r\n    navigator.geolocation.getCurrentPosition(\r\n        async (position) => {\r\n            const { latitude, longitude } = position.coords;\r\n            currentLocation.value = {\r\n                latitude,\r\n                longitude,\r\n                timestamp: new Date().toISOString()\r\n            };\r\n            \r\n            // Try to get address from coordinates\r\n            try {\r\n                const response = await axios.get(\r\n                    `https://nominatim.openstreetmap.org/reverse?lat=${latitude}&lon=${longitude}&format=json`\r\n                );\r\n                if (response.data.display_name) {\r\n                    currentLocation.value.address = response.data.display_name;\r\n                } else {\r\n                    currentLocation.value.address = `Lat: ${latitude.toFixed(6)}, Lon: ${longitude.toFixed(6)}`;\r\n                }\r\n            } catch (error) {\r\n                currentLocation.value.address = `Lat: ${latitude.toFixed(6)}, Lon: ${longitude.toFixed(6)}`;\r\n            }\r\n            \r\n            refreshingLocation.value = false;\r\n        },\r\n        (error) => {\r\n            console.error(error);\r\n            showError(error.message);\r\n        },\r\n        {\r\n            enableHighAccuracy: true,\r\n            timeout: 10000,\r\n            maximumAge: 0\r\n        }\r\n    );\r\n};\r\n\r\nonMounted(() => {\r\n  getUserStatus();\r\n  getAttendance();\r\n  getCurrentLocation();\r\n  // Fix leaflet default icon path (if necessary)\r\n  delete L.Icon.Default.prototype._getIconUrl;\r\n  L.Icon.Default.mergeOptions({\r\n    iconRetinaUrl: require('leaflet/dist/images/marker-icon-2x.png'),\r\n    iconUrl: require('leaflet/dist/images/marker-icon.png'),\r\n    shadowUrl: require('leaflet/dist/images/marker-shadow.png'),\r\n  });\r\n});\r\n\r\n</script>\r\n\r\n<style scoped>\r\n.map-container {\r\n  height: calc(100vh - 150px); /* Full screen minus header/footer */\r\n  border-radius: 0;\r\n  border: none;\r\n}\r\n.table3 .actions svg {\r\n  padding: 2px;\r\n}\r\n</style>\r\n","import script from \"./individual.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./individual.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./individual.vue?vue&type=style&index=0&id=1606c75c&scoped=true&lang=css\"\n\nimport exportComponent from \"D:\\\\copexErp\\\\frontEnd\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-1606c75c\"]])\n\nexport default __exports__"],"names":["useRoute","showMessage","inject","showError","formatDate","tableShimmer","loading_spinner","ref","columns","attendance","table_option","perPage","perPageValues","skin","columnsClasses","actions","sortable","sortIcon","base","up","down","pagination","nav","chunk","texts","count","filter","filterPlaceholder","limit","resizableColumns","axiosInstance","axios","baseURL","process","selectedDate","filteredAttendance","computed","value","u","Date","created_at","toISOString","split","selectedAttendance","reportMap","leaveMap","toFloat","v","undefined","n","parseFloat","String","replace","Number","isFinite","getAttendance","async","response","get","JSON","parse","localStorage","getItem","id","data","map","item","index","SNo","name","user","phone","phone_no","store_name","store","date","site","project","short_name","location","report_latitude","latitude","report_longitude","longitude","error","console","message","getUserStatus","userStatus","openViewModal","row","setTimeout","loadReportMap","leave_latitude","loadLeaveMap","remove","lat","lon","e","L","center","zoom","scrollWheelZoom","attribution","addTo","marker","bindPopup","openPopup","invalidateSize","leave_longitude","printReport","iframe","document","createElement","style","display","body","appendChild","now","day","getDate","padStart","month","getMonth","year","getFullYear","formattedDate","formattedDateTime","toLocaleTimeString","hour","minute","printContent","join","iframeDoc","contentWindow","open","write","close","onload","focus","print","removeChild","currentLocation","address","timestamp","refreshingLocation","isSupervisorLoading","initiateReport","Swal","title","html","icon","showCancelButton","confirmButtonColor","cancelButtonColor","confirmButtonText","cancelButtonText","then","result","isConfirmed","submitReport","window","eatNow","getTime","slice","getCurrentLocation","payload","user_id","post","navigator","geolocation","getCurrentPosition","position","coords","display_name","toFixed","enableHighAccuracy","timeout","maximumAge","onMounted","iconRetinaUrl","require","iconUrl","shadowUrl","__exports__"],"sourceRoot":""}