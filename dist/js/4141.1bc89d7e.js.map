{"version":3,"file":"js/4141.1bc89d7e.js","mappings":"o2EAwKIA,EAAAA,EAAAA,GAAQ,CAAEC,MAAO,sBAIjB,MAAMC,EAAgBC,EAAAA,EAAAA,OAAa,CAC/BC,QAASC,gCAETC,GAAkBC,EAAAA,EAAAA,KAAI,GAExBC,GAAiBC,EAAAA,EAAAA,KAAS,KACvB,CACLC,MAAOC,EAAgBC,MAAMC,OAC7BC,MAAOH,EAAgBC,MAAMG,QAC3B,CAACC,EAAKC,IAAQD,EAAME,OAAOD,EAAIE,gBAC/B,OAKAC,EAAkB,KAClBT,EAAgBC,MAAMC,SAAWQ,GAAYT,MAAMC,OACrDF,EAAgBC,MAAQ,GAExBD,EAAgBC,MAAQ,IAAIS,GAAYT,QAItCU,GAAqBf,EAAAA,EAAAA,IAAI,IACzBgB,EAAqB,KACzBC,QAAQC,IAAId,EAAgBC,QAGpBc,GAAcC,EAAAA,EAAAA,IAAO,eACrBC,GAAYD,EAAAA,EAAAA,IAAO,aAInBE,IAHgBF,EAAAA,EAAAA,IAAO,kBACNA,EAAAA,EAAAA,IAAO,mBACLA,EAAAA,EAAAA,IAAO,qBACXA,EAAAA,EAAAA,IAAO,iBACtBG,GAAYH,EAAAA,EAAAA,IAAO,cACnBI,GAAeJ,EAAAA,EAAAA,IAAO,gBAEtBK,IADOzB,EAAAA,EAAAA,IAAI,KACDA,EAAAA,EAAAA,KAAI,IACdI,GAAkBJ,EAAAA,EAAAA,IAAI,IACtB0B,IAAU1B,EAAAA,EAAAA,IAAI,CAAC,MAAO,YAAY,OAAO,OAAO,UAAU,aAAa,OAAO,SAAS,OAAO,YAC9F2B,IAAiB3B,EAAAA,EAAAA,IAAI,CAAC,MAAO,YAAa,OAAQ,OAAQ,UAAU,OAAQ,SAC5E4B,IAAe5B,EAAAA,EAAAA,IAAI,CACrB6B,QAAS,GACTC,cAAe,CAAC,GAAI,GAAK,KACzBC,KAAM,kCACNC,eAAgB,CAAEC,QAAS,uBAC3BC,SAAU,CAAC,KAAM,gBACjBC,SAAU,CACNC,KAAM,iBACNC,GAAI,gBACJC,KAAM,kBAEVC,WAAY,CAAEC,IAAK,SAAUC,MAAO,GACpCC,MAAO,CACHvC,MAAO,oCACPwC,OAAQ,GACRC,kBAAmB,YACnBC,MAAO,YAEXC,kBAAkB,IAGpBhC,IAAcd,EAAAA,EAAAA,IAAI,IAElB+C,KADO/C,EAAAA,EAAAA,KAAI,IAAIgD,MAAOC,cAAcC,MAAM,EAAG,MAChClD,EAAAA,EAAAA,KAAI,IAAIgD,MAAOC,cAAcC,MAAM,EAAG,MACnDC,IAAWnD,EAAAA,EAAAA,KAAI,IAAIgD,MAAOC,cAAcC,MAAM,EAAG,KACjDE,GAAsBC,UAC1B5B,EAAQpB,OAAQ,EAChB,IACE,MAAMiD,EAAS,CACbP,WAAYA,GAAW1C,MACvB8C,SAAUA,GAAS9C,OAGjBkD,GAAQlD,OAAOmD,aACjBF,EAAOG,WAAaF,GAAQlD,MAAMqD,IAGpC,MAAMC,QAAiBhE,EAAciE,IAAI,oBAAqB,CAAEN,OAAAA,IAEhExC,GAAYT,MAAQsD,EAASE,KAAKC,KAAI,CAACC,EAAMC,KAAP,IACjCD,EACHE,IAAKD,EAAQ,EACbE,UAAWH,EAAKI,YAChBC,KAAML,EAAKM,aAAaC,KACxBC,KAAMjD,EAAayC,EAAKM,aAAaE,MACrC3D,cAAemD,EAAKM,aAAaE,KACjChB,QAASQ,EAAKR,SAASC,WACvBgB,WAAYT,EAAKU,WAAWH,KAC5BI,KAAMnD,EAAWwC,EAAKY,gBAExB,MAAOC,GACPvD,EAAUuD,EAAMC,SAxBlB,QA0BEpD,EAAQpB,OAAQ,IAIdyE,IAAW9E,EAAAA,EAAAA,IAAI,CAAC,KAChBuD,IAAUvD,EAAAA,EAAAA,MAGV+E,GAAc1B,UACjB,IACE,MAAMM,QAAiBhE,EAAciE,IAAI,YACzCkB,GAASzE,MAAQsD,EAASE,KAC3B,MAAMe,GACNvD,EAAUuD,EAAMC,SAChB5D,QAAQC,IAAI0D,KAMVI,IAA2BhF,EAAAA,EAAAA,KAAI,GAC/BiF,GAAuB5B,UAC3B,GAAKE,GAAQlD,MAAb,CAKA2E,GAAyB3E,OAAQ,EAEjC,IAEE,MAAMsD,QAAiBhE,EAAciE,IAAI,0BAA2B,CAClEN,OAAQ,CAAEG,WAAYF,GAAQlD,MAAMqD,MAGhCwB,EAAmBvB,EAASE,KAC5BsB,EAAYD,EAAiBE,MAAKC,GACtCA,EAAEtC,aAAeA,GAAW1C,OAASgF,EAAElC,WAAaA,GAAS9C,QAG/D,GAAI8E,EAEF,YADA9D,EAAU,qEAIZ,MAAMiE,EAAU,CACd7B,WAAYF,GAAQlD,MAAMqD,GAC1BX,WAAYA,GAAW1C,MACvB8C,SAAUA,GAAS9C,MACnBkF,UAAWC,KAAKC,MAAMC,aAAaC,QAAQ,SAASjC,GACpDkC,YAAa7E,EAAmBV,MAChCwF,QAASzF,EAAgBC,MAAMyD,KAAIgC,IAAK,CACtCC,cAAeD,EAAEpC,GACjBsC,UAAWF,EAAEE,UACbC,SAAUH,EAAElF,yBAIVjB,EAAcuG,KAAK,0BAA2BZ,GACpDnE,EAAY,wCACZgF,SAASC,eAAe,yBAAyBC,QAEjD,MAAOzB,GACP3D,QAAQC,IAAI0D,GACZvD,EAAUuD,EAAMC,SAnClB,QAqCEG,GAAyB3E,OAAQ,QA3CjCgB,EAAU,4BAgDRiF,GAAoB,KACxBlG,EAAgBC,MAAQ,GACxBU,EAAmBV,MAAQ,GAC3BN,EAAgBM,OAAQ,G,OAGtBkG,EAAAA,EAAAA,KAAU,KACNnD,KACA2B,Q,00GCpVR,MAAMyB,EAAc,EAEpB","sources":["webpack://cork-vue3/./src/views/hr/labour/issueRequest.vue","webpack://cork-vue3/./src/views/hr/labour/issueRequest.vue?3a32"],"sourcesContent":["<template>\r\n    <div class=\"layout-px-spacing\">  \r\n            <ul class=\"navbar-nav flex-row mt-2\">\r\n                <li>\r\n                    <div class=\"page-header\">\r\n                        <nav class=\"breadcrumb-one\" aria-label=\"breadcrumb\">\r\n                            <ol class=\"breadcrumb\">\r\n                                <li class=\"breadcrumb-item\"><a href=\"javascript:;\">Masters</a></li>\r\n                                <li class=\"breadcrumb-item active\" aria-current=\"page\"><span>Services</span></li>\r\n                            </ol>\r\n                        </nav>\r\n                    </div>\r\n                </li>\r\n            </ul>\r\n\r\n            <h3 class=\"text-center\">SITE LABOUR ATTENDANCE FROM {{ start_date }} TO {{ end_date }}</h3>\r\n            <!-- <span v-if=\"loading\" v-html=\"waitIndicator()\"></span> -->\r\n<div class=\"d-flex me-4 mt-2 align-items-center flex-wrap\">\r\n  \r\n  <button class=\"btn btn-success me-2\" @click=\"printLabourAttendance(attendances)\">\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"26\" height=\"26\" fill=\"currentColor\" class=\"bi bi-printer\" viewBox=\"0 0 16 16\">\r\n      <path d=\"M2.5 8a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1\"/>\r\n      <path d=\"M5 1a2 2 0 0 0-2 2v2H2a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h1v1a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-1h1a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-1V3a2 2 0 0 0-2-2zM4 3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v2H4zm1 5a2 2 0 0 0-2 2v1H2a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v-1a2 2 0 0 0-2-2zm7 2v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1\"/>\r\n    </svg>\r\n  </button>\r\n\r\n  <input type=\"date\" v-model=\"start_date\" class=\"form-control me-2\" style=\"max-width: 180px;\">\r\n  <input type=\"date\" v-model=\"end_date\" class=\"form-control me-2\" style=\"max-width: 180px;\">\r\n\r\n  <Multiselect\r\n    v-model=\"project\"\r\n    :options=\"projects\"\r\n    label=\"short_name\"\r\n    placeholder=\"Select Project\"\r\n    :searchable=\"true\"\r\n    :allow-empty=\"false\"\r\n    class=\"me-2\"\r\n    style=\"min-width: 200px;max-width: 300px;\"\r\n  />\r\n\r\n  <button class=\"btn btn-primary me-2\" @click=\"getLabourAttendance()\">Search</button>\r\n  <button \r\n  class=\"btn btn-primary me-2\"\r\n  @click=\"request_payment = !request_payment\"\r\n  v-if=\"!request_payment\"\r\n>\r\nCreate Payment Request\r\n</button>\r\n\r\n<button \r\n  class=\"btn btn-success flex-shrink-0\"\r\n  @click=\"openPaymentSummary\"\r\n  :disabled=\"selectedLabours.length === 0\"\r\n  data-bs-toggle=\"modal\"\r\n  data-bs-target=\"#payment-request-modal\"\r\n  v-if=\"request_payment\"\r\n>\r\n   Request Payment\r\n</button>\r\n\r\n<button \r\n  v-if=\"request_payment\"\r\n  class=\"btn btn-secondary ms-2\"\r\n  @click=\"toggleSelectAll\"\r\n>\r\n  {{ selectedLabours.length === attendances.length ? '❌' : '✔' }}\r\n</button>\r\n\r\n</div>\r\n\r\n\r\n      \r\n        <div class=\"row layout-top-spacing\">\r\n            <div class=\"col-xl-12 col-lg-12 col-sm-12 layout-spacing\">\r\n                <div class=\"panel p-0\">\r\n                    <div class=\"custom-table table3\">\r\n                        <div v-if=\"loading\" v-html=\"tableShimmer()\"></div>\r\n                        <v-client-table v-else :data=\"attendances\" :columns=\"columns\" :options=\"table_option\">\r\n                            <template #status=\"props\">\r\n                                <span class=\"badge inv-status\" :class=\"'badge-' + props.row.status.color\">\r\n                                    {{ props.row.status.name }}\r\n                                </span>\r\n                            </template>\r\n                            <template #actions=\"props\">\r\n                                <input \r\n                                v-if=\"request_payment\"\r\n                            type=\"checkbox\" \r\n                            :value=\"props.row\" \r\n                            v-model=\"selectedLabours\"\r\n                           />\r\n                            </template>\r\n                          \r\n                           \r\n                         \r\n\r\n                        </v-client-table>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n  <!-- payment modal starts -->\r\n<div class=\"modal fade mymodal\" id=\"payment-request-modal\" data-bs-backdrop=\"false\" data-bs-keyboard=\"false\" tabindex=\"-1\" aria-labelledby=\"paymentRequestModalLabel\" aria-hidden=\"true\">\r\n  <div class=\"modal-dialog modal-xl\">\r\n    <div class=\"modal-content\">\r\n      <div class=\"modal-header\">\r\n        <h1 class=\"modal-title fs-5\" id=\"paymentRequestModalLabel\">Create Payment Request</h1>\r\n        <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\" @click=\"closePaymentModal()\"></button>\r\n      </div>\r\n      <form @submit.prevent=\"submitPaymentRequest()\">\r\n        <div class=\"modal-body\">\r\n            <div class=\"row mb-3\">\r\n              <div class=\"col-md-6 my-2 \">\r\n                <p><b>Selected labours:</b> {{ paymentSummary?.count }}</p>\r\n              </div>\r\n              <div class=\"col-md-6 my-2\">\r\n                <p><b>Total Amount:</b> {{ formatNumber(paymentSummary?.total) }}</p>\r\n              </div>\r\n\r\n              <div class=\"col-md-12\">\r\n                <label class=\"form-label\">Summary Description</label>\r\n                <input type=\"text\" v-model=\"paymentDescription\" class=\"form-control\" placeholder=\"Enter summary description\">\r\n              </div>\r\n\r\n              <div class=\"col-md-12\">\r\n                <hr>\r\n              </div>\r\n\r\n              <div class=\"col-md-12\">\r\n                <div class=\"panel p-0\">\r\n                  <div class=\"custom-table\">\r\n                    <v-client-table\r\n                      v-if=\"selectedLabours.length > 0\"\r\n                      :data=\"selectedLabours\"\r\n                      :columns=\"paymentColumns\"\r\n                      :options=\"table_option\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            \r\n          </div>\r\n        </div>\r\n         <div class=\"modal-footer\">\r\n          <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\" @click=\"closePaymentModal()\" id=\"close_payment_request\">Close</button>\r\n          <button type=\"submit\" class=\"btn btn-primary\" :disabled=\"submittingPaymentRequest\">\r\n            <span v-if=\"submittingPaymentRequest\" class=\"spinner-border spinner-border-sm text-white me-2\" role=\"status\"></span>\r\n            submit\r\n          </button>\r\n        </div> \r\n      </form>\r\n    </div>\r\n  </div>\r\n</div>\r\n  <!-- payment modal ends -->\r\n\r\n\r\n    </div>\r\n</template>\r\n<style>\r\n    .table3 .actions svg {\r\n        padding: 2px;\r\n    }\r\n</style>\r\n<script setup>\r\n    import { onMounted, ref ,inject ,watch,computed,watchEffect } from 'vue';\r\n    import axios from 'axios';\r\n    import { useMeta } from '@/composables/use-meta';\r\n    useMeta({ title: 'Labour Attendance' });\r\n    import Multiselect from '@suadelabs/vue3-multiselect';\r\n    import '@suadelabs/vue3-multiselect/dist/vue3-multiselect.css';\r\nimport { start } from '@popperjs/core';\r\n    const axiosInstance = axios.create({\r\n        baseURL: process.env.VUE_APP_API_BASE_URL\r\n    });\r\n  const request_payment = ref(false);\r\n    \r\nconst paymentSummary = computed(() => {\r\n  return {\r\n    count: selectedLabours.value.length,\r\n    total: selectedLabours.value.reduce(\r\n      (sum, row) => sum + Number(row.rate_original),\r\n      0\r\n    )\r\n  }\r\n})\r\n\r\nconst toggleSelectAll = () => {\r\n  if (selectedLabours.value.length === attendances.value.length) {\r\n    selectedLabours.value = []\r\n  } else {\r\n    selectedLabours.value = [...attendances.value]\r\n  }\r\n}\r\n\r\nconst paymentDescription = ref('')\r\nconst openPaymentSummary = () => {\r\n  console.log(selectedLabours.value)\r\n}\r\n\r\n    const showMessage = inject('showMessage');\r\n    const showError = inject('showError');\r\n    const waitIndicator = inject('waitIndicator')\r\n    const printEmployees = inject('printEmployees')\r\n    const showConfirmation = inject('showConfirmation')\r\n    const formatNumber = inject('formatNumber')\r\n    const formatDate =inject('formatDate')\r\n    const tableShimmer = inject('tableShimmer');\r\n    const name = ref('');\r\n    const loading = ref(false);\r\n    const selectedLabours = ref([]);\r\n    const columns = ref(['Sno', 'full_name','type','rate','project','supervisor','task','status','date','actions']);\r\n    const paymentColumns = ref(['Sno', 'full_name', 'type', 'rate', 'project','task', 'date']);\r\n    const table_option = ref({\r\n        perPage: 20,\r\n        perPageValues: [20, 50 , 100],\r\n        skin: 'table table-hover table-striped',\r\n        columnsClasses: { actions: 'actions text-center' },\r\n        sortable: ['id', 'service_name'],\r\n        sortIcon: {\r\n            base: 'sort-icon-none',\r\n            up: 'sort-icon-asc',\r\n            down: 'sort-icon-desc',\r\n        },\r\n        pagination: { nav: 'scroll', chunk: 5 },\r\n        texts: {\r\n            count: 'Showing {from} to {to} of {count}',\r\n            filter: '',\r\n            filterPlaceholder: 'Search...',\r\n            limit: 'Results:',\r\n        },\r\n        resizableColumns: false,\r\n    });\r\n\r\nconst attendances = ref([])\r\nconst date = ref(new Date().toISOString().slice(0, 10))\r\nconst start_date = ref(new Date().toISOString().slice(0, 10))\r\nconst end_date = ref(new Date().toISOString().slice(0, 10))\r\nconst getLabourAttendance = async () => {\r\n  loading.value = true\r\n  try {\r\n    const params = {\r\n      start_date: start_date.value,\r\n      end_date: end_date.value\r\n    }\r\n\r\n    if (project.value?.short_name) {\r\n      params.project_id = project.value.id\r\n    }\r\n\r\n    const response = await axiosInstance.get('labour-attendants', { params })\r\n\r\n    attendances.value = response.data.map((item, index) => ({\r\n      ...item,\r\n      Sno: index + 1,\r\n      full_name: item.labour_name,\r\n      type: item.labour_type?.name,\r\n      rate: formatNumber(item.labour_type?.rate),\r\n      rate_original: item.labour_type?.rate,\r\n      project: item.project?.short_name,\r\n      supervisor: item.registrar?.name,\r\n      date: formatDate(item.created_at)\r\n    }))\r\n  } catch (error) {\r\n    showError(error.message)\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\nconst projects = ref([''])\r\nconst project = ref()\r\n\r\n\r\nconst getProjects = async () => {\r\n   try{\r\n     const response = await axiosInstance.get('projects')\r\n     projects.value = response.data\r\n   }catch(error){\r\n    showError(error.message)\r\n    console.log(error)\r\n   }finally{\r\n\r\n   }\r\n};\r\n\r\nconst submittingPaymentRequest = ref(false)\r\nconst submitPaymentRequest = async () => {\r\n  if (!project.value) {\r\n    showError('Please select a project');\r\n    return;\r\n  }\r\n\r\n  submittingPaymentRequest.value = true;\r\n\r\n  try {\r\n  \r\n    const response = await axiosInstance.get('labour-payment-requests', {\r\n      params: { project_id: project.value.id }\r\n    });\r\n\r\n    const existingRequests = response.data;\r\n    const duplicate = existingRequests.some(r =>\r\n      r.start_date === start_date.value && r.end_date === end_date.value\r\n    );\r\n\r\n    if (duplicate) {\r\n      showError('A payment request already exists for this project and date range.');\r\n      return; \r\n    }\r\n\r\n    const payload = {\r\n      project_id: project.value.id,\r\n      start_date: start_date.value,\r\n      end_date: end_date.value,\r\n      issuer_id: JSON.parse(localStorage.getItem('user')).id,\r\n      description: paymentDescription.value,\r\n      labours: selectedLabours.value.map(l => ({\r\n        attendance_id: l.id,\r\n        labour_id: l.labour_id,\r\n        quantity: l.rate_original,\r\n      }))\r\n    };\r\n\r\n    await axiosInstance.post('labour-payment-requests', payload);\r\n    showMessage('Payment request created successfully');\r\n    document.getElementById('close_payment_request').click();\r\n\r\n  } catch (error) {\r\n    console.log(error);\r\n    showError(error.message);\r\n  } finally {\r\n    submittingPaymentRequest.value = false;\r\n  }\r\n};\r\n\r\n\r\nconst closePaymentModal = () => {\r\n  selectedLabours.value = [];\r\n  paymentDescription.value = '';\r\n  request_payment.value = false;\r\n}\r\n\r\n    onMounted(() => {\r\n        getLabourAttendance();\r\n        getProjects()\r\n    });\r\n</script>\r\n","import script from \"./issueRequest.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./issueRequest.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./issueRequest.vue?vue&type=style&index=0&id=439d38a9&lang=css\"\n\nconst __exports__ = script;\n\nexport default __exports__"],"names":["useMeta","title","axiosInstance","axios","baseURL","process","request_payment","ref","paymentSummary","computed","count","selectedLabours","value","length","total","reduce","sum","row","Number","rate_original","toggleSelectAll","attendances","paymentDescription","openPaymentSummary","console","log","showMessage","inject","showError","formatNumber","formatDate","tableShimmer","loading","columns","paymentColumns","table_option","perPage","perPageValues","skin","columnsClasses","actions","sortable","sortIcon","base","up","down","pagination","nav","chunk","texts","filter","filterPlaceholder","limit","resizableColumns","start_date","Date","toISOString","slice","end_date","getLabourAttendance","async","params","project","short_name","project_id","id","response","get","data","map","item","index","Sno","full_name","labour_name","type","labour_type","name","rate","supervisor","registrar","date","created_at","error","message","projects","getProjects","submittingPaymentRequest","submitPaymentRequest","existingRequests","duplicate","some","r","payload","issuer_id","JSON","parse","localStorage","getItem","description","labours","l","attendance_id","labour_id","quantity","post","document","getElementById","click","closePaymentModal","onMounted","__exports__"],"sourceRoot":""}