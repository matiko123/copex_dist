{"version":3,"file":"js/9898.6243f30c.js","mappings":"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","sources":["webpack://cork-vue3/./src/views/requisitions/individual.vue","webpack://cork-vue3/./src/views/requisitions/individual.vue?9f17"],"sourcesContent":["<template>\r\n    <div class=\"layout-px-spacing\">  \r\n       <ul class=\"navbar-nav flex-row mt-2\">\r\n                <li>\r\n                    <div class=\"page-header\">\r\n                        <nav class=\"breadcrumb-one\" aria-label=\"breadcrumb\">\r\n                            <ol class=\"breadcrumb\">\r\n                                <li class=\"breadcrumb-item\"><a href=\"javascript:;\">Masters</a></li>\r\n                                <li class=\"breadcrumb-item active\" aria-current=\"page\"><span>Requisitions</span></li>\r\n                            </ol>\r\n                        </nav>\r\n                    </div>\r\n                </li>\r\n            </ul>\r\n\r\n            <!-- Requisition Header -->\r\n            <div class=\"col-xl-12 col-lg-12 col-sm-12 layout-spacing\">\r\n                <div class=\"panel p-0\">\r\n                    <div class=\"custom-table table3\">\r\n                        <table class=\"table table-bordered table-striped\">\r\n                            <thead>\r\n                                <tr>\r\n                                    <th>Requisition_no</th>\r\n                                    <th>Requester</th>\r\n                                    <th>Date Requested</th>\r\n                                    <th>Date Approved</th>\r\n                                    <th>Source</th>\r\n                                    <th>Purpose</th>\r\n                                    <th>Project</th>\r\n                                    <th>Status</th>\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody>\r\n                                <tr>\r\n                                    <td>{{ requisition.ref_no }}</td>\r\n                                    <td>{{ requisition.requester }}</td>\r\n                                    <td>{{ requisition.date }}</td>\r\n                                    <td> {{ formatDate(requisition.approved_at) }}</td>\r\n                                    <td>{{ requisition.type }}</td>\r\n                                    <td>{{ requisition.purpose }}</td>\r\n                                    <td>{{ requisition.project }}</td>\r\n                                    <td>\r\n                                        <span class=\"mb-0 badge\" :class=\"`badge-${requisition.status?.class}`\">\r\n                                            {{ requisition.status?.key }}\r\n                                        </span>\r\n                                    </td>\r\n                                </tr>\r\n                                <tr v-if=\"requisition.description\">\r\n                                    <td colspan=\"6\"><b>Brief Description:</b> {{ requisition.description }}</td>\r\n                                </tr>\r\n                                <tr v-if=\"requisition.remark\">\r\n                                    <td colspan=\"6\"><b>Remark:</b> {{ requisition.remark }}</td>\r\n                                </tr>\r\n                            </tbody>\r\n                        </table>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <!-- Total Cost -->\r\n            <div class=\"mb-2 text-center fw-bold\" style=\"font-size: x-large;\">\r\n                <strong>Total Cost: </strong>\r\n                <span>\r\n                    {{\r\n                        requisition?.items?.reduce((sum, item) => {\r\n                            const qty = Number(item.quantity) || 0;\r\n                            const rate = Number(item.rate) || 0;\r\n                            return sum + qty * rate;\r\n                        }, 0).toLocaleString() + '/='\r\n                    }}\r\n                </span>\r\n            </div>\r\n\r\n            <!-- Approval Buttons -->\r\n            <div v-if=\"(requisition.status?.key === 'Unapproved' || requisition.status?.key === 'Remarked' || requisition.status?.key === 'On Hold') && user_permissions.includes('is_md')\" class=\"mb-2 text-center\">\r\n                <div class=\"btn-group mb-3\">\r\n                    <button class=\"btn btn-primary me-2\" @click=\"status = 3\" :disabled=\"spinner\">Approve</button>\r\n                    <button class=\"btn btn-danger me-2\" @click=\"status = 4\" :disabled=\"spinner\">Reject</button>\r\n                    <button class=\"btn btn-warning me-2\" @click=\"status = 17, remark = requisition.remark\" :disabled=\"spinner\">Hold Request</button>\r\n                    <button class=\"btn btn-info\" @click=\"status = 14, remark = requisition.remark\" :disabled=\"spinner\">Remark</button>\r\n                </div>\r\n\r\n                <div v-if=\"status\" class=\"mb-2\">\r\n                    <span\r\n                        class=\"badge rounded-pill\"\r\n                        :class=\"{\r\n                            'bg-danger': status == 4,\r\n                            'bg-success': status == 3,\r\n                            'bg-warning': status == 17,\r\n                            'bg-info': status != 3 && status != 4\r\n                        }\"\r\n                        style=\"font-size: 1rem;\"\r\n                    >\r\n                        {{\r\n                            status == 3\r\n                                ? 'Approve Request'\r\n                                : status == 17\r\n                                ? 'Hold Request'\r\n                                : status == 4\r\n                                ? 'Reject Request'\r\n                                : 'Fill Remark'\r\n                        }}\r\n                    </span>\r\n                </div>\r\n\r\n                <div class=\"input-group\" v-if=\"status\">\r\n                    <input\r\n                        type=\"text\"\r\n                        class=\"form-control\"\r\n                        :placeholder=\"status == 3 ? 'Enter Approval Remark' : status == 4 ? 'Enter Rejection Remark' : 'Enter Remark'\"\r\n                        v-model=\"remark\"\r\n                    >\r\n                    <button class=\"btn btn-primary\" type=\"button\" :disabled=\"spinner\" @click=\"fillRequisitionRemark(requisition)\">\r\n                        <span v-if=\"spinner\" v-html=\"loadingSpinner()\"></span>\r\n                        <span v-else>Save</span>\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            <!-- Requisition Form -->\r\n            <form @submit.prevent=\"registerIncidence()\">\r\n                <div class=\"row layout-top-spacing\">\r\n                    \r\n                    <!-- Store Items for Issuing -->\r\n                    <div v-if=\"incidence?.id === 6 && store\" class=\"mt-2 col-xl-12 col-lg-12 col-sm-12 layout-spacing\">\r\n                        <div class=\"panel p-0\">\r\n                            <div class=\"custom-table table3\">\r\n                                <table class=\"table table-bordered table-striped\">\r\n                                    <thead>\r\n                                        <tr>\r\n                                            <th>Item Requested</th>\r\n                                            <th>Item Issued</th>\r\n                                            <th>Quantity Issuing</th>\r\n                                            <th>Item Condition</th>\r\n                                        </tr>\r\n                                    </thead>\r\n                                    <tbody>\r\n                                        <tr v-for=\"item in requisitionItems\" :key=\"item.id\">\r\n                                            <td>{{ item.item }}</td>\r\n                                            <td>\r\n                                                <multiselect\r\n                                                    v-model=\"item.store_item\"\r\n                                                    :options=\"storeItems\"\r\n                                                    placeholder=\"Select Item\"\r\n                                                    :searchable=\"true\"\r\n                                                    multiple=\"false\"\r\n                                                    label=\"name\"\r\n                                                    :required=\"true\"\r\n                                                    :allow-empty=\"false\"\r\n                                                ></multiselect>\r\n                                            </td>\r\n                                            <td>\r\n                                                <input\r\n                                                    type=\"number\"\r\n                                                    class=\"form-control\"\r\n                                                    :placeholder=\"'available ' + (item.store_item?.balance_quantity || 0)\"\r\n                                                    v-model=\"item.issued_quantity\"\r\n                                                    required\r\n                                                    :max=\"item.store_item?.balance_quantity || 0\"\r\n                                                />\r\n                                            </td>\r\n                                            <td>\r\n                                                <label\r\n                                                    type=\"number\"\r\n                                                    class=\"form-control\"\r\n                                                >{{ item.store_item?.condition || 'Select Item First' }}</label>\r\n                                            </td>\r\n                                        </tr>\r\n                                    </tbody>\r\n                                </table>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <!-- Requisition Items Table -->\r\n                    <div :class=\"['col-lg-12', 'col-sm-12', 'layout-spacing', proforma || subcontractor ? 'col-xl-6' : 'col-xl-12']\">\r\n                        <div class=\"panel p-0\">\r\n                            <div class=\"custom-table table3\">\r\n                                <v-client-table :data=\"requisitionItems\" :columns=\"itemColumns\" :options=\"table_option\">\r\n                                    <template #actions=\"props\">\r\n                                        <div class=\"d-flex justify-content-center align-items-center gap-2\">\r\n                                            <a href=\"javascript:void(0);\" title=\"Edit\" @click=\"openEditItemModal(props.row)\" v-if=\"user_permissions.includes('can_edit_requisition')\">\r\n                                                <svg\r\n                                                    xmlns=\"http://www.w3.org/2000/svg\"\r\n                                                    width=\"20\"\r\n                                                    height=\"20\"\r\n                                                    viewBox=\"0 0 24 24\"\r\n                                                    fill=\"none\"\r\n                                                    stroke=\"currentColor\"\r\n                                                    stroke-width=\"1.5\"\r\n                                                    stroke-linecap=\"round\"\r\n                                                    stroke-linejoin=\"round\"\r\n                                                    class=\"text-primary\"\r\n                                                    data-bs-toggle=\"modal\"\r\n                                                    data-bs-target=\"#edit-requisition-items-modal\"\r\n                                                >\r\n                                                    <path d=\"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\"></path>\r\n                                                    <path d=\"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z\"></path>\r\n                                                </svg>\r\n                                            </a>\r\n                                            \r\n                                            <router-link :to=\"`/statement/${props.row.asset_id}`\" @click=\"closeModal\" v-if=\"props.row.asset_id\">     \r\n                                                <button class=\"btn btn-primary\">Diesel</button>\r\n                                            </router-link>  \r\n                                        </div>\r\n                                    </template>\r\n                                </v-client-table>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <!-- Rejection Details -->\r\n                        <div v-if=\"remarks.length > 0\" class=\"mt-3\">\r\n                            <h4 class=\"text-center text-danger\">Rejection Details</h4>\r\n                            <table class=\"table table-bordered table-striped align-middle\">\r\n                                <thead>\r\n                                    <tr>\r\n                                        <th>Sno</th>\r\n                                        <th>Rejected By</th>\r\n                                        <th>Date</th>\r\n                                        <th>Reason</th>\r\n                                    </tr>\r\n                                </thead>\r\n                                <tbody>\r\n                                    <tr v-for=\"(remark, i) in remarks\" :key=\"remark.id\">\r\n                                        <td>{{ i + 1 }}</td>\r\n                                        <td>Director</td>\r\n                                        <td>{{ new Date(remark.created_at).toLocaleDateString('en-GB') }}</td>\r\n                                        <td>{{ remark.remark }}</td>\r\n                                    </tr>\r\n                                </tbody>\r\n                            </table>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <!-- Proforma Invoice -->\r\n                    <div class=\"col-xl-6 col-lg-12 col-sm-12 layout-spacing\" v-if=\"proforma\">\r\n                        <div class=\"panel p-3 position-relative\">\r\n                            <a :href=\"proforma\" target=\"_blank\" class=\"stretched-link\"></a>\r\n                            <h4 class=\"text-center\">Proforma Invoice</h4>\r\n                            <embed :src=\"proforma\" type=\"application/pdf\" width=\"100%\" height=\"600px\" />\r\n                        </div>\r\n                    </div>\r\n\r\n                    <!-- Subcontractor Agreement -->\r\n                    <div class=\"col-xl-6 col-lg-12 col-sm-12 layout-spacing\" v-if=\"subcontractor\">\r\n                        <div class=\"panel p-3 position-relative\">\r\n                            <a :href=\"subcontractor\" target=\"_blank\" class=\"stretched-link\"></a>\r\n                            <h4 class=\"text-center\">Subcontractor's Agreement</h4>\r\n                            <embed :src=\"subcontractor\" type=\"application/pdf\" width=\"100%\" height=\"600px\" />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </form>\r\n        </div>\r\n\r\n    <!-- Edit Requisition Items Modal -->\r\n    <div class=\"modal fade mymodal\" id=\"edit-requisition-items-modal\" data-bs-backdrop=\"false\" data-bs-keyboard=\"false\" tabindex=\"-1\" aria-labelledby=\"editRequisitionItemsModalLabel\" aria-hidden=\"true\">\r\n        <div class=\"modal-dialog modal-xl\">\r\n            <div class=\"modal-content\">\r\n                <div class=\"modal-header\">\r\n                    <h1 class=\"modal-title fs-5\" id=\"editRequisitionItemsModalLabel\">Edit Requisition Items</h1>\r\n                    <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\" @click=\"closeEditModal()\"></button>\r\n                </div>\r\n                <form @submit.prevent=\"updateRequisitionItem()\">\r\n                    <div class=\"modal-body\">\r\n                        <div class=\"row\">\r\n                            <div class=\"col-md-3\">\r\n                                <label for=\"item\">Item</label>\r\n                                <input \r\n                                    type=\"text\" \r\n                                    v-model=\"item\" \r\n                                    class=\"form-control\" \r\n                                    placeholder=\"Enter Item\"\r\n                                    required\r\n                                >\r\n                            </div>\r\n                            <div class=\"col-md-3\">\r\n                                <label for=\"units\">Units</label>\r\n                                <multiselect \r\n                                    v-model=\"units\"\r\n                                    :options= \"unitList\"\r\n                                    placeholder=\"Select Unit\"\r\n                                    label=\"short_name\"\r\n                                    :searchable = \"true\"        \r\n                                    multple=\"false\"\r\n                                    :required=\"true\"\r\n                                    :allow-empty=\"false\"\r\n                                ></multiselect>\r\n                            </div>\r\n                            <div class=\"col-md-3\">\r\n                                <label for=\"quantity\">Quantity</label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    v-model=\"quantity\"\r\n                                    class=\"form-control\"\r\n                                    placeholder=\"Enter Quantity\"\r\n                                    min=\"0\"\r\n                                    required\r\n                                    step=\"any\"\r\n                                />\r\n                            </div>\r\n                            <div class=\"col-md-3\">\r\n                                <label for=\"rate\">Rate</label>\r\n                                <input \r\n                                    type=\"number\" \r\n                                    v-model=\"rate\" \r\n                                    class=\"form-control\" \r\n                                    placeholder=\"Enter Rate\" \r\n                                    min=\"0\" \r\n                                    required \r\n                                    step=\"any\"\r\n                                >\r\n                            </div>\r\n                            <div class=\"col-md-6\">\r\n                                <label for=\"description\">Description</label>\r\n                                <input \r\n                                    type=\"text\" \r\n                                    v-model=\"description\" \r\n                                    class=\"form-control\" \r\n                                    placeholder=\"Enter Description\"\r\n                                >\r\n                            </div>\r\n                            <div class=\"col-md-6\">\r\n                                <label class=\"form-label small\">Select An Asset</label>\r\n                                <multiselect \r\n                                    v-model=\"asset\"\r\n                                    :options=\"assets\"\r\n                                    placeholder=\"Select An Asset\"\r\n                                    label=\"name\"\r\n                                    :searchable=\"true\"        \r\n                                    multiple=\"false\"\r\n                                    :required=\"true\"\r\n                                    :allow-empty=\"false\"\r\n                                ></multiselect>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"modal-footer\">\r\n                        <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\" @click=\"closeEditModal()\" id=\"close_editing\">Close</button>\r\n                        <button type=\"submit\" class=\"btn btn-primary\" :disabled=\"loading_spinner || loading\">\r\n                            <span v-if=\"loading_spinner || loading\" class=\"spinner-border spinner-border-sm text-white me-2\" role=\"status\"></span>\r\n                            <span v-else>Update</span>\r\n                        </button>\r\n                    </div>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script setup>\r\n    import Multiselect from '@suadelabs/vue3-multiselect';\r\n    import '@suadelabs/vue3-multiselect/dist/vue3-multiselect.css';\r\n    import { onMounted, ref, inject, computed, watch } from 'vue';\r\n    import axios from 'axios';\r\n    import { useMeta } from '@/composables/use-meta';\r\n    import '@/assets/sass/scrollspyNav.scss';\r\n    import { useRouter, useRoute } from 'vue-router';\r\n\r\n    useMeta({ title: 'Requisition Details' });\r\n\r\n    const axiosInstance = axios.create({\r\n        baseURL: process.env.VUE_APP_API_BASE_URL\r\n    });\r\n\r\n    const router = useRouter();\r\n    const route = useRoute(); \r\n    \r\n    // Reactive data\r\n    const user_permissions = JSON.parse(localStorage.getItem(\"user\")).permissions;\r\n    const allTypes = ref(['General','budget','labour','construction materials','spares'])\r\n    const types = ref([])\r\n    const requisitionTypes = ref([]);\r\n    const requisition_type = ref('');\r\n    const spinner = ref(false)\r\n    const incidence = ref('')\r\n    const formatNumber = inject('formatNumber');\r\n    const formatDate = inject('formatDate');\r\n    const loadingSpinner = inject('loadingSpinner');\r\n    const date = ref(new Date().toISOString().split('T')[0])\r\n    const status = ref('')\r\n    const item = ref('')\r\n    const quantity = ref('')\r\n    const rate = ref('')\r\n    const remark = ref()\r\n    const units = ref('')\r\n    const remarks = ref([])\r\n    const item_id = ref(0)\r\n    const required_date = ref('');\r\n    const requisitions = ref([]);\r\n    const loading_spinner = ref(false);\r\n    const error = ref('')\r\n    const columns = ref(['sno','ref_no', 'requester','purpose','type','project','date','cost','status','remark', 'actions']);\r\n    const role_registration = ref(false);\r\n    const showMessage = inject('showMessage');\r\n    const showError = inject('showError');\r\n    const formRequisitionItems = ref([])\r\n    const formRequisitionItems2 = ref([])\r\n    const upload = ref('')\r\n    const issueItems = ref([''])\r\n    const unitList = ref([])\r\n    const vendor = ref('')\r\n    const beneficiary = ref('')\r\n    \r\n   \r\n\r\n    // Main requisition data\r\n    const requisition = ref({})\r\n    const requisitionItems = ref([])\r\n    const proforma = ref('')\r\n    const subcontractor = ref('')\r\n\r\n\r\n    const assets = ref([])\r\n    const getAssets = async () => {\r\n        try {\r\n            const response = await axiosInstance.get('machines')\r\n            assets.value = response.data.map((item) => ({\r\n                ...item,\r\n                name: item.name + ' - ' + item.type_name\r\n            }))\r\n        } catch (err) {\r\n            console.error('Error fetching assets:', err)\r\n        }\r\n    }\r\n\r\n    \r\n    const project = ref('')\r\n\r\n    const budgets = ref([])\r\n    const budget = ref('')\r\n    const getBudgets = async (id) => {\r\n        try {\r\n            const response = await axiosInstance.get(`budgets?project_id=${id}`)\r\n            budgets.value = response.data.filter(b => b.status === 'closed')\r\n        } catch (err) {\r\n            console.error('Error fetching budgets:', err)\r\n        }\r\n    }\r\n\r\n    watch(project, (newVal) => {\r\n        if (newVal) {\r\n            getBudgets(newVal.id)\r\n        }\r\n    });\r\n\r\n    watch(requisition_type, (newVal) => {\r\n        if (newVal) {\r\n            formRequisitionItems.value = []\r\n            formRequisitionItems2.value = []\r\n            budgets.value = []\r\n            budget.value = ''\r\n            project.value = ''\r\n            clearItemForm()\r\n        }\r\n    });\r\n\r\n    watch(incidence, (newVal) => {\r\n        if (newVal) {\r\n            clearForm()\r\n            incidence.value = newVal\r\n            formRequisitionItems.value = []\r\n            formRequisitionItems2.value = []\r\n            clearItemForm()\r\n        }\r\n    });\r\n\r\n    const budgetItems = ref([])\r\n    const budget_item = ref('')\r\n    watch(budget, (newVal) => {\r\n        if (newVal) {\r\n            budgetItems.value = newVal.items\r\n        }\r\n    });\r\n\r\n    const budgetItemDescriptions = ref([])\r\n    const budget_item_description = ref('')\r\n    const max_cost = ref('')\r\n    const max_quantity = ref('')\r\n    watch(budget_item, (newVal) => {\r\n        if (newVal) {\r\n            budgetItemDescriptions.value = newVal.descriptions\r\n            item.value = newVal.name\r\n        }\r\n    });\r\n\r\n    watch(budget_item_description, (newVal) => {\r\n        if (newVal) {\r\n            max_quantity.value = newVal.quantity * newVal.quantity_2,\r\n            max_cost.value = (newVal.quantity * newVal.quantity_2 * newVal.cost) - newVal.used_cost\r\n            item_id.value = newVal.id\r\n            description.value = newVal.name\r\n            units.value = newVal.units\r\n        }\r\n    });\r\n\r\n    const subcontractors = ref([])\r\n    const selected_subcontractor = ref('')\r\n    const getSubcontractors = async () => {\r\n        try {\r\n            const response = await axiosInstance.get('subcontractor-agreements')\r\n            subcontractors.value = response.data.map((item) => ({\r\n                ...item,\r\n                name: item.project.short_name + ' - ' + item.item\r\n            }))\r\n        } catch (err) {\r\n            console.error('Error fetching subcontractors:', err)\r\n        }\r\n    }\r\n\r\n    const getUnits = async () => {\r\n        try {\r\n            const response = await axiosInstance.get('units')\r\n            unitList.value = response.data\r\n        } catch (err) {\r\n            console.error('Error fetching units:', err)\r\n        }\r\n    }\r\n\r\n    // Main function to get requisition data\r\n    const getRequisitions = async () => {\r\n        loading_spinner.value = true;\r\n        error.value = '';\r\n\r\n        try {\r\n            const response = await axiosInstance.get(`requisitions/${route.params.requisition_id}`);\r\n            let data = response.data;\r\n            \r\n            console.log('API Response:', data); // Debug log\r\n\r\n            // Handle both array and single object responses\r\n            if (Array.isArray(data)) {\r\n                if (data.length > 0) {\r\n                    data = data[0]; // Take first item if array\r\n                } else {\r\n                    error.value = \"No requisition data found\";\r\n                    loading_spinner.value = false;\r\n                    return;\r\n                }\r\n            }\r\n\r\n            // Process the requisition data\r\n            const processedRequisition = {\r\n                ...data,\r\n                ref_no: data.id,\r\n                date: formatDate(data.created_at),\r\n                requester_id: data.requester_id,\r\n                type: data.type,\r\n                purpose: data.approval_group,\r\n                attachment: data.attachment ? 'https://copex.trustdigital.space/' + data.attachment : null,\r\n                status_id: data.status?.id,\r\n                cost: formatNumber(\r\n                    Array.isArray(data.items)\r\n                        ? data.items.reduce((total, it) => total + (Number(it.quantity) || 0) * (Number(it.rate) || 0), 0)\r\n                        : 0\r\n                ),\r\n                status: {\r\n                    key: data.status,\r\n                    class: data.status_color\r\n                },\r\n            };\r\n\r\n            // Set the main requisition data\r\n            requisition.value = processedRequisition;\r\n            \r\n            // Fill items and other related data\r\n            fillItems(processedRequisition);\r\n            \r\n        } catch (err) {\r\n            console.error('Error fetching requisition:', err);\r\n            error.value = err.message || 'Failed to load requisition data';\r\n            showError(error.value);\r\n        } finally {\r\n            loading_spinner.value = false;\r\n        }\r\n    };\r\n\r\n    const fillItems = (req) => {\r\n        console.log('Filling items for requisition:', req); // Debug log\r\n        \r\n        requisition.value = req;\r\n        remarks.value = req.remarks || [];\r\n        proforma.value = req.attachment;\r\n        subcontractor.value = req.subcontractor;\r\n\r\n        if (req.subcontractor) {\r\n            printDetails(req.subcontractor, req.project);\r\n        }\r\n\r\n        // Process items for display\r\n        requisitionItems.value = (req.items || []).map((item, index) => ({\r\n            ...item,\r\n            Sno: index + 1,\r\n            item: item.remark,\r\n            asset_id: item.asset_id,\r\n            description: item.description,\r\n            rate: Number(item.rate).toLocaleString() + '/=',\r\n            total: (item.quantity * item.rate).toLocaleString() + '/=',\r\n            issued_quantity: '',\r\n            store_item: ''\r\n        }));\r\n\r\n        console.log('Processed requisition items:', requisitionItems.value); // Debug log\r\n    };\r\n\r\n\r\n    const table_option = ref({\r\n        perPage: 50,\r\n        perPageValues: [50, 100, 200, 500],\r\n        skin: 'table table-hover table-striped',\r\n        columnsClasses: { actions: 'actions text-center' },\r\n        sortable: ['id', 'role_name'],\r\n        sortIcon: {\r\n            base: 'sort-icon-none',\r\n            up: 'sort-icon-asc',\r\n            down: 'sort-icon-desc',\r\n        },\r\n        pagination: { nav: 'scroll', chunk: 5 },\r\n        texts: {\r\n            count: 'Showing {from} to {to} of {count}',\r\n            filter: '',\r\n            filterPlaceholder: 'Search...',\r\n            limit: 'Results:',\r\n        },\r\n        resizableColumns: false,\r\n    });\r\n\r\n    const itemColumns = ref(['Sno', 'item', 'description', 'units', 'quantity', 'rate', 'total', 'actions']);\r\n\r\n    watch(requisition_type, (newVal) => {\r\n        if (newVal === 'spares') getItems('get-spares');\r\n        if (newVal === 'labour') getLabours();\r\n        if (newVal === 'construction materials') getItems('get-materials');\r\n    });\r\n\r\n    watch(item, (newVal) => {\r\n        if (requisition_type.value === 'labour' && newVal) {\r\n            rate.value = newVal.rate;\r\n        }\r\n    });\r\n\r\n    \r\n    const clearItemForm = () => {\r\n        quantity.value = '';\r\n        rate.value = '';\r\n        remark.value = '';\r\n        item.value = '';\r\n        description.value = '';\r\n        units.value = '';\r\n        asset.value = '';\r\n        budget_item_description.value = '';\r\n        budget_item.value = '';\r\n    };\r\n\r\n    const asset = ref('');\r\n    const description = ref('');\r\n   \r\n\r\n    const clearForm = () => {\r\n        requisitionItems.value = [];\r\n        incidence.value = '';\r\n        remark.value = '';\r\n        status.value = '';\r\n        budget.value = '';\r\n        budget_item.value = '';\r\n        project.value = '';\r\n        units.value = '';\r\n        item.value = '';\r\n        quantity.value = '';\r\n        rate.value = '';\r\n        description.value = '';\r\n        requisition_type.value = '';\r\n        budget_item_description.value = '';\r\n        budgets.value = [];\r\n        budgetItems.value = [];\r\n        budgetItemDescriptions.value = [];\r\n        briefing.value = '';\r\n    };\r\n\r\n\r\n    const closeModal = () => {\r\n        const modalEl = document.querySelector('.modal.show');\r\n        if (modalEl) {\r\n            const modalInstance = bootstrap.Modal.getInstance(modalEl);\r\n            modalInstance?.hide();\r\n        }\r\n        document.body.classList.remove('modal-open');\r\n        document.body.style.overflow = 'auto';\r\n        document.body.style.paddingRight = '';\r\n        clearForm();\r\n    };\r\n\r\n    const requisitionToEdit = ref(null);\r\n    const requisitionItemToEdit = ref(null);\r\n    const loading = ref(false);\r\n    const briefing = ref('');\r\n\r\n   \r\n    const closeEditModal = () => {\r\n        requisitionToEdit.value = null;\r\n        requisitionItemToEdit.value = null;\r\n        selected_subcontractor.value = '';\r\n        project.value = '';\r\n        description.value = '';\r\n        vendor.value = '';\r\n        incidence.value = '';\r\n        beneficiary.value = '';\r\n        status.value = '';\r\n    };\r\n\r\n    const updateRequisitionItem = async () => {\r\n        loading_spinner.value = true;\r\n        try {\r\n            const payload = {\r\n                requisition_type_id: requisitionItemToEdit.value.requisition_type_id,\r\n                remark: item.value,\r\n                quantity: quantity.value,\r\n                rate: rate.value,\r\n                description: description.value,\r\n                units: units.value?.short_name || units.value,\r\n                asset_id: asset.value?.id,\r\n            };\r\n\r\n            await axiosInstance.put(`/requisition-type-items/${requisitionItemToEdit.value.id}`, payload);\r\n            getRequisitions();\r\n            document.getElementById('close_editing').click();\r\n            showMessage(\"Requisition item updated successfully\");\r\n            closeEditModal();\r\n        } catch (error) {\r\n            showError(error.message);\r\n            console.log(error);\r\n        } finally {\r\n            loading_spinner.value = false;\r\n        }\r\n    };\r\n\r\n    const openEditItemModal = (row) => {\r\n        requisitionItemToEdit.value = row;\r\n\r\n        if (requisition_type.value === 'labour') {\r\n            item.value = labours.value.find(l => l.name === row.remark) || row.remark;\r\n        } else if (['spares', 'construction materials'].includes(requisition_type.value)) {\r\n            item.value = items_list.value.find(i => i.name === row.remark) || row.remark;\r\n        } else {\r\n            item.value = row.remark;\r\n        }\r\n\r\n        units.value = unitList.value.find(u => u.short_name === row.units) || row.units;\r\n        quantity.value = row.quantity;\r\n\r\n        if (typeof row.rate === 'string') {\r\n            rate.value = Number(row.rate.replace(/[^0-9.]/g, '')) || 0;\r\n        } else {\r\n            rate.value = Number(row.rate) || 0;\r\n        }\r\n        description.value = row.description;\r\n        asset.value = assets.value.find(a => a.id === row.asset_id) || '';\r\n    };\r\n\r\n    const printDetails = async (row, project) => {\r\n  try {\r\n    const now = new Date()\r\n    const day = String(now.getDate()).padStart(2, '0')\r\n    const month = String(now.getMonth() + 1).padStart(2, '0')\r\n    const year = now.getFullYear()\r\n    const dateString = `${day}/${month}`\r\n    const formattedDate = `${day}/${month}/${year}`\r\n    const formatDate = `${day}.${month}.${year}`\r\n    const formattedDateTime = `${formattedDate}, ${now.toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'})}`\r\n    const agreementId = `${String(row.id).padStart(3, '0')}/${dateString}`\r\n    const agreementNo = `${row.id}`\r\n    const noticeNo = `${row.id}/${year}`\r\nconst payableAmount = row.payments && row.payments.length > 0\r\n  ? row.payments.reduce((sum, p) => sum + Number(p.quantity), 0)\r\n  : 0\r\n    const printContent = `\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n<title>Subcontractor Agreement Details</title>\r\n<style>\r\n  body { font-family: Arial, sans-serif; margin: 40px; font-size: 13px; }\r\n  .header { display: flex; justify-content: space-between; align-items: flex-start; }\r\n  .logo { width: 160px; height: auto; }\r\n  .agreement-box { border: 1px solid #000; padding: 5px 10px; font-size: 13px; text-align: center; margin-left: auto; border-radius: 5px; }\r\n  .company-title { text-align: center; margin-top: 10px; }\r\n  .company-title h2 { margin: 5px 0; }\r\n  .reg-info { position: absolute; top: 120px; right: 40px; text-align: right; font-size: 10px; line-height: 1.4; }\r\n  .section-title { text-align: center; font-weight: bold; text-decoration: underline; margin: 20px 0 10px 0; }\r\n  .title { text-align: center; font-weight: bold; margin: 20px 0 10px 0; }\r\n  .details-list { margin-top: 15px; line-height: 1.6; }\r\n  .details-list div { margin-bottom: 4px; }\r\n  table { width: 100%; border-collapse: collapse; margin-top: 10px; }\r\n  table.items th, table.items td { border: 1px solid #000; padding: 6px; font-weight: normal; }\r\n  table.items thead tr th { background-color: #f8f8f8; border: 1px solid #000; }\r\n  .text-right { text-align: right; }\r\n  .text-center { text-align: center; }\r\n  @media print { body { margin: 10mm; } .no-print { display: none; } }\r\n</style>\r\n</head>\r\n<body>\r\n<div class=\"header\">\r\n  <img src=\"https://bushman.ink/copex.jpg\" class=\"logo\" />\r\n  <div class=\"agreement-box\">\r\n    Agreement ID:<br>\r\n    <span style=\"color:red;\">${agreementId}</span>\r\n  </div>\r\n</div>\r\n\r\n<div class=\"reg-info\">\r\n  TIN: 103-826-519<br>\r\n  VRN: 20-01-017530R\r\n</div>\r\n\r\n<div class=\"company-title\">\r\n  <h2>COPEX CONTRACTORS CO.LTD</h2>\r\n  <div>Msamvu, P.O.BOX 678, Morogoro</div>\r\n  <div>Mobile, 0713 000 777, 0657 111 555</div>\r\n</div>\r\n\r\n<div class=\"section-title\">SUBCONTRACTOR AGREEMENT DETAILS</div>\r\n<div class=\"title\">${project.toUpperCase()} - ${row.item.toUpperCase()}</div>\r\n\r\n<div style=\"display: flex; justify-content: space-between; align-items: center;\">\r\n  <div class=\"text-start\"><strong>NOTICE NO. 00${noticeNo}</strong></div>\r\n  <div class=\"text-end\"><strong>Date: ${formatDate}</strong></div>\r\n</div>\r\n\r\n<div class=\"text-center\"><strong>REF: SUBCONTRACTING NOTICE No. ${agreementNo}</strong></div>\r\n\r\n<div class=\"text-start\"><p>Refer the subject matter above</p></div>\r\n<div class=\"text-start\"><p>This form as internal notice on subcontracting piece work on <strong>${row.item.toUpperCase()}</strong></p></div>\r\n\r\n<div class=\"details-list\">\r\n  <div><strong>Subcontracted:</strong> ${row.subcontracted_to}</div><br>\r\n  <div><strong>Item Description:</strong> ${row.item}</div><br>\r\n  <div><strong>Contracted Quantity:</strong> ${row.quantity}</div><br>\r\n  <div><strong>This payment certificate:</strong> ${row.payment_term.name}</div><br>\r\n  <div><strong>Subcontracted To:</strong> ${row.subcontracted_to}</div><br>\r\n  <div><strong>Payment Details:</strong> ${row.payment_number}</div><br>\r\n  <div><strong>Subcontracting Unit Price:</strong> TZS ${formatNumber(row.rate)} per ${row.unit}</div><br>\r\n  <div><strong>Total Amount of Contract:</strong> TZS ${formatNumber(row.quantity * row.rate)}</div><br>\r\n  <div><strong>Total Amount Archived:</strong></div><br>\r\n  <div><strong>This Certificate Payable Amount:</strong> ${formatNumber(payableAmount)} </div>\r\n</div>\r\n\r\n${row.payments && row.payments.length > 0 ? `\r\n<div class=\"section-title\">PAYMENT HISTORY</div>\r\n<table class=\"items\">\r\n  <thead>\r\n    <tr>\r\n      <th style=\"width: 30px;\"><strong>Sno.</strong></th>\r\n      <th><strong>Date</strong></th>\r\n      <th><strong>Description</strong></th>\r\n      <th><strong>Amount</strong></th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    ${row.payments.map((payment, index) => {\r\n      const d = new Date(payment.created_at)\r\n      const paidAt = `${String(d.getDate()).padStart(2, '0')}.${String(d.getMonth() + 1).padStart(2, '0')}.${d.getFullYear()}`\r\n      return `\r\n        <tr>\r\n          <td class=\"text-center\">${index + 1}</td>\r\n          <td class=\"text-center\">${paidAt}</td>\r\n          <td class=\"text-center\">${payment.description || ''}</td>\r\n          <td class=\"text-center\">${formatNumber(payment.quantity)}</td>\r\n        </tr>\r\n      `\r\n    }).join('')}\r\n  </tbody>\r\n</table>\r\n` : ''}\r\n\r\n<div style=\"margin-top: 40px; text-align: center; font-size: 12px; border-top: 1px solid #666; padding-top: 8px;\">\r\n  <p> ${new Date().getFullYear()} COPEX CONTRACTORS CO.LTD | TIN: 135-489-247 | VRN: 40-032826C</p>\r\n  <p>Msamvu, P.O.BOX 678, Morogoro | Mobile: 0713 000 777, 0657 111 555</p>\r\n</div>\r\n\r\n<div style=\"margin-top: 10px; font-size: 11px; text-align: left;\">\r\n  ${formattedDateTime}\r\n</div>\r\n\r\n</body>\r\n</html>\r\n`\r\n\r\n    const blob = new Blob([printContent], { type: \"text/html\" })\r\n    subcontractor.value = URL.createObjectURL(blob)\r\n  } catch (error) {\r\n    showError(`Failed to generate agreement details: ${error.message}`)\r\n  }\r\n}\r\n\r\n  \r\n    onMounted(async () => {\r\n        types.value = allTypes.value.filter(t => t !== 'General' || user_permissions.includes('can_create_general_requisitions'));\r\n        \r\n        // Load the main requisition data first\r\n        await getRequisitions();\r\n        \r\n        // Load other supporting data\r\n        getUnits();\r\n        getSubcontractors();\r\n        getAssets();\r\n        \r\n    });\r\n</script>","import script from \"./individual.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./individual.vue?vue&type=script&setup=true&lang=js\"\n\nconst __exports__ = script;\n\nexport default __exports__"],"names":["useMeta","title","axiosInstance","axios","baseURL","process","route","useRouter","useRoute","user_permissions","JSON","parse","localStorage","getItem","permissions","allTypes","ref","types","requisition_type","spinner","incidence","formatNumber","inject","formatDate","loadingSpinner","status","Date","toISOString","split","item","quantity","rate","remark","units","remarks","item_id","loading_spinner","error","showMessage","showError","formRequisitionItems","formRequisitionItems2","unitList","vendor","beneficiary","requisition","requisitionItems","proforma","subcontractor","assets","getAssets","async","response","get","value","data","map","name","type_name","err","console","project","budgets","budget","getBudgets","id","filter","b","watch","newVal","clearItemForm","clearForm","budgetItems","budget_item","items","budgetItemDescriptions","budget_item_description","max_cost","max_quantity","descriptions","quantity_2","cost","used_cost","description","subcontractors","selected_subcontractor","getSubcontractors","short_name","getUnits","getRequisitions","params","requisition_id","log","Array","isArray","length","processedRequisition","ref_no","date","created_at","requester_id","type","purpose","approval_group","attachment","status_id","reduce","total","it","Number","key","class","status_color","fillItems","message","req","printDetails","index","Sno","asset_id","toLocaleString","issued_quantity","store_item","table_option","perPage","perPageValues","skin","columnsClasses","actions","sortable","sortIcon","base","up","down","pagination","nav","chunk","texts","count","filterPlaceholder","limit","resizableColumns","itemColumns","getItems","getLabours","asset","briefing","closeModal","modalEl","document","querySelector","modalInstance","bootstrap","Modal","getInstance","hide","body","classList","remove","style","overflow","paddingRight","requisitionToEdit","requisitionItemToEdit","loading","closeEditModal","updateRequisitionItem","payload","requisition_type_id","put","getElementById","click","openEditItemModal","row","labours","find","l","includes","items_list","i","u","replace","a","now","day","String","getDate","padStart","month","getMonth","year","getFullYear","dateString","formattedDate","formattedDateTime","toLocaleTimeString","hour","minute","agreementId","agreementNo","noticeNo","payableAmount","payments","sum","p","printContent","toUpperCase","subcontracted_to","payment_term","payment_number","unit","payment","d","paidAt","join","blob","Blob","URL","createObjectURL","onMounted","t","__exports__"],"sourceRoot":""}