{"version":3,"file":"js/8598.c0d6cfe5.js","mappings":"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","sources":["webpack://cork-vue3/./src/views/jobcards/jobcard_list.vue","webpack://cork-vue3/./src/views/jobcards/jobcard_list.vue?bb11"],"sourcesContent":["<template>\r\n    <div class=\"layout-px-spacing\">  \r\n            <ul class=\"navbar-nav flex-row mt-2\">\r\n                <li>\r\n                    <div class=\"page-header\">\r\n                        <nav class=\"breadcrumb-one\" aria-label=\"breadcrumb\">\r\n                            <ol class=\"breadcrumb\">\r\n                                <li class=\"breadcrumb-item active\" aria-current=\"page\"><span>Jobcards</span></li>\r\n                            </ol>\r\n                        </nav>\r\n                    </div>\r\n                </li>\r\n            </ul>\r\n\r\n            <!-- offcanvas start -->\r\n\r\n<div class=\"offcanvas offcanvas-end\" data-bs-scroll=\"true\" tabindex=\"-1\" id=\"offcanvasWithBothOptions\" aria-labelledby=\"offcanvasWithBothOptionsLabel\">\r\n  <div class=\"offcanvas-header\">\r\n    <h5 class=\"offcanvas-title\" id=\"offcanvasWithBothOptionsLabel\">COMPANIES LIST</h5>\r\n    <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"offcanvas\" aria-label=\"Close\"></button>\r\n  </div>\r\n  <div class=\"offcanvas-body\">\r\n  <div class=\"row\">\r\n  <div class=\"col-12\">\r\n    <div class=\"list-group\" id=\"list-tab\" role=\"tablist\"  >\r\n      <a v-for=\"list in companies\" :key=\"list.id\" class=\"list-group-item list-group-item-action\" :id=\"'company-link-' + list.id\" data-bs-toggle=\"list\" :href=\"'#company-' + list.id\" role=\"tab\" :aria-controls=\"'company-' + list.id\" data-bs-dismiss=\"offcanvas\" @click=\"company = list\">{{ list.short_name }}</a>\r\n      <a  class=\"list-group-item list-group-item-action\" id=\"company-link-all\" data-bs-toggle=\"list\" href=\"#company-all\" role=\"tab\" aria-controls=\"company-all\" data-bs-dismiss=\"offcanvas\" @click=\"company = ''\">ALL COMPANIES</a>\r\n    </div>\r\n  </div>\r\n</div>\r\n  </div>\r\n</div>\r\n <!-- offcanvas ends -->\r\n\r\n\r\n            <div class=\"d-flex me-4 mt-2\">\r\n                         \r\n        <button class=\"btn btn-dark me-2 px-3\" @click=\"$router.go(-1)\">\r\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" class=\"bi bi-arrow-left\" viewBox=\"0 0 16 16\">\r\n  <path fill-rule=\"evenodd\" d=\"M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8\"/>\r\n</svg>\r\n                </button>\r\n                        <div class=\"ms-auto\">\r\n                            <button class=\" me-2 btn btn-primary me-2\" @click=\"jobcard_registration=!jobcard_registration\">                           \r\n                              <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" class=\"bi bi-plus-square\" viewBox=\"0 0 16 16\">\r\n  <path d=\"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z\"/>\r\n  <path d=\"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4\"/>\r\n</svg>\r\n</button>\r\n                            <button class=\" me-2 btn btn-info\" data-bs-toggle=\"offcanvas\" data-bs-target=\"#offcanvasWithBothOptions\" aria-controls=\"offcanvasWithBothOptions\">                           \r\n                             <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"26\" height=\"26\" fill=\"currentColor\" class=\"bi bi-funnel\" viewBox=\"0 0 16 16\">\r\n  <path d=\"M1.5 1.5A.5.5 0 0 1 2 1h12a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.128.334L10 8.692V13.5a.5.5 0 0 1-.342.474l-3 1A.5.5 0 0 1 6 14.5V8.692L1.628 3.834A.5.5 0 0 1 1.5 3.5zm1 .5v1.308l4.372 4.858A.5.5 0 0 1 7 8.5v5.306l2-.666V8.5a.5.5 0 0 1 .128-.334L13.5 3.308V2z\"/>\r\n</svg> Select Company\r\n</button>\r\n                             <button class=\"btn btn-success \" \r\n                             v-if=\"machine_id\"\r\n                             @click=\"jobcardSummary(machine_id)\"\r\n                             >\r\n\r\n                             \r\n <div \r\n                                     v-if=\"loader\"\r\n                                     class=\"spinner-border text-white mt-1\"\r\n                                      role=\"status\"\r\n                                      style=\"width: 1.5rem; height: 1.5rem;\"\r\n                                      >\r\n                                      <span class=\"sr-only\">Loading...</span>\r\n                                    </div>\r\n                                     <svg \r\n                                     v-else\r\n                                     xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"feather feather-printer me-1\">\r\n                        <polyline points=\"6 9 6 2 18 2 18 9\"></polyline>\r\n                        <path d=\"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2\"></path>\r\n                        <rect x=\"6\" y=\"14\" width=\"12\" height=\"8\"></rect>\r\n                    </svg>\r\n                             </button>\r\n \r\n                             \r\n<div class=\"btn-group ms-2 me-4\" role=\"group\" aria-label=\"Filter Job Cards\">\r\n  <!-- Show this only when filters are hidden -->\r\n\r\n  <!-- Show Rated & Unrated buttons only after Filter is clicked -->\r\n  <div \r\n\r\n    class=\"btn-group\" \r\n    role=\"group\" \r\n    aria-label=\"Filter Job Cards\"\r\n  >\r\n\r\n\r\n\r\n  </div>\r\n</div>\r\n                        </div>\r\n                    </div>  \r\n      <!-- jobcard registration form starts -->\r\n    <form v-if=\"jobcard_registration\" class=\"mt-3 p-3 border rounded bg-white shadow\" @submit.prevent=\"registerJobcard\">\r\n        <h4  class=\"text-center\"> JOBCARD REGISTRATION</h4>\r\n        <div class=\"row mb-2\">\r\n                                  <div class=\"col-md-4\">\r\n                <label class=\"form-label\">Company </label>\r\n                <Multiselect\r\n  v-model=\"company\"\r\n  :options=\"companies\"\r\n  :close-on-select=\"true\"\r\n  label=\"name\"\r\n  value-prop=\"id\"\r\n  placeholder=\"Select Company\"  \r\n  :searchable=\"true\" \r\n/>\r\n            </div>\r\n            <div class=\"col-md-4\">\r\n                <label class=\"form-label\">Vehicle / Machine</label>\r\n                <Multiselect\r\n                :disabled=\"!company\"\r\n  v-model=\"selected_machine\"\r\n  :options=\"Machines\"\r\n  :close-on-select=\"true\"\r\n  label=\"name\"\r\n  value-prop=\"id\"\r\n  placeholder=\"Select Machine\"  \r\n  @change=\"handleDescriptionChange\"\r\n  :required=\"!machine_field\"\r\n  :searchable=\"true\" \r\n/>\r\n            </div>\r\n\r\n            <div class=\"col-md-4\">\r\n                <label class=\"form-label\">Service Type</label>\r\n                <select class=\"form-select\" v-model=\"selected_service\" required>\r\n                    <option value=\"\" >Select a Service Type</option>\r\n                    <option v-for=\"service in services\" :key=\"service.id\" :value=\"service.id\">{{ service.name }}</option>\r\n                </select>\r\n            </div>\r\n            <div class=\"col-md-4\">\r\n                <label class=\"form-label\">Current Km of Service</label>\r\n                <input type=\"number\" class=\"form-control\" placeholder=\"Enter Current Km\" v-model=\"current_km_of_service\" >\r\n            </div>\r\n            <div class=\"col-md-4\">\r\n                <label class=\"form-label\">Next Km of Service</label>\r\n                <input type=\"number\" class=\"form-control\" placeholder=\"Enter Next Km\" v-model=\"next_km_of_service\" >\r\n            </div>\r\n             <div class=\"col-md-4\">\r\n                <label class=\"form-label\">Enter Date Created</label>\r\n                <input type=\"date\" class=\"form-control\" placeholder=\"Enter Next Km\" v-model=\"date_created\" >\r\n            </div>\r\n        </div>\r\n        <div class=\"text-center gap-2 justify-content-end\">\r\n            <button type=\"button\" class=\"btn btn-danger me-3\" @click=\"jobcard_registration = false\">Cancel</button>\r\n            <button type=\"submit\" class=\"btn btn-primary\">Register</button>\r\n        </div>\r\n    </form>\r\n             <!-- jobcard registration form ends-->\r\n\r\n\r\n        <div class=\"text-center mb-2\">\r\n        <h4 > {{ header }}  <span v-if=\"company\">{{ 'FOR ' }} {{ company.short_name }}</span> </h4>\r\n           \r\n        </div>\r\n      \r\n        <div class=\"row layout-top-spacing\">\r\n            <div class=\"col-xl-12 col-lg-12 col-sm-12 layout-spacing\">\r\n                <div class=\"panel p-0\">\r\n                    <div class=\"custom-table table3\">\r\n                                      <!-- loading spinner starts -->\r\n        <div v-if=\"loading_spinner\" v-html=\"tableShimmer()\"></div>\r\n        <!-- Loading spinner ends -->\r\n                        <v-client-table v-else :data=\"filteredJobcards\" :columns=\"columns\" :options=\"table_option\" >\r\n                          <template #status=\"props\">\r\n                                <span class=\"badge inv-status\" :class=\"'badge-' + props.row.status.class\">{{ props.row.status.key }}</span>\r\n                            </template>\r\n                            <template #actions=\"props\">\r\n\r\n                                <div class=\"d-flex justify-content-center align-items-center gap-2\">\r\n                                    <a \r\n                                        href=\"javascript:;\" \r\n                                        class=\"text-success\" \r\n                                        @click=\"openEditModal(props.row)\" \r\n                                        data-bs-toggle=\"modal\"\r\n                                        data-bs-target=\"#edit-modal\"\r\n                                        title=\"Edit Jobcard\"\r\n                                        v-if=\"user_permissions.includes('can_edit_jobcard')\"\r\n                                    >\r\n                                        <svg\r\n                                            xmlns=\"http://www.w3.org/2000/svg\"\r\n                                            width=\"24\"\r\n                                            height=\"24\"\r\n                                            viewBox=\"0 0 24 24\"\r\n                                            fill=\"none\"\r\n                                            stroke=\"currentColor\"\r\n                                            stroke-width=\"1.5\"\r\n                                            stroke-linecap=\"round\"\r\n                                            stroke-linejoin=\"round\"\r\n                                        >\r\n                                            <path d=\"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\"></path>\r\n                                            <path d=\"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z\"></path>\r\n                                        </svg>\r\n                                    </a>\r\n\r\n                                <router-link :to=\"'/jobcard/'+ props.row.id + '/' + props.row.machine_id\" class=\"text-primary\"  >\r\n                                    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" class=\"bi bi-eye\" viewBox=\"0 0 16 16\">\r\n                                      <path d=\"M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8M1.173 8a13 13 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5s3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5s-3.879-1.168-5.168-2.457A13 13 0 0 1 1.172 8z\"/>\r\n                                      <path d=\"M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5M4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0\"/>\r\n                                    </svg>\r\n                                </router-link>\r\n                                </div>\r\n            \r\n                                \r\n                            </template>\r\n                           \r\n                        </v-client-table>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n     \r\n\r\n                <!-- Edit jobcard modal starts -->\r\n<div class=\"modal fade mymodal\" id=\"edit-modal\" data-bs-backdrop=\"false\" data-bs-keyboard=\"false\" tabindex=\"-1\" aria-labelledby=\"editModalLabel\" aria-hidden=\"true\">\r\n  <div class=\"modal-dialog modal-xl\">\r\n    <div class=\"modal-content\">\r\n      <div class=\"modal-header\">\r\n        <h1 class=\"modal-title fs-5\" id=\"editModalLabel\">Edit Jobcard for {{ selected_machine?.asset }}</h1>\r\n        <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\" @click=\"closeEditModal()\"></button>\r\n      </div>\r\n      <form @submit.prevent=\"updateJobcard()\">\r\n        <div class=\"modal-body\">\r\n            <div class=\"row mb-3\">\r\n            <div class=\"col-md-6\">\r\n                <label for=\"current_km_of_service\">Current Km of Service</label>\r\n                <input type=\"number\" v-model=\"current_km_of_service\" class=\"form-control\" placeholder=\"Enter Current Km\">\r\n            </div>\r\n            <div class=\"col-md-6\">\r\n                <label for=\"next_km_of_service\">Next Km of Service</label>\r\n                <input type=\"number\" v-model=\"next_km_of_service\" class=\"form-control\" placeholder=\"Enter Next Km\">\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class=\"modal-footer\">\r\n          <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\" @click=\"closeEditModal()\" id=\"close_editing\">Close</button>\r\n          <button type=\"submit\" class=\"btn btn-primary\">\r\n            <span v-if=\"loading\" class=\"spinner-border spinner-border-sm text-white me-2\" role=\"status\"></span>\r\n            Edit\r\n          </button>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  </div>\r\n</div>\r\n<!-- Edit jobcard modal ends -->\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    </div>\r\n</template>\r\n<style>\r\n    .table3 .actions svg {\r\n        padding: 2px;\r\n    }\r\n</style>\r\n<script setup>\r\n    import { onMounted, ref,inject,watch,nextTick } from 'vue';\r\n    import axios from 'axios';\r\n    import { useMeta } from '@/composables/use-meta';\r\n    import Multiselect from '@suadelabs/vue3-multiselect';\r\n    import '@suadelabs/vue3-multiselect/dist/vue3-multiselect.css';\r\n    import '@/assets/sass/scrollspyNav.scss';\r\n    const selected_machine = ref(null);\r\n    const user_permissions = JSON.parse(localStorage.getItem(\"user\")).permissions;\r\n    const selected_service = ref('');\r\n    const machine_filter = ref(null);\r\n    const current_km_of_service = ref('');\r\n    const next_km_of_service = ref('');\r\n    const loading_spinner = ref(true);\r\n    const jobcard_registration = ref(false);\r\n    const loader = ref(false);\r\n    const Machines = ref([]);\r\n    const services = ref([]);\r\n    const showMessage = inject('showMessage');\r\n    const showError = inject('showError');\r\n    const tableShimmer = inject('tableShimmer');\r\n    useMeta({ title: 'Jobcard Lists' });\r\n    const source = ref(localStorage.getItem('source'))\r\n   const filter_jobcard = ref(false)\r\n    const jobcardData = ref ([])\r\nconst jobcardSummary = async (id) => {\r\n  loader.value = true;\r\n    try {\r\n        const response = await axiosInstance.get(`/jobcard-summary?asset_id=${id}`);\r\n        jobcardData.value = response.data;\r\n\r\n        await nextTick(); // ensures reactivity is done updating\r\n        printJobcardSummary();\r\n        \r\n    } catch (error) {\r\n        showError(error.message);\r\n        console.error(\"Error fetching jobcard summary:\", error);\r\n    }\r\n};\r\n\r\nconst printJobcardSummary = () => {\r\n  const jobcards = jobcardData.value || [];\r\n\r\n  loader.value = false;\r\n  const iframe = document.createElement(\"iframe\");\r\n  iframe.style.display = \"none\";\r\n  document.body.appendChild(iframe);\r\n\r\n  const printContent = `\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n<title>Jobcard Summary</title>\r\n<style>\r\n  body { font-family: Arial, sans-serif; margin: 40px; font-size: 13px; }\r\n  .header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }\r\n  .logo { width: 150px; height: auto; }\r\n  .company-title { text-align: center; margin-top: 5px; }\r\n  .company-title h2 { margin: 5px 0; }\r\n  .reg-info { position: absolute; top: 40px; right: 40px; text-align: right; font-size: 10px; line-height: 1.4; font-weight: normal; }\r\n  table { width: 100%; border-collapse: collapse; margin-top: 20px; }\r\n  th, td { border: 1px solid #000; padding: 6px; text-align: center; }\r\n  th { background-color: #f8f8f8; }\r\n</style>\r\n</head>\r\n<body>\r\n\r\n<div class=\"header\">\r\n  <img src=\"https://bushman.ink/copex.jpg\" class=\"logo\" />\r\n  <div class=\"reg-info\">\r\n    TIN: 135-489-247<br>\r\n    VRN: 40-032826C\r\n  </div>\r\n</div>\r\n\r\n<div class=\"company-title\">\r\n  <h2>COPEX CONTRACTORS CO.LTD</h2>\r\n  <div>Msamvu, P.O.BOX 678, Morogoro</div>\r\n  <div>Mobile: 0713 000 777, 0657 111 555</div>\r\n</div>\r\n\r\n\r\n<table>\r\n  <thead>\r\n    <tr>\r\n      <th>${machine_filter.value.category.name}</th>\r\n      <th>TYPE</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n      <tr>\r\n        <td>${machine_filter.value.name}</td>\r\n        <td>${machine_filter.value.type_name}</td>\r\n      </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<h2 style=\"text-align:center; margin-top: 20px;\">Jobcard Summary</h2>\r\n\r\n<table>\r\n  <thead>\r\n    <tr>\r\n      <th>SN</th>\r\n      <th>Jobcard NO</th>\r\n      <th>Date Created</th>\r\n      <th>Service Type</th>\r\n      <th>Current Km Service</th>\r\n      <th>Next Km Service</th>\r\n      <th>Status</th>\r\n      <th>Total Sum</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    ${jobcards.map((jc, index) => `\r\n      <tr>\r\n        <td>${index + 1}</td>\r\n        <td>${jc.id}</td>\r\n        <td>${jc.date_created}</td>\r\n        <td>${jc.service_type}</td>\r\n        <td>${jc.current_km_service}</td>\r\n        <td>${jc.next_km_service}</td>\r\n        <td>${jc.status_name}</td>\r\n        <td style=\"text-align:right\">${parseFloat(jc.total_sum).toLocaleString()}/=</td>\r\n      </tr>\r\n    `).join(\"\")}\r\n    <tr>\r\n      <td colspan=\"7\" style=\"text-align:right\"><strong>Grand Total</strong></td>\r\n      <td style=\"text-align:right\"><strong>${\r\n        jobcards.reduce((sum, jc) => sum + parseFloat(jc.total_sum || 0), 0).toLocaleString()\r\n      }/=</strong></td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n\r\n\r\n\r\n</body>\r\n</html>\r\n`;\r\n\r\n  const iframeDoc = iframe.contentWindow.document;\r\n  iframeDoc.open();\r\n  iframeDoc.write(printContent);\r\n  iframeDoc.close();\r\n\r\n  iframe.onload = () => {\r\n    iframe.contentWindow.focus();\r\n    iframe.contentWindow.print();\r\n    setTimeout(() => {\r\n      document.body.removeChild(iframe);\r\n    }, 1000);\r\n  };\r\n};\r\n\r\n\r\n    const columns = ref(['Sno','jobcard_id', 'name','date_created','service_type','current_km_of_service','next_km_of_service','status','actions']);\r\n    const items = ref([]);\r\n    const table_option = ref({\r\n        perPage: 50,\r\n        perPageValues: [ 50,100,200,500,1000],\r\n        skin: 'table table-hover table-striped',\r\n        columnsClasses: { actions: 'actions text-center' },\r\n        sortable: ['id', 'vehicle_no','date','service_type','current_service_kms','next_service_kms','status'],\r\n        sortIcon: {\r\n            base: 'sort-icon-none',\r\n            up: 'sort-icon-asc',\r\n            down: 'sort-icon-desc',\r\n        },\r\n        pagination: { nav: 'scroll', chunk: 5 },\r\n        texts: {\r\n            count: 'Showing {from} to {to} of {count}',\r\n            filter: '',\r\n            filterPlaceholder: 'Search...',\r\n            limit: 'Results:',\r\n        },\r\n        resizableColumns: false,\r\n    });\r\n\r\n    const axiosInstance = axios.create({\r\n        baseURL: process.env.VUE_APP_API_BASE_URL\r\n    });\r\n\r\n    const machine_id = ref(null);\r\n\r\n   \r\n   const header = ref('JOBCARD LIST')\r\n  const fetchJobCards = async() => {\r\n   try{\r\n     const response = await axiosInstance.get('job-card')\r\n     items.value = response.data.map((item,index)=>({\r\n      ...item,\r\n      Sno : index + 1,\r\n      jobcard_id : item.id,\r\n      name : item.machine.name + ' - ' + item.machine.type_name,\r\n      status : {\r\n        key : item.status.name,\r\n        class : item.status.color\r\n      }\r\n     }))\r\n     filteredJobcards.value = items.value\r\n   }catch(error){\r\n\r\n   }\r\n};\r\n\r\n    const date_created = ref('')\r\n    const registerJobcard = () => {\r\n        jobcard_registration.value = false;\r\n        loading_spinner.value = true;\r\n        const jobcardData = {\r\n            machine_id: selected_machine.value.id,\r\n            machine_name: \"none\",\r\n            status_name: 'Active',\r\n            status_color: 'primary',\r\n            status_id : 6,\r\n            service_type: services.value.find(service => service.id === selected_service.value).name,\r\n            current_km_of_service: current_km_of_service.value,\r\n            next_km_of_service: next_km_of_service.value ,\r\n            date_created : date_created.value,\r\n            company_id : company.value.id,\r\n            issuer_id : JSON.parse(localStorage.getItem(\"user\")).id,\r\n        };\r\n\r\n        axiosInstance\r\n            .post('/job-card', jobcardData)\r\n            .then((response) => {\r\n                fetchJobCards();\r\n                showMessage('Jobcard registered successfully!');\r\n                loading_spinner.value = false;\r\n            })\r\n            .catch((error) => {\r\n                showError(error.message);\r\n                console.log(error);\r\n                loading_spinner.value = false;\r\n            });\r\n    };\r\n\r\nconst fetchServices = () =>{\r\n      loading_spinner.value = true;\r\n      axiosInstance\r\n        .get(`/service-type`)\r\n        .then((response) => {\r\n          if (Array.isArray(response.data)) {\r\n            services.value = response.data;\r\n          } else {\r\n            console.error(\"Invalid response format\");\r\n          }\r\n        })\r\n        .catch((error) => {\r\n          console.error(\"Error fetching user data:\", error.message);\r\n        })\r\n        .finally(() => {\r\n          loading_spinner.value = false;\r\n        });\r\n    }\r\n\r\n    const fetchMachines = async () => {\r\n      loading_spinner.value = true;\r\n      try {\r\n        const response = await axiosInstance.get(`/machines`);\r\n        if (Array.isArray(response.data)) {\r\n          Machines.value = response.data.map(machine => ({\r\n            id: machine.id,\r\n            name: machine.name,\r\n            type: machine.type_name,  \r\n            asset: machine.name + ' - ' + machine.type_name        \r\n          }));\r\n        } else {\r\n          console.error(\"Invalid response format\");\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error fetching machine data:\", error.message);\r\n      } finally {\r\n        loading_spinner.value = false;\r\n      }\r\n    }\r\n\r\nconst deleteJobcard = (jobcardId) => {\r\n    if (confirm('Are you sure you want to delete this jobcard?')) {\r\n        axiosInstance\r\n            .delete(`/job-card/${jobcardId}`)\r\n            .then((response) => {\r\n                fetchJobCards();\r\n                loading_spinner.value = true;\r\n                alert('Jobcard deleted successfully!');\r\n                if (response.data.status === 200) {\r\n                    fetchJobCards();\r\n                } else {\r\n                    console.error(\"Error deleting jobcard:\", response.data.message);\r\n                }\r\n            })\r\n            .catch((error) => {\r\n                console.error(\"Error deleting jobcard:\", error.message);\r\n            });\r\n    }\r\n};\r\n\r\nconst companies= ref([])\r\nconst company = ref('')\r\nconst getCompanies = async()=>{\r\n  const response = await axiosInstance.get('companies')\r\n  companies.value = response.data\r\n}\r\n\r\nconst filteredJobcards = ref([])\r\n        watch(company, (newVal) => {\r\n    if (newVal) {\r\n         filteredJobcards.value = items.value.filter(card => card.company_id === newVal.id)\r\n    }else{\r\n      filteredJobcards.value = items.value\r\n    }\r\n});\r\n\r\nconst openEditModal = (jobcard) => {\r\n    selected_machine.value = Machines.value.find(machine => machine.id === jobcard.machine_id);\r\n    current_km_of_service.value = jobcard.current_km_of_service;\r\n    next_km_of_service.value = jobcard.next_km_of_service;\r\n    jobcard_id.value = jobcard.id;\r\n    editModal.value = true;\r\n}\r\n\r\nconst jobcard_id = ref(null);\r\nconst editModal = ref(false);\r\n\r\nconst loading = ref(false)\r\nconst updateJobcard = async () => {\r\n    loading.value = true;\r\n    try {\r\n        const payload = {\r\n            current_km_of_service: current_km_of_service.value,\r\n            next_km_of_service: next_km_of_service.value\r\n        };\r\n        await axiosInstance.put(`/job-card/${jobcard_id.value}`, payload);\r\n        showMessage('Jobcard updated successfully!');\r\n        fetchJobCards();\r\n        document.getElementById('close_editing').click();\r\n        closeEditModal();\r\n    } catch (error) {\r\n        showError(error.message);\r\n        console.log(error);\r\n    } finally {\r\n        loading.value = false;\r\n    }\r\n};\r\n\r\nconst closeEditModal = () => {\r\n    selected_machine.value = null;\r\n    current_km_of_service.value = '';\r\n    next_km_of_service.value = '';\r\n    jobcard_id.value = null;\r\n    editModal.value = false;\r\n};\r\n\r\n    onMounted(() => {\r\n        getCompanies();\r\n        fetchJobCards();\r\n        fetchServices();\r\n        fetchMachines();\r\n    });\r\n</script>\r\n\r\n","import script from \"./jobcard_list.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./jobcard_list.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./jobcard_list.vue?vue&type=style&index=0&id=01a9d521&lang=css\"\n\nconst __exports__ = script;\n\nexport default __exports__"],"names":["selected_machine","ref","user_permissions","JSON","parse","localStorage","getItem","permissions","selected_service","machine_filter","current_km_of_service","next_km_of_service","loading_spinner","jobcard_registration","loader","Machines","services","showMessage","inject","showError","tableShimmer","useMeta","title","jobcardData","jobcardSummary","async","value","response","axiosInstance","get","id","data","nextTick","printJobcardSummary","error","message","console","jobcards","iframe","document","createElement","style","display","body","appendChild","printContent","category","name","type_name","map","jc","index","date_created","service_type","current_km_service","next_km_service","status_name","parseFloat","total_sum","toLocaleString","join","reduce","sum","iframeDoc","contentWindow","open","write","close","onload","focus","print","setTimeout","removeChild","columns","items","table_option","perPage","perPageValues","skin","columnsClasses","actions","sortable","sortIcon","base","up","down","pagination","nav","chunk","texts","count","filter","filterPlaceholder","limit","resizableColumns","axios","baseURL","process","machine_id","header","fetchJobCards","item","Sno","jobcard_id","machine","status","key","class","color","filteredJobcards","registerJobcard","machine_name","status_color","status_id","find","service","company_id","company","issuer_id","post","then","catch","log","fetchServices","Array","isArray","finally","fetchMachines","type","asset","companies","getCompanies","watch","newVal","card","openEditModal","jobcard","editModal","loading","updateJobcard","payload","put","getElementById","click","closeEditModal","onMounted","__exports__"],"sourceRoot":""}