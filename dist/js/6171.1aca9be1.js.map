{"version":3,"file":"js/6171.1aca9be1.js","mappings":"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","sources":["webpack://cork-vue3/./src/views/approvalChain/sheet.vue","webpack://cork-vue3/./src/views/approvalChain/sheet.vue?00e9"],"sourcesContent":["<template>\r\n  <div class=\"layout-px-spacing\">\r\n    <ul class=\"navbar-nav flex-row mt-2\">\r\n      <li>\r\n        <div class=\"page-header\">\r\n          <nav class=\"breadcrumb-one\" aria-label=\"breadcrumb\">\r\n            <ol class=\"breadcrumb\">\r\n              <li class=\"breadcrumb-item\"><a href=\"javascript:;\">{{ approvalGroup.group }}</a></li>\r\n              <li class=\"breadcrumb-item active\" aria-current=\"page\">\r\n                <span v-for=\"chain in approvalGroup.roles\">{{ chain.role }} >></span>\r\n              </li>\r\n            </ol>\r\n          </nav>\r\n        </div>\r\n      </li>\r\n    </ul>\r\n    <div class=\"d-flex\">\r\n      <div class=\"ms-auto\">\r\n        <div class=\"btn-group\">\r\n          <router-link to=\"/requisitions/all\" class=\"btn btn-primary me-2\">Requisitions</router-link>\r\n           <router-link to=\"/good-received-notes/dashboard\" class=\"btn btn-secondary\">Good Received Notes</router-link>\r\n        </div>\r\n      </div>\r\n    </div>\r\n<h2 class=\"text-center my-3\">\r\n  {{ approvalGroup?.group?.toLowerCase().includes('voucher') ? \"PAYMENT VOUCHERS\" : \"LOCAL PURCHASE ORDERS\" }}\r\n</h2>\r\n\r\n  \r\n   \r\n\r\n  <!-- Modal -->\r\n <!-- Loop through items and render approval chain and controls in each card -->\r\n<div class=\"row\">\r\n  <div\r\n    class=\"card shadow mb-4 col-xl-12 col-lg-12 col-sm-12 layout-spacing\"\r\n    v-for=\"item in items\"\r\n    :key=\"item.id\"\r\n  >\r\n    <!-- Item details table -->\r\n    <div class=\"custom-table table3 table-responsive\">\r\n      <table class=\"table table-bordered table-striped\">\r\n        <thead>\r\n          <tr>\r\n            <th>LPO No.</th>\r\n            <th>\r\n            <router-link :to=\"`/masters/requsition/${item.source_id}`\">\r\n              Req No.\r\n            </router-link>\r\n          </th>\r\n            <th>Requester</th>\r\n            <th>Date Requested</th>\r\n            <th>Purpose</th>\r\n            <th>Approval Chain</th>\r\n            <th v-if=\"item.project\">Project</th>\r\n            <th v-if=\"item.vendor\">\r\n              <span v-if=\"item.type.toLowerCase().includes('voucher')\">Beneficiary</span>\r\n              <span v-else>Vendor</span>\r\n            </th>\r\n            <th>Awaits</th>\r\n            <th>Cost</th>\r\n            <th>Status</th>\r\n            <th v-if=\"user_permissions.includes('can_print_lpo')\">Action</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          <tr>\r\n            <td>{{ item.id }}</td>\r\n            <td>{{ item.source_id }}</td>\r\n            <td @click=\"printTest(item,item.vendor_data)\">{{ item.requester }}</td>\r\n            <td>{{ item.date }}</td>\r\n            <td>{{ item.type }}</td>\r\n            <td>{{ item.purpose }}</td>\r\n            <td v-if=\"item.project\">{{ item.project }}</td>\r\n            <td v-if=\"item.vendor\">{{ item.vendor }}</td>\r\n            <td>{{ item.awaits }}</td>\r\n            <td>{{ item.cost }}</td>\r\n             <td> <span class=\"mb-0 badge\" :class=\"`badge-${item.status?.class}`\">\r\n                  {{ item.status?.key }}\r\n                </span>\r\n          </td>\r\n            <td>\r\n              <a v-if=\"user_permissions.includes('can_print_lpo')\" href=\"javascript:void(0);\" @click=\"printVoucher(item,item.vendor_data)\" class=\"text-success\">\r\n                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" fill=\"currentColor\" class=\"bi bi-printer\" viewBox=\"0 0 16 16\">\r\n    <path d=\"M2.5 8a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1z\"/>\r\n    <path d=\"M5 1a2 2 0 0 0-2 2v2H2a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h1v1a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-1h1a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-1V3a2 2 0 0 0-2-2H5zM4 3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v2H4V3zm1 5a2 2 0 0 0-2 2v1H2a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v-1a2 2 0 0 0-2-2H5zm7 2v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1z\"/>\r\n  </svg>\r\n              </a>\r\n            </td>\r\n          </tr>\r\n          <tr v-if=\"item.description\">\r\n            <td colspan=\"8\" class=\"text-start\"><b> Brief Description : </b> {{ item.description }}</td>\r\n          </tr>\r\n          <tr v-if=\"item.remark\">\r\n            <td colspan=\"8\" class=\"text-start\"> <b> Remark :  </b> {{ item.remark }}</td>\r\n          </tr>\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n\r\n   \r\n\r\n    <!-- Approval controls for this item -->\r\n    <div class=\"d-flex justify-content-center mb-2\"\r\n      v-if=\"user_role_id == item.awaiting_approval?.role_id && item.awaits !== 'no one'\">\r\n      <div class=\"btn-group\">\r\n        <button class=\"btn btn-primary me-2\" @click=\"setStatus(item.id, 3)\">Check</button>\r\n        <button class=\"btn btn-danger me-2\" @click=\"setStatus(item.id, 4)\">Reject</button>\r\n        <button class=\"btn btn-info\" @click=\"setStatus(item.id, 14)\">Remark</button>\r\n      </div>\r\n    </div>\r\n    <div v-if=\"statusMap[item.id]\" class=\"mb-2 text-center\">\r\n      <span\r\n        class=\"badge rounded-pill\"\r\n        :class=\"{\r\n          'bg-danger': statusMap[item.id] == 4,\r\n          'bg-success': statusMap[item.id] == 3,\r\n          'bg-info': statusMap[item.id] == 14\r\n        }\"\r\n        style=\"font-size: 1rem;\"\r\n      >\r\n        {{\r\n          statusMap[item.id] == 3\r\n            ? 'Check / Approve Request'\r\n            : statusMap[item.id] == 4\r\n            ? 'Reject Request'\r\n            : 'Fill Remark'\r\n        }}\r\n      </span>\r\n    </div>\r\n    <div class=\"input-group\" v-if=\"statusMap[item.id]\">\r\n      <input type=\"text\" class=\"form-control\"\r\n        :placeholder=\"statusMap[item.id] == 3 ? 'Enter Approval Remark' : statusMap[item.id] == 4 ? 'Enter Rejection Remark' : 'Enter Remark'\"\r\n        v-model=\"remarkMap[item.id]\"\r\n        @keyup.enter=\"onApproveClick(item)\">\r\n      <button\r\n        @click=\"onApproveClick(item)\"\r\n        class=\"btn btn-primary me-2\"\r\n        type=\"button\"\r\n        :disabled=\"loading_spinner\"\r\n      >\r\n        <span v-if=\"loading_spinner\" v-html=\"loadingSpinner()\"></span>\r\n        <span v-else>Save</span>\r\n      </button>\r\n    </div>\r\n\r\n     <!-- Approval chain table for this item -->\r\n    <div class=\"custom-table table3 table-responsive\">\r\n      <table class=\"table\">\r\n        <thead>\r\n          <tr>\r\n            <th v-for=\"chain in item.roles_sequence\" :key=\"chain.role_id || chain.position || chain.name\">\r\n              {{ chain.name }} <br/>\r\n            </th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          <tr>\r\n            <td\r\n              v-for=\"(role, idx) in item.roles_sequence\"\r\n              :key=\"role.role_id || role.position || idx\"\r\n              :class=\"role?.status?.color ? 'text-' + role.status.color : 'text-danger'\"\r\n            >\r\n              <span> {{ role?.status?.name ?? 'Unchecked' }}</span><br/>\r\n              <span class=\"text-dark\" v-if=\"role.approved_at\">Checked At :{{ formatDate(role.approved_at) }} </span>  <br>\r\n              <span class=\"text-dark\" v-if=\"role.remark\">Remark :  {{ role.remark }}</span>\r\n            </td>\r\n          </tr>\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n\r\n     <!-- approval items starts -->\r\n        <div class=\"col-xl-12 col-lg-12 col-sm-12 layout-spacing\">\r\n          <div class=\"panel p-0\">\r\n            <div class=\"custom-table table3\">\r\n              <v-client-table  :data=\"item.items.map((sub, i) => ({\r\n    Sno: i + 1,\r\n    item: sub.requisition_items?.remark,\r\n    description: sub.requisition_items?.description,\r\n    quantity: sub.requisition_items?.quantity,\r\n    rate: sub.requisition_items?.rate,\r\n    total: (sub.requisition_items?.quantity * sub.requisition_items?.rate).toLocaleString(),\r\n    asset_id: sub.requisition_items?.asset_id\r\n  }))\" :columns=\"itemColumns\" :options=\"table_option\">\r\n  <template #actions=\"props\">\r\n  \r\n  <router-link  :to=\"`/assets/fuel-statement/${props.row.asset_id}`\" @click=\"closeModal\" v-if =\"props.row.asset_id\">     \r\n                            <button class=\"btn btn-primary\">Diesel</button>\r\n                      </router-link> \r\n\r\n  </template>\r\n</v-client-table>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n  </div>\r\n</div>\r\n\r\n       <!-- loading spinner starts -->\r\n                 <div v-if=\"loading_spinner \" v-html=\"tableShimmer()\"></div>\r\n        <!-- Loading spinner ends -->\r\n\r\n\r\n\r\n</div>\r\n  <!-- modal ends -->\r\n</template>\r\n\r\n<style>\r\n.table3 .actions svg {\r\n  padding: 2px;\r\n}\r\n</style>\r\n\r\n<script setup>\r\nimport { onMounted, onBeforeUnmount, ref, inject, computed } from 'vue';\r\nimport axios from 'axios';\r\nimport { useMeta } from '@/composables/use-meta';\r\nimport router from '@/router';\r\nimport html2pdf from \"html2pdf.js\";\r\n\r\nuseMeta({ title: 'Approval Chains' });\r\n import { useRoute } from 'vue-router';\r\nconst route = useRoute();\r\nconst axiosInstance = axios.create({\r\n  baseURL: process.env.VUE_APP_API_BASE_URL\r\n});\r\nimport { watch } from 'vue';\r\n\r\nconst completeTransaction = async (id)=>{\r\n  const payload = {\r\n    status_id : 16\r\n  }\r\n  try{\r\n        loading.value = true\r\n    const response = await axiosInstance.put(`approval-lists/${id}`,payload)\r\n    showMessage('Transaction Completed')\r\n   getApprovalItems()\r\n    document.getElementById('close').click()\r\n  }catch(error){\r\n    showError(error.message)\r\n    console.log(error)\r\n  }finally{\r\n    loading.value = false\r\n  }\r\n}\r\n\r\nconst statusMap = ref({});\r\nconst remarkMap = ref({});\r\n\r\nfunction setStatus(itemId, value) {\r\n  statusMap.value[itemId] = value;\r\n}\r\nfunction setRemark(itemId, value) {\r\n  remarkMap.value[itemId] = value;\r\n}\r\n\r\nconst user_permissions = JSON.parse(localStorage.getItem(\"user\")).permissions;\r\nconst loading_spinner = ref(false);\r\nconst user_id = JSON.parse(localStorage.getItem(\"user\")).id\r\nconst total_amount = ref(0);\r\nconst user_role_id = ref(JSON.parse(localStorage.getItem('user')).role);\r\nconst columns = ref(['Sno','requisition', 'approval', 'purpose','type','requester','project','vendor', 'cost', 'status','date', 'awaits','actions']);\r\nconst itemColumns = ref(['Sno', 'item','description', 'quantity', 'rate', 'total','actions']);\r\nconst items = ref([]);\r\nconst requisitionItems = ref([]);\r\nconst table_option = ref({\r\n  perPage: 50,\r\n  perPageValues: [  50,100,200],\r\n  skin: 'table table-hover table-striped',\r\n  columnsClasses: { actions: 'actions text-center' },\r\n  sortable: ['id', 'service_name'],\r\n  sortIcon: { base: 'sort-icon-none', up: 'sort-icon-asc', down: 'sort-icon-desc' },\r\n  pagination: { nav: 'scroll', chunk: 5 },\r\n  texts: { count: 'Showing {from} to {to} of {count}', filter: '', filterPlaceholder: 'Search...', limit: 'Results:' },\r\n  resizableColumns: false,\r\n  headings: {\r\n    vendor: function() {\r\n      return isBeneficiaryGroup.value ? 'Beneficiary' : 'Vendor';\r\n    }\r\n  }\r\n});\r\n\r\n\r\n\r\nconst isBeneficiaryGroup = computed(() => {\r\n  return route.params.group_id == '4' || route.params.group_id == '8';\r\n});\r\n\r\n\r\n\r\n\r\n\r\nconst clearForm = () =>{\r\n  status.value = '',\r\n  remark.value = ''\r\n}\r\nconst showMessage = inject('showMessage');\r\nconst showError = inject('showError');\r\nconst formatNumber = inject('formatNumber');\r\nconst tableShimmer = inject('tableShimmer');\r\nconst formatDate = inject('formatDate');\r\nconst loadingSpinner = inject('loadingSpinner')\r\nconst approvalChain = ref([]);\r\nconst awaiter = ref({});\r\nconst awaiter_id = ref('');\r\nconst item_id = ref('');\r\nconst status = ref('')\r\n/** local flag you wanted */\r\nconst localChecked = ref(false);\r\n\r\n/** modal ref to reset flag when closed */\r\nconst approvalModal = ref(null);\r\nlet onHidden = null;\r\n// const loading_spinner = ref(false)\r\n\r\nconst getApprovalItems = async () => {\r\n  loading_spinner.value = true;\r\n  try {\r\n    let url = 'approval-lists';\r\n    if (route.params.group_id !== 'all') {\r\n      url += `?group_id=${route.params.group_id}`;\r\n    }\r\n\r\n    const response = await axiosInstance.get(url);\r\n    items.value = response.data.map((item, index) => {\r\n      let status = item.status;\r\n      if (item.last_checked_in?.status?.id == 4) {\r\n        status = {\r\n          name: item.last_checked_in.status.name,\r\n          color: item.last_checked_in.status.color\r\n        };\r\n      }\r\n\r\n      let awaits = item.awaiting_approval?.name || 'no one';\r\n      if (item.last_checked_in?.status?.id == 4) {\r\n        awaits = 'no one';\r\n      }\r\n\r\n      let awaiter_role_id = item.awaiting_approval?.role_id || null;\r\n      if (item.last_checked_in?.status?.id == 4) {\r\n        awaiter_role_id = null;\r\n      }\r\n\r\n      return {\r\n        ...item,\r\n         status: {\r\n          key: status.name,\r\n          class: status.color\r\n        },\r\n        Sno: index + 1,\r\n        latest_status_date: item.last_checked_in?.approved_at || item.last_checked_in?.remarked_at || item.last_checked_in?.rejected_at || item.date,\r\n        purpose: item.approval_group || 'N/A',\r\n        type: item.requisition_type || 'N/A',\r\n        approval: '0' + item.id,\r\n        requisition: item?.requisition_id ?? '',\r\n        requester: item.requester?.name || 'Unknown', // Add null check\r\n        requester_id: item.requester?.id || null,\r\n        awaits,\r\n        awaiter_role_id,\r\n        vendor: item.vendor?.name || item.beneficiary || 'N/A', // Add null checks\r\n        vendor_data: item.vendor || null,\r\n        date: formatDate(item.date),\r\n        created_at: item.date,\r\n        last_checked: formatDate(item.last_checked_in?.approved_at),\r\n        cost: item.items\r\n          ? formatNumber(item.items.reduce(\r\n              (sum, i) =>\r\n                sum +\r\n                ((i.requisition_items?.quantity || 0) *\r\n                  (i.requisition_items?.rate || 0)),\r\n              0\r\n            ))\r\n          : 0,\r\n        approved_at: item.last_checked_in?.approved_at\r\n          ? new Date(item.last_checked_in.approved_at).toLocaleString('en-GB', {\r\n              year: 'numeric',\r\n              month: '2-digit',\r\n              day: '2-digit',\r\n              hour: '2-digit',\r\n              minute: '2-digit',\r\n              second: '2-digit'\r\n            })\r\n          : null\r\n      };\r\n    });\r\n\r\n    items.value.sort((a, b) => {\r\n      const role = Number(user_role_id.value);\r\n      const aMatch = a.awaiter_role_id === role;\r\n      const bMatch = b.awaiter_role_id === role;\r\n\r\n      if (aMatch && !bMatch) return -1;\r\n      if (!aMatch && bMatch) return 1;\r\n      return 0;\r\n    });\r\n\r\n    items.value.sort((a, b) => {\r\n  const dateA = new Date(a.latest_status_date);\r\n  const dateB = new Date(b.latest_status_date);\r\n  return dateB - dateA;\r\n});\r\n\r\n  } catch (error) {\r\n    showError(error.message);\r\n    console.error(error);\r\n  } finally {\r\n    loading_spinner.value = false;\r\n  }\r\n};\r\n\r\n\r\n\r\n\r\nwatch(\r\n  () => route.params.group_id,\r\n  (newGroupId, oldGroupId) => {\r\n    if (newGroupId !== oldGroupId) {\r\n      getApprovalGroup()\r\n      getApprovalItems();\r\n    }\r\n  }\r\n);\r\n\r\nconst lastApprovalRole = ref('')\r\nconst requisition_source_item_id = ref(0)\r\nconst item_date =  ref('')\r\nconst awaits = ref('')\r\nconst item = ref('')\r\nconst getApprovalChain = (row) => {\r\n  requisitionItems.value = row.items.map((item, index) => ({\r\n    ...item,\r\n    Sno: index + 1,\r\n    item: item?.requisition_items?.remark,\r\n    description: item?.requisition_items?.description,\r\n    rate: Number(item?.requisition_items?.rate).toLocaleString() + '/=',\r\n    total: (item?.requisition_items?.quantity * item?.requisition_items?.rate).toLocaleString() + '/='\r\n  }));\r\n\r\n  awaits.value = row.awaits\r\n  approvalChain.value = (row.roles_sequence || []).slice();\r\n  lastApprovalRole.value = (row.roles_sequence?.length > 0)\r\n    ? row.roles_sequence[row.roles_sequence.length - 1].role_id\r\n    : null;\r\n  \r\n  // Add null checks here\r\n  awaiter.value = row.awaiting_approval || {};\r\n  awaiter_id.value = row.awaiting_approval?.role_id || null;\r\n  \r\n  item_id.value = row.id;\r\n  item_date.value = row.date;\r\n  requisition_source_item_id.value = row;\r\n  item.value = row;\r\n  localChecked.value = false;\r\n};\r\n\r\n\r\nconst remark = ref('')\r\nconst approveRequest = async () => {\r\n  const payload = {\r\n    subcontractor_agreement_id : item.value.subcontractor_agreement_id,\r\n    approval_group_id : route.params.group_id,\r\n    status_id : status.value,\r\n    approval_item_id: item_id.value,\r\n    role_id: user_role_id.value,\r\n    remark: remark.value,\r\n    last_role: lastApprovalRole.value,\r\n    requisition_type: requisition_source_item_id.value.requisition_type,\r\n    project : requisition_source_item_id.value,\r\n    requisition_items : requisition_source_item_id.value.items.map((item)=>({\r\n      source_id: item.requisition_items.item_id,\r\n      cost : item.requisition_items.quantity * item.requisition_items.rate,\r\n      description : item.requisition_items.description,\r\n      remark : \"From LPO NO : \" + item_id.value + \" created on date \" + item_date.value,\r\n      remarker_id : JSON.parse(localStorage.getItem('user')).id,\r\n      remarker : JSON.parse(localStorage.getItem('user')).name\r\n    }))\r\n  };\r\n\r\n// console.log(payload)\r\n// return ;\r\n  await axiosInstance.post('approval-chains', payload);\r\n  awaiter_id.value = '';\r\n  remark.value = ''\r\n  getApprovalItems();\r\n  showMessage('data saved successfully');\r\n};\r\n\r\n/** click handler: set flag true after approving */\r\nconst onApproveClick = async (item) => {\r\n  try {\r\n    loading_spinner.value = true;\r\n    \r\n    // Set the current item data before calling approveRequest\r\n    item_id.value = item.id;\r\n    requisition_source_item_id.value = item;\r\n    status.value = statusMap.value[item.id];\r\n    remark.value = remarkMap.value[item.id];\r\n    \r\n    // Add this line to set lastApprovalRole properly\r\n    lastApprovalRole.value = (item.roles_sequence?.length > 0)\r\n      ? item.roles_sequence[item.roles_sequence.length - 1].role_id\r\n      : null;\r\n    \r\n    await approveRequest();\r\n    showMessage('data saved successfully');\r\n    statusMap.value[item.id] = '';\r\n    remarkMap.value[item.id] = '';\r\n  } catch (error) {\r\n    showError(error.message);\r\n    console.error(error);\r\n  } finally {\r\n    loading_spinner.value = false;\r\n  }\r\n};\r\n\r\n\r\nconst printVoucher = async (voucher,vendor) => {\r\n  total_amount.value = voucher.items.reduce((acc, item) => acc + (item.requisition_items?.quantity * item.requisition_items?.rate), 0); // calculate total amount\r\n  try {\r\n    const iframe = document.createElement(\"iframe\");\r\n    iframe.style.display = \"none\";\r\n    document.body.appendChild(iframe);\r\n    const today = new Date();\r\n   const date = new Date(voucher.created_at)\r\n    const dateString = `${date.getDate().toString().padStart(2,'0')}/${(date.getMonth()+1).toString().padStart(2,'0')}`\r\n    const printContent = `\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n<title>Print Voucher</title>\r\n<style>\r\n  body { font-family: Arial, sans-serif; margin: 40px; font-size: 13px; }\r\n  .header { display: flex; justify-content: space-between; align-items: flex-start; }\r\n  .logo { width: 160px; height: auto; }\r\n  .voucher-box { border: 1px solid #000; padding: 5px 10px; font-weight: normal; font-size: 13px; text-align: center; margin-left: auto; border-radius: 5px; }\r\n  .company-title { text-align: center; margin-top: 10px; }\r\n  .company-title h2 { margin: 5px 0; }\r\n  .reg-info { position: absolute; top: 120px; right: 40px; text-align: right; font-size: 10px; line-height: 1.4; font-weight: normal; }\r\n  .section-title { text-align: center; font-weight: bold; text-decoration: underline; margin: 20px 0 10px 0; }\r\n  .title { text-align: center; font-weight: bold;  margin: 20px 0 10px 0; }\r\n  table { width: 100%; border-collapse: collapse; margin-top: 10px; border-radius: 4px; overflow: hidden; }\r\n  table.details td, table.items th, table.items td, .signatures th, .signatures td { border: 0.5px solid #000; padding: 6px; font-weight: normal; }\r\n  table.items thead tr th { background-color: #f8f8f8; border-bottom: 1px solid #000; }\r\n  .text-right { text-align: right; }\r\n  .text-center { text-align: center; }\r\n  .text-success { color: green; }\r\n .signature-area { margin-top: 30px; }\r\n  .signature-line { border-top: 1px solid #000; width: 200px; display: inline-block; margin-top: 50px; }\r\n  .text-danger { color: red; }\r\n  @media print { body { margin: 10mm; } .no-print { display: none; } }\r\n</style>\r\n</head>\r\n<body>\r\n<div class=\"header\">\r\n  <img src=\"https://bushman.ink/copex.jpg\" class=\"logo\" />\r\n  <div class=\"voucher-box\">\r\n    ${voucher.type.toLowerCase().includes('voucher') ? `Voucher`:'LPO'} NO:<br>\r\n    <span style=\"color:red;\">${(\"0000\" + voucher.requisition).slice(-4)}/${dateString}</span>\r\n  </div>\r\n</div>\r\n<div class=\"reg-info\">\r\n  TIN: 135-489-247<br>\r\n  VRN: 40-032826C\r\n</div>\r\n<div class=\"company-title\">\r\n  <h2>COPEX CONTRACTORS CO.LTD</h2>\r\n  <div>Msamvu, P.O.BOX 678, Morogoro</div>\r\n  <div>Mobile, 0713 000 777, 0657 111 555</div>\r\n</div>\r\n<div class=\"section-title\"> ${voucher?.purpose?.toUpperCase()  } DETAILS</div>\r\n\r\n<div class=\"title\">PROJECT :  ${voucher?.project?.toUpperCase() ?? \"NO PROJECT\" }</div>\r\n\r\n${!voucher.purpose.toLowerCase().includes('voucher') ? `\r\n\r\n\r\n<p><strong>Vendor Details </strong></p>\r\n<table class=\"items\">\r\n  <thead>\r\n    <tr>\r\n      <th>Vendor Name</th>\r\n      <th>Location</th>\r\n      <th>Email</th>\r\n      <th>Phone</th>\r\n      <th>Address</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n\r\n    <tr>\r\n      <td>${vendor?.name || '&nbsp;'}</td>\r\n      <td>${vendor?.location || ' '}</td>\r\n      <td class=\"text-right\">${vendor?.email || ' '}</td>\r\n      <td class=\"text-right\">${vendor?.phone || ' '}</td>\r\n      <td class=\"text-right\">${vendor?.address|| ' '}</td>\r\n    </tr>\r\n\r\n  </tbody>\r\n</table>\r\n    ` : ''}\r\n\r\n<p><strong>Please provide the following as per requisition details below</strong></p>\r\n<table class=\"items\">\r\n  <thead>\r\n    <tr>\r\n      <th>SN</th>\r\n      <th>Item</th>\r\n      <th>Description</th>\r\n      <th>Quantity</th>\r\n      <th>Rate</th>\r\n      <th>Total</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    ${voucher.items.map((item, index) => `\r\n    <tr>\r\n      <td>${index + 1}</td>\r\n      <td>${item.requisition_items?.remark || 'N/A'}</td>\r\n      <td>${item.requisition_items?.description || 'N/A'}</td>\r\n      <td class=\"text-right\">${item.requisition_items?.quantity || '0'}</td>\r\n      <td class=\"text-right\">${Number(item.requisition_items?.rate || 0).toLocaleString()}/=</td>\r\n      <td class=\"text-right\">${(item.requisition_items?.quantity * item.requisition_items?.rate || 0).toLocaleString()}/=</td>\r\n    </tr>\r\n\r\n    `\r\n  )\r\n    .join(\"\")}\r\n ${voucher.description? `\r\n  <tr>\r\n    <td colspan=\"6\" style=\"text-align:start;\">\r\n      Brief Description : ${voucher.description ?? ''}\r\n    </td>\r\n  </tr>\r\n` : ''}\r\n\r\n    <tr>\r\n     <td colspan=\"6\" style=\"text-align:right;\"><strong>TOTAL</strong>  <strong>${total_amount.value.toLocaleString()}/=</strong></td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<div class=\"section-title\">APPROVAL CHAIN</div>\r\n<table class=\"signatures\" style=\"margin-top: 20px;\">\r\n  <thead>\r\n    <tr>\r\n          ${voucher.roles_sequence.map(role => `\r\n      <th>${role.name || 'N/A'}</td>\r\n            `).join('')}\r\n    </tr>\r\n\r\n  </thead>\r\n  <tbody>\r\n    <tr>\r\n          ${voucher.roles_sequence.map(role => `\r\n      <td class=\"text-center ${role?.status?.id == 3 ? 'text-success' : 'text-danger'}\">${role?.status?.name ?? 'Pending'}</td>\r\n       `).join('')}\r\n      </tr>\r\n  </tbody>\r\n</table>\r\n\r\n\r\n\r\n${voucher.purpose.toLowerCase().includes('voucher') ? `\r\n<div class=\"signature-area\" style=\"display: flex; justify-content: space-between; margin-top: 20px;\">\r\n  <div style=\"text-align: center;\">\r\n    \r\n<div style=\"text-align: center; margin-top: 30px;\">\r\n  <!-- Beneficiary name above the line -->\r\n  <div style=\"margin-bottom: 5px;\">\r\n    <strong>${voucher.beneficiary || '&nbsp;'}</strong>\r\n  </div>\r\n\r\n  <!-- The signature line -->\r\n  <div style=\"border-bottom: 1px solid #000; width: 200px; margin: 0 auto;\"></div>\r\n</div>    <p>Received By: </p>\r\n  </div>\r\n  <div style=\"text-align: center;\">\r\n    <div class=\"signature-line\"></div>\r\n    <p>Receiver's Signature</p>\r\n  </div>\r\n  <div style=\"text-align: center;\">\r\n    <div class=\"signature-line\"></div>\r\n    <p>Received Date</p>\r\n  </div>\r\n</div>\r\n` : ''}\r\n</body>\r\n</html>\r\n`;\r\n\r\n    // Write content to iframe and print\r\n    const iframeDoc = iframe.contentWindow.document;\r\n    iframeDoc.open();\r\n    iframeDoc.write(printContent);\r\n    iframeDoc.close();\r\n\r\n    iframe.onload = () => {\r\n      iframe.contentWindow.focus();\r\n      iframe.contentWindow.print();\r\n      setTimeout(() => {\r\n        document.body.removeChild(iframe);\r\n      }, 1000);\r\n    };\r\n  } catch (error) {\r\n    showError(`Failed to print voucher: ${error.message}`);\r\n  }\r\n};\r\n\r\n\r\nconst printTest = async (voucher,vendor) => {\r\n  total_amount.value = voucher.items.reduce((acc, item) => acc + (item.requisition_items?.quantity * item.requisition_items?.rate), 0); // calculate total amount\r\n  try {\r\n    const iframe = document.createElement(\"iframe\");\r\n    iframe.style.display = \"none\";\r\n    document.body.appendChild(iframe);\r\n    const today = new Date();\r\n   const date = new Date(voucher.created_at)\r\n    const dateString = `${date.getDate().toString().padStart(2,'0')}/${(date.getMonth()+1).toString().padStart(2,'0')}`\r\n    const printContent = `\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n<title>Print Voucher</title>\r\n<style>\r\n  body { font-family: Arial, sans-serif; margin: 40px; font-size: 13px; }\r\n  .header {  display: flex; justify-content: space-between; align-items: flex-start;font-weight:bold }\r\n  .logo { width: 160px; height: auto; }\r\n  .text-style { font-family: 'Courier New', monospace; }\r\n  .voucher-box { border: 1px solid #000; padding: 5px 10px; font-weight: normal; font-size: 13px; text-align: center; margin-left: auto; border-radius: 5px; }\r\n  .company-title { text-align: center; margin-top: 10px; }\r\n  .company-title h2 { margin: 5px 0; }\r\n  .reg-info { position: absolute; top: 120px; right: 40px; text-align: right; font-size: 10px; line-height: 1.4; font-weight: normal; }\r\n  .section-title { text-align: center; font-weight: bold; text-decoration: underline; margin: 20px 0 10px 0; }\r\n  .title { text-align: center;   margin: 10px 0 10px 0; font-size:20px }\r\n  table { width: 100%; border-collapse: collapse; margin-top: 10px; border-radius: 4px; overflow: hidden; }\r\n  table.details td, table.items th, table.items td, .signatures th, .signatures td { border: 0.5px solid #000; padding: 6px; font-weight: normal; }\r\n  table.items thead tr th { background-color: #f8f8f8; border-bottom: 1px solid #000; }\r\n  .text-right { text-align: right; }\r\n  .text-center { text-align: center; }\r\n  .text-success { color: green; }\r\n .signature-area { margin-top: 30px; }\r\n  .signature-line { border-top: 1px solid #000; width: 200px; display: inline-block; margin-top: 50px; }\r\n  .text-danger { color: red; }\r\n  hr {\r\n  border: 0;\r\n  border-top: 0.4px solid #000 !important;\r\n  opacity: 1 !important;\r\n  margin: 0px 0;\r\n}\r\n\r\n  @media print { body { margin: 10mm; } .no-print { display: none; } }\r\n</style>\r\n</head>\r\n<body>\r\n<div class=\"text-style\">\r\n  ${voucher.purpose.toLowerCase().includes('voucher') ? `VOUCHER`:'LPO'}  NO. ${voucher.requisition}\r\n</div>\r\n<div class=\"company-title text-style\">\r\n  <i>\r\n  <h1>COPEX CONTRACTORS CO.LTD</h1>\r\n  <div><b>Address:</b> Msamvu, P.O.BOX 678, Morogoro</div>\r\n  <div><b>Tel:</b> , 0713 000 777, 0657 111 555</div>\r\n  <div><b>Email:</b> info@copexcontractors.co.tz</div>\r\n  <div><b>TIN:</b> 135-489-247    <b>VRN:</b> 40-032826C</div>\r\n  </i>\r\n</div>\r\n<hr style=\"margin-top:20px\">\r\n<div class=\"title text-style\">  ${voucher?.purpose?.toUpperCase()  } :  ${voucher?.project?.toUpperCase() ?? \"NO PROJECT\" }</div>\r\n<hr>\r\n${!voucher.purpose.toLowerCase().includes('voucher') ? `\r\n\r\n<div style=\"display:flex;justify-content:space-between;gap:20px;margin-top:10px;font-size:13px;\">\r\n  <div style=\"flex:1;border:1px solid #f0f0f0;padding:8px;\">\r\n  <table style=\"width:100%; border-collapse: collapse;\">\r\n  <tr><td style=\"background:#333; border-top:1px solid #000; border-right:1px solid #000; border-bottom:1px solid #000; padding:5px;width:2cm\">\r\n  <b>Vendor</b>\r\n</td>\r\n</tr>\r\n  <tr ><td>Name</td><td style=\"border-bottom:1px solid #000;\">${vendor?.name || ''}</td></tr>\r\n  <tr ><td>Address</td><td class=\"text-style\" style=\"border-bottom:1px solid #000;\">${vendor?.address || ''}</td></tr>\r\n  <tr ><td>City</td><td class=\"text-style\" style=\"border-bottom:1px solid #000;\">${vendor?.location || ''}</td></tr>\r\n  <tr ><td>Phone</td><td class=\"text-style\" style=\"border-bottom:1px solid #000;\">${vendor?.phone || ''}</td></tr>\r\n  <tr ><td >TIN</td><td class=\"text-style\" style=\"border-bottom:1px solid #000;\">${vendor?.tin || ''}</td></tr>\r\n  <tr ><td >VRN</td><td  class=\"text-style\" style=\"border-bottom:1px solid #000;\">${vendor?.vrn || ''}</td></tr>\r\n</table>\r\n\r\n  </div>\r\n  <div style=\"width:35%;border:1px solid #f0f0f0;padding:8px;margin-top:1cm\">\r\n    <table style=\"width:100%;border-collapse:collapse;\">\r\n      <tr><td class=\"text-style\"> ${voucher.purpose.toLowerCase().includes('voucher') ? `VOUCHER`:'LPO'} :</td><td class=\"text-style\">${voucher?.requisition || ''}</td></tr>\r\n      <tr><td class=\"text-style\"> ${voucher.purpose.toLowerCase().includes('voucher') ? `VOUCHER`:'LPO'} DATE:</td><td class=\"text-style\">${dateString}/${date.getFullYear()}</td></tr>\r\n      <tr><td class=\"text-style\">REQ:</td><td class=\"text-style\">${voucher?.id || ''}</td></tr>\r\n      <tr><td class=\"text-style\">REQ DATE:</td><td class=\"text-style\">${dateString}/${date.getFullYear()}</td></tr>\r\n      <tr><td class=\"text-style\">STATUS:</td><td class=\"text-style\">${voucher?.status.name || ''}</td></tr>\r\n      <tr><td class=\"text-style\">AWAITS:</td><td class=\"text-style\">${voucher?.awaits || ''}</td></tr>\r\n    </table>\r\n  </div>\r\n</div>\r\n<br>\r\n\r\n  </tbody>\r\n</table>\r\n    ` : ''}\r\n\r\n<p class=\"text-style\">Please provide the following as per requisition details below</p>\r\n<h2 class=\"text-style\">CURRENCY : TSH</h2>\r\n<table class=\"items\">\r\n  <thead>\r\n    <tr>\r\n      <th class=\"text-style\">No.</th>\r\n      <th class=\"text-style\">ITEM NAME</th>\r\n      <th class=\"text-style\">DESCRIPTION</th>\r\n      <th class=\"text-style\">QUANTITY</th>\r\n      <th class=\"text-style\">RATE</th>\r\n      <th class=\"text-style\">TOTAL</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    ${voucher.items.map((item, index) => `\r\n    <tr>\r\n      <td class=\"text-style\">${index + 1}</td>\r\n      <td class=\"text-style\">${item.requisition_items?.remark || 'N/A'}</td>\r\n      <td class=\"text-style\">${item.requisition_items?.description || 'N/A'}</td>\r\n      <td class=\"text-style text-right\">${item.requisition_items?.quantity || '0'}</td>\r\n      <td class=\" text-style text-right\">${Number(item.requisition_items?.rate || 0).toLocaleString()}/=</td>\r\n      <td class=\"text-style text-right\">${(item.requisition_items?.quantity * item.requisition_items?.rate || 0).toLocaleString()}/=</td>\r\n    </tr>\r\n\r\n    `\r\n  )\r\n    .join(\"\")}\r\n\r\n    <tr>\r\n     <td colspan=\"6\" class=\"text-style\" style=\"text-align:right;\"><strong>TOTAL</strong>  <strong>${total_amount.value.toLocaleString()}/=</strong></td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<h2 style=\"text-style\">Note : </h2>\r\n<p class=\"text-style\">${voucher.description ?? ''}</p>\r\n<div class=\"title text-style\" style=\"margin-top:40px\">APPROVAL CHAIN</div>\r\n<table class=\"signatures\" style=\"margin-top: 10px;\">\r\n  <tbody>\r\n    <tr>\r\n          ${voucher.roles_sequence.map(role => `\r\n      <td style=\"border-bottom:1px solid #000;border-top:1px solid #fff;border-right:1px solid #fff;border-left:1px solid #fff;\" class=\"text-center ${role?.status?.id == 3 ? 'text-success' : 'text-danger'}\">${role?.status?.name ?? 'Pending'}</td>\r\n       `).join('')}\r\n      </tr>\r\n  </tbody>\r\n    <tfooter>\r\n    <tr>\r\n          ${voucher.roles_sequence.map(role => `\r\n      <th style=\"border-bottom:1px solid #fff;border-top:1px solid #fff;border-right:55px solid #fff;border-left:1px solid #fff;\">${role.name || 'N/A'}</td>\r\n            `).join('')}\r\n    </tr>\r\n\r\n  </tfooter>\r\n</table>\r\n\r\n\r\n\r\n${voucher.purpose.toLowerCase().includes('voucher') ? `\r\n    <div class=\"title text-style\" style=\"margin-top:40px;margin-bottom:-20px\">BENEFICIARY</div>\r\n\r\n<div class=\"signature-area\" style=\"display: flex; justify-content: space-between; margin-top: 20px;\">\r\n  <div style=\"text-align: center;\">\r\n<div style=\"text-align: center; margin-top: 30px;\">\r\n  <!-- Beneficiary name above the line -->\r\n  <div class=\"text-style\" style=\"margin-bottom: 5px;\">\r\n    <strong>${voucher.beneficiary || '&nbsp;'}</strong>\r\n  </div>\r\n\r\n  <!-- The signature line -->\r\n  <div style=\"border-bottom: 1px solid #000; width: 200px; margin: 0 auto;\"></div>\r\n</div>    <p>Received By: </p>\r\n  </div>\r\n  <div style=\"text-align: center;\">\r\n    <div class=\"signature-line\"></div>\r\n    <p>Receiver's Signature</p>\r\n  </div>\r\n  <div style=\"text-align: center;\">\r\n    <div class=\"signature-line\"></div>\r\n    <p>Received Date</p>\r\n  </div>\r\n</div>\r\n` : ''}\r\n</body>\r\n</html>\r\n`;\r\n\r\n    // Write content to iframe and print\r\n    const iframeDoc = iframe.contentWindow.document;\r\n    iframeDoc.open();\r\n    iframeDoc.write(printContent);\r\n    iframeDoc.close();\r\n\r\n    iframe.onload = () => {\r\n      iframe.contentWindow.focus();\r\n      iframe.contentWindow.print();\r\n      setTimeout(() => {\r\n        document.body.removeChild(iframe);\r\n      }, 1000);\r\n    };\r\n  } catch (error) {\r\n    showError(`Failed to print voucher: ${error.message}`);\r\n  }\r\n};\r\n\r\n\r\n\r\n\r\nimport jsPDF from \"jspdf\";\r\nimport \"jspdf-autotable\";\r\nimport logo from \"@/assets/images/logo.jpg\";\r\n\r\nconst downloadApprovalItem = async (voucher, vendor) => {\r\n  try {\r\n    const totalAmount = voucher.items.reduce(\r\n      (acc, item) =>\r\n        acc + (item.requisition_items?.quantity * item.requisition_items?.rate || 0),\r\n      0\r\n    );\r\n\r\n    const today = new Date();\r\n    const date = today.getDate().toString().padStart(2, \"0\");\r\n    const month = (today.getMonth() + 1).toString().padStart(2, \"0\");\r\n    const dateString = `${date}/${month}`;\r\n\r\n    const doc = new jsPDF(\"p\", \"pt\", \"a4\");\r\n    let cursorY = 20;\r\n\r\n    const img = new Image();\r\n    img.src = logo;\r\n    img.onload = () => {\r\n      doc.addImage(img, \"PNG\", 40, cursorY, 160, 50);\r\n\r\n    // Voucher Ref box\r\ndoc.setDrawColor(0);\r\ndoc.rect(480, cursorY, 90, 40); // moved right and reduced size\r\ndoc.setFontSize(12);\r\ndoc.text(\"Ref NO:\", 500, cursorY + 15);\r\ndoc.setTextColor(255, 0, 0);\r\ndoc.text(\r\n  `${(\"0000\" + voucher.ref_no).slice(-4)}/${dateString}`,\r\n  500,\r\n  cursorY + 30\r\n);\r\ndoc.setTextColor(0);\r\n\r\n\r\n      doc.setFontSize(10);\r\n      doc.text(\"TIN: 103-826-519\", 400, cursorY + 65);\r\n      doc.text(\"VRN: 20-01-017530R\", 400, cursorY + 80);\r\n\r\n      cursorY += 100;\r\n\r\n      const pageWidth = doc.internal.pageSize.getWidth();\r\n\r\n      doc.setFontSize(16);\r\n      doc.setFont(undefined, \"bold\");\r\n      doc.text(\"COPEX CONTRACTORS CO.LTD\", pageWidth / 2, cursorY, { align: \"center\" });\r\n      cursorY += 15;\r\n      doc.setFontSize(10);\r\n      doc.setFont(undefined, \"normal\");\r\n      doc.text(\"Msamvu, P.O.BOX 678, Morogoro\", pageWidth / 2, cursorY, { align: \"center\" });\r\n      cursorY += 12;\r\n      doc.text(\"Mobile: 0713 000 777, 0657 111 555\", pageWidth / 2, cursorY, { align: \"center\" });\r\n      cursorY += 20;\r\n\r\n      doc.setFontSize(12);\r\n      doc.setFont(undefined, \"bold\");\r\n      doc.text(`${voucher.type.toUpperCase()} DETAILS`, pageWidth / 2, cursorY, { align: \"center\" });\r\n      cursorY += 20;\r\n\r\n      doc.autoTable({\r\n        startY: cursorY,\r\n        head: [[\"Vendor Name\", \"Location\", \"Email\", \"Phone\", \"Address\"]],\r\n        body: [[\r\n          vendor.name || \"N/A\",\r\n          vendor.location || \"N/A\",\r\n          vendor.email || \"N/A\",\r\n          vendor.phone || \"N/A\",\r\n          vendor.address || \"N/A\",\r\n        ]],\r\n        theme: \"grid\",\r\n        headStyles: { fillColor: [248, 248, 248], textColor: 0 },\r\n        styles: { fontSize: 10 },\r\n      });\r\n      cursorY = doc.lastAutoTable.finalY + 15;\r\n\r\n      const itemsBody = voucher.items.map((item, i) => [\r\n        i + 1,\r\n        item.requisition_items?.remark || \"N/A\",\r\n        item.requisition_items?.description || \"N/A\",\r\n        item.requisition_items?.quantity || 0,\r\n        Number(item.requisition_items?.rate || 0).toLocaleString(),\r\n        ((item.requisition_items?.quantity || 0) * (item.requisition_items?.rate || 0)).toLocaleString(),\r\n      ]);\r\n      itemsBody.push([{ content: \"TOTAL\", colSpan: 5, styles: { halign: \"right\", fontStyle: \"bold\" } }, totalAmount.toLocaleString()]);\r\n\r\n      doc.autoTable({\r\n        startY: cursorY,\r\n        head: [[\"SN\", \"Item\", \"Description\", \"Quantity\", \"Rate\", \"Total\"]],\r\n        body: itemsBody,\r\n        theme: \"grid\",\r\n        headStyles: { fillColor: [248, 248, 248], textColor: 0 },\r\n        styles: { fontSize: 10, halign: \"center\" },\r\n        columnStyles: { 0: { halign: \"center\" }, 1: { halign: \"left\" }, 2: { halign: \"left\" } },\r\n      });\r\n      cursorY = doc.lastAutoTable.finalY + 25;\r\n\r\n      doc.setFontSize(12);\r\n      doc.setFont(undefined, \"bold\");\r\n      doc.text(\"APPROVAL CHAIN\", pageWidth / 2, cursorY, { align: \"center\" });\r\n      cursorY += 10;\r\n\r\n      const approvalHead = voucher.roles_sequence.map(r => r.name || \"N/A\");\r\n      const approvalBody = [\r\n        voucher.roles_sequence.map(r => ({\r\n          content: r.checked ? \"Approved\" : \"Pending\",\r\n          styles: { halign: \"center\", textColor: r.checked ? [0, 128, 0] : [255, 0, 0] },\r\n        })),\r\n      ];\r\n\r\n      doc.autoTable({\r\n        startY: cursorY,\r\n        head: [approvalHead],\r\n        body: approvalBody,\r\n        theme: \"grid\",\r\n        headStyles: { fillColor: [248, 248, 248], textColor: 0 },\r\n        styles: { fontSize: 10 },\r\n      });\r\n\r\n      doc.save(`voucher_${voucher.ref_no}.pdf`);\r\n    };\r\n  } catch (error) {\r\n    console.error(`Failed to generate voucher: ${error.message}`);\r\n    throw error;\r\n  }\r\n};\r\n\r\n\r\n\r\n/** UI helper: first cell reflects local flag, others from data if any */\r\nconst isChecked = (idx, role) => {\r\n  if (idx === 0 && localChecked.value) return true;\r\n  return !!role?.checked;\r\n};\r\n\r\nconst approvalGroup = ref('')\r\nconst getApprovalGroup = async() =>{\r\n  approvalGroup.value = '';\r\n  if (!route.params.group_id || route.params.group_id === 'undefined') {\r\n    return; // Don't make the request if group_id is missing\r\n  }\r\n  const response = await axiosInstance.get(`approval-groups/${route.params.group_id}`);\r\n  approvalGroup.value = response.data;\r\n}\r\nonMounted(() => {\r\n  getApprovalGroup()\r\n  getApprovalItems();\r\n\r\n  if (approvalModal.value) {\r\n    onHidden = () => {\r\n      localChecked.value = false;\r\n      spinner.value = false;\r\n    };\r\n    approvalModal.value.addEventListener('hidden.bs.modal', onHidden);\r\n  }\r\n});\r\n\r\nonBeforeUnmount(() => {\r\n  if (approvalModal.value && onHidden) {\r\n    approvalModal.value.removeEventListener('hidden.bs.modal', onHidden);\r\n  }\r\n});\r\n</script>\r\n","import script from \"./sheet.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./sheet.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./sheet.vue?vue&type=style&index=0&id=649d4fc5&lang=css\"\n\nconst __exports__ = script;\n\nexport default __exports__"],"names":["useMeta","title","route","useRoute","axiosInstance","axios","baseURL","process","statusMap","ref","remarkMap","setStatus","itemId","value","user_permissions","JSON","parse","localStorage","getItem","permissions","loading_spinner","total_amount","id","user_role_id","role","itemColumns","items","table_option","perPage","perPageValues","skin","columnsClasses","actions","sortable","sortIcon","base","up","down","pagination","nav","chunk","texts","count","filter","filterPlaceholder","limit","resizableColumns","headings","vendor","isBeneficiaryGroup","computed","params","group_id","showMessage","inject","showError","formatNumber","tableShimmer","formatDate","loadingSpinner","awaiter_id","item_id","status","localChecked","approvalModal","onHidden","getApprovalItems","async","url","response","get","data","map","item","index","last_checked_in","name","color","awaits","awaiting_approval","awaiter_role_id","role_id","key","class","Sno","latest_status_date","approved_at","remarked_at","rejected_at","date","purpose","approval_group","type","requisition_type","approval","requisition","requisition_id","requester","requester_id","beneficiary","vendor_data","created_at","last_checked","cost","reduce","sum","i","requisition_items","quantity","rate","Date","toLocaleString","year","month","day","hour","minute","second","sort","a","b","Number","aMatch","bMatch","dateA","dateB","error","message","console","watch","newGroupId","oldGroupId","getApprovalGroup","lastApprovalRole","requisition_source_item_id","item_date","remark","approveRequest","payload","subcontractor_agreement_id","approval_group_id","status_id","approval_item_id","last_role","project","source_id","description","remarker_id","remarker","post","onApproveClick","roles_sequence","length","printVoucher","voucher","acc","iframe","document","createElement","style","display","body","appendChild","dateString","getDate","toString","padStart","getMonth","printContent","toLowerCase","includes","slice","toUpperCase","location","email","phone","address","join","iframeDoc","contentWindow","open","write","close","onload","focus","print","setTimeout","removeChild","printTest","tin","vrn","getFullYear","approvalGroup","onMounted","spinner","addEventListener","onBeforeUnmount","removeEventListener","__exports__"],"sourceRoot":""}